var Xv=Object.defineProperty,Kv=Object.defineProperties;var Hv=Object.getOwnPropertyDescriptors;var Xc=Object.getOwnPropertySymbols;var Vm=Object.prototype.hasOwnProperty,$m=Object.prototype.propertyIsEnumerable;var jm=(r,t,e)=>t in r?Xv(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,sh=(r,t)=>{for(var e in t||(t={}))Vm.call(t,e)&&jm(r,e,t[e]);if(Xc)for(var e of Xc(t))$m.call(t,e)&&jm(r,e,t[e]);return r},oh=(r,t)=>Kv(r,Hv(t));var lh=(r,t)=>{var e={};for(var n in r)Vm.call(r,n)&&t.indexOf(n)<0&&(e[n]=r[n]);if(r!=null&&Xc)for(var n of Xc(r))t.indexOf(n)<0&&$m.call(r,n)&&(e[n]=r[n]);return e};var Wv=function(){function r(){this.disposed=!1}return r.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},r.prototype.disposeInternal=function(){},r}(),Kc=Wv,Yv=function(){function r(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}return r.prototype.preventDefault=function(){this.defaultPrevented=!0},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r}(),As=Yv;function Yf(r,t){return r>t?1:r<t?-1:0}function Jf(r,t,e){var n=r.length;if(r[0]<=t)return 0;if(t<=r[n-1])return n-1;var s=void 0;if(e>0){for(s=1;s<n;++s)if(r[s]<t)return s-1}else if(e<0){for(s=1;s<n;++s)if(r[s]<=t)return s}else for(s=1;s<n;++s){if(r[s]==t)return s;if(r[s]<t)return typeof e=="function"?e(t,r[s-1],r[s])>0?s-1:s:r[s-1]-t<t-r[s]?s-1:s}return n-1}function Jv(r,t){for(var e=Array.isArray(t)?t:[t],n=e.length,s=0;s<n;s++)r[r.length]=e[s]}function Zm(r,t){var e=r.length;if(e!==t.length)return!1;for(var n=0;n<e;n++)if(r[n]!==t[n])return!1;return!0}function Qv(r,t,e){var n=t||Yf;return r.every(function(s,u){if(u===0)return!0;var g=n(r[u-1],s);return!(g>0||e&&g===0)})}function hh(){return!0}function Hc(){return!1}function ch(){}function ex(r){var t=!1,e,n,s;return function(){var u=Array.prototype.slice.call(arguments);return(!t||this!==s||!Zm(u,n))&&(t=!0,s=this,n=u,e=r.apply(this,arguments)),e}}var vi=typeof Object.assign=="function"?Object.assign:function(r,t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(r),n=1,s=arguments.length;n<s;++n){var u=arguments[n];if(u!=null)for(var g in u)u.hasOwnProperty(g)&&(e[g]=u[g])}return e};function uh(r){for(var t in r)delete r[t]}var tx=typeof Object.values=="function"?Object.values:function(r){var t=[];for(var e in r)t.push(r[e]);return t};function rx(r){var t;for(t in r)return!1;return!t}var ix=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),nx=function(r){ix(t,r);function t(e){var n=r.call(this)||this;return n.eventTarget_=e,n.pendingRemovals_=null,n.dispatching_=null,n.listeners_=null,n}return t.prototype.addEventListener=function(e,n){if(!(!e||!n)){var s=this.listeners_||(this.listeners_={}),u=s[e]||(s[e]=[]);u.indexOf(n)===-1&&u.push(n)}},t.prototype.dispatchEvent=function(e){var n=typeof e=="string"?new As(e):e,s=n.type;n.target||(n.target=this.eventTarget_||this);var u=this.listeners_&&this.listeners_[s],g;if(u){var h=this.dispatching_||(this.dispatching_={}),b=this.pendingRemovals_||(this.pendingRemovals_={});s in h||(h[s]=0,b[s]=0),++h[s];for(var T=0,C=u.length;T<C;++T)if("handleEvent"in u[T]?g=u[T].handleEvent(n):g=u[T].call(this,n),g===!1||n.propagationStopped){g=!1;break}if(--h[s],h[s]===0){var P=b[s];for(delete b[s];P--;)this.removeEventListener(s,ch);delete h[s]}return g}},t.prototype.disposeInternal=function(){this.listeners_&&uh(this.listeners_)},t.prototype.getListeners=function(e){return this.listeners_&&this.listeners_[e]||void 0},t.prototype.hasListener=function(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1},t.prototype.removeEventListener=function(e,n){var s=this.listeners_&&this.listeners_[e];if(s){var u=s.indexOf(n);u!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(s[u]=ch,++this.pendingRemovals_[e]):(s.splice(u,1),s.length===0&&delete this.listeners_[e]))}},t}(Kc),Io=nx,wt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"},jt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function lr(){return function(){throw new Error("Unimplemented abstract method.")}()}var ax=0;function ga(r){return r.ol_uid||(r.ol_uid=String(++ax))}var sx="6.9.0";function qm(r){return Math.pow(r,3)}function Po(r){return 1-qm(1-r)}function ox(r){return 3*r*r-2*r*r*r}function lx(r){return r}var hx=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),cx=function(r){hx(t,r);function t(e,n,s){var u=r.call(this)||this,g=s||{};return u.tileCoord=e,u.state=n,u.interimTile=null,u.key="",u.transition_=g.transition===void 0?250:g.transition,u.transitionStarts_={},u}return t.prototype.changed=function(){this.dispatchEvent(wt.CHANGE)},t.prototype.release=function(){},t.prototype.getKey=function(){return this.key+"/"+this.tileCoord},t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(e.getState()==jt.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this},t.prototype.refreshInterimChain=function(){if(!!this.interimTile){var e=this.interimTile,n=this;do{if(e.getState()==jt.LOADED){e.interimTile=null;break}else e.getState()==jt.LOADING?n=e:e.getState()==jt.IDLE?n.interimTile=e.interimTile:n=e;e=n.interimTile}while(e)}},t.prototype.getTileCoord=function(){return this.tileCoord},t.prototype.getState=function(){return this.state},t.prototype.setState=function(e){if(this.state!==jt.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()},t.prototype.load=function(){lr()},t.prototype.getAlpha=function(e,n){if(!this.transition_)return 1;var s=this.transitionStarts_[e];if(!s)s=n,this.transitionStarts_[e]=s;else if(s===-1)return 1;var u=n-s+1e3/60;return u>=this.transition_?1:qm(u/this.transition_)},t.prototype.inTransition=function(e){return this.transition_?this.transitionStarts_[e]!==-1:!1},t.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)},t}(Io),Xm=cx,ux=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),fx=function(r){ux(t,r);function t(e){var n=this,s=jt.IDLE;return n=r.call(this,e.tileCoord,s,{transition:e.transition})||this,n.loader_=e.loader,n.data_=null,n.error_=null,n}return t.prototype.getData=function(){return this.data_},t.prototype.getError=function(){return this.error_},t.prototype.load=function(){this.state=jt.LOADING,this.changed();var e=this;this.loader_().then(function(n){e.data_=n,e.state=jt.LOADED,e.changed()}).catch(function(n){e.error_=n,e.state=jt.ERROR,e.changed()})},t}(Xm),dx=fx,Qf={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Ro={PROPERTYCHANGE:"propertychange"};function hr(r,t,e,n,s){if(n&&n!==r&&(e=e.bind(n)),s){var u=e;e=function(){r.removeEventListener(t,e),u.apply(this,arguments)}}var g={target:r,type:t,listener:e};return r.addEventListener(t,e),g}function Wc(r,t,e,n){return hr(r,t,e,n,!0)}function jr(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),uh(r))}var px=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Yc=function(r){px(t,r);function t(){var e=r.call(this)||this;return e.on=e.onInternal,e.once=e.onceInternal,e.un=e.unInternal,e.revision_=0,e}return t.prototype.changed=function(){++this.revision_,this.dispatchEvent(wt.CHANGE)},t.prototype.getRevision=function(){return this.revision_},t.prototype.onInternal=function(e,n){if(Array.isArray(e)){for(var s=e.length,u=new Array(s),g=0;g<s;++g)u[g]=hr(this,e[g],n);return u}else return hr(this,e,n)},t.prototype.onceInternal=function(e,n){var s;if(Array.isArray(e)){var u=e.length;s=new Array(u);for(var g=0;g<u;++g)s[g]=Wc(this,e[g],n)}else s=Wc(this,e,n);return n.ol_key=s,s},t.prototype.unInternal=function(e,n){var s=n.ol_key;if(s)mx(s);else if(Array.isArray(e))for(var u=0,g=e.length;u<g;++u)this.removeEventListener(e[u],n);else this.removeEventListener(e,n)},t}(Io);Yc.prototype.on;Yc.prototype.once;Yc.prototype.un;function mx(r){if(Array.isArray(r))for(var t=0,e=r.length;t<e;++t)jr(r[t]);else jr(r)}var Km=Yc,Hm=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Wm=function(r){Hm(t,r);function t(e,n,s){var u=r.call(this,e)||this;return u.key=n,u.oldValue=s,u}return t}(As),gx=function(r){Hm(t,r);function t(e){var n=r.call(this)||this;return n.on,n.once,n.un,ga(n),n.values_=null,e!==void 0&&n.setProperties(e),n}return t.prototype.get=function(e){var n;return this.values_&&this.values_.hasOwnProperty(e)&&(n=this.values_[e]),n},t.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},t.prototype.getProperties=function(){return this.values_&&vi({},this.values_)||{}},t.prototype.hasProperties=function(){return!!this.values_},t.prototype.notify=function(e,n){var s;s="change:"+e,this.dispatchEvent(new Wm(s,e,n)),s=Ro.PROPERTYCHANGE,this.dispatchEvent(new Wm(s,e,n))},t.prototype.addChangeListener=function(e,n){this.addEventListener("change:"+e,n)},t.prototype.removeChangeListener=function(e,n){this.removeEventListener("change:"+e,n)},t.prototype.set=function(e,n,s){var u=this.values_||(this.values_={});if(s)u[e]=n;else{var g=u[e];u[e]=n,g!==n&&this.notify(e,g)}},t.prototype.setProperties=function(e,n){for(var s in e)this.set(s,e[s],n)},t.prototype.applyProperties=function(e){!e.values_||vi(this.values_||(this.values_={}),e.values_)},t.prototype.unset=function(e,n){if(this.values_&&e in this.values_){var s=this.values_[e];delete this.values_[e],rx(this.values_)&&(this.values_=null),n||this.notify(e,s)}},t}(Km),_a=gx,zn={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},_n={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},_x={"9001":_n.METERS,"9002":_n.FEET,"9003":_n.USFEET,"9101":_n.RADIANS,"9102":_n.DEGREES};function Ym(r){return _x[r]}var ja={};ja[_n.RADIANS]=6370997/(2*Math.PI);ja[_n.DEGREES]=2*Math.PI*6370997/360;ja[_n.FEET]=.3048;ja[_n.METERS]=1;ja[_n.USFEET]=1200/3937;var fh=_n,yx=function(){function r(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}return r.prototype.canWrapX=function(){return this.canWrapX_},r.prototype.getCode=function(){return this.code_},r.prototype.getExtent=function(){return this.extent_},r.prototype.getUnits=function(){return this.units_},r.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ja[this.units_]},r.prototype.getWorldExtent=function(){return this.worldExtent_},r.prototype.getAxisOrientation=function(){return this.axisOrientation_},r.prototype.isGlobal=function(){return this.global_},r.prototype.setGlobal=function(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)},r.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},r.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t},r.prototype.setExtent=function(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)},r.prototype.setWorldExtent=function(t){this.worldExtent_=t},r.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t},r.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},r}(),Jc=yx;function oi(r,t,e){return Math.min(Math.max(r,t),e)}var vx=function(){var r;return"cosh"in Math?r=Math.cosh:r=function(t){var e=Math.exp(t);return(e+1/e)/2},r}(),xx=function(){var r;return"log2"in Math?r=Math.log2:r=function(t){return Math.log(t)*Math.LOG2E},r}();function bx(r,t,e,n,s,u){var g=s-e,h=u-n;if(g!==0||h!==0){var b=((r-e)*g+(t-n)*h)/(g*g+h*h);b>1?(e=s,n=u):b>0&&(e+=g*b,n+=h*b)}return ko(r,t,e,n)}function ko(r,t,e,n){var s=e-r,u=n-t;return s*s+u*u}function wx(r){return r*180/Math.PI}function Ex(r){return r*Math.PI/180}function ed(r,t){var e=r%t;return e*t<0?e+t:e}function Tx(r,t,e){return r+e*(t-r)}var Mx=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),dh=6378137,Do=Math.PI*dh,Sx=[-Do,-Do,Do,Do],Ax=[-180,-85,180,85],Qc=dh*Math.log(Math.tan(Math.PI/2)),Lo=function(r){Mx(t,r);function t(e){return r.call(this,{code:e,units:fh.METERS,extent:Sx,global:!0,worldExtent:Ax,getPointResolution:function(n,s){return n/vx(s[1]/dh)}})||this}return t}(Jc),Jm=[new Lo("EPSG:3857"),new Lo("EPSG:102100"),new Lo("EPSG:102113"),new Lo("EPSG:900913"),new Lo("http://www.opengis.net/def/crs/EPSG/0/3857"),new Lo("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Cx(r,t,e){var n=r.length,s=e>1?e:2,u=t;u===void 0&&(s>2?u=r.slice():u=new Array(n));for(var g=0;g<n;g+=s){u[g]=Do*r[g]/180;var h=dh*Math.log(Math.tan(Math.PI*(+r[g+1]+90)/360));h>Qc?h=Qc:h<-Qc&&(h=-Qc),u[g+1]=h}return u}function Ix(r,t,e){var n=r.length,s=e>1?e:2,u=t;u===void 0&&(s>2?u=r.slice():u=new Array(n));for(var g=0;g<n;g+=s)u[g]=180*r[g]/Do,u[g+1]=360*Math.atan(Math.exp(r[g+1]/dh))/Math.PI-90;return u}var Px=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Rx=6378137,Qm=[-180,-90,180,90],kx=Math.PI*Rx/180,Cs=function(r){Px(t,r);function t(e,n){return r.call(this,{code:e,units:fh.DEGREES,extent:Qm,axisOrientation:n,global:!0,metersPerUnit:kx,worldExtent:Qm})||this}return t}(Jc),eg=[new Cs("CRS:84"),new Cs("EPSG:4326","neu"),new Cs("urn:ogc:def:crs:OGC:1.3:CRS84"),new Cs("urn:ogc:def:crs:OGC:2:84"),new Cs("http://www.opengis.net/def/crs/OGC/1.3/CRS84","neu"),new Cs("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Cs("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],td={};function Dx(r){return td[r]||td[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Lx(r,t){td[r]=t}var Oo={};function eu(r,t,e){var n=r.getCode(),s=t.getCode();n in Oo||(Oo[n]={}),Oo[n][s]=e}function Ox(r,t){var e;return r in Oo&&t in Oo[r]&&(e=Oo[r][t]),e}var ph={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},li={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},zx=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Fx=function(r){zx(t,r);function t(e){var n=this,s="v"+sx.split("-")[0],u="Assertion failed. See https://openlayers.org/en/"+s+"/doc/errors/#"+e+" for details.";return n=r.call(this,u)||this,n.code=e,n.name="AssertionError",n.message=u,n}return t}(Error),tg=Fx;function Yt(r,t){if(!r)throw new tg(t)}function Bx(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function rg(r,t,e){var n,s;return t<r[0]?n=r[0]-t:r[2]<t?n=t-r[2]:n=0,e<r[1]?s=r[1]-e:r[3]<e?s=e-r[3]:s=0,n*n+s*s}function Nx(r,t){return ig(r,t[0],t[1])}function Ux(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function ig(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function ng(r,t){var e=r[0],n=r[1],s=r[2],u=r[3],g=t[0],h=t[1],b=li.UNKNOWN;return g<e?b=b|li.LEFT:g>s&&(b=b|li.RIGHT),h<n?b=b|li.BELOW:h>u&&(b=b|li.ABOVE),b===li.UNKNOWN&&(b=li.INTERSECTING),b}function rd(){return[1/0,1/0,-1/0,-1/0]}function zo(r,t,e,n,s){return s?(s[0]=r,s[1]=t,s[2]=e,s[3]=n,s):[r,t,e,n]}function tu(r){return zo(1/0,1/0,-1/0,-1/0,r)}function Gx(r,t){var e=r[0],n=r[1];return zo(e,n,e,n,t)}function Vx(r,t,e,n,s){var u=tu(s);return sg(u,r,t,e,n)}function ag(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function sg(r,t,e,n,s){for(;e<n;e+=s)$x(r,t[e],t[e+1]);return r}function $x(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function jx(r,t){var e;return e=t(og(r)),e||(e=t(lg(r)),e)||(e=t(hg(r)),e)||(e=t(ad(r)),e)?e:!1}function og(r){return[r[0],r[1]]}function lg(r){return[r[2],r[1]]}function mh(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function Zx(r,t){var e;return t===ph.BOTTOM_LEFT?e=og(r):t===ph.BOTTOM_RIGHT?e=lg(r):t===ph.TOP_LEFT?e=ad(r):t===ph.TOP_RIGHT?e=hg(r):Yt(!1,13),e}function id(r,t,e,n,s){var u=t*n[0]/2,g=t*n[1]/2,h=Math.cos(e),b=Math.sin(e),T=u*h,C=u*b,P=g*h,R=g*b,U=r[0],j=r[1],H=U-T+R,re=U-T-R,ge=U+T-R,ce=U+T+R,be=j-C-P,we=j-C+P,Ae=j+C+P,De=j+C-P;return zo(Math.min(H,re,ge,ce),Math.min(be,we,Ae,De),Math.max(H,re,ge,ce),Math.max(be,we,Ae,De),s)}function Za(r){return r[3]-r[1]}function nd(r,t,e){var n=e||rd();return cg(r,t)?(r[0]>t[0]?n[0]=r[0]:n[0]=t[0],r[1]>t[1]?n[1]=r[1]:n[1]=t[1],r[2]<t[2]?n[2]=r[2]:n[2]=t[2],r[3]<t[3]?n[3]=r[3]:n[3]=t[3]):tu(n),n}function ad(r){return[r[0],r[3]]}function hg(r){return[r[2],r[3]]}function qa(r){return r[2]-r[0]}function cg(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function sd(r){return r[2]<r[0]||r[3]<r[1]}function qx(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function Xx(r,t,e){var n=!1,s=ng(r,t),u=ng(r,e);if(s===li.INTERSECTING||u===li.INTERSECTING)n=!0;else{var g=r[0],h=r[1],b=r[2],T=r[3],C=t[0],P=t[1],R=e[0],U=e[1],j=(U-P)/(R-C),H=void 0,re=void 0;!!(u&li.ABOVE)&&!(s&li.ABOVE)&&(H=R-(U-T)/j,n=H>=g&&H<=b),!n&&!!(u&li.RIGHT)&&!(s&li.RIGHT)&&(re=U-(R-b)*j,n=re>=h&&re<=T),!n&&!!(u&li.BELOW)&&!(s&li.BELOW)&&(H=R-(U-h)/j,n=H>=g&&H<=b),!n&&!!(u&li.LEFT)&&!(s&li.LEFT)&&(re=U-(R-g)*j,n=re>=h&&re<=T)}return n}var ru={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};function Kx(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function od(r,t){for(var e=!0,n=r.length-1;n>=0;--n)if(r[n]!=t[n]){e=!1;break}return e}function ld(r,t){var e=Math.cos(t),n=Math.sin(t),s=r[0]*e-r[1]*n,u=r[1]*e+r[0]*n;return r[0]=s,r[1]=u,r}function Hx(r,t){return r[0]*=t,r[1]*=t,r}function Wx(r,t){if(t.canWrapX()){var e=qa(t.getExtent()),n=Yx(r,t,e);n&&(r[0]-=n*e)}return r}function Yx(r,t,e){var n=t.getExtent(),s=0;if(t.canWrapX()&&(r[0]<n[0]||r[0]>n[2])){var u=e||qa(n);s=Math.floor((r[0]-n[0])/u)}return s}function hd(r,t,e){var n;if(t!==void 0){for(var s=0,u=r.length;s<u;++s)t[s]=r[s];n=t}else n=r.slice();return n}function Jx(r,t,e){if(t!==void 0&&r!==t){for(var n=0,s=r.length;n<s;++n)t[n]=r[n];r=t}return r}function Qx(r){Lx(r.getCode(),r),eu(r,r,hd)}function e1(r){r.forEach(Qx)}function Fn(r){return typeof r=="string"?Dx(r):r||null}function ug(r){e1(r),r.forEach(function(t){r.forEach(function(e){t!==e&&eu(t,e,hd)})})}function t1(r,t,e,n){r.forEach(function(s){t.forEach(function(u){eu(s,u,e),eu(u,s,n)})})}function cd(r,t){return r?typeof r=="string"?Fn(r):r:Fn(t)}function zP(r,t){return dg(r,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function r1(r,t){var e=dg(r,t!==void 0?t:"EPSG:3857","EPSG:4326"),n=e[0];return(n<-180||n>180)&&(e[0]=ed(n+180,360)-180),e}function i1(r,t){if(r===t)return!0;var e=r.getUnits()===t.getUnits();if(r.getCode()===t.getCode())return e;var n=fg(r,t);return n===hd&&e}function fg(r,t){var e=r.getCode(),n=t.getCode(),s=Ox(e,n);return s||(s=Jx),s}function ud(r,t){var e=Fn(r),n=Fn(t);return fg(e,n)}function dg(r,t,e){var n=ud(t,e);return n(r,void 0,r.length)}var n1=null;function a1(){return n1}function iu(r,t){return r}function ya(r,t){return r}function pg(r,t){return r}function gh(r,t){return r}function s1(){ug(Jm),ug(eg),t1(eg,Jm,Cx,Ix)}s1();var o1=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),l1=function(r){o1(t,r);function t(e){var n=r.call(this)||this;n.projection=Fn(e.projection),n.attributions_=mg(e.attributions),n.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,n.loading=!1,n.state_=e.state!==void 0?e.state:zn.READY,n.wrapX_=e.wrapX!==void 0?e.wrapX:!1,n.viewResolver=null,n.viewRejector=null;var s=n;return n.viewPromise_=new Promise(function(u,g){s.viewResolver=u,s.viewRejector=g}),n}return t.prototype.getAttributions=function(){return this.attributions_},t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},t.prototype.getProjection=function(){return this.projection},t.prototype.getResolutions=function(){return lr()},t.prototype.getView=function(){return this.viewPromise_},t.prototype.getState=function(){return this.state_},t.prototype.getWrapX=function(){return this.wrapX_},t.prototype.getContextOptions=function(){},t.prototype.refresh=function(){this.changed()},t.prototype.setAttributions=function(e){this.attributions_=mg(e),this.changed()},t.prototype.setState=function(e){this.state_=e,this.changed()},t}(_a);function mg(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}var h1=l1,c1=function(){function r(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return r.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},r.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},r.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)},r.prototype.forEach=function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer},r.prototype.get=function(t,e){var n=this.entries_[t];return Yt(n!==void 0,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_},r.prototype.remove=function(t){var e=this.entries_[t];return Yt(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_},r.prototype.getCount=function(){return this.count_},r.prototype.getKeys=function(){var t=new Array(this.count_),e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t},r.prototype.getValues=function(){var t=new Array(this.count_),e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t},r.prototype.peekLast=function(){return this.oldest_.value_},r.prototype.peekLastKey=function(){return this.oldest_.key_},r.prototype.peekFirstKey=function(){return this.newest_.key_},r.prototype.pop=function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_},r.prototype.replace=function(t,e){this.get(t),this.entries_[t].value_=e},r.prototype.set=function(t,e){Yt(!(t in this.entries_),16);var n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_},r.prototype.setSize=function(t){this.highWaterMark=t},r}(),gg=c1;function nu(r,t,e,n){return n!==void 0?(n[0]=r,n[1]=t,n[2]=e,n):[r,t,e]}function au(r,t,e){return r+"/"+t+"/"+e}function su(r){return au(r[0],r[1],r[2])}function u1(r){return r.split("/").map(Number)}function f1(r,t){var e=r[0],n=r[1],s=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;var u=t.getFullTileRange(e);return u?u.containsXY(n,s):!0}var d1=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),p1=function(r){d1(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.expireCache=function(e){for(;this.canExpireCache();){var n=this.peekLast();if(n.getKey()in e)break;this.pop().release()}},t.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var e=this.peekFirstKey(),n=u1(e),s=n[0];this.forEach(function(u){u.tileCoord[0]!==s&&(this.remove(su(u.tileCoord)),u.release())}.bind(this))}},t}(gg),m1=p1,_g=function(){function r(t,e,n,s){this.minX=t,this.maxX=e,this.minY=n,this.maxY=s}return r.prototype.contains=function(t){return this.containsXY(t[1],t[2])},r.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY},r.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY},r.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY},r.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)},r.prototype.getHeight=function(){return this.maxY-this.minY+1},r.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},r.prototype.getWidth=function(){return this.maxX-this.minX+1},r.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY},r}();function Fo(r,t,e,n,s){return s!==void 0?(s.minX=r,s.maxX=t,s.minY=e,s.maxY=n,s):new _g(r,t,e,n)}var yg=_g,g1=42,fd=256;function vg(r){return r[0]>0&&r[1]>0}function _1(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function yn(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}var y1=[0,0,0],v1=function(){function r(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,Yt(Qv(this.resolutions_,function(g,h){return h-g},!0),17);var e;if(!t.origins){for(var n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,Yt(this.origins_.length==this.resolutions_.length,20));var u=t.extent;u!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=ad(u)),Yt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,Yt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:fd,Yt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=u!==void 0?u:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(g,h){var b=new yg(Math.min(0,g[0]),Math.max(g[0]-1,-1),Math.min(0,g[1]),Math.max(g[1]-1,-1));if(u){var T=this.getTileRangeForExtentAndZ(u,h);b.minX=Math.max(T.minX,b.minX),b.maxX=Math.min(T.maxX,b.maxX),b.minY=Math.max(T.minY,b.minY),b.maxY=Math.min(T.maxY,b.maxY)}return b},this):u&&this.calculateTileRanges_(u)}return r.prototype.forEachTileCoord=function(t,e,n){for(var s=this.getTileRangeForExtentAndZ(t,e),u=s.minX,g=s.maxX;u<=g;++u)for(var h=s.minY,b=s.maxY;h<=b;++h)n([e,u,h])},r.prototype.forEachTileCoordParentTileRange=function(t,e,n,s){var u,g,h,b=null,T=t[0]-1;for(this.zoomFactor_===2?(g=t[1],h=t[2]):b=this.getTileCoordExtent(t,s);T>=this.minZoom;){if(this.zoomFactor_===2?(g=Math.floor(g/2),h=Math.floor(h/2),u=Fo(g,g,h,h,n)):u=this.getTileRangeForExtentAndZ(b,T,n),e(T,u))return!0;--T}return!1},r.prototype.getExtent=function(){return this.extent_},r.prototype.getMaxZoom=function(){return this.maxZoom},r.prototype.getMinZoom=function(){return this.minZoom},r.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]},r.prototype.getResolution=function(t){return this.resolutions_[t]},r.prototype.getResolutions=function(){return this.resolutions_},r.prototype.getTileCoordChildTileRange=function(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){var s=t[1]*2,u=t[2]*2;return Fo(s,s+1,u,u+1,e)}var g=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(g,t[0]+1,e)}return null},r.prototype.getTileRangeForTileCoordAndZ=function(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;var s=t[0],u=t[1],g=t[2];if(e===s)return Fo(u,g,u,g,n);if(this.zoomFactor_){var h=Math.pow(this.zoomFactor_,e-s),b=Math.floor(u*h),T=Math.floor(g*h);if(e<s)return Fo(b,b,T,T,n);var C=Math.floor(h*(u+1))-1,P=Math.floor(h*(g+1))-1;return Fo(b,C,T,P,n)}var R=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(R,e,n)},r.prototype.getTileRangeExtent=function(t,e,n){var s=this.getOrigin(t),u=this.getResolution(t),g=yn(this.getTileSize(t),this.tmpSize_),h=s[0]+e.minX*g[0]*u,b=s[0]+(e.maxX+1)*g[0]*u,T=s[1]+e.minY*g[1]*u,C=s[1]+(e.maxY+1)*g[1]*u;return zo(h,T,b,C,n)},r.prototype.getTileRangeForExtentAndZ=function(t,e,n){var s=y1;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,s);var u=s[1],g=s[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,s),Fo(u,s[1],g,s[2],n)},r.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=yn(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*n,e[1]-(t[2]+.5)*s[1]*n]},r.prototype.getTileCoordExtent=function(t,e){var n=this.getOrigin(t[0]),s=this.getResolution(t[0]),u=yn(this.getTileSize(t[0]),this.tmpSize_),g=n[0]+t[1]*u[0]*s,h=n[1]-(t[2]+1)*u[1]*s,b=g+u[0]*s,T=h+u[1]*s;return zo(g,h,b,T,e)},r.prototype.getTileCoordForCoordAndResolution=function(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)},r.prototype.getTileCoordForXYAndResolution_=function(t,e,n,s,u){var g=this.getZForResolution(n),h=n/this.getResolution(g),b=this.getOrigin(g),T=yn(this.getTileSize(g),this.tmpSize_),C=s?.5:0,P=s?.5:0,R=Math.floor((t-b[0])/n+C),U=Math.floor((b[1]-e)/n+P),j=h*R/T[0],H=h*U/T[1];return s?(j=Math.ceil(j)-1,H=Math.ceil(H)-1):(j=Math.floor(j),H=Math.floor(H)),nu(g,j,H,u)},r.prototype.getTileCoordForXYAndZ_=function(t,e,n,s,u){var g=this.getOrigin(n),h=this.getResolution(n),b=yn(this.getTileSize(n),this.tmpSize_),T=s?.5:0,C=s?.5:0,P=Math.floor((t-g[0])/h+T),R=Math.floor((g[1]-e)/h+C),U=P/b[0],j=R/b[1];return s?(U=Math.ceil(U)-1,j=Math.ceil(j)-1):(U=Math.floor(U),j=Math.floor(j)),nu(n,U,j,u)},r.prototype.getTileCoordForCoordAndZ=function(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)},r.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]},r.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]},r.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null},r.prototype.getZForResolution=function(t,e){var n=Jf(this.resolutions_,t,e||0);return oi(n,this.minZoom,this.maxZoom)},r.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,n=new Array(e),s=this.minZoom;s<e;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n},r}(),dd=v1;function x1(r){var t=r.getDefaultTileGrid();return t||(t=T1(r),r.setDefaultTileGrid(t)),t}function b1(r,t,e){var n=t[0],s=r.getTileCoordCenter(t),u=pd(e);if(Nx(u,s))return t;var g=qa(u),h=Math.ceil((u[0]-s[0])/g);return s[0]+=g*h,r.getTileCoordForCoordAndZ(s,n)}function w1(r,t,e,n){var s=n!==void 0?n:ph.TOP_LEFT,u=xg(r,t,e);return new dd({extent:r,origin:Zx(r,s),resolutions:u,tileSize:e})}function E1(r){var t=r||{},e=t.extent||Fn("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:xg(e,t.maxZoom,t.tileSize,t.maxResolution)};return new dd(n)}function xg(r,t,e,n){for(var s=t!==void 0?t:g1,u=Za(r),g=qa(r),h=yn(e!==void 0?e:fd),b=n>0?n:Math.max(g/h[0],u/h[1]),T=s+1,C=new Array(T),P=0;P<T;++P)C[P]=b/Math.pow(2,P);return C}function T1(r,t,e,n){var s=pd(r);return w1(s,t,e,n)}function pd(r){r=Fn(r);var t=r.getExtent();if(!t){var e=180*ja[fh.DEGREES]/r.getMetersPerUnit();t=zo(-e,-e,e,e)}return t}var bg=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),M1=function(r){bg(t,r);function t(e){var n=r.call(this,{attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX})||this;n.on,n.once,n.un,n.opaque_=e.opaque!==void 0?e.opaque:!1,n.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,n.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;var s=[256,256],u=e.tileGrid;return u&&yn(u.getTileSize(u.getMinZoom()),s),n.tileCache=new m1(e.cacheSize||0),n.tmpSize=[0,0],n.key_=e.key||"",n.tileOptions={transition:e.transition},n.zDirection=e.zDirection?e.zDirection:0,n}return t.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},t.prototype.expireCache=function(e,n){var s=this.getTileCacheForProjection(e);s&&s.expireCache(n)},t.prototype.forEachLoadedTile=function(e,n,s,u){var g=this.getTileCacheForProjection(e);if(!g)return!1;for(var h=!0,b,T,C,P=s.minX;P<=s.maxX;++P)for(var R=s.minY;R<=s.maxY;++R)T=au(n,P,R),C=!1,g.containsKey(T)&&(b=g.get(T),C=b.getState()===jt.LOADED,C&&(C=u(b)!==!1)),C||(h=!1);return h},t.prototype.getGutterForProjection=function(e){return 0},t.prototype.getKey=function(){return this.key_},t.prototype.setKey=function(e){this.key_!==e&&(this.key_=e,this.changed())},t.prototype.getOpaque=function(e){return this.opaque_},t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},t.prototype.getTile=function(e,n,s,u,g){return lr()},t.prototype.getTileGrid=function(){return this.tileGrid},t.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:x1(e)},t.prototype.getTileCacheForProjection=function(e){return Yt(i1(this.getProjection(),e),68),this.tileCache},t.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_},t.prototype.getTilePixelSize=function(e,n,s){var u=this.getTileGridForProjection(s),g=this.getTilePixelRatio(n),h=yn(u.getTileSize(e),this.tmpSize);return g==1?h:_1(h,g,this.tmpSize)},t.prototype.getTileCoordForTileUrlFunction=function(e,n){var s=n!==void 0?n:this.getProjection(),u=this.getTileGridForProjection(s);return this.getWrapX()&&s.isGlobal()&&(e=b1(u,e,s)),f1(e,u)?e:null},t.prototype.clear=function(){this.tileCache.clear()},t.prototype.refresh=function(){this.clear(),r.prototype.refresh.call(this)},t.prototype.updateCacheSize=function(e,n){var s=this.getTileCacheForProjection(n);e>s.highWaterMark&&(s.highWaterMark=e)},t.prototype.useTile=function(e,n,s,u){},t}(h1),S1=function(r){bg(t,r);function t(e,n){var s=r.call(this,e)||this;return s.tile=n,s}return t}(As),A1=M1,C1=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),I1=function(r){C1(t,r);function t(e){var n=this,s=e.projection===void 0?"EPSG:3857":e.projection,u=e.tileGrid;return u===void 0&&s&&(u=E1({extent:pd(s),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),n=r.call(this,{cacheSize:.1,projection:s,tileGrid:u,opaque:e.opaque,state:e.state,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition})||this,n.tileLoadingKeys_={},n.loader_=e.loader,n.handleTileChange_=n.handleTileChange_.bind(n),n.bandCount=e.bandCount===void 0?4:e.bandCount,n}return t.prototype.setLoader=function(e){this.loader_=e},t.prototype.getTile=function(e,n,s,u,g){var h=au(e,n,s);if(this.tileCache.containsKey(h))return this.tileCache.get(h);var b=this.loader_;function T(){return b(e,n,s)}var C=new dx(vi({tileCoord:[e,n,s],loader:T},this.tileOptions));return C.key=this.getKey(),C.addEventListener(wt.CHANGE,this.handleTileChange_),this.tileCache.set(h,C),C},t.prototype.handleTileChange_=function(e){var n=e.target,s=ga(n),u=n.getState(),g;u==jt.LOADING?(this.tileLoadingKeys_[s]=!0,g=Qf.TILELOADSTART):s in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[s],g=u==jt.ERROR?Qf.TILELOADERROR:u==jt.LOADED?Qf.TILELOADEND:void 0),g&&this.dispatchEvent(new S1(g,n))},t}(A1),P1=I1;const wg=new ArrayBuffer(4),R1=new Float32Array(wg),k1=new Uint32Array(wg),Bn=new Uint32Array(512),Nn=new Uint32Array(512);for(let r=0;r<256;++r){const t=r-127;t<-27?(Bn[r]=0,Bn[r|256]=32768,Nn[r]=24,Nn[r|256]=24):t<-14?(Bn[r]=1024>>-t-14,Bn[r|256]=1024>>-t-14|32768,Nn[r]=-t-1,Nn[r|256]=-t-1):t<=15?(Bn[r]=t+15<<10,Bn[r|256]=t+15<<10|32768,Nn[r]=13,Nn[r|256]=13):t<128?(Bn[r]=31744,Bn[r|256]=64512,Nn[r]=24,Nn[r|256]=24):(Bn[r]=31744,Bn[r|256]=64512,Nn[r]=13,Nn[r|256]=13)}const ou=new Uint32Array(2048),Is=new Uint32Array(64),lu=new Uint32Array(64);ou[0]=0;for(let r=1;r<1024;++r){let t=r<<13,e=0;for(;(t&8388608)==0;)e-=8388608,t<<=1;t&=~8388608,e+=947912704,ou[r]=t|e}for(let r=1024;r<2048;++r)ou[r]=939524096+(r-1024<<13);Is[0]=0;for(let r=1;r<31;++r)Is[r]=r<<23;Is[31]=1199570944;Is[32]=2147483648;for(let r=33;r<63;++r)Is[r]=2147483648+(r-32<<23);Is[63]=3347054592;lu[0]=0;for(let r=1;r<64;++r)r===32?lu[r]=0:lu[r]=1024;function D1(r){const t=r>>10;return k1[0]=ou[lu[t]+(r&1023)]+Is[t],R1[0]}const L1=Reflect.getOwnPropertyDescriptor(Reflect.getPrototypeOf(Uint8Array).prototype,Symbol.toStringTag).get;function O1(r){return L1.call(r)!==void 0}function z1(r){return!(!ArrayBuffer.isView(r)||O1(r))}function Eg(r,t,...e){if(!z1(r))throw new TypeError("First argument to getFloat16 function must be a DataView");return D1(r.getUint16(t,...e))}var F1=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function B1(r,t,e){const n=e&&e.debug||!1;n&&console.log("getting "+t+" in "+r);const s=typeof r=="object"?r.outer:r,u=`${t}\\="([^"]*)"`;n&&console.log("pattern:",u);const h=new RegExp(u).exec(s);if(n&&console.log("match:",h),h)return h[1]}var Tg=B1;function N1(r,t,e){const s=new RegExp(t).exec(r.slice(e));return s?e+s.index:-1}var U1=N1;const md=U1;function G1(r,t,e){const n=e&&e.debug||!1,s=e&&e.startIndex||0;n&&console.log("starting findTagByName with",t," and ",e);const u=md(r,`<${t}[ >]`,s);if(n&&console.log("start:",u),u===-1)return;const g=r.slice(u+t.length);let h=md(g,"[ /]"+t+">",0);const b=h===-1;b&&(h=md(g,"[ /]>",0));const T=u+t.length+h+1+(b?0:t.length)+1;if(n&&console.log("end:",T),T===-1)return;const C=r.slice(u,T);let P;return b?P=null:P=C.slice(C.indexOf(">")+1,C.lastIndexOf("<")),{inner:P,outer:C,start:u,end:T}}var V1=G1;const $1=V1;function j1(r,t,e){const n=[],s=e&&e.debug||!1;let u=e&&e.startIndex||0,g;for(;g=$1(r,t,{debug:s,startIndex:u});)u=g.end,n.push(g);return s&&console.log("findTagsByName found",n.length,"tags"),n}var Z1=j1;const _h={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Un={};for(const r in _h)_h.hasOwnProperty(r)&&(Un[_h[r]]=parseInt(r,10));const q1=[Un.BitsPerSample,Un.ExtraSamples,Un.SampleFormat,Un.StripByteCounts,Un.StripOffsets,Un.StripRowCounts,Un.TileByteCounts,Un.TileOffsets,Un.SubIFDs],gd={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Mt={};for(const r in gd)gd.hasOwnProperty(r)&&(Mt[gd[r]]=parseInt(r,10));const Hi={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},X1={Unspecified:0,Assocalpha:1,Unassalpha:2},FP={Version:0,AddCompression:1},BP={None:0,Deflate:1},hu={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},K1={};for(const r in hu)hu.hasOwnProperty(r)&&(K1[hu[r]]=parseInt(r,10));function H1(r,t){const{width:e,height:n}=r,s=new Uint8Array(e*n*3);let u;for(let g=0,h=0;g<r.length;++g,h+=3)u=256-r[g]/t*256,s[h]=u,s[h+1]=u,s[h+2]=u;return s}function W1(r,t){const{width:e,height:n}=r,s=new Uint8Array(e*n*3);let u;for(let g=0,h=0;g<r.length;++g,h+=3)u=r[g]/t*256,s[h]=u,s[h+1]=u,s[h+2]=u;return s}function Y1(r,t){const{width:e,height:n}=r,s=new Uint8Array(e*n*3),u=t.length/3,g=t.length/3*2;for(let h=0,b=0;h<r.length;++h,b+=3){const T=r[h];s[b]=t[T]/65536*256,s[b+1]=t[T+u]/65536*256,s[b+2]=t[T+g]/65536*256}return s}function J1(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let s=0,u=0;s<r.length;s+=4,u+=3){const g=r[s],h=r[s+1],b=r[s+2],T=r[s+3];n[u]=255*((255-g)/256)*((255-T)/256),n[u+1]=255*((255-h)/256)*((255-T)/256),n[u+2]=255*((255-b)/256)*((255-T)/256)}return n}function Q1(r){const{width:t,height:e}=r,n=new Uint8ClampedArray(t*e*3);for(let s=0,u=0;s<r.length;s+=3,u+=3){const g=r[s],h=r[s+1],b=r[s+2];n[u]=g+1.402*(b-128),n[u+1]=g-.34414*(h-128)-.71414*(b-128),n[u+2]=g+1.772*(h-128)}return n}const eb=.95047,tb=1,rb=1.08883;function ib(r){const{width:t,height:e}=r,n=new Uint8Array(t*e*3);for(let s=0,u=0;s<r.length;s+=3,u+=3){const g=r[s+0],h=r[s+1]<<24>>24,b=r[s+2]<<24>>24;let T=(g+16)/116,C=h/500+T,P=T-b/200,R,U,j;C=eb*(C*C*C>.008856?C*C*C:(C-16/116)/7.787),T=tb*(T*T*T>.008856?T*T*T:(T-16/116)/7.787),P=rb*(P*P*P>.008856?P*P*P:(P-16/116)/7.787),R=C*3.2406+T*-1.5372+P*-.4986,U=C*-.9689+T*1.8758+P*.0415,j=C*.0557+T*-.204+P*1.057,R=R>.0031308?1.055*R**(1/2.4)-.055:12.92*R,U=U>.0031308?1.055*U**(1/2.4)-.055:12.92*U,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,n[u]=Math.max(0,Math.min(1,R))*255,n[u+1]=Math.max(0,Math.min(1,U))*255,n[u+2]=Math.max(0,Math.min(1,j))*255}return n}const Mg=new Map;function Ps(r,t){Array.isArray(r)||(r=[r]),r.forEach(e=>Mg.set(e,t))}async function nb(r){const t=Mg.get(r.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const e=await t();return new e(r)}Ps([void 0,1],()=>import("./raw.2483ba67.js").then(r=>r.default));Ps(5,()=>import("./lzw.87ab191f.js").then(r=>r.default));Ps(6,()=>{throw new Error("old style JPEG compression is not supported.")});Ps(7,()=>import("./jpeg.35385e90.js").then(r=>r.default));Ps([8,32946],()=>import("./deflate.318ef6ba.js").then(r=>r.default));Ps(32773,()=>import("./packbits.9b36fb03.js").then(r=>r.default));Ps(34887,()=>import("./lerc.bda254b2.js").then(r=>r.default));function cu(r,t,e,n=1){return new(Object.getPrototypeOf(r)).constructor(t*e*n)}function ab(r,t,e,n,s){const u=t/n,g=e/s;return r.map(h=>{const b=cu(h,n,s);for(let T=0;T<s;++T){const C=Math.min(Math.round(g*T),e-1);for(let P=0;P<n;++P){const R=Math.min(Math.round(u*P),t-1),U=h[C*t+R];b[T*n+P]=U}}return b})}function Bo(r,t,e){return(1-e)*r+e*t}function sb(r,t,e,n,s){const u=t/n,g=e/s;return r.map(h=>{const b=cu(h,n,s);for(let T=0;T<s;++T){const C=g*T,P=Math.floor(C),R=Math.min(Math.ceil(C),e-1);for(let U=0;U<n;++U){const j=u*U,H=j%1,re=Math.floor(j),ge=Math.min(Math.ceil(j),t-1),ce=h[P*t+re],be=h[P*t+ge],we=h[R*t+re],Ae=h[R*t+ge],De=Bo(Bo(ce,be,H),Bo(we,Ae,H),C%1);b[T*n+U]=De}}return b})}function ob(r,t,e,n,s,u="nearest"){switch(u.toLowerCase()){case"nearest":return ab(r,t,e,n,s);case"bilinear":case"linear":return sb(r,t,e,n,s);default:throw new Error(`Unsupported resampling method: '${u}'`)}}function lb(r,t,e,n,s,u){const g=t/n,h=e/s,b=cu(r,n,s,u);for(let T=0;T<s;++T){const C=Math.min(Math.round(h*T),e-1);for(let P=0;P<n;++P){const R=Math.min(Math.round(g*P),t-1);for(let U=0;U<u;++U){const j=r[C*t*u+R*u+U];b[T*n*u+P*u+U]=j}}}return b}function hb(r,t,e,n,s,u){const g=t/n,h=e/s,b=cu(r,n,s,u);for(let T=0;T<s;++T){const C=h*T,P=Math.floor(C),R=Math.min(Math.ceil(C),e-1);for(let U=0;U<n;++U){const j=g*U,H=j%1,re=Math.floor(j),ge=Math.min(Math.ceil(j),t-1);for(let ce=0;ce<u;++ce){const be=r[P*t*u+re*u+ce],we=r[P*t*u+ge*u+ce],Ae=r[R*t*u+re*u+ce],De=r[R*t*u+ge*u+ce],it=Bo(Bo(be,we,H),Bo(Ae,De,H),C%1);b[T*n*u+U*u+ce]=it}}}return b}function cb(r,t,e,n,s,u,g="nearest"){switch(g.toLowerCase()){case"nearest":return lb(r,t,e,n,s,u);case"bilinear":case"linear":return hb(r,t,e,n,s,u);default:throw new Error(`Unsupported resampling method: '${g}'`)}}function ub(r,t,e){let n=0;for(let s=t;s<e;++s)n+=r[s];return n}function _d(r,t,e){switch(r){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function fb(r,t){return(r===1||r===2)&&t<=32&&t%8==0?!1:!(r===3&&(t===16||t===32||t===64))}function db(r,t,e,n,s,u,g){const h=new DataView(r),b=e===2?g*u:g*u*n,T=e===2?1:n,C=_d(t,s,b),P=parseInt("1".repeat(s),2);if(t===1){let R;e===1?R=n*s:R=s;let U=u*R;(U&7)!=0&&(U=U+7&~7);for(let j=0;j<g;++j){const H=j*U;for(let re=0;re<u;++re){const ge=H+re*T*s;for(let ce=0;ce<T;++ce){const be=ge+ce*s,we=(j*u+re)*T+ce,Ae=Math.floor(be/8),De=be%8;if(De+s<=8)C[we]=h.getUint8(Ae)>>8-s-De&P;else if(De+s<=16)C[we]=h.getUint16(Ae)>>16-s-De&P;else if(De+s<=24){const it=h.getUint16(Ae)<<8|h.getUint8(Ae+2);C[we]=it>>24-s-De&P}else C[we]=h.getUint32(Ae)>>32-s-De&P}}}}return C.buffer}class pb{constructor(t,e,n,s,u,g){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=s,this.tiles=u?{}:null,this.isTiled=!t.StripOffsets;const h=t.PlanarConfiguration;if(this.planarConfiguration=typeof h=="undefined"?1:h,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=g}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel!="undefined"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip!="undefined"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,u){return Eg(this,s,u)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),s=this.getBitsPerSample(t);return _d(n,s,e)}async getTileOrStrip(t,e,n,s,u){const g=Math.ceil(this.getWidth()/this.getTileWidth()),h=Math.ceil(this.getHeight()/this.getTileHeight());let b;const{tiles:T}=this;this.planarConfiguration===1?b=e*g+t:this.planarConfiguration===2&&(b=n*g*h+e*g+t);let C,P;this.isTiled?(C=this.fileDirectory.TileOffsets[b],P=this.fileDirectory.TileByteCounts[b]):(C=this.fileDirectory.StripOffsets[b],P=this.fileDirectory.StripByteCounts[b]);const R=(await this.source.fetch([{offset:C,length:P}],u))[0];let U;return T===null||!T[b]?(U=(async()=>{let j=await s.decode(this.fileDirectory,R);const H=this.getSampleFormat(),re=this.getBitsPerSample();return fb(H,re)&&(j=db(j,H,this.planarConfiguration,this.getSamplesPerPixel(),re,this.getTileWidth(),this.getBlockHeight(e))),j})(),T!==null&&(T[b]=U)):U=T[b],{x:t,y:e,sample:n,data:await U}}async _readRaster(t,e,n,s,u,g,h,b,T){const C=this.getTileWidth(),P=this.getTileHeight(),R=this.getWidth(),U=this.getHeight(),j=Math.max(Math.floor(t[0]/C),0),H=Math.min(Math.ceil(t[2]/C),Math.ceil(R/C)),re=Math.max(Math.floor(t[1]/P),0),ge=Math.min(Math.ceil(t[3]/P),Math.ceil(U/P)),ce=t[2]-t[0];let be=this.getBytesPerPixel();const we=[],Ae=[];for(let ze=0;ze<e.length;++ze)this.planarConfiguration===1?we.push(ub(this.fileDirectory.BitsPerSample,0,e[ze])/8):we.push(0),Ae.push(this.getReaderForSample(e[ze]));const De=[],{littleEndian:it}=this;for(let ze=re;ze<ge;++ze)for(let lt=j;lt<H;++lt)for(let ct=0;ct<e.length;++ct){const Rt=ct,Bt=e[ct];this.planarConfiguration===2&&(be=this.getSampleByteSize(ct));const Kt=this.getTileOrStrip(lt,ze,Bt,u,T);De.push(Kt),Kt.then(Ht=>{const At=Ht.data,qe=new DataView(At),Ut=this.getBlockHeight(Ht.y),Zt=Ht.y*P,Er=Ht.x*C,nr=Zt+Ut,qr=(Ht.x+1)*C,Fi=Ae[Rt],ci=Math.min(Ut,Ut-(nr-t[3]),U-Zt),Nr=Math.min(C,C-(qr-t[2]),R-Er);for(let Ur=Math.max(0,t[1]-Zt);Ur<ci;++Ur)for(let Rr=Math.max(0,t[0]-Er);Rr<Nr;++Rr){const ri=(Ur*C+Rr)*be,ui=Fi.call(qe,ri+we[Rt],it);let Gr;s?(Gr=(Ur+Zt-t[1])*ce*e.length+(Rr+Er-t[0])*e.length+Rt,n[Gr]=ui):(Gr=(Ur+Zt-t[1])*ce+Rr+Er-t[0],n[Rt][Gr]=ui)}})}if(await Promise.all(De),g&&t[2]-t[0]!==g||h&&t[3]-t[1]!==h){let ze;return s?ze=cb(n,t[2]-t[0],t[3]-t[1],g,h,e.length,b):ze=ob(n,t[2]-t[0],t[3]-t[1],g,h,b),ze.width=g,ze.height=h,ze}return n.width=g||t[2]-t[0],n.height=h||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:s=null,width:u,height:g,resampleMethod:h,fillValue:b,signal:T}={}){const C=t||[0,0,this.getWidth(),this.getHeight()];if(C[0]>C[2]||C[1]>C[3])throw new Error("Invalid subsets");const P=C[2]-C[0],R=C[3]-C[1],U=P*R,j=this.getSamplesPerPixel();if(!e||!e.length)for(let ce=0;ce<j;++ce)e.push(ce);else for(let ce=0;ce<e.length;++ce)if(e[ce]>=j)return Promise.reject(new RangeError(`Invalid sample index '${e[ce]}'.`));let H;if(n){const ce=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,be=Math.max.apply(null,this.fileDirectory.BitsPerSample);H=_d(ce,be,U*e.length),b&&H.fill(b)}else{H=[];for(let ce=0;ce<e.length;++ce){const be=this.getArrayForSample(e[ce],U);Array.isArray(b)&&ce<b.length?be.fill(b[ce]):b&&!Array.isArray(b)&&be.fill(b),H.push(be)}}const re=s||await nb(this.fileDirectory);return await this._readRaster(C,e,H,n,re,u,g,h,T)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:s,height:u,resampleMethod:g,enableAlpha:h=!1,signal:b}={}){const T=t||[0,0,this.getWidth(),this.getHeight()];if(T[0]>T[2]||T[1]>T[3])throw new Error("Invalid subsets");const C=this.fileDirectory.PhotometricInterpretation;if(C===Hi.RGB){let ge=[0,1,2];if(this.fileDirectory.ExtraSamples!==X1.Unspecified&&h){ge=[];for(let ce=0;ce<this.fileDirectory.BitsPerSample.length;ce+=1)ge.push(ce)}return this.readRasters({window:t,interleave:e,samples:ge,pool:n,width:s,height:u,resampleMethod:g,signal:b})}let P;switch(C){case Hi.WhiteIsZero:case Hi.BlackIsZero:case Hi.Palette:P=[0];break;case Hi.CMYK:P=[0,1,2,3];break;case Hi.YCbCr:case Hi.CIELab:P=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const R={window:T,interleave:!0,samples:P,pool:n,width:s,height:u,resampleMethod:g,signal:b},{fileDirectory:U}=this,j=await this.readRasters(R),H=2**this.fileDirectory.BitsPerSample[0];let re;switch(C){case Hi.WhiteIsZero:re=H1(j,H);break;case Hi.BlackIsZero:re=W1(j,H);break;case Hi.Palette:re=Y1(j,U.ColorMap);break;case Hi.CMYK:re=J1(j);break;case Hi.YCbCr:re=Q1(j);break;case Hi.CIELab:re=ib(j);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const ge=new Uint8Array(re.length/3),ce=new Uint8Array(re.length/3),be=new Uint8Array(re.length/3);for(let we=0,Ae=0;we<re.length;we+=3,++Ae)ge[Ae]=re[we],ce[Ae]=re[we+1],be[Ae]=re[we+2];re=[ge,ce,be]}return re.width=j.width,re.height=j.height,re}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=Z1(n,"Item");t!==null&&(s=s.filter(u=>Number(Tg(u,"sample"))===t));for(let u=0;u<s.length;++u){const g=s[u];e[Tg(g,"name")]=g.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return[n[0],n[5],n[10]];if(t){const[s,u,g]=t.getResolution();return[s*t.getWidth()/this.getWidth(),u*t.getHeight()/this.getHeight(),g*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(){const t=this.getOrigin(),e=this.getResolution(),n=t[0],s=t[1],u=n+e[0]*this.getWidth(),g=s+e[1]*this.getHeight();return[Math.min(n,u),Math.min(s,g),Math.max(n,u),Math.max(s,g)]}}var Sg=pb;class mb{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),s=this.getUint32(t+4,e);let u;if(e){if(u=n+2**32*s,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}if(u=2**32*n+s,!Number.isSafeInteger(u))throw new Error(`${u} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return u}getInt64(t,e){let n=0;const s=(this._dataView.getUint8(t+(e?7:0))&128)>0;let u=!0;for(let g=0;g<8;g++){let h=this._dataView.getUint8(t+(e?g:7-g));s&&(u?h!==0&&(h=~(h-1)&255,u=!1):h=~h&255),n+=h*256**g}return s&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return Eg(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class gb{constructor(t,e,n,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*e+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let s=!0;for(let u=0;u<8;u++){let g=this._dataView.getUint8(t+(this._littleEndian?u:7-u));n&&(s?g!==0&&(g=~(g-1)&255,s=!1):g=~g&255),e+=g*256**u}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const Ag={deserialize(r){return Object.assign(Error(r.message),{name:r.name,stack:r.stack})},serialize(r){return{__error_marker:"$$error",message:r.message,name:r.name,stack:r.stack}}},_b=r=>r&&typeof r=="object"&&"__error_marker"in r&&r.__error_marker==="$$error",yb={deserialize(r){return _b(r)?Ag.deserialize(r):r},serialize(r){return r instanceof Error?Ag.serialize(r):r}};let Cg=yb;function uu(r){return Cg.deserialize(r)}function Ig(r){return Cg.serialize(r)}let yd;function Pg(){return yd||(yd=vb()),yd}function vb(){try{throw new Error}catch(r){const t=(""+r.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return xb(t[0])}return"/"}function xb(r){return(""+r).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}const bb=typeof navigator!="undefined"&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4,Rg=r=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(r);function kg(r){const t=new Blob([r],{type:"application/javascript"});return URL.createObjectURL(t)}function wb(){if(typeof Worker=="undefined")return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class r extends Worker{constructor(n,s){var u,g;typeof n=="string"&&s&&s._baseURL?n=new URL(n,s._baseURL):typeof n=="string"&&!Rg(n)&&Pg().match(/^file:\/\//i)&&(n=new URL(n,Pg().replace(/\/[^\/]+$/,"/")),((u=s==null?void 0:s.CORSWorkaround)!==null&&u!==void 0?u:!0)&&(n=kg(`importScripts(${JSON.stringify(n)});`))),typeof n=="string"&&Rg(n)&&((g=s==null?void 0:s.CORSWorkaround)!==null&&g!==void 0?g:!0)&&(n=kg(`importScripts(${JSON.stringify(n)});`));super(n,s)}}class t extends r{constructor(n,s){const u=window.URL.createObjectURL(n);super(u,s)}static fromText(n,s){const u=new window.Blob([n],{type:"text/javascript"});return new t(u,s)}}return{blob:t,default:r}}let vd;function Dg(){return vd||(vd=wb()),vd}var xd={exports:{}},No=1e3,Uo=No*60,Go=Uo*60,Rs=Go*24,Eb=Rs*7,Tb=Rs*365.25,Mb=function(r,t){t=t||{};var e=typeof r;if(e==="string"&&r.length>0)return Sb(r);if(e==="number"&&isFinite(r))return t.long?Cb(r):Ab(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function Sb(r){if(r=String(r),!(r.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!t){var e=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return e*Tb;case"weeks":case"week":case"w":return e*Eb;case"days":case"day":case"d":return e*Rs;case"hours":case"hour":case"hrs":case"hr":case"h":return e*Go;case"minutes":case"minute":case"mins":case"min":case"m":return e*Uo;case"seconds":case"second":case"secs":case"sec":case"s":return e*No;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function Ab(r){var t=Math.abs(r);return t>=Rs?Math.round(r/Rs)+"d":t>=Go?Math.round(r/Go)+"h":t>=Uo?Math.round(r/Uo)+"m":t>=No?Math.round(r/No)+"s":r+"ms"}function Cb(r){var t=Math.abs(r);return t>=Rs?fu(r,t,Rs,"day"):t>=Go?fu(r,t,Go,"hour"):t>=Uo?fu(r,t,Uo,"minute"):t>=No?fu(r,t,No,"second"):r+" ms"}function fu(r,t,e,n){var s=t>=e*1.5;return Math.round(r/e)+" "+n+(s?"s":"")}function Ib(r){e.debug=e,e.default=e,e.coerce=b,e.disable=u,e.enable=s,e.enabled=g,e.humanize=Mb,e.destroy=T,Object.keys(r).forEach(C=>{e[C]=r[C]}),e.names=[],e.skips=[],e.formatters={};function t(C){let P=0;for(let R=0;R<C.length;R++)P=(P<<5)-P+C.charCodeAt(R),P|=0;return e.colors[Math.abs(P)%e.colors.length]}e.selectColor=t;function e(C){let P,R=null,U,j;function H(...re){if(!H.enabled)return;const ge=H,ce=Number(new Date),be=ce-(P||ce);ge.diff=be,ge.prev=P,ge.curr=ce,P=ce,re[0]=e.coerce(re[0]),typeof re[0]!="string"&&re.unshift("%O");let we=0;re[0]=re[0].replace(/%([a-zA-Z%])/g,(De,it)=>{if(De==="%%")return"%";we++;const ze=e.formatters[it];if(typeof ze=="function"){const lt=re[we];De=ze.call(ge,lt),re.splice(we,1),we--}return De}),e.formatArgs.call(ge,re),(ge.log||e.log).apply(ge,re)}return H.namespace=C,H.useColors=e.useColors(),H.color=e.selectColor(C),H.extend=n,H.destroy=e.destroy,Object.defineProperty(H,"enabled",{enumerable:!0,configurable:!1,get:()=>R!==null?R:(U!==e.namespaces&&(U=e.namespaces,j=e.enabled(C)),j),set:re=>{R=re}}),typeof e.init=="function"&&e.init(H),H}function n(C,P){const R=e(this.namespace+(typeof P=="undefined"?":":P)+C);return R.log=this.log,R}function s(C){e.save(C),e.namespaces=C,e.names=[],e.skips=[];let P;const R=(typeof C=="string"?C:"").split(/[\s,]+/),U=R.length;for(P=0;P<U;P++)!R[P]||(C=R[P].replace(/\*/g,".*?"),C[0]==="-"?e.skips.push(new RegExp("^"+C.slice(1)+"$")):e.names.push(new RegExp("^"+C+"$")))}function u(){const C=[...e.names.map(h),...e.skips.map(h).map(P=>"-"+P)].join(",");return e.enable(""),C}function g(C){if(C[C.length-1]==="*")return!0;let P,R;for(P=0,R=e.skips.length;P<R;P++)if(e.skips[P].test(C))return!1;for(P=0,R=e.names.length;P<R;P++)if(e.names[P].test(C))return!0;return!1}function h(C){return C.toString().substring(2,C.toString().length-2).replace(/\.\*\?$/,"*")}function b(C){return C instanceof Error?C.stack||C.message:C}function T(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var Pb=Ib;(function(r,t){t.formatArgs=n,t.save=s,t.load=u,t.useColors=e,t.storage=g(),t.destroy=(()=>{let b=!1;return()=>{b||(b=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function n(b){if(b[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+b[0]+(this.useColors?"%c ":" ")+"+"+r.exports.humanize(this.diff),!this.useColors)return;const T="color: "+this.color;b.splice(1,0,T,"color: inherit");let C=0,P=0;b[0].replace(/%[a-zA-Z%]/g,R=>{R!=="%%"&&(C++,R==="%c"&&(P=C))}),b.splice(P,0,T)}t.log=console.debug||console.log||(()=>{});function s(b){try{b?t.storage.setItem("debug",b):t.storage.removeItem("debug")}catch(T){}}function u(){let b;try{b=t.storage.getItem("debug")}catch(T){}return!b&&typeof process!="undefined"&&"env"in process&&(b={}.DEBUG),b}function g(){try{return localStorage}catch(b){}}r.exports=Pb(t);const{formatters:h}=r.exports;h.j=function(b){try{return JSON.stringify(b)}catch(T){return"[UnexpectedJSONParseError]: "+T.message}}})(xd,xd.exports);var yh=xd.exports;const Lg=()=>typeof Symbol=="function",bd=r=>Lg()&&Boolean(Symbol[r]),wd=r=>bd(r)?Symbol[r]:"@@"+r;bd("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const Rb=wd("iterator"),Ed=wd("observable"),Og=wd("species");function du(r,t){const e=r[t];if(e!=null){if(typeof e!="function")throw new TypeError(e+" is not a function");return e}}function vh(r){let t=r.constructor;return t!==void 0&&(t=t[Og],t===null&&(t=void 0)),t!==void 0?t:va}function kb(r){return r instanceof va}function Vo(r){Vo.log?Vo.log(r):setTimeout(()=>{throw r},0)}function pu(r){Promise.resolve().then(()=>{try{r()}catch(t){Vo(t)}})}function zg(r){const t=r._cleanup;if(t!==void 0&&(r._cleanup=void 0,!!t))try{if(typeof t=="function")t();else{const e=du(t,"unsubscribe");e&&e.call(t)}}catch(e){Vo(e)}}function Td(r){r._observer=void 0,r._queue=void 0,r._state="closed"}function Db(r){const t=r._queue;if(!!t){r._queue=void 0,r._state="ready";for(const e of t)if(Fg(r,e.type,e.value),r._state==="closed")break}}function Fg(r,t,e){r._state="running";const n=r._observer;try{const s=n?du(n,t):void 0;switch(t){case"next":s&&s.call(n,e);break;case"error":if(Td(r),s)s.call(n,e);else throw e;break;case"complete":Td(r),s&&s.call(n);break}}catch(s){Vo(s)}r._state==="closed"?zg(r):r._state==="running"&&(r._state="ready")}function Md(r,t,e){if(r._state!=="closed"){if(r._state==="buffering"){r._queue=r._queue||[],r._queue.push({type:t,value:e});return}if(r._state!=="ready"){r._state="buffering",r._queue=[{type:t,value:e}],pu(()=>Db(r));return}Fg(r,t,e)}}class Lb{constructor(t,e){this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";const n=new Ob(this);try{this._cleanup=e.call(void 0,n)}catch(s){n.error(s)}this._state==="initializing"&&(this._state="ready")}get closed(){return this._state==="closed"}unsubscribe(){this._state!=="closed"&&(Td(this),zg(this))}}class Ob{constructor(t){this._subscription=t}get closed(){return this._subscription._state==="closed"}next(t){Md(this._subscription,"next",t)}error(t){Md(this._subscription,"error",t)}complete(){Md(this._subscription,"complete")}}class va{constructor(t){if(!(this instanceof va))throw new TypeError("Observable cannot be called as a function");if(typeof t!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=t}subscribe(t,e,n){return(typeof t!="object"||t===null)&&(t={next:t,error:e,complete:n}),new Lb(t,this._subscriber)}pipe(t,...e){let n=this;for(const s of[t,...e])n=s(n);return n}tap(t,e,n){const s=typeof t!="object"||t===null?{next:t,error:e,complete:n}:t;return new va(u=>this.subscribe({next(g){s.next&&s.next(g),u.next(g)},error(g){s.error&&s.error(g),u.error(g)},complete(){s.complete&&s.complete(),u.complete()},start(g){s.start&&s.start(g)}}))}forEach(t){return new Promise((e,n)=>{if(typeof t!="function"){n(new TypeError(t+" is not a function"));return}function s(){u.unsubscribe(),e(void 0)}const u=this.subscribe({next(g){try{t(g,s)}catch(h){n(h),u.unsubscribe()}},error(g){n(g)},complete(){e(void 0)}})})}map(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=vh(this);return new e(n=>this.subscribe({next(s){let u=s;try{u=t(s)}catch(g){return n.error(g)}n.next(u)},error(s){n.error(s)},complete(){n.complete()}}))}filter(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=vh(this);return new e(n=>this.subscribe({next(s){try{if(!t(s))return}catch(u){return n.error(u)}n.next(s)},error(s){n.error(s)},complete(){n.complete()}}))}reduce(t,e){if(typeof t!="function")throw new TypeError(t+" is not a function");const n=vh(this),s=arguments.length>1;let u=!1,g=e;return new n(h=>this.subscribe({next(b){const T=!u;if(u=!0,!T||s)try{g=t(g,b)}catch(C){return h.error(C)}else g=b},error(b){h.error(b)},complete(){if(!u&&!s)return h.error(new TypeError("Cannot reduce an empty sequence"));h.next(g),h.complete()}}))}concat(...t){const e=vh(this);return new e(n=>{let s,u=0;function g(h){s=h.subscribe({next(b){n.next(b)},error(b){n.error(b)},complete(){u===t.length?(s=void 0,n.complete()):g(e.from(t[u++]))}})}return g(this),()=>{s&&(s.unsubscribe(),s=void 0)}})}flatMap(t){if(typeof t!="function")throw new TypeError(t+" is not a function");const e=vh(this);return new e(n=>{const s=[],u=this.subscribe({next(h){let b;if(t)try{b=t(h)}catch(C){return n.error(C)}else b=h;const T=e.from(b).subscribe({next(C){n.next(C)},error(C){n.error(C)},complete(){const C=s.indexOf(T);C>=0&&s.splice(C,1),g()}});s.push(T)},error(h){n.error(h)},complete(){g()}});function g(){u.closed&&s.length===0&&n.complete()}return()=>{s.forEach(h=>h.unsubscribe()),u.unsubscribe()}})}[Ed](){return this}static from(t){const e=typeof this=="function"?this:va;if(t==null)throw new TypeError(t+" is not an object");const n=du(t,Ed);if(n){const s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return kb(s)&&s.constructor===e?s:new e(u=>s.subscribe(u))}if(bd("iterator")){const s=du(t,Rb);if(s)return new e(u=>{pu(()=>{if(!u.closed){for(const g of s.call(t))if(u.next(g),u.closed)return;u.complete()}})})}if(Array.isArray(t))return new e(s=>{pu(()=>{if(!s.closed){for(const u of t)if(s.next(u),s.closed)return;s.complete()}})});throw new TypeError(t+" is not observable")}static of(...t){const e=typeof this=="function"?this:va;return new e(n=>{pu(()=>{if(!n.closed){for(const s of t)if(n.next(s),n.closed)return;n.complete()}})})}static get[Og](){return this}}Lg()&&Object.defineProperty(va,Symbol("extensions"),{value:{symbol:Ed,hostReportError:Vo},configurable:!0});var $o=va;function zb(r){typeof r=="function"?r():r&&typeof r.unsubscribe=="function"&&r.unsubscribe()}class Fb extends $o{constructor(){super(t=>(this._observers.add(t),()=>this._observers.delete(t)));this._observers=new Set}next(t){for(const e of this._observers)e.next(t)}error(t){for(const e of this._observers)e.error(t)}complete(){for(const t of this._observers)t.complete()}}var Bg=Fb;function Ng(r){const t=new Bg;let e,n=0;return new $o(s=>{e||(e=r.subscribe(t));const u=t.subscribe(s);return n++,()=>{n--,u.unsubscribe(),n===0&&(zb(e),e=void 0)}})}function Ug(r){return Promise.all(r.map(t=>{const e=u=>({status:"fulfilled",value:u}),n=u=>({status:"rejected",reason:u}),s=Promise.resolve(t);try{return s.then(e,n)}catch(u){return Promise.reject(u)}}))}var Zr;(function(r){r.initialized="initialized",r.taskCanceled="taskCanceled",r.taskCompleted="taskCompleted",r.taskFailed="taskFailed",r.taskQueued="taskQueued",r.taskQueueDrained="taskQueueDrained",r.taskStart="taskStart",r.terminated="terminated"})(Zr||(Zr={}));const Gg=Symbol("thread.errors"),Vg=Symbol("thread.events"),$g=Symbol("thread.terminate"),jg=Symbol("thread.transferable"),Bb=Symbol("thread.worker");function Zg(r){throw Error(r)}const Nb={errors(r){return r[Gg]||Zg("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},events(r){return r[Vg]||Zg("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise.")},terminate(r){return r[$g]()}};var ks=function(r,t,e,n){function s(u){return u instanceof e?u:new e(function(g){g(u)})}return new(e||(e=Promise))(function(u,g){function h(C){try{T(n.next(C))}catch(P){g(P)}}function b(C){try{T(n.throw(C))}catch(P){g(P)}}function T(C){C.done?u(C.value):s(C.value).then(h,b)}T((n=n.apply(r,t||[])).next())})};let Ub=1;function Gb(r){const t=[];for(let e=0;e<r;e++)t.push(e);return t}function Vb(r){return new Promise(t=>setTimeout(t,r))}function $b(r,t){return r.reduce((e,n)=>[...e,...t(n)],[])}function jb(r){return r.replace(/\W/g," ").trim().replace(/\s+/g,"-")}function Zb(r,t){return Gb(t).map(()=>({init:r(),runningTasks:[]}))}class qg{constructor(t,e){this.eventSubject=new Bg,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const n=typeof e=="number"?{size:e}:e||{},{size:s=bb}=n;this.debug=yh(`threads:pool:${jb(n.name||String(Ub++))}`),this.options=n,this.workers=Zb(t,s),this.eventObservable=Ng($o.from(this.eventSubject)),Promise.all(this.workers.map(u=>u.init)).then(()=>this.eventSubject.next({type:Zr.initialized,size:this.workers.length}),u=>{this.debug("Error while initializing pool worker:",u),this.eventSubject.error(u),this.initErrors.push(u)})}findIdlingWorker(){const{concurrency:t=1}=this.options;return this.workers.find(e=>e.runningTasks.length<t)}runPoolTask(t,e){return ks(this,void 0,void 0,function*(){const n=this.workers.indexOf(t)+1;this.debug(`Running task #${e.id} on worker #${n}...`),this.eventSubject.next({type:Zr.taskStart,taskID:e.id,workerID:n});try{const s=yield e.run(yield t.init);this.debug(`Task #${e.id} completed successfully`),this.eventSubject.next({type:Zr.taskCompleted,returnValue:s,taskID:e.id,workerID:n})}catch(s){this.debug(`Task #${e.id} failed`),this.eventSubject.next({type:Zr.taskFailed,taskID:e.id,error:s,workerID:n})}})}run(t,e){return ks(this,void 0,void 0,function*(){const n=(()=>ks(this,void 0,void 0,function*(){const s=()=>{t.runningTasks=t.runningTasks.filter(u=>u!==n)};yield Vb(0);try{yield this.runPoolTask(t,e)}finally{s(),this.isClosing||this.scheduleWork()}}))();t.runningTasks.push(n)})}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const t=this.findIdlingWorker();if(!t)return;const e=this.taskQueue.shift();if(!e){this.debug("Task queue is empty"),this.eventSubject.next({type:Zr.taskQueueDrained});return}this.run(t,e)}taskCompletion(t){return new Promise((e,n)=>{const s=this.events().subscribe(u=>{u.type===Zr.taskCompleted&&u.taskID===t?(s.unsubscribe(),e(u.returnValue)):u.type===Zr.taskFailed&&u.taskID===t?(s.unsubscribe(),n(u.error)):u.type===Zr.terminated&&(s.unsubscribe(),n(Error("Pool has been terminated before task was run.")))})})}settled(t=!1){return ks(this,void 0,void 0,function*(){const e=()=>$b(this.workers,u=>u.runningTasks),n=[],s=this.eventObservable.subscribe(u=>{u.type===Zr.taskFailed&&n.push(u.error)});return this.initErrors.length>0?Promise.reject(this.initErrors[0]):t&&this.taskQueue.length===0?(yield Ug(e()),n):(yield new Promise((u,g)=>{const h=this.eventObservable.subscribe({next(b){b.type===Zr.taskQueueDrained&&(h.unsubscribe(),u(void 0))},error:g})}),yield Ug(e()),s.unsubscribe(),n)})}completed(t=!1){return ks(this,void 0,void 0,function*(){const e=this.settled(t),n=new Promise((u,g)=>{const h=this.eventObservable.subscribe({next(b){b.type===Zr.taskQueueDrained?(h.unsubscribe(),u(e)):b.type===Zr.taskFailed&&(h.unsubscribe(),g(b.error))},error:g})}),s=yield Promise.race([e,n]);if(s.length>0)throw s[0]})}events(){return this.eventObservable}queue(t){const{maxQueuedJobs:e=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const n=this.nextTaskID++,s=this.taskCompletion(n);s.catch(g=>{this.debug(`Task #${n} errored:`,g)});const u={id:n,run:t,cancel:()=>{this.taskQueue.indexOf(u)!==-1&&(this.taskQueue=this.taskQueue.filter(g=>g!==u),this.eventSubject.next({type:Zr.taskCanceled,taskID:u.id}))},then:s.then.bind(s)};if(this.taskQueue.length>=e)throw Error(`Maximum number of pool tasks queued. Refusing to queue another one.
This usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.`);return this.debug(`Queueing task #${u.id}...`),this.taskQueue.push(u),this.eventSubject.next({type:Zr.taskQueued,taskID:u.id}),this.scheduleWork(),u}terminate(t){return ks(this,void 0,void 0,function*(){this.isClosing=!0,t||(yield this.completed(!0)),this.eventSubject.next({type:Zr.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map(e=>ks(this,void 0,void 0,function*(){return Nb.terminate(yield e.init)})))})}}qg.EventType=Zr;function Xg(r,t){return new qg(r,t)}Xg.EventType=Zr;const qb=Xg,Xb=()=>{};function Kb(){let r=!1,t,e=Xb;return[new Promise(u=>{r?u(t):e=u}),u=>{r=!0,t=u,e(t)}]}var jo;(function(r){r.internalError="internalError",r.message="message",r.termination="termination"})(jo||(jo={}));const Hb=()=>{},Wb=r=>r,Kg=r=>Promise.resolve().then(r);function Yb(r){throw r}function Jb(r){return r&&typeof r.then=="function"}class mu extends $o{constructor(t){super(e=>{const n=this,s=Object.assign(Object.assign({},e),{complete(){e.complete(),n.onCompletion()},error(u){e.error(u),n.onError(u)},next(u){e.next(u),n.onNext(u)}});try{return this.initHasRun=!0,t(s)}catch(u){s.error(u)}});this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(t){this.firstValueSet||(this.firstValue=t,this.firstValueSet=!0)}onError(t){this.state="rejected",this.rejection=t;for(const e of this.rejectionCallbacks)Kg(()=>e(t))}onCompletion(){this.state="fulfilled";for(const t of this.fulfillmentCallbacks)Kg(()=>t(this.firstValue))}then(t,e){const n=t||Wb,s=e||Yb;let u=!1;return new Promise((g,h)=>{const b=C=>{if(!u){u=!0;try{g(s(C))}catch(P){h(P)}}},T=C=>{try{g(n(C))}catch(P){b(P)}};if(this.initHasRun||this.subscribe({error:b}),this.state==="fulfilled")return g(n(this.firstValue));if(this.state==="rejected")return u=!0,g(s(this.rejection));this.fulfillmentCallbacks.push(T),this.rejectionCallbacks.push(b)})}catch(t){return this.then(void 0,t)}finally(t){const e=t||Hb;return this.then(n=>(e(),n),()=>e())}static from(t){return Jb(t)?new mu(e=>{const n=u=>{e.next(u),e.complete()},s=u=>{e.error(u)};t.then(n,s)}):super.from(t)}}function Qb(r){return!(!r||typeof r!="object")}function ew(r){return r&&typeof r=="object"&&r[jg]}function tw(r,t){if(!t){if(!Qb(r))throw Error();t=[r]}return{[jg]:!0,send:r,transferables:t}}var gu;(function(r){r.cancel="cancel",r.run="run"})(gu||(gu={}));var xh;(function(r){r.error="error",r.init="init",r.result="result",r.running="running",r.uncaughtError="uncaughtError"})(xh||(xh={}));const Hg=yh("threads:master:messages");let rw=1;const iw=r=>Array.from(new Set(r)),nw=r=>r&&r.type===xh.error,aw=r=>r&&r.type===xh.result,sw=r=>r&&r.type===xh.running;function ow(r,t){return new $o(e=>{let n;const s=u=>{if(Hg("Message from worker:",u.data),!(!u.data||u.data.uid!==t)){if(sw(u.data))n=u.data.resultType;else if(aw(u.data))n==="promise"?(typeof u.data.payload!="undefined"&&e.next(uu(u.data.payload)),e.complete(),r.removeEventListener("message",s)):(u.data.payload&&e.next(uu(u.data.payload)),u.data.complete&&(e.complete(),r.removeEventListener("message",s)));else if(nw(u.data)){const g=uu(u.data.error);e.error(g),r.removeEventListener("message",s)}}};return r.addEventListener("message",s),()=>{if(n==="observable"||!n){const u={type:gu.cancel,uid:t};r.postMessage(u)}r.removeEventListener("message",s)}})}function lw(r){if(r.length===0)return{args:[],transferables:[]};const t=[],e=[];for(const n of r)ew(n)?(t.push(Ig(n.send)),e.push(...n.transferables)):t.push(Ig(n));return{args:t,transferables:e.length===0?e:iw(e)}}function Wg(r,t){return(...e)=>{const n=rw++,{args:s,transferables:u}=lw(e),g={type:gu.run,uid:n,method:t,args:s};Hg("Sending command to run function to worker:",g);try{r.postMessage(g,u)}catch(h){return mu.from(Promise.reject(h))}return mu.from(Ng(ow(r,n)))}}function hw(r,t){const e={};for(const n of t)e[n]=Wg(r,n);return e}var Sd=function(r,t,e,n){function s(u){return u instanceof e?u:new e(function(g){g(u)})}return new(e||(e=Promise))(function(u,g){function h(C){try{T(n.next(C))}catch(P){g(P)}}function b(C){try{T(n.throw(C))}catch(P){g(P)}}function T(C){C.done?u(C.value):s(C.value).then(h,b)}T((n=n.apply(r,t||[])).next())})};const cw=yh("threads:master:messages"),uw=yh("threads:master:spawn"),Yg=yh("threads:master:thread-utils"),fw=r=>r&&r.type==="init",dw=r=>r&&r.type==="uncaughtError",pw=typeof process!="undefined"&&{}.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt({}.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function mw(r,t,e){return Sd(this,void 0,void 0,function*(){let n;const s=new Promise((g,h)=>{n=setTimeout(()=>h(Error(e)),t)}),u=yield Promise.race([r,s]);return clearTimeout(n),u})}function gw(r){return new Promise((t,e)=>{const n=s=>{cw("Message from worker before finishing initialization:",s.data),fw(s.data)?(r.removeEventListener("message",n),t(s.data)):dw(s.data)&&(r.removeEventListener("message",n),e(uu(s.data.error)))};r.addEventListener("message",n)})}function _w(r,t){return new $o(e=>{const n=u=>{const g={type:jo.message,data:u.data};e.next(g)},s=u=>{Yg("Unhandled promise rejection event in thread:",u);const g={type:jo.internalError,error:Error(u.reason)};e.next(g)};r.addEventListener("message",n),r.addEventListener("unhandledrejection",s),t.then(()=>{const u={type:jo.termination};r.removeEventListener("message",n),r.removeEventListener("unhandledrejection",s),e.next(u),e.complete()})})}function yw(r){const[t,e]=Kb();return{terminate:()=>Sd(this,void 0,void 0,function*(){Yg("Terminating worker"),yield r.terminate(),e()}),termination:t}}function Jg(r,t,e,n){const s=e.filter(u=>u.type===jo.internalError).map(u=>u.error);return Object.assign(r,{[Gg]:s,[Vg]:e,[$g]:n,[Bb]:t})}function vw(r,t){return Sd(this,void 0,void 0,function*(){uw("Initializing new thread");const e=t&&t.timeout?t.timeout:pw,s=(yield mw(gw(r),e,`Timeout: Did not receive an init message from worker after ${e}ms. Make sure the worker calls expose().`)).exposed,{termination:u,terminate:g}=yw(r),h=_w(r,u);if(s.type==="function"){const b=Wg(r);return Jg(b,r,h,g)}else if(s.type==="module"){const b=hw(r,s.methods);return Jg(b,r,h,g)}else{const b=s.type;throw Error(`Worker init message states unexpected type of expose(): ${b}`)}})}Dg().blob;const xw=Dg().default,bw=typeof navigator!="undefined"?navigator.hardwareConcurrency:null;class ww{constructor(t=bw,e=new xw("./decoder.worker.js")){this.pool=qb(()=>vw(e),t)}async decode(t,e){return new Promise((n,s)=>{this.pool.queue(async u=>{try{const g=await u(t,tw(e));n(g)}catch(g){s(g)}})})}destroy(){this.pool.terminate(!0)}}var Ew=ww;const Qg=`\r
\r
`;function e_(r){if(typeof Object.fromEntries!="undefined")return Object.fromEntries(r);const t={};for(const[e,n]of r)t[e.toLowerCase()]=n;return t}function Tw(r){const t=r.split(`\r
`).map(e=>{const n=e.split(":").map(s=>s.trim());return n[0]=n[0].toLowerCase(),n});return e_(t)}function Mw(r){const[t,...e]=r.split(";").map(s=>s.trim()),n=e.map(s=>s.split("="));return{type:t,params:e_(n)}}function Ad(r){let t,e,n;return r&&([,t,e,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function Sw(r,t){let e=null;const n=new TextDecoder("ascii"),s=[],u=`--${t}`,g=`${u}--`;for(let h=0;h<10;++h)n.decode(new Uint8Array(r,h,u.length))===u&&(e=h);if(e===null)throw new Error("Could not find initial boundary");for(;e<r.byteLength;){const h=n.decode(new Uint8Array(r,e,Math.min(u.length+1024,r.byteLength-e)));if(h.length===0||h.startsWith(g))break;if(!h.startsWith(u))throw new Error("Part does not start with boundary");const b=h.substr(u.length+2);if(b.length===0)break;const T=b.indexOf(Qg),C=Tw(b.substr(0,T)),{start:P,end:R,total:U}=Ad(C["content-range"]),j=e+u.length+T+Qg.length,H=parseInt(R,10)+1-parseInt(P,10);s.push({headers:C,data:r.slice(j,j+H),offset:P,length:H,fileSize:U}),e=j+H+4}return s}class t_{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}var Aw=Nt;Nt.Node=Ds;Nt.create=Nt;function Nt(r){var t=this;if(t instanceof Nt||(t=new Nt),t.tail=null,t.head=null,t.length=0,r&&typeof r.forEach=="function")r.forEach(function(s){t.push(s)});else if(arguments.length>0)for(var e=0,n=arguments.length;e<n;e++)t.push(arguments[e]);return t}Nt.prototype.removeNode=function(r){if(r.list!==this)throw new Error("removing node which does not belong to this list");var t=r.next,e=r.prev;return t&&(t.prev=e),e&&(e.next=t),r===this.head&&(this.head=t),r===this.tail&&(this.tail=e),r.list.length--,r.next=null,r.prev=null,r.list=null,t};Nt.prototype.unshiftNode=function(r){if(r!==this.head){r.list&&r.list.removeNode(r);var t=this.head;r.list=this,r.next=t,t&&(t.prev=r),this.head=r,this.tail||(this.tail=r),this.length++}};Nt.prototype.pushNode=function(r){if(r!==this.tail){r.list&&r.list.removeNode(r);var t=this.tail;r.list=this,r.prev=t,t&&(t.next=r),this.tail=r,this.head||(this.head=r),this.length++}};Nt.prototype.push=function(){for(var r=0,t=arguments.length;r<t;r++)Iw(this,arguments[r]);return this.length};Nt.prototype.unshift=function(){for(var r=0,t=arguments.length;r<t;r++)Pw(this,arguments[r]);return this.length};Nt.prototype.pop=function(){if(!!this.tail){var r=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,r}};Nt.prototype.shift=function(){if(!!this.head){var r=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,r}};Nt.prototype.forEach=function(r,t){t=t||this;for(var e=this.head,n=0;e!==null;n++)r.call(t,e.value,n,this),e=e.next};Nt.prototype.forEachReverse=function(r,t){t=t||this;for(var e=this.tail,n=this.length-1;e!==null;n--)r.call(t,e.value,n,this),e=e.prev};Nt.prototype.get=function(r){for(var t=0,e=this.head;e!==null&&t<r;t++)e=e.next;if(t===r&&e!==null)return e.value};Nt.prototype.getReverse=function(r){for(var t=0,e=this.tail;e!==null&&t<r;t++)e=e.prev;if(t===r&&e!==null)return e.value};Nt.prototype.map=function(r,t){t=t||this;for(var e=new Nt,n=this.head;n!==null;)e.push(r.call(t,n.value,this)),n=n.next;return e};Nt.prototype.mapReverse=function(r,t){t=t||this;for(var e=new Nt,n=this.tail;n!==null;)e.push(r.call(t,n.value,this)),n=n.prev;return e};Nt.prototype.reduce=function(r,t){var e,n=this.head;if(arguments.length>1)e=t;else if(this.head)n=this.head.next,e=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=0;n!==null;s++)e=r(e,n.value,s),n=n.next;return e};Nt.prototype.reduceReverse=function(r,t){var e,n=this.tail;if(arguments.length>1)e=t;else if(this.tail)n=this.tail.prev,e=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;n!==null;s--)e=r(e,n.value,s),n=n.prev;return e};Nt.prototype.toArray=function(){for(var r=new Array(this.length),t=0,e=this.head;e!==null;t++)r[t]=e.value,e=e.next;return r};Nt.prototype.toArrayReverse=function(){for(var r=new Array(this.length),t=0,e=this.tail;e!==null;t++)r[t]=e.value,e=e.prev;return r};Nt.prototype.slice=function(r,t){t=t||this.length,t<0&&(t+=this.length),r=r||0,r<0&&(r+=this.length);var e=new Nt;if(t<r||t<0)return e;r<0&&(r=0),t>this.length&&(t=this.length);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(;s!==null&&n<t;n++,s=s.next)e.push(s.value);return e};Nt.prototype.sliceReverse=function(r,t){t=t||this.length,t<0&&(t+=this.length),r=r||0,r<0&&(r+=this.length);var e=new Nt;if(t<r||t<0)return e;r<0&&(r=0),t>this.length&&(t=this.length);for(var n=this.length,s=this.tail;s!==null&&n>t;n--)s=s.prev;for(;s!==null&&n>r;n--,s=s.prev)e.push(s.value);return e};Nt.prototype.splice=function(r,t,...e){r>this.length&&(r=this.length-1),r<0&&(r=this.length+r);for(var n=0,s=this.head;s!==null&&n<r;n++)s=s.next;for(var u=[],n=0;s&&n<t;n++)u.push(s.value),s=this.removeNode(s);s===null&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(var n=0;n<e.length;n++)s=Cw(this,s,e[n]);return u};Nt.prototype.reverse=function(){for(var r=this.head,t=this.tail,e=r;e!==null;e=e.prev){var n=e.prev;e.prev=e.next,e.next=n}return this.head=t,this.tail=r,this};function Cw(r,t,e){var n=t===r.head?new Ds(e,null,t,r):new Ds(e,t,t.next,r);return n.next===null&&(r.tail=n),n.prev===null&&(r.head=n),r.length++,n}function Iw(r,t){r.tail=new Ds(t,r.tail,null,r),r.head||(r.head=r.tail),r.length++}function Pw(r,t){r.head=new Ds(t,null,r.head,r),r.tail||(r.tail=r.head),r.length++}function Ds(r,t,e,n){if(!(this instanceof Ds))return new Ds(r,t,e,n);this.list=n,this.value=r,t?(t.next=this,this.prev=t):this.prev=null,e?(e.prev=this,this.next=e):this.next=null}try{require("./iterator.js")(Nt)}catch(r){}const Rw=Aw,Ls=Symbol("max"),xa=Symbol("length"),Zo=Symbol("lengthCalculator"),bh=Symbol("allowStale"),Os=Symbol("maxAge"),ba=Symbol("dispose"),r_=Symbol("noDisposeOnSet"),Qr=Symbol("lruList"),vn=Symbol("cache"),i_=Symbol("updateAgeOnGet"),Cd=()=>1;class kw{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[Ls]=t.max||1/0;const e=t.length||Cd;if(this[Zo]=typeof e!="function"?Cd:e,this[bh]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[Os]=t.maxAge||0,this[ba]=t.dispose,this[r_]=t.noDisposeOnSet||!1,this[i_]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[Ls]=t||1/0,wh(this)}get max(){return this[Ls]}set allowStale(t){this[bh]=!!t}get allowStale(){return this[bh]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[Os]=t,wh(this)}get maxAge(){return this[Os]}set lengthCalculator(t){typeof t!="function"&&(t=Cd),t!==this[Zo]&&(this[Zo]=t,this[xa]=0,this[Qr].forEach(e=>{e.length=this[Zo](e.value,e.key),this[xa]+=e.length})),wh(this)}get lengthCalculator(){return this[Zo]}get length(){return this[xa]}get itemCount(){return this[Qr].length}rforEach(t,e){e=e||this;for(let n=this[Qr].tail;n!==null;){const s=n.prev;n_(this,t,n,e),n=s}}forEach(t,e){e=e||this;for(let n=this[Qr].head;n!==null;){const s=n.next;n_(this,t,n,e),n=s}}keys(){return this[Qr].toArray().map(t=>t.key)}values(){return this[Qr].toArray().map(t=>t.value)}reset(){this[ba]&&this[Qr]&&this[Qr].length&&this[Qr].forEach(t=>this[ba](t.key,t.value)),this[vn]=new Map,this[Qr]=new Rw,this[xa]=0}dump(){return this[Qr].map(t=>_u(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[Qr]}set(t,e,n){if(n=n||this[Os],n&&typeof n!="number")throw new TypeError("maxAge must be a number");const s=n?Date.now():0,u=this[Zo](e,t);if(this[vn].has(t)){if(u>this[Ls])return qo(this,this[vn].get(t)),!1;const b=this[vn].get(t).value;return this[ba]&&(this[r_]||this[ba](t,b.value)),b.now=s,b.maxAge=n,b.value=e,this[xa]+=u-b.length,b.length=u,this.get(t),wh(this),!0}const g=new Dw(t,e,u,s,n);return g.length>this[Ls]?(this[ba]&&this[ba](t,e),!1):(this[xa]+=g.length,this[Qr].unshift(g),this[vn].set(t,this[Qr].head),wh(this),!0)}has(t){if(!this[vn].has(t))return!1;const e=this[vn].get(t).value;return!_u(this,e)}get(t){return Id(this,t,!0)}peek(t){return Id(this,t,!1)}pop(){const t=this[Qr].tail;return t?(qo(this,t),t.value):null}del(t){qo(this,this[vn].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const s=t[n],u=s.e||0;if(u===0)this.set(s.k,s.v);else{const g=u-e;g>0&&this.set(s.k,s.v,g)}}}prune(){this[vn].forEach((t,e)=>Id(this,e,!1))}}const Id=(r,t,e)=>{const n=r[vn].get(t);if(n){const s=n.value;if(_u(r,s)){if(qo(r,n),!r[bh])return}else e&&(r[i_]&&(n.value.now=Date.now()),r[Qr].unshiftNode(n));return s.value}},_u=(r,t)=>{if(!t||!t.maxAge&&!r[Os])return!1;const e=Date.now()-t.now;return t.maxAge?e>t.maxAge:r[Os]&&e>r[Os]},wh=r=>{if(r[xa]>r[Ls])for(let t=r[Qr].tail;r[xa]>r[Ls]&&t!==null;){const e=t.prev;qo(r,t),t=e}},qo=(r,t)=>{if(t){const e=t.value;r[ba]&&r[ba](e.key,e.value),r[xa]-=e.length,r[vn].delete(e.key),r[Qr].removeNode(t)}};class Dw{constructor(t,e,n,s,u){this.key=t,this.value=e,this.length=n,this.now=s,this.maxAge=u||0}}const n_=(r,t,e,n)=>{let s=e.value;_u(r,s)&&(qo(r,e),r[bh]||(s=void 0)),s&&t.call(n,s.value,s.key,r)};var Lw=kw;async function Ow(r){return new Promise(t=>setTimeout(t,r))}function a_(r,t){const e=Array.isArray(r)?r:Array.from(r),n=Array.isArray(t)?t:Array.from(t);return e.map((s,u)=>[s,n[u]])}class Xo extends Error{constructor(t){super(t);Error.captureStackTrace&&Error.captureStackTrace(this,Xo),this.name="AbortError"}}class zw extends Error{constructor(t,e){super(e);this.errors=t,this.message=e,this.name="AggregateError"}}const Fw=zw;class Bw{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class s_{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class Nw extends t_{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super();this.source=t,this.blockSize=e,this.blockCache=new Lw({max:n}),this.blockRequests=new Map,this.blockIdsToFetch=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=new Map,s=new Map,u=new Set;for(const{offset:T,length:C}of t){let P=T+C;const{fileSize:R}=this;R!==null&&(P=Math.min(P,R));const U=Math.floor(T/this.blockSize)*this.blockSize;for(let j=U;j<P;j+=this.blockSize){const H=Math.floor(j/this.blockSize);this.blockCache.has(H)?n.set(H,this.blockCache.get(H)):this.blockRequests.has(H)?s.set(H,this.blockRequests.get(H)):(this.blockIdsToFetch.has(H)||this.blockIdsToFetch.add(H),u.add(H))}}await Ow(),this.fetchBlocks(e);for(const T of u){const C=this.blockRequests.get(T),P=this.blockCache.get(T);if(C)s.set(T,C);else if(P)n.set(T,P);else throw new Error(`Block ${T} is not in the block requests`)}let g=await Promise.allSettled(Array.from(s.values()));if(g.some(T=>T.status==="rejected")){const T=new Set;for(const[C,P]of a_(s.keys(),g)){const{rejected:R,reason:U}=P;R&&U.name==="AbortError"&&U.signal!==e&&(this.blockIdsToFetch.add(C),T.add(C))}if(this.blockIdsToFetch.length>0){this.fetchBlocks(e);for(const C of T){const P=this.blockRequests.get(C);if(!P)throw new Error(`Block ${C} is not in the block requests`);s.set(C,P)}g=await Promise.allSettled(Array.from(s.values()))}}if(g.some(T=>T.status==="rejected"))throw e&&e.aborted?new Xo("Request was aborted"):new Fw(g.filter(T=>T.status==="rejected").map(T=>T.reason),"Request failed");const h=g.map(T=>T.value),b=new Map(a_(Array.from(s.keys()),h));for(const[T,C]of n)b.set(T,C);return this.readSliceData(t,b)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let s=0;s<e.length;++s){const u=e[s];for(const g of u.blockIds){const h=(async()=>{try{const b=(await n)[s],T=g*this.blockSize,C=T-b.offset,P=Math.min(C+this.blockSize,b.data.byteLength),R=b.data.slice(C,P),U=new Bw(T,R.byteLength,R);return this.blockCache.set(g,U),U}catch(b){throw b.name==="AbortError"&&(b.signal=t),b}finally{this.blockRequests.delete(g)}})();this.blockRequests.set(g,h)}}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((g,h)=>g-h);if(e.length===0)return[];let n=[],s=null;const u=[];for(const g of e)s===null||s+1===g?(n.push(g),s=g):(u.push(new s_(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[g],s=g);return u.push(new s_(n[0]*this.blockSize,n.length*this.blockSize,n)),u}readSliceData(t,e){return t.map(n=>{const s=n.offset+n.length,u=Math.floor(n.offset/this.blockSize),g=Math.floor((n.offset+n.length)/this.blockSize),h=new ArrayBuffer(n.length),b=new Uint8Array(h);for(let T=u;T<=g;++T){const C=e.get(T),P=C.offset-n.offset,R=C.top-s;let U=0,j=0,H;P<0?U=-P:P>0&&(j=P),R<0?H=C.length-U:H=s-C.offset-U;const re=new Uint8Array(C.data,U,H);b.set(re,j)}return h})}}class Pd{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Rd{constructor(t){this.url=t}async request({headers:t,credentials:e,signal:n}={}){throw new Error("request is not implemented")}}class Uw extends Pd{constructor(t){super();this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Gw extends Rd{constructor(t,e){super(t);this.credentials=e}async request({headers:t,credentials:e,signal:n}={}){const s=await fetch(this.url,{headers:t,credentials:e,signal:n});return new Uw(s)}}class Vw extends Pd{constructor(t,e){super();this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class $w extends Rd{constructRequest(t,e){return new Promise((n,s)=>{const u=new XMLHttpRequest;u.open("GET",this.url),u.responseType="arraybuffer";for(const[g,h]of Object.entries(t))u.setRequestHeader(g,h);u.onload=()=>{const g=u.response;n(new Vw(u,g))},u.onerror=s,u.onabort=()=>s(new Xo("Request aborted")),u.send(),e&&(e.aborted&&u.abort(),e.addEventListener("abort",()=>u.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}var kd={};class jw extends Pd{constructor(t,e){super();this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class Zw extends Rd{constructor(t){super(t);this.parsedUrl=kd.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",kd)}constructRequest(t,e){return new Promise((n,s)=>{const u=this.httpApi.get(oh(sh({},this.parsedUrl),{headers:t}),g=>{const h=new Promise(b=>{const T=[];g.on("data",C=>{T.push(C)}),g.on("end",()=>{const C=Buffer.concat(T).buffer;b(C)}),g.on("error",s)});n(new jw(g,h))});u.on("error",s),e&&(e.aborted&&u.destroy(new Xo("Request aborted")),e.addEventListener("abort",()=>u.destroy(new Xo("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class Dd extends t_{constructor(t,e,n,s){super();this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=s,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:oh(sh({},this.headers),{Range:`bytes=${t.map(({offset:s,length:u})=>`${s}-${s+u}`).join(",")}`}),signal:e});if(n.ok)if(n.status===206){const{type:s,params:u}=Mw(n.getHeader("content-type"));if(s==="multipart/byteranges"){const P=Sw(await n.getData(),u.boundary);return this._fileSize=P[0].fileSize||null,P}const g=await n.getData(),{start:h,end:b,total:T}=Ad(n.getHeader("content-range"));this._fileSize=T||null;const C=[{data:g,offset:h,length:b-h}];if(t.length>1){const P=await Promise.all(t.slice(1).map(R=>this.fetchSlice(R,e)));return C.concat(P)}return C}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await n.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:s}=t,u=await this.client.request({headers:oh(sh({},this.headers),{Range:`bytes=${n}-${n+s}`}),signal:e});if(u.ok)if(u.status===206){const g=await u.getData(),{total:h}=Ad(u.getHeader("content-range"));return this._fileSize=h||null,{data:g,offset:n,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const g=await u.getData();return this._fileSize=g.byteLength,{data:g,offset:0,length:g.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function Ld(r,{blockSize:t,cacheSize:e}){return t===null?r:new Nw(r,t,e)}function qw(r,g={}){var h=g,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:s=!1}=h,u=lh(h,["headers","credentials","maxRanges","allowFullFile"]);const b=new Gw(r,e),T=new Dd(b,t,n,s);return Ld(T,u)}function Xw(r,u={}){var g=u,{headers:t={},maxRanges:e=0,allowFullFile:n=!1}=g,s=lh(g,["headers","maxRanges","allowFullFile"]);const h=new $w(r),b=new Dd(h,t,e,n);return Ld(b,s)}function Kw(r,u={}){var g=u,{headers:t={},maxRanges:e=0,allowFullFile:n=!1}=g,s=lh(g,["headers","maxRanges","allowFullFile"]);const h=new Zw(r),b=new Dd(h,t,e,n);return Ld(b,s)}function Od(r,n={}){var s=n,{forceXHR:t=!1}=s,e=lh(s,["forceXHR"]);return typeof fetch=="function"&&!t?qw(r,e):typeof XMLHttpRequest!="undefined"?Xw(r,e):Kw(r,e)}function zd(r){switch(r){case Mt.BYTE:case Mt.ASCII:case Mt.SBYTE:case Mt.UNDEFINED:return 1;case Mt.SHORT:case Mt.SSHORT:return 2;case Mt.LONG:case Mt.SLONG:case Mt.FLOAT:case Mt.IFD:return 4;case Mt.RATIONAL:case Mt.SRATIONAL:case Mt.DOUBLE:case Mt.LONG8:case Mt.SLONG8:case Mt.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function Hw(r){const t=r.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const s=hu[t[n]],u=t[n+1]?_h[t[n+1]]:null,g=t[n+2],h=t[n+3];let b=null;if(!u)b=h;else{if(b=r[u],typeof b=="undefined"||b===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof b=="string"?b=b.substring(h,h+g-1):b.subarray&&(b=b.subarray(h,h+g),g===1&&(b=b[0]))}e[s]=b}return e}function Ko(r,t,e,n){let s=null,u=null;const g=zd(t);switch(t){case Mt.BYTE:case Mt.ASCII:case Mt.UNDEFINED:s=new Uint8Array(e),u=r.readUint8;break;case Mt.SBYTE:s=new Int8Array(e),u=r.readInt8;break;case Mt.SHORT:s=new Uint16Array(e),u=r.readUint16;break;case Mt.SSHORT:s=new Int16Array(e),u=r.readInt16;break;case Mt.LONG:case Mt.IFD:s=new Uint32Array(e),u=r.readUint32;break;case Mt.SLONG:s=new Int32Array(e),u=r.readInt32;break;case Mt.LONG8:case Mt.IFD8:s=new Array(e),u=r.readUint64;break;case Mt.SLONG8:s=new Array(e),u=r.readInt64;break;case Mt.RATIONAL:s=new Uint32Array(e*2),u=r.readUint32;break;case Mt.SRATIONAL:s=new Int32Array(e*2),u=r.readInt32;break;case Mt.FLOAT:s=new Float32Array(e),u=r.readFloat32;break;case Mt.DOUBLE:s=new Float64Array(e),u=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===Mt.RATIONAL||t===Mt.SRATIONAL)for(let h=0;h<e;h+=2)s[h]=u.call(r,n+h*g),s[h+1]=u.call(r,n+(h*g+4));else for(let h=0;h<e;++h)s[h]=u.call(r,n+h*g);return t===Mt.ASCII?new TextDecoder("utf-8").decode(s):s}class Ww{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class yu extends Error{constructor(t){super(`No image at index ${t}`);this.index=t}}class o_{async readRasters(t={}){const{window:e,width:n,height:s}=t;let{resX:u,resY:g,bbox:h}=t;const b=await this.getImage();let T=b;const C=await this.getImageCount(),P=b.getBoundingBox();if(e&&h)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(e){const[j,H]=b.getOrigin(),[re,ge]=b.getResolution();h=[j+e[0]*re,H+e[1]*ge,j+e[2]*re,H+e[3]*ge]}const U=h||P;if(n){if(u)throw new Error("Both width and resX passed");u=(U[2]-U[0])/n}if(s){if(g)throw new Error("Both width and resY passed");g=(U[3]-U[1])/s}}if(u||g){const U=[];for(let j=0;j<C;++j){const H=await this.getImage(j),{SubfileType:re,NewSubfileType:ge}=H.fileDirectory;(j===0||re===2||ge&1)&&U.push(H)}U.sort((j,H)=>j.getWidth()-H.getWidth());for(let j=0;j<U.length;++j){const H=U[j],re=(P[2]-P[0])/H.getWidth(),ge=(P[3]-P[1])/H.getHeight();if(T=H,u&&u>re||g&&g>ge)break}}let R=e;if(h){const[U,j]=b.getOrigin(),[H,re]=T.getResolution(b);R=[Math.round((h[0]-U)/H),Math.round((h[1]-j)/re),Math.round((h[2]-U)/H),Math.round((h[3]-j)/re)],R=[Math.min(R[0],R[2]),Math.min(R[1],R[3]),Math.max(R[0],R[2]),Math.max(R[1],R[3])]}return T.readRasters(oh(sh({},t),{window:R}))}}class Eh extends o_{constructor(t,e,n,s,u={}){super();this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=s,this.cache=u.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new gb((await this.source.fetch([{offset:t,length:typeof e!="undefined"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(t);const u=this.bigTiff?s.readUint64(t):s.readUint16(t),g=u*e+(this.bigTiff?16:6);s.covers(t,g)||(s=await this.getSlice(t,g));const h={};let b=t+(this.bigTiff?8:2);for(let P=0;P<u;b+=e,++P){const R=s.readUint16(b),U=s.readUint16(b+2),j=this.bigTiff?s.readUint64(b+4):s.readUint32(b+4);let H,re;const ge=zd(U),ce=b+(this.bigTiff?12:8);if(ge*j<=(this.bigTiff?8:4))H=Ko(s,U,j,ce);else{const be=s.readOffset(ce),we=zd(U)*j;if(s.covers(be,we))H=Ko(s,U,j,be);else{const Ae=await this.getSlice(be,we);H=Ko(Ae,U,j,be)}}j===1&&q1.indexOf(R)===-1&&!(U===Mt.RATIONAL||U===Mt.SRATIONAL)?re=H[0]:re=H,h[_h[R]]=re}const T=Hw(h),C=s.readOffset(t+n+e*u);return new Ww(h,T,C)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof yu?new yu(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new yu(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new Sg(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof yu)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let s=await this.getSlice(t,n);if(e===Ko(s,Mt.ASCII,e.length,t)){const g=Ko(s,Mt.ASCII,n,t).split(`
`)[0],h=Number(g.split("=")[1].split(" ")[0])+g.length;h>n&&(s=await this.getSlice(t,h));const b=Ko(s,Mt.ASCII,h,t);this.ghostValues={},b.split(`
`).filter(T=>T.length>0).map(T=>T.split("=")).forEach(([T,C])=>{this.ghostValues[T]=C})}return this.ghostValues}static async fromSource(t,e,n){const s=(await t.fetch([{offset:0,length:1024}],n))[0],u=new mb(s),g=u.getUint16(0,0);let h;if(g===18761)h=!0;else if(g===19789)h=!1;else throw new TypeError("Invalid byte order value.");const b=u.getUint16(2,h);let T;if(b===42)T=!1;else if(b===43){if(T=!0,u.getUint16(4,h)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const C=T?u.getUint64(8,h):u.getUint32(4,h);return new Eh(t,h,T,C,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class Yw extends o_{constructor(t,e){super();this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,n=0;for(let s=0;s<this.imageFiles.length;s++){const u=this.imageFiles[s];for(let g=0;g<this.imageCounts[s];g++){if(t===e){const h=await u.requestIFD(n);return new Sg(h.fileDirectory,h.geoKeyDirectory,u.dataView,u.littleEndian,u.cache,u.source)}e++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,n)=>e+n,0),this.imageCount}}async function Jw(r,t={},e){return Eh.fromSource(Od(r,t),e)}async function Qw(r,t=[],e={},n){const s=await Eh.fromSource(Od(r,e),n),u=await Promise.all(t.map(g=>Eh.fromSource(Od(g,e))));return new Yw(s,u)}var e2=`function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,r,n,a,i,o){try{var s=e[i](o),l=s.value}catch(e){return void r(e)}s.done?t(l):Promise.resolve(l).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){asyncGeneratorStep(i,n,a,o,s,"next",e)}function s(e){asyncGeneratorStep(i,n,a,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var runtime={exports:{}};!function(e){var t=function(e){var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var a=t&&t.prototype instanceof g?t:g,i=Object.create(a.prototype),o=new A(n||[]);return i._invoke=function(e,t,r){var n=u;return function(a,i){if(n===h)throw new Error("Generator is already running");if(n===p){if("throw"===a)throw i;return I()}for(r.method=a,r.arg=i;;){var o=r.delegate;if(o){var s=x(o,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===u)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=h;var l=c(e,t,r);if("normal"===l.type){if(n=r.done?p:d,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(n=p,r.method="throw",r.arg=l.arg)}}}(e,r,o),i}function c(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=f;var u="suspendedStart",d="suspendedYield",h="executing",p="completed",m={};function g(){}function y(){}function _(){}var b={};l(b,i,(function(){return this}));var v=Object.getPrototypeOf,w=v&&v(v(M([])));w&&w!==r&&n.call(w,i)&&(b=w);var k=_.prototype=g.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(a,i,o,s){var l=c(e[a],e,i);if("throw"!==l.type){var f=l.arg,u=f.value;return u&&"object"===_typeof(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(u).then((function(e){f.value=e,o(f)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var a;this._invoke=function(e,n){function i(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(i,i):i()}}function x(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=c(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,m;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function M(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,o=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:I}}function I(){return{value:t,done:!0}}return y.prototype=_,l(k,"constructor",_),l(_,"constructor",y),y.displayName=l(_,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,s,"GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},T(E.prototype),l(E.prototype,o,(function(){return this})),e.AsyncIterator=E,e.async=function(t,r,n,a,i){void 0===i&&(i=Promise);var o=new E(f(t,r,n,a),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(k),l(k,s,"Generator"),l(k,i,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=M,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return s.type="throw",s.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=n.call(o,"catchLoc"),f=n.call(o,"finallyLoc");if(l&&f){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!f)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),D(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;D(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:M(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":_typeof(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(runtime);var worker={},isObservable=function(e){return!!e&&("symbol"===_typeof(Symbol.observable)&&"function"==typeof e[Symbol.observable]?e===e[Symbol.observable]():"function"==typeof e["@@observable"]&&e===e["@@observable"]())},common$1={},serializers={};function extendSerializer(e,t){var r=e.deserialize.bind(e),n=e.serialize.bind(e);return{deserialize:function(e){return t.deserialize(e,r)},serialize:function(e){return t.serialize(e,n)}}}Object.defineProperty(serializers,"__esModule",{value:!0}),serializers.DefaultSerializer=serializers.extendSerializer=void 0,serializers.extendSerializer=extendSerializer;var DefaultErrorSerializer={deserialize:function(e){return Object.assign(Error(e.message),{name:e.name,stack:e.stack})},serialize:function(e){return{__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack}}},isSerializedError=function(e){return e&&"object"===_typeof(e)&&"__error_marker"in e&&"$$error"===e.__error_marker};serializers.DefaultSerializer={deserialize:function(e){return isSerializedError(e)?DefaultErrorSerializer.deserialize(e):e},serialize:function(e){return e instanceof Error?DefaultErrorSerializer.serialize(e):e}},Object.defineProperty(common$1,"__esModule",{value:!0}),common$1.serialize=common$1.deserialize=common$1.registerSerializer=void 0;var serializers_1=serializers,registeredSerializer=serializers_1.DefaultSerializer;function registerSerializer(e){registeredSerializer=serializers_1.extendSerializer(registeredSerializer,e)}function deserialize(e){return registeredSerializer.deserialize(e)}function serialize(e){return registeredSerializer.serialize(e)}common$1.registerSerializer=registerSerializer,common$1.deserialize=deserialize,common$1.serialize=serialize;var transferable={},symbols={};Object.defineProperty(symbols,"__esModule",{value:!0}),symbols.$worker=symbols.$transferable=symbols.$terminate=symbols.$events=symbols.$errors=void 0,symbols.$errors=Symbol("thread.errors"),symbols.$events=Symbol("thread.events"),symbols.$terminate=Symbol("thread.terminate"),symbols.$transferable=Symbol("thread.transferable"),symbols.$worker=Symbol("thread.worker"),Object.defineProperty(transferable,"__esModule",{value:!0}),transferable.Transfer=transferable.isTransferDescriptor=void 0;var symbols_1=symbols;function isTransferable(e){return!(!e||"object"!==_typeof(e))}function isTransferDescriptor(e){return e&&"object"===_typeof(e)&&e[symbols_1.$transferable]}function Transfer$1(e,t){var r;if(!t){if(!isTransferable(e))throw Error();t=[e]}return _defineProperty(r={},symbols_1.$transferable,!0),_defineProperty(r,"send",e),_defineProperty(r,"transferables",t),r}transferable.isTransferDescriptor=isTransferDescriptor,transferable.Transfer=Transfer$1;var messages$1={},exports,MasterMessageType,WorkerMessageType;exports=messages$1,Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorkerMessageType=exports.MasterMessageType=void 0,(MasterMessageType=exports.MasterMessageType||(exports.MasterMessageType={})).cancel="cancel",MasterMessageType.run="run",(WorkerMessageType=exports.WorkerMessageType||(exports.WorkerMessageType={})).error="error",WorkerMessageType.init="init",WorkerMessageType.result="result",WorkerMessageType.running="running",WorkerMessageType.uncaughtError="uncaughtError";var implementation$1={},implementation_browser={};Object.defineProperty(implementation_browser,"__esModule",{value:!0});var isWorkerRuntime$2=function(){var e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)},postMessageToMaster$2=function(e,t){self.postMessage(e,t)},subscribeToMasterMessages$2=function(e){var t=function(t){e(t.data)};return self.addEventListener("message",t),function(){self.removeEventListener("message",t)}};implementation_browser.default={isWorkerRuntime:isWorkerRuntime$2,postMessageToMaster:postMessageToMaster$2,subscribeToMasterMessages:subscribeToMasterMessages$2};var implementation_tinyWorker={};Object.defineProperty(implementation_tinyWorker,"__esModule",{value:!0}),"undefined"==typeof self&&(commonjsGlobal.self=commonjsGlobal);var isWorkerRuntime$1=function(){return!("undefined"==typeof self||!self.postMessage)},postMessageToMaster$1=function(e){self.postMessage(e)},muxingHandlerSetUp=!1,messageHandlers=new Set,subscribeToMasterMessages$1=function(e){muxingHandlerSetUp||(self.addEventListener("message",(function(e){messageHandlers.forEach((function(t){return t(e.data)}))})),muxingHandlerSetUp=!0),messageHandlers.add(e);return function(){return messageHandlers.delete(e)}};implementation_tinyWorker.default={isWorkerRuntime:isWorkerRuntime$1,postMessageToMaster:postMessageToMaster$1,subscribeToMasterMessages:subscribeToMasterMessages$1};var implementation_worker_threads={},worker_threads={},implementation;function selectImplementation(){return"function"==typeof __non_webpack_require__?__non_webpack_require__("worker_threads"):eval("require")("worker_threads")}function getImplementation(){return implementation||(implementation=selectImplementation()),implementation}Object.defineProperty(worker_threads,"__esModule",{value:!0}),worker_threads.default=getImplementation;var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(implementation_worker_threads,"__esModule",{value:!0});var worker_threads_1=__importDefault$1(worker_threads);function assertMessagePort(e){if(!e)throw Error("Invariant violation: MessagePort to parent is not available.");return e}var isWorkerRuntime=function(){return!worker_threads_1.default().isMainThread},postMessageToMaster=function(e,t){assertMessagePort(worker_threads_1.default().parentPort).postMessage(e,t)},subscribeToMasterMessages=function(e){var t=worker_threads_1.default().parentPort;if(!t)throw Error("Invariant violation: MessagePort to parent is not available.");var r=function(t){e(t)};return assertMessagePort(t).on("message",r),function(){assertMessagePort(t).off("message",r)}};function testImplementation(){worker_threads_1.default()}implementation_worker_threads.default={isWorkerRuntime:isWorkerRuntime,postMessageToMaster:postMessageToMaster,subscribeToMasterMessages:subscribeToMasterMessages,testImplementation:testImplementation};var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(implementation$1,"__esModule",{value:!0});var implementation_browser_1=__importDefault(implementation_browser),implementation_tiny_worker_1=__importDefault(implementation_tinyWorker),implementation_worker_threads_1=__importDefault(implementation_worker_threads),runningInNode="undefined"!=typeof process&&"browser"!==process.arch&&"pid"in process;function selectNodeImplementation(){try{return implementation_worker_threads_1.default.testImplementation(),implementation_worker_threads_1.default}catch(e){return implementation_tiny_worker_1.default}}implementation$1.default=runningInNode?selectNodeImplementation():implementation_browser_1.default,function(e){var t=commonjsGlobal&&commonjsGlobal.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,s)}l((n=n.apply(e,t||[])).next())}))},r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;var n=r(isObservable),a=common$1,i=transferable,o=messages$1,s=r(implementation$1),l=common$1;Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var f=transferable;Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return f.Transfer}}),e.isWorkerRuntime=s.default.isWorkerRuntime;var c=!1,u=new Map,d=function(e){return e&&e.type===o.MasterMessageType.run},h=function(e){return n.default(e)||function(e){return e&&"object"===_typeof(e)&&"function"==typeof e.subscribe}(e)};function p(e){return i.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function m(e,t){var r=p(t),n=r.payload,i=r.transferables,l={type:o.WorkerMessageType.error,uid:e,error:a.serialize(n)};s.default.postMessageToMaster(l,i)}function g(e,t,r){var n=p(r),a=n.payload,i=n.transferables,l={type:o.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:a};s.default.postMessageToMaster(l,i)}function y(e,t){var r={type:o.WorkerMessageType.running,uid:e,resultType:t};s.default.postMessageToMaster(r)}function _(e){try{var t={type:o.WorkerMessageType.uncaughtError,error:a.serialize(e)};s.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\\nLatest error:",t,"\\nOriginal error:",e)}}function b(e,r,n){return t(this,void 0,void 0,regeneratorRuntime.mark((function t(){var i,o,s,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=r.apply(void 0,_toConsumableArray(n)),t.next=7;break;case 4:return t.prev=4,t.t0=t.catch(0),t.abrupt("return",m(e,t.t0));case 7:if(o=h(i)?"observable":"promise",y(e,o),!h(i)){t.next=14;break}s=i.subscribe((function(t){return g(e,!1,a.serialize(t))}),(function(t){m(e,a.serialize(t)),u.delete(e)}),(function(){g(e,!0),u.delete(e)})),u.set(e,s),t.next=24;break;case 14:return t.prev=14,t.next=17,i;case 17:l=t.sent,g(e,!0,a.serialize(l)),t.next=24;break;case 21:t.prev=21,t.t1=t.catch(14),m(e,a.serialize(t.t1));case 24:case"end":return t.stop()}}),t,null,[[0,4],[14,21]])})))}e.expose=function(e){if(!s.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(c)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(c=!0,"function"==typeof e)s.default.subscribeToMasterMessages((function(t){d(t)&&!t.method&&b(t.uid,e,t.args.map(a.deserialize))})),t={type:o.WorkerMessageType.init,exposed:{type:"function"}},s.default.postMessageToMaster(t);else{if("object"!==_typeof(e)||!e)throw Error("Invalid argument passed to expose(). Expected a function or an object, got: ".concat(e));s.default.subscribeToMasterMessages((function(t){d(t)&&t.method&&b(t.uid,e[t.method],t.args.map(a.deserialize))})),function(e){var t={type:o.WorkerMessageType.init,exposed:{type:"module",methods:e}};s.default.postMessageToMaster(t)}(Object.keys(e).filter((function(t){return"function"==typeof e[t]})))}var t;s.default.subscribeToMasterMessages((function(e){if((n=e)&&n.type===o.MasterMessageType.cancel){var t=e.uid,r=u.get(t);r&&(r.unsubscribe(),u.delete(t))}var n}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&s.default.isWorkerRuntime()&&(self.addEventListener("error",(function(e){setTimeout((function(){return _(e.error||e)}),250)})),self.addEventListener("unhandledrejection",(function(e){var t=e.reason;t&&"string"==typeof t.message&&setTimeout((function(){return _(t)}),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&s.default.isWorkerRuntime()&&(process.on("uncaughtException",(function(e){setTimeout((function(){return _(e)}),250)})),process.on("unhandledRejection",(function(e){e&&"string"==typeof e.message&&setTimeout((function(){return _(e)}),250)})))}(worker);var WorkerContext=getDefaultExportFromCjs(worker),expose=WorkerContext.expose;WorkerContext.registerSerializer;var Transfer=WorkerContext.Transfer,registry=new Map;function addDecoder(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){return registry.set(e,t)}))}function getDecoder(e){return _getDecoder.apply(this,arguments)}function _getDecoder(){return(_getDecoder=_asyncToGenerator(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=registry.get(t.Compression)){e.next=3;break}throw new Error("Unknown compression method identifier: ".concat(t.Compression));case 3:return e.next=5,r();case 5:return n=e.sent,e.abrupt("return",new n(t));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function decode(e,t){return _decode.apply(this,arguments)}function _decode(){return(_decode=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r){var n,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getDecoder(t);case 2:return n=e.sent,e.next=5,n.decode(t,r);case 5:return a=e.sent,e.abrupt("return",Transfer(a));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function decodeRowAcc(e,t){var r=e.length-t,n=0;do{for(var a=t;a>0;a--)e[n+t]+=e[n],n++;r-=t}while(r>0)}function decodeRowFloatingPoint(e,t,r){for(var n=0,a=e.length,i=a/r;a>t;){for(var o=t;o>0;--o)e[n+t]+=e[n],++n;a-=t}for(var s=e.slice(),l=0;l<i;++l)for(var f=0;f<r;++f)e[r*l+f]=s[(r-f-1)*i+l]}function applyPredictor(e,t,r,n,a,i){if(!t||1===t)return e;for(var o=0;o<a.length;++o){if(a[o]%8!=0)throw new Error("When decoding with predictor, only multiple of 8 bits are supported.");if(a[o]!==a[0])throw new Error("When decoding with predictor, all samples must have the same size.")}for(var s=a[0]/8,l=2===i?1:a.length,f=0;f<n&&!(f*l*r*s>=e.byteLength);++f){var c=void 0;if(2===t){switch(a[0]){case 8:c=new Uint8Array(e,f*l*r*s,l*r*s);break;case 16:c=new Uint16Array(e,f*l*r*s,l*r*s/2);break;case 32:c=new Uint32Array(e,f*l*r*s,l*r*s/4);break;default:throw new Error("Predictor 2 not allowed with ".concat(a[0]," bits per sample."))}decodeRowAcc(c,l)}else 3===t&&decodeRowFloatingPoint(c=new Uint8Array(e,f*l*r*s,l*r*s),l,s)}return e}addDecoder([void 0,1],(function(){return Promise.resolve().then((function(){return raw})).then((function(e){return e.default}))})),addDecoder(5,(function(){return Promise.resolve().then((function(){return lzw})).then((function(e){return e.default}))})),addDecoder(6,(function(){throw new Error("old style JPEG compression is not supported.")})),addDecoder(7,(function(){return Promise.resolve().then((function(){return jpeg})).then((function(e){return e.default}))})),addDecoder([8,32946],(function(){return Promise.resolve().then((function(){return deflate})).then((function(e){return e.default}))})),addDecoder(32773,(function(){return Promise.resolve().then((function(){return packbits})).then((function(e){return e.default}))})),addDecoder(34887,(function(){return Promise.resolve().then((function(){return lerc})).then((function(e){return e.default}))})),expose(decode);var BaseDecoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"decode",value:function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,r){var n,a,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decodeBlock(r);case 2:if(n=e.sent,1===(a=t.Predictor||1)){e.next=9;break}return i=!t.StripOffsets,o=i?t.TileWidth:t.ImageWidth,s=i?t.TileLength:t.RowsPerStrip||t.ImageLength,e.abrupt("return",applyPredictor(n,a,o,s,t.BitsPerSample,t.PlanarConfiguration));case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),RawDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"decodeBlock",value:function(e){return e}}]),r}(),raw=Object.freeze({__proto__:null,default:RawDecoder}),MIN_BITS=9,CLEAR_CODE=256,EOI_CODE=257,MAX_BYTELENGTH=12;function getByte(e,t,r){var n=t%8,a=Math.floor(t/8),i=8-n,o=t+r-8*(a+1),s=8*(a+2)-(t+r),l=8*(a+2)-t;if(s=Math.max(0,s),a>=e.length)return console.warn("ran off the end of the buffer before finding EOI_CODE (end on input code)"),EOI_CODE;var f=e[a]&Math.pow(2,8-n)-1,c=f<<=r-i;if(a+1<e.length){var u=e[a+1]>>>s;c+=u<<=Math.max(0,r-l)}if(o>8&&a+2<e.length){var d=8*(a+3)-(t+r);c+=e[a+2]>>>d}return c}function appendReversed(e,t){for(var r=t.length-1;r>=0;r--)e.push(t[r]);return e}function decompress(e){for(var t=new Uint16Array(4093),r=new Uint8Array(4093),n=0;n<=257;n++)t[n]=4096,r[n]=n;var a=258,i=MIN_BITS,o=0;function s(){a=258,i=MIN_BITS}function l(e){var t=getByte(e,o,i);return o+=i,t}function f(e,n){return r[a]=n,t[a]=e,++a-1}function c(e){for(var n=[],a=e;4096!==a;a=t[a])n.push(r[a]);return n}var u=[];s();for(var d,h=new Uint8Array(e),p=l(h);p!==EOI_CODE;){if(p===CLEAR_CODE){for(s(),p=l(h);p===CLEAR_CODE;)p=l(h);if(p===EOI_CODE)break;if(p>CLEAR_CODE)throw new Error("corrupted code at scanline ".concat(p));appendReversed(u,c(p)),d=p}else if(p<a){var m=c(p);appendReversed(u,m),f(d,m[m.length-1]),d=p}else{var g=c(d);if(!g)throw new Error("Bogus entry. Not in dictionary, ".concat(d," / ").concat(a,", position: ").concat(o));appendReversed(u,g),u.push(g[g.length-1]),f(d,g[g.length-1]),d=p}a+1>=Math.pow(2,i)&&(i===MAX_BYTELENGTH?d=void 0:i++),p=l(h)}return new Uint8Array(u)}var LZWDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"decodeBlock",value:function(e){return decompress(e).buffer}}]),r}(),lzw=Object.freeze({__proto__:null,default:LZWDecoder}),dctZigZag=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),dctCos1=4017,dctSin1=799,dctCos3=3406,dctSin3=2276,dctCos6=1567,dctSin6=3784,dctSqrt2=5793,dctSqrt1d2=2896;function buildHuffmanTable(e,t){for(var r=0,n=[],a=16;a>0&&!e[a-1];)--a;n.push({children:[],index:0});for(var i,o=n[0],s=0;s<a;s++){for(var l=0;l<e[s];l++){for((o=n.pop()).children[o.index]=t[r];o.index>0;)o=n.pop();for(o.index++,n.push(o);n.length<=s;)n.push(i={children:[],index:0}),o.children[o.index]=i.children,o=i;r++}s+1<a&&(n.push(i={children:[],index:0}),o.children[o.index]=i.children,o=i)}return n[0].children}function decodeScan(e,t,r,n,a,i,o,s,l){var f=r.mcusPerLine,c=r.progressive,u=t,d=t,h=0,p=0;function m(){if(p>0)return p--,h>>p&1;if(255===(h=e[d++])){var t=e[d++];if(t)throw new Error("unexpected marker: ".concat((h<<8|t).toString(16)))}return p=7,h>>>7}function g(e){for(var t,r=e;null!==(t=m());){if("number"==typeof(r=r[t]))return r;if("object"!==_typeof(r))throw new Error("invalid huffman sequence")}return null}function y(e){for(var t=e,r=0;t>0;){var n=m();if(null===n)return;r=r<<1|n,--t}return r}function _(e){var t=y(e);return t>=1<<e-1?t:t+(-1<<e)+1}var b=0;var v,w=0;function k(e,t,r,n,a){var i=r%f,o=(r/f|0)*e.v+n,s=i*e.h+a;t(e,e.blocks[o][s])}function T(e,t,r){var n=r/e.blocksPerLine|0,a=r%e.blocksPerLine;t(e,e.blocks[n][a])}var E,x,S,D,A,M,I=n.length;M=c?0===i?0===s?function(e,t){var r=g(e.huffmanTableDC),n=0===r?0:_(r)<<l;e.pred+=n,t[0]=e.pred}:function(e,t){t[0]|=m()<<l}:0===s?function(e,t){if(b>0)b--;else for(var r=i,n=o;r<=n;){var a=g(e.huffmanTableAC),s=15&a,f=a>>4;if(0===s){if(f<15){b=y(f)+(1<<f)-1;break}r+=16}else t[dctZigZag[r+=f]]=_(s)*(1<<l),r++}}:function(e,t){for(var r=i,n=o,a=0;r<=n;){var s=dctZigZag[r],f=t[s]<0?-1:1;switch(w){case 0:var c=g(e.huffmanTableAC),u=15&c;if(a=c>>4,0===u)a<15?(b=y(a)+(1<<a),w=4):(a=16,w=1);else{if(1!==u)throw new Error("invalid ACn encoding");v=_(u),w=a?2:3}continue;case 1:case 2:t[s]?t[s]+=(m()<<l)*f:0==--a&&(w=2===w?3:0);break;case 3:t[s]?t[s]+=(m()<<l)*f:(t[s]=v<<l,w=0);break;case 4:t[s]&&(t[s]+=(m()<<l)*f)}r++}4===w&&0==--b&&(w=0)}:function(e,t){var r=g(e.huffmanTableDC),n=0===r?0:_(r);e.pred+=n,t[0]=e.pred;for(var a=1;a<64;){var i=g(e.huffmanTableAC),o=15&i,s=i>>4;if(0===o){if(s<15)break;a+=16}else t[dctZigZag[a+=s]]=_(o),a++}};var R,O,C=0;O=1===I?n[0].blocksPerLine*n[0].blocksPerColumn:f*r.mcusPerColumn;for(var P=a||O;C<O;){for(x=0;x<I;x++)n[x].pred=0;if(b=0,1===I)for(E=n[0],A=0;A<P;A++)T(E,M,C),C++;else for(A=0;A<P;A++){for(x=0;x<I;x++){var L=E=n[x],U=L.h,B=L.v;for(S=0;S<B;S++)for(D=0;D<U;D++)k(E,M,C,S,D)}if(++C===O)break}if(p=0,(R=e[d]<<8|e[d+1])<65280)throw new Error("marker was not found");if(!(R>=65488&&R<=65495))break;d+=2}return d-u}function buildComponentData(e,t){var r=[],n=t.blocksPerLine,a=t.blocksPerColumn,i=n<<3,o=new Int32Array(64),s=new Uint8Array(64);function l(e,r,n){var a,i,o,s,l,f,c,u,d,h,p=t.quantizationTable,m=n;for(h=0;h<64;h++)m[h]=e[h]*p[h];for(h=0;h<8;++h){var g=8*h;0!==m[1+g]||0!==m[2+g]||0!==m[3+g]||0!==m[4+g]||0!==m[5+g]||0!==m[6+g]||0!==m[7+g]?(a=dctSqrt2*m[0+g]+128>>8,i=dctSqrt2*m[4+g]+128>>8,o=m[2+g],s=m[6+g],l=dctSqrt1d2*(m[1+g]-m[7+g])+128>>8,u=dctSqrt1d2*(m[1+g]+m[7+g])+128>>8,f=m[3+g]<<4,c=m[5+g]<<4,d=a-i+1>>1,a=a+i+1>>1,i=d,d=o*dctSin6+s*dctCos6+128>>8,o=o*dctCos6-s*dctSin6+128>>8,s=d,d=l-c+1>>1,l=l+c+1>>1,c=d,d=u+f+1>>1,f=u-f+1>>1,u=d,d=a-s+1>>1,a=a+s+1>>1,s=d,d=i-o+1>>1,i=i+o+1>>1,o=d,d=l*dctSin3+u*dctCos3+2048>>12,l=l*dctCos3-u*dctSin3+2048>>12,u=d,d=f*dctSin1+c*dctCos1+2048>>12,f=f*dctCos1-c*dctSin1+2048>>12,c=d,m[0+g]=a+u,m[7+g]=a-u,m[1+g]=i+c,m[6+g]=i-c,m[2+g]=o+f,m[5+g]=o-f,m[3+g]=s+l,m[4+g]=s-l):(d=dctSqrt2*m[0+g]+512>>10,m[0+g]=d,m[1+g]=d,m[2+g]=d,m[3+g]=d,m[4+g]=d,m[5+g]=d,m[6+g]=d,m[7+g]=d)}for(h=0;h<8;++h){var y=h;0!==m[8+y]||0!==m[16+y]||0!==m[24+y]||0!==m[32+y]||0!==m[40+y]||0!==m[48+y]||0!==m[56+y]?(a=dctSqrt2*m[0+y]+2048>>12,i=dctSqrt2*m[32+y]+2048>>12,o=m[16+y],s=m[48+y],l=dctSqrt1d2*(m[8+y]-m[56+y])+2048>>12,u=dctSqrt1d2*(m[8+y]+m[56+y])+2048>>12,f=m[24+y],c=m[40+y],d=a-i+1>>1,a=a+i+1>>1,i=d,d=o*dctSin6+s*dctCos6+2048>>12,o=o*dctCos6-s*dctSin6+2048>>12,s=d,d=l-c+1>>1,l=l+c+1>>1,c=d,d=u+f+1>>1,f=u-f+1>>1,u=d,d=a-s+1>>1,a=a+s+1>>1,s=d,d=i-o+1>>1,i=i+o+1>>1,o=d,d=l*dctSin3+u*dctCos3+2048>>12,l=l*dctCos3-u*dctSin3+2048>>12,u=d,d=f*dctSin1+c*dctCos1+2048>>12,f=f*dctCos1-c*dctSin1+2048>>12,c=d,m[0+y]=a+u,m[56+y]=a-u,m[8+y]=i+c,m[48+y]=i-c,m[16+y]=o+f,m[40+y]=o-f,m[24+y]=s+l,m[32+y]=s-l):(d=dctSqrt2*n[h+0]+8192>>14,m[0+y]=d,m[8+y]=d,m[16+y]=d,m[24+y]=d,m[32+y]=d,m[40+y]=d,m[48+y]=d,m[56+y]=d)}for(h=0;h<64;++h){var _=128+(m[h]+8>>4);r[h]=_<0?0:_>255?255:_}}for(var f=0;f<a;f++){for(var c=f<<3,u=0;u<8;u++)r.push(new Uint8Array(i));for(var d=0;d<n;d++){l(t.blocks[f][d],s,o);for(var h=0,p=d<<3,m=0;m<8;m++)for(var g=r[c+m],y=0;y<8;y++)g[p+y]=s[h++]}}return r}var JpegStreamReader=function(){function e(){_classCallCheck(this,e),this.jfif=null,this.adobe=null,this.quantizationTables=[],this.huffmanTablesAC=[],this.huffmanTablesDC=[],this.resetFrames()}return _createClass(e,[{key:"resetFrames",value:function(){this.frames=[]}},{key:"parse",value:function(e){var t=0;function r(){var r=e[t]<<8|e[t+1];return t+=2,r}function n(e){var t,r,n=0,a=0;for(r in e.components)e.components.hasOwnProperty(r)&&(n<(t=e.components[r]).h&&(n=t.h),a<t.v&&(a=t.v));var i=Math.ceil(e.samplesPerLine/8/n),o=Math.ceil(e.scanLines/8/a);for(r in e.components)if(e.components.hasOwnProperty(r)){t=e.components[r];for(var s=Math.ceil(Math.ceil(e.samplesPerLine/8)*t.h/n),l=Math.ceil(Math.ceil(e.scanLines/8)*t.v/a),f=i*t.h,c=o*t.v,u=[],d=0;d<c;d++){for(var h=[],p=0;p<f;p++)h.push(new Int32Array(64));u.push(h)}t.blocksPerLine=s,t.blocksPerColumn=l,t.blocks=u}e.maxH=n,e.maxV=a,e.mcusPerLine=i,e.mcusPerColumn=o}var a,i,o=r();if(65496!==o)throw new Error("SOI not found");for(o=r();65497!==o;){switch(o){case 65280:break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var s=(a=void 0,i=void 0,a=r(),i=e.subarray(t,t+a-2),t+=i.length,i);65504===o&&74===s[0]&&70===s[1]&&73===s[2]&&70===s[3]&&0===s[4]&&(this.jfif={version:{major:s[5],minor:s[6]},densityUnits:s[7],xDensity:s[8]<<8|s[9],yDensity:s[10]<<8|s[11],thumbWidth:s[12],thumbHeight:s[13],thumbData:s.subarray(14,14+3*s[12]*s[13])}),65518===o&&65===s[0]&&100===s[1]&&111===s[2]&&98===s[3]&&101===s[4]&&0===s[5]&&(this.adobe={version:s[6],flags0:s[7]<<8|s[8],flags1:s[9]<<8|s[10],transformCode:s[11]});break;case 65499:for(var l=r()+t-2;t<l;){var f=e[t++],c=new Int32Array(64);if(f>>4==0)for(var u=0;u<64;u++){c[dctZigZag[u]]=e[t++]}else{if(f>>4!=1)throw new Error("DQT: invalid table spec");for(var d=0;d<64;d++){c[dctZigZag[d]]=r()}}this.quantizationTables[15&f]=c}break;case 65472:case 65473:case 65474:r();for(var h={extended:65473===o,progressive:65474===o,precision:e[t++],scanLines:r(),samplesPerLine:r(),components:{},componentsOrder:[]},p=e[t++],m=void 0,g=0;g<p;g++){m=e[t];var y=e[t+1]>>4,_=15&e[t+1],b=e[t+2];h.componentsOrder.push(m),h.components[m]={h:y,v:_,quantizationIdx:b},t+=3}n(h),this.frames.push(h);break;case 65476:for(var v=r(),w=2;w<v;){for(var k=e[t++],T=new Uint8Array(16),E=0,x=0;x<16;x++,t++)T[x]=e[t],E+=T[x];for(var S=new Uint8Array(E),D=0;D<E;D++,t++)S[D]=e[t];w+=17+E,k>>4==0?this.huffmanTablesDC[15&k]=buildHuffmanTable(T,S):this.huffmanTablesAC[15&k]=buildHuffmanTable(T,S)}break;case 65501:r(),this.resetInterval=r();break;case 65498:r();for(var A=e[t++],M=[],I=this.frames[0],R=0;R<A;R++){var O=I.components[e[t++]],C=e[t++];O.huffmanTableDC=this.huffmanTablesDC[C>>4],O.huffmanTableAC=this.huffmanTablesAC[15&C],M.push(O)}var P=e[t++],L=e[t++],U=e[t++],B=decodeScan(e,t,I,M,this.resetInterval,P,L,U>>4,15&U);t+=B;break;case 65535:255!==e[t]&&t--;break;default:if(255===e[t-3]&&e[t-2]>=192&&e[t-2]<=254){t-=3;break}throw new Error("unknown JPEG marker ".concat(o.toString(16)))}o=r()}}},{key:"getResult",value:function(){var e=this.frames;if(0===this.frames.length)throw new Error("no frames were decoded");this.frames.length>1&&console.warn("more than one frame is not supported");for(var t=0;t<this.frames.length;t++)for(var r=this.frames[t].components,n=0,a=Object.keys(r);n<a.length;n++){var i=a[n];r[i].quantizationTable=this.quantizationTables[r[i].quantizationIdx],delete r[i].quantizationIdx}for(var o=e[0],s=o.components,l=o.componentsOrder,f=[],c=o.samplesPerLine,u=o.scanLines,d=0;d<l.length;d++){var h=s[l[d]];f.push({lines:buildComponentData(o,h),scaleX:h.h/o.maxH,scaleY:h.v/o.maxV})}for(var p=new Uint8Array(c*u*f.length),m=0,g=0;g<u;++g)for(var y=0;y<c;++y)for(var _=0;_<f.length;++_){var b=f[_];p[m]=b.lines[0|g*b.scaleY][0|y*b.scaleX],++m}return p}}]),e}(),JpegDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).reader=new JpegStreamReader,e.JPEGTables&&n.reader.parse(e.JPEGTables),n}return _createClass(r,[{key:"decodeBlock",value:function(e){return this.reader.resetFrames(),this.reader.parse(new Uint8Array(e)),this.reader.getResult().buffer}}]),r}(),jpeg=Object.freeze({__proto__:null,default:JpegDecoder});function zero$1(e){for(var t=e.length;--t>=0;)e[t]=0}var MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,DIST_CODE_LEN=512,static_ltree=new Array(2*(L_CODES$1+2));zero$1(static_ltree);var static_dtree=new Array(2*D_CODES$1);zero$1(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);var _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);var base_length=new Array(LENGTH_CODES$1);zero$1(base_length);var base_dist=new Array(D_CODES$1);zero$1(base_dist);var adler32=function(e,t,r,n){for(var a=65535&e|0,i=e>>>16&65535|0,o=0;0!==r;){r-=o=r>2e3?2e3:r;do{i=i+(a=a+t[n++]|0)|0}while(--o);a%=65521,i%=65521}return a|i<<16|0},adler32_1=adler32,makeTable=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t},crcTable=new Uint32Array(makeTable()),crc32=function(e,t,r,n){var a=crcTable,i=n+r;e^=-1;for(var o=n;o<i;o++)e=e>>>8^a[255&(e^t[o])];return-1^e},crc32_1=crc32,messages={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},constants$2={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},_has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var r=t.shift();if(r){if("object"!==_typeof(r))throw new TypeError(r+"must be non-object");for(var n in r)_has(r,n)&&(e[n]=r[n])}}return e},flattenChunks=function(e){for(var t=0,r=0,n=e.length;r<n;r++)t+=e[r].length;for(var a=new Uint8Array(t),i=0,o=0,s=e.length;i<s;i++){var l=e[i];a.set(l,o),o+=l.length}return a},common={assign:assign,flattenChunks:flattenChunks},STR_APPLY_UIA_OK=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){STR_APPLY_UIA_OK=!1}for(var _utf8len=new Uint8Array(256),q=0;q<256;q++)_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1;_utf8len[254]=_utf8len[254]=1;var string2buf=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,r,n,a,i,o=e.length,s=0;for(a=0;a<o;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(s),i=0,a=0;i<s;a++)55296==(64512&(r=e.charCodeAt(a)))&&a+1<o&&56320==(64512&(n=e.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(n-56320),a++),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},buf2binstring=function(e,t){if(t<65534&&e.subarray&&STR_APPLY_UIA_OK)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r},buf2string=function(e,t){var r,n,a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var i=new Array(2*a);for(n=0,r=0;r<a;){var o=e[r++];if(o<128)i[n++]=o;else{var s=_utf8len[o];if(s>4)i[n++]=65533,r+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&r<a;)o=o<<6|63&e[r++],s--;s>1?i[n++]=65533:o<65536?i[n++]=o:(o-=65536,i[n++]=55296|o>>10&1023,i[n++]=56320|1023&o)}}}return buf2binstring(i,n)},utf8border=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+_utf8len[e[r]]>t?r:t},strings={string2buf:string2buf,buf2string:buf2string,utf8border:utf8border};function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var zstream=ZStream,BAD$1=30,TYPE$1=12,inffast=function(e,t){var r,n,a,i,o,s,l,f,c,u,d,h,p,m,g,y,_,b,v,w,k,T,E,x,S=e.state;r=e.next_in,E=e.input,n=r+(e.avail_in-5),a=e.next_out,x=e.output,i=a-(t-e.avail_out),o=a+(e.avail_out-257),s=S.dmax,l=S.wsize,f=S.whave,c=S.wnext,u=S.window,d=S.hold,h=S.bits,p=S.lencode,m=S.distcode,g=(1<<S.lenbits)-1,y=(1<<S.distbits)-1;e:do{h<15&&(d+=E[r++]<<h,h+=8,d+=E[r++]<<h,h+=8),_=p[d&g];t:for(;;){if(d>>>=b=_>>>24,h-=b,0===(b=_>>>16&255))x[a++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=p[(65535&_)+(d&(1<<b)-1)];continue t}if(32&b){S.mode=TYPE$1;break e}e.msg="invalid literal/length code",S.mode=BAD$1;break e}v=65535&_,(b&=15)&&(h<b&&(d+=E[r++]<<h,h+=8),v+=d&(1<<b)-1,d>>>=b,h-=b),h<15&&(d+=E[r++]<<h,h+=8,d+=E[r++]<<h,h+=8),_=m[d&y];r:for(;;){if(d>>>=b=_>>>24,h-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=m[(65535&_)+(d&(1<<b)-1)];continue r}e.msg="invalid distance code",S.mode=BAD$1;break e}if(w=65535&_,h<(b&=15)&&(d+=E[r++]<<h,(h+=8)<b&&(d+=E[r++]<<h,h+=8)),(w+=d&(1<<b)-1)>s){e.msg="invalid distance too far back",S.mode=BAD$1;break e}if(d>>>=b,h-=b,w>(b=a-i)){if((b=w-b)>f&&S.sane){e.msg="invalid distance too far back",S.mode=BAD$1;break e}if(k=0,T=u,0===c){if(k+=l-b,b<v){v-=b;do{x[a++]=u[k++]}while(--b);k=a-w,T=x}}else if(c<b){if(k+=l+c-b,(b-=c)<v){v-=b;do{x[a++]=u[k++]}while(--b);if(k=0,c<v){v-=b=c;do{x[a++]=u[k++]}while(--b);k=a-w,T=x}}}else if(k+=c-b,b<v){v-=b;do{x[a++]=u[k++]}while(--b);k=a-w,T=x}for(;v>2;)x[a++]=T[k++],x[a++]=T[k++],x[a++]=T[k++],v-=3;v&&(x[a++]=T[k++],v>1&&(x[a++]=T[k++]))}else{k=a-w;do{x[a++]=x[k++],x[a++]=x[k++],x[a++]=x[k++],v-=3}while(v>2);v&&(x[a++]=x[k++],v>1&&(x[a++]=x[k++]))}break}}break}}while(r<n&&a<o);r-=v=h>>3,d&=(1<<(h-=v<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=a<o?o-a+257:257-(a-o),S.hold=d,S.bits=h},MAXBITS=15,ENOUGH_LENS$1=852,ENOUGH_DISTS$1=592,CODES$1=0,LENS$1=1,DISTS$1=2,lbase=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),lext=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),dbase=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dext=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),inflate_table=function(e,t,r,n,a,i,o,s){var l,f,c,u,d,h,p,m,g,y=s.bits,_=0,b=0,v=0,w=0,k=0,T=0,E=0,x=0,S=0,D=0,A=null,M=0,I=new Uint16Array(MAXBITS+1),R=new Uint16Array(MAXBITS+1),O=null,C=0;for(_=0;_<=MAXBITS;_++)I[_]=0;for(b=0;b<n;b++)I[t[r+b]]++;for(k=y,w=MAXBITS;w>=1&&0===I[w];w--);if(k>w&&(k=w),0===w)return a[i++]=20971520,a[i++]=20971520,s.bits=1,0;for(v=1;v<w&&0===I[v];v++);for(k<v&&(k=v),x=1,_=1;_<=MAXBITS;_++)if(x<<=1,(x-=I[_])<0)return-1;if(x>0&&(e===CODES$1||1!==w))return-1;for(R[1]=0,_=1;_<MAXBITS;_++)R[_+1]=R[_]+I[_];for(b=0;b<n;b++)0!==t[r+b]&&(o[R[t[r+b]]++]=b);if(e===CODES$1?(A=O=o,h=19):e===LENS$1?(A=lbase,M-=257,O=lext,C-=257,h=256):(A=dbase,O=dext,h=-1),D=0,b=0,_=v,d=i,T=k,E=0,c=-1,u=(S=1<<k)-1,e===LENS$1&&S>ENOUGH_LENS$1||e===DISTS$1&&S>ENOUGH_DISTS$1)return 1;for(;;){p=_-E,o[b]<h?(m=0,g=o[b]):o[b]>h?(m=O[C+o[b]],g=A[M+o[b]]):(m=96,g=0),l=1<<_-E,v=f=1<<T;do{a[d+(D>>E)+(f-=l)]=p<<24|m<<16|g|0}while(0!==f);for(l=1<<_-1;D&l;)l>>=1;if(0!==l?(D&=l-1,D+=l):D=0,b++,0==--I[_]){if(_===w)break;_=t[r+o[b]]}if(_>k&&(D&u)!==c){for(0===E&&(E=k),d+=v,x=1<<(T=_-E);T+E<w&&!((x-=I[T+E])<=0);)T++,x<<=1;if(S+=1<<T,e===LENS$1&&S>ENOUGH_LENS$1||e===DISTS$1&&S>ENOUGH_DISTS$1)return 1;a[c=D&u]=k<<24|T<<16|d-i|0}}return 0!==D&&(a[d+D]=_-E<<24|64<<16|0),s.bits=k,0},inftrees=inflate_table,CODES=0,LENS=1,DISTS=2,Z_FINISH$1=constants$2.Z_FINISH,Z_BLOCK=constants$2.Z_BLOCK,Z_TREES=constants$2.Z_TREES,Z_OK$1=constants$2.Z_OK,Z_STREAM_END$1=constants$2.Z_STREAM_END,Z_NEED_DICT$1=constants$2.Z_NEED_DICT,Z_STREAM_ERROR$1=constants$2.Z_STREAM_ERROR,Z_DATA_ERROR$1=constants$2.Z_DATA_ERROR,Z_MEM_ERROR$1=constants$2.Z_MEM_ERROR,Z_BUF_ERROR=constants$2.Z_BUF_ERROR,Z_DEFLATED=constants$2.Z_DEFLATED,HEAD=1,FLAGS=2,TIME=3,OS=4,EXLEN=5,EXTRA=6,NAME=7,COMMENT=8,HCRC=9,DICTID=10,DICT=11,TYPE=12,TYPEDO=13,STORED=14,COPY_=15,COPY=16,TABLE=17,LENLENS=18,CODELENS=19,LEN_=20,LEN=21,LENEXT=22,DIST=23,DISTEXT=24,MATCH=25,LIT=26,CHECK=27,LENGTH=28,DONE=29,BAD=30,MEM=31,SYNC=32,ENOUGH_LENS=852,ENOUGH_DISTS=592,MAX_WBITS=15,DEF_WBITS=MAX_WBITS,zswap32=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var inflateResetKeep=function(e){if(!e||!e.state)return Z_STREAM_ERROR$1;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=HEAD,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(ENOUGH_LENS),t.distcode=t.distdyn=new Int32Array(ENOUGH_DISTS),t.sane=1,t.back=-1,Z_OK$1},inflateReset=function(e){if(!e||!e.state)return Z_STREAM_ERROR$1;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,inflateResetKeep(e)},inflateReset2=function(e,t){var r;if(!e||!e.state)return Z_STREAM_ERROR$1;var n=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Z_STREAM_ERROR$1:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,inflateReset(e))},inflateInit2=function(e,t){if(!e)return Z_STREAM_ERROR$1;var r=new InflateState;e.state=r,r.window=null;var n=inflateReset2(e,t);return n!==Z_OK$1&&(e.state=null),n},inflateInit=function(e){return inflateInit2(e,DEF_WBITS)},virgin=!0,lenfix,distfix,fixedtables=function(e){if(virgin){lenfix=new Int32Array(512),distfix=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(inftrees(LENS,e.lens,0,288,lenfix,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;inftrees(DISTS,e.lens,0,32,distfix,0,e.work,{bits:5}),virgin=!1}e.lencode=lenfix,e.lenbits=9,e.distcode=distfix,e.distbits=5},updatewindow=function(e,t,r,n){var a,i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):((a=i.wsize-i.wnext)>n&&(a=n),i.window.set(t.subarray(r-n,r-n+a),i.wnext),(n-=a)?(i.window.set(t.subarray(r-n,r),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=a,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=a))),0},inflate$2=function(e,t){var r,n,a,i,o,s,l,f,c,u,d,h,p,m,g,y,_,b,v,w,k,T,E,x,S=0,D=new Uint8Array(4),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Z_STREAM_ERROR$1;(r=e.state).mode===TYPE&&(r.mode=TYPEDO),o=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,n=e.input,s=e.avail_in,f=r.hold,c=r.bits,u=s,d=l,T=Z_OK$1;e:for(;;)switch(r.mode){case HEAD:if(0===r.wrap){r.mode=TYPEDO;break}for(;c<16;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(2&r.wrap&&35615===f){r.check=0,D[0]=255&f,D[1]=f>>>8&255,r.check=crc32_1(r.check,D,2,0),f=0,c=0,r.mode=FLAGS;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",r.mode=BAD;break}if((15&f)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(c-=4,k=8+(15&(f>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){e.msg="invalid window size",r.mode=BAD;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&f?DICTID:TYPE,f=0,c=0;break;case FLAGS:for(;c<16;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(r.flags=f,(255&r.flags)!==Z_DEFLATED){e.msg="unknown compression method",r.mode=BAD;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=BAD;break}r.head&&(r.head.text=f>>8&1),512&r.flags&&(D[0]=255&f,D[1]=f>>>8&255,r.check=crc32_1(r.check,D,2,0)),f=0,c=0,r.mode=TIME;case TIME:for(;c<32;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.head&&(r.head.time=f),512&r.flags&&(D[0]=255&f,D[1]=f>>>8&255,D[2]=f>>>16&255,D[3]=f>>>24&255,r.check=crc32_1(r.check,D,4,0)),f=0,c=0,r.mode=OS;case OS:for(;c<16;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.head&&(r.head.xflags=255&f,r.head.os=f>>8),512&r.flags&&(D[0]=255&f,D[1]=f>>>8&255,r.check=crc32_1(r.check,D,2,0)),f=0,c=0,r.mode=EXLEN;case EXLEN:if(1024&r.flags){for(;c<16;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.length=f,r.head&&(r.head.extra_len=f),512&r.flags&&(D[0]=255&f,D[1]=f>>>8&255,r.check=crc32_1(r.check,D,2,0)),f=0,c=0}else r.head&&(r.head.extra=null);r.mode=EXTRA;case EXTRA:if(1024&r.flags&&((h=r.length)>s&&(h=s),h&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(i,i+h),k)),512&r.flags&&(r.check=crc32_1(r.check,n,h,i)),s-=h,i+=h,r.length-=h),r.length))break e;r.length=0,r.mode=NAME;case NAME:if(2048&r.flags){if(0===s)break e;h=0;do{k=n[i+h++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k))}while(k&&h<s);if(512&r.flags&&(r.check=crc32_1(r.check,n,h,i)),s-=h,i+=h,k)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=COMMENT;case COMMENT:if(4096&r.flags){if(0===s)break e;h=0;do{k=n[i+h++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k))}while(k&&h<s);if(512&r.flags&&(r.check=crc32_1(r.check,n,h,i)),s-=h,i+=h,k)break e}else r.head&&(r.head.comment=null);r.mode=HCRC;case HCRC:if(512&r.flags){for(;c<16;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(f!==(65535&r.check)){e.msg="header crc mismatch",r.mode=BAD;break}f=0,c=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=TYPE;break;case DICTID:for(;c<32;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}e.adler=r.check=zswap32(f),f=0,c=0,r.mode=DICT;case DICT:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=f,r.bits=c,Z_NEED_DICT$1;e.adler=r.check=1,r.mode=TYPE;case TYPE:if(t===Z_BLOCK||t===Z_TREES)break e;case TYPEDO:if(r.last){f>>>=7&c,c-=7&c,r.mode=CHECK;break}for(;c<3;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}switch(r.last=1&f,c-=1,3&(f>>>=1)){case 0:r.mode=STORED;break;case 1:if(fixedtables(r),r.mode=LEN_,t===Z_TREES){f>>>=2,c-=2;break e}break;case 2:r.mode=TABLE;break;case 3:e.msg="invalid block type",r.mode=BAD}f>>>=2,c-=2;break;case STORED:for(f>>>=7&c,c-=7&c;c<32;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",r.mode=BAD;break}if(r.length=65535&f,f=0,c=0,r.mode=COPY_,t===Z_TREES)break e;case COPY_:r.mode=COPY;case COPY:if(h=r.length){if(h>s&&(h=s),h>l&&(h=l),0===h)break e;a.set(n.subarray(i,i+h),o),s-=h,i+=h,l-=h,o+=h,r.length-=h;break}r.mode=TYPE;break;case TABLE:for(;c<14;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(r.nlen=257+(31&f),f>>>=5,c-=5,r.ndist=1+(31&f),f>>>=5,c-=5,r.ncode=4+(15&f),f>>>=4,c-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=BAD;break}r.have=0,r.mode=LENLENS;case LENLENS:for(;r.have<r.ncode;){for(;c<3;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.lens[A[r.have++]]=7&f,f>>>=3,c-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,E={bits:r.lenbits},T=inftrees(CODES,r.lens,0,19,r.lencode,0,r.work,E),r.lenbits=E.bits,T){e.msg="invalid code lengths set",r.mode=BAD;break}r.have=0,r.mode=CODELENS;case CODELENS:for(;r.have<r.nlen+r.ndist;){for(;y=(S=r.lencode[f&(1<<r.lenbits)-1])>>>16&255,_=65535&S,!((g=S>>>24)<=c);){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(_<16)f>>>=g,c-=g,r.lens[r.have++]=_;else{if(16===_){for(x=g+2;c<x;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(f>>>=g,c-=g,0===r.have){e.msg="invalid bit length repeat",r.mode=BAD;break}k=r.lens[r.have-1],h=3+(3&f),f>>>=2,c-=2}else if(17===_){for(x=g+3;c<x;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}c-=g,k=0,h=3+(7&(f>>>=g)),f>>>=3,c-=3}else{for(x=g+7;c<x;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}c-=g,k=0,h=11+(127&(f>>>=g)),f>>>=7,c-=7}if(r.have+h>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=BAD;break}for(;h--;)r.lens[r.have++]=k}}if(r.mode===BAD)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=BAD;break}if(r.lenbits=9,E={bits:r.lenbits},T=inftrees(LENS,r.lens,0,r.nlen,r.lencode,0,r.work,E),r.lenbits=E.bits,T){e.msg="invalid literal/lengths set",r.mode=BAD;break}if(r.distbits=6,r.distcode=r.distdyn,E={bits:r.distbits},T=inftrees(DISTS,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,E),r.distbits=E.bits,T){e.msg="invalid distances set",r.mode=BAD;break}if(r.mode=LEN_,t===Z_TREES)break e;case LEN_:r.mode=LEN;case LEN:if(s>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=f,r.bits=c,inffast(e,d),o=e.next_out,a=e.output,l=e.avail_out,i=e.next_in,n=e.input,s=e.avail_in,f=r.hold,c=r.bits,r.mode===TYPE&&(r.back=-1);break}for(r.back=0;y=(S=r.lencode[f&(1<<r.lenbits)-1])>>>16&255,_=65535&S,!((g=S>>>24)<=c);){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(y&&0==(240&y)){for(b=g,v=y,w=_;y=(S=r.lencode[w+((f&(1<<b+v)-1)>>b)])>>>16&255,_=65535&S,!(b+(g=S>>>24)<=c);){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}f>>>=b,c-=b,r.back+=b}if(f>>>=g,c-=g,r.back+=g,r.length=_,0===y){r.mode=LIT;break}if(32&y){r.back=-1,r.mode=TYPE;break}if(64&y){e.msg="invalid literal/length code",r.mode=BAD;break}r.extra=15&y,r.mode=LENEXT;case LENEXT:if(r.extra){for(x=r.extra;c<x;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.length+=f&(1<<r.extra)-1,f>>>=r.extra,c-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=DIST;case DIST:for(;y=(S=r.distcode[f&(1<<r.distbits)-1])>>>16&255,_=65535&S,!((g=S>>>24)<=c);){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(0==(240&y)){for(b=g,v=y,w=_;y=(S=r.distcode[w+((f&(1<<b+v)-1)>>b)])>>>16&255,_=65535&S,!(b+(g=S>>>24)<=c);){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}f>>>=b,c-=b,r.back+=b}if(f>>>=g,c-=g,r.back+=g,64&y){e.msg="invalid distance code",r.mode=BAD;break}r.offset=_,r.extra=15&y,r.mode=DISTEXT;case DISTEXT:if(r.extra){for(x=r.extra;c<x;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}r.offset+=f&(1<<r.extra)-1,f>>>=r.extra,c-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=BAD;break}r.mode=MATCH;case MATCH:if(0===l)break e;if(h=d-l,r.offset>h){if((h=r.offset-h)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=BAD;break}h>r.wnext?(h-=r.wnext,p=r.wsize-h):p=r.wnext-h,h>r.length&&(h=r.length),m=r.window}else m=a,p=o-r.offset,h=r.length;h>l&&(h=l),l-=h,r.length-=h;do{a[o++]=m[p++]}while(--h);0===r.length&&(r.mode=LEN);break;case LIT:if(0===l)break e;a[o++]=r.length,l--,r.mode=LEN;break;case CHECK:if(r.wrap){for(;c<32;){if(0===s)break e;s--,f|=n[i++]<<c,c+=8}if(d-=l,e.total_out+=d,r.total+=d,d&&(e.adler=r.check=r.flags?crc32_1(r.check,a,d,o-d):adler32_1(r.check,a,d,o-d)),d=l,(r.flags?f:zswap32(f))!==r.check){e.msg="incorrect data check",r.mode=BAD;break}f=0,c=0}r.mode=LENGTH;case LENGTH:if(r.wrap&&r.flags){for(;c<32;){if(0===s)break e;s--,f+=n[i++]<<c,c+=8}if(f!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=BAD;break}f=0,c=0}r.mode=DONE;case DONE:T=Z_STREAM_END$1;break e;case BAD:T=Z_DATA_ERROR$1;break e;case MEM:return Z_MEM_ERROR$1;case SYNC:default:return Z_STREAM_ERROR$1}return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=s,r.hold=f,r.bits=c,(r.wsize||d!==e.avail_out&&r.mode<BAD&&(r.mode<CHECK||t!==Z_FINISH$1))&&updatewindow(e,e.output,e.next_out,d-e.avail_out),u-=e.avail_in,d-=e.avail_out,e.total_in+=u,e.total_out+=d,r.total+=d,r.wrap&&d&&(e.adler=r.check=r.flags?crc32_1(r.check,a,d,e.next_out-d):adler32_1(r.check,a,d,e.next_out-d)),e.data_type=r.bits+(r.last?64:0)+(r.mode===TYPE?128:0)+(r.mode===LEN_||r.mode===COPY_?256:0),(0===u&&0===d||t===Z_FINISH$1)&&T===Z_OK$1&&(T=Z_BUF_ERROR),T},inflateEnd=function(e){if(!e||!e.state)return Z_STREAM_ERROR$1;var t=e.state;return t.window&&(t.window=null),e.state=null,Z_OK$1},inflateGetHeader=function(e,t){if(!e||!e.state)return Z_STREAM_ERROR$1;var r=e.state;return 0==(2&r.wrap)?Z_STREAM_ERROR$1:(r.head=t,t.done=!1,Z_OK$1)},inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&r.mode!==DICT?Z_STREAM_ERROR$1:r.mode===DICT&&adler32_1(1,t,n,0)!==r.check?Z_DATA_ERROR$1:updatewindow(e,t,n,n)?(r.mode=MEM,Z_MEM_ERROR$1):(r.havedict=1,Z_OK$1):Z_STREAM_ERROR$1},inflateReset_1=inflateReset,inflateReset2_1=inflateReset2,inflateResetKeep_1=inflateResetKeep,inflateInit_1=inflateInit,inflateInit2_1=inflateInit2,inflate_2$1=inflate$2,inflateEnd_1=inflateEnd,inflateGetHeader_1=inflateGetHeader,inflateSetDictionary_1=inflateSetDictionary,inflateInfo="pako inflate (from Nodeca project)",inflate_1$2={inflateReset:inflateReset_1,inflateReset2:inflateReset2_1,inflateResetKeep:inflateResetKeep_1,inflateInit:inflateInit_1,inflateInit2:inflateInit2_1,inflate:inflate_2$1,inflateEnd:inflateEnd_1,inflateGetHeader:inflateGetHeader_1,inflateSetDictionary:inflateSetDictionary_1,inflateInfo:inflateInfo};function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var gzheader=GZheader,toString=Object.prototype.toString,Z_NO_FLUSH=constants$2.Z_NO_FLUSH,Z_FINISH=constants$2.Z_FINISH,Z_OK=constants$2.Z_OK,Z_STREAM_END=constants$2.Z_STREAM_END,Z_NEED_DICT=constants$2.Z_NEED_DICT,Z_STREAM_ERROR=constants$2.Z_STREAM_ERROR,Z_DATA_ERROR=constants$2.Z_DATA_ERROR,Z_MEM_ERROR=constants$2.Z_MEM_ERROR;function Inflate$1(e){this.options=common.assign({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new zstream,this.strm.avail_out=0;var r=inflate_1$2.inflateInit2(this.strm,t.windowBits);if(r!==Z_OK)throw new Error(messages[r]);if(this.header=new gzheader,inflate_1$2.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=strings.string2buf(t.dictionary):"[object ArrayBuffer]"===toString.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=inflate_1$2.inflateSetDictionary(this.strm,t.dictionary))!==Z_OK))throw new Error(messages[r])}function inflate$1(e,t){var r=new Inflate$1(t);if(r.push(e),r.err)throw r.msg||messages[r.err];return r.result}function inflateRaw$1(e,t){return(t=t||{}).raw=!0,inflate$1(e,t)}Inflate$1.prototype.push=function(e,t){var r,n,a,i=this.strm,o=this.options.chunkSize,s=this.options.dictionary;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Z_FINISH:Z_NO_FLUSH,"[object ArrayBuffer]"===toString.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(r=inflate_1$2.inflate(i,n))===Z_NEED_DICT&&s&&((r=inflate_1$2.inflateSetDictionary(i,s))===Z_OK?r=inflate_1$2.inflate(i,n):r===Z_DATA_ERROR&&(r=Z_NEED_DICT));i.avail_in>0&&r===Z_STREAM_END&&i.state.wrap>0&&0!==e[i.next_in];)inflate_1$2.inflateReset(i),r=inflate_1$2.inflate(i,n);switch(r){case Z_STREAM_ERROR:case Z_DATA_ERROR:case Z_NEED_DICT:case Z_MEM_ERROR:return this.onEnd(r),this.ended=!0,!1}if(a=i.avail_out,i.next_out&&(0===i.avail_out||r===Z_STREAM_END))if("string"===this.options.to){var l=strings.utf8border(i.output,i.next_out),f=i.next_out-l,c=strings.buf2string(i.output,l);i.next_out=f,i.avail_out=o-f,f&&i.output.set(i.output.subarray(l,l+f),0),this.onData(c)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==Z_OK||0!==a){if(r===Z_STREAM_END)return r=inflate_1$2.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},Inflate$1.prototype.onData=function(e){this.chunks.push(e)},Inflate$1.prototype.onEnd=function(e){e===Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=common.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Inflate_1$1=Inflate$1,inflate_2=inflate$1,inflateRaw_1$1=inflateRaw$1,ungzip$1=inflate$1,constants=constants$2,inflate_1$1={Inflate:Inflate_1$1,inflate:inflate_2,inflateRaw:inflateRaw_1$1,ungzip:ungzip$1,constants:constants},inflate=inflate_1$1.inflate,inflate_1=inflate,DeflateDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"decodeBlock",value:function(e){return inflate_1(new Uint8Array(e)).buffer}}]),r}(),deflate=Object.freeze({__proto__:null,default:DeflateDecoder}),PackbitsDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"decodeBlock",value:function(e){for(var t=new DataView(e),r=[],n=0;n<e.byteLength;++n){var a=t.getInt8(n);if(a<0){var i=t.getUint8(n+1);a=-a;for(var o=0;o<=a;++o)r.push(i);n+=1}else{for(var s=0;s<=a;++s)r.push(t.getUint8(n+s+1));n+=a+1}}return new Uint8Array(r).buffer}}]),r}(),packbits=Object.freeze({__proto__:null,default:PackbitsDecoder}),LercDecode={exports:{}},module;module=LercDecode,
/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */
function(){var e,t,r,n,a,i,o,s,l,f,c,u,d,h,p,m,g=(e={defaultNoDataValue:-34027999387901484e22,decode:function(i,o){var s=(o=o||{}).encodedMaskData||null===o.encodedMaskData,l=a(i,o.inputOffset||0,s),f=null!==o.noDataValue?o.noDataValue:e.defaultNoDataValue,c=t(l,o.pixelType||Float32Array,o.encodedMaskData,f,o.returnMask),u={width:l.width,height:l.height,pixelData:c.resultPixels,minValue:c.minValue,maxValue:l.pixels.maxValue,noDataValue:f};return c.resultMask&&(u.maskData=c.resultMask),o.returnEncodedMask&&l.mask&&(u.encodedMaskData=l.mask.bitset?l.mask.bitset:null),o.returnFileInfo&&(u.fileInfo=r(l),o.computeUsedBitDepths&&(u.fileInfo.bitDepths=n(l))),u}},t=function(e,t,r,n,a){var o,s,l,f=0,c=e.pixels.numBlocksX,u=e.pixels.numBlocksY,d=Math.floor(e.width/c),h=Math.floor(e.height/u),p=2*e.maxZError,m=Number.MAX_VALUE;r=r||(e.mask?e.mask.bitset:null),s=new t(e.width*e.height),a&&r&&(l=new Uint8Array(e.width*e.height));for(var g,y,_=new Float32Array(d*h),b=0;b<=u;b++){var v=b!==u?h:e.height%u;if(0!==v)for(var w=0;w<=c;w++){var k=w!==c?d:e.width%c;if(0!==k){var T,E,x,S,D=b*e.width*h+w*d,A=e.width-k,M=e.pixels.blocks[f];if(M.encoding<2?(0===M.encoding?T=M.rawData:(i(M.stuffedData,M.bitsPerPixel,M.numValidPixels,M.offset,p,_,e.pixels.maxValue),T=_),E=0):x=2===M.encoding?0:M.offset,r)for(y=0;y<v;y++){for(7&D&&(S=r[D>>3],S<<=7&D),g=0;g<k;g++)7&D||(S=r[D>>3]),128&S?(l&&(l[D]=1),m=m>(o=M.encoding<2?T[E++]:x)?o:m,s[D++]=o):(l&&(l[D]=0),s[D++]=n),S<<=1;D+=A}else if(M.encoding<2)for(y=0;y<v;y++){for(g=0;g<k;g++)m=m>(o=T[E++])?o:m,s[D++]=o;D+=A}else for(m=m>x?x:m,y=0;y<v;y++){for(g=0;g<k;g++)s[D++]=x;D+=A}if(1===M.encoding&&E!==M.numValidPixels)throw"Block and Mask do not match";f++}}}return{resultPixels:s,resultMask:l,minValue:m}},r=function(e){return{fileIdentifierString:e.fileIdentifierString,fileVersion:e.fileVersion,imageType:e.imageType,height:e.height,width:e.width,maxZError:e.maxZError,eofOffset:e.eofOffset,mask:e.mask?{numBlocksX:e.mask.numBlocksX,numBlocksY:e.mask.numBlocksY,numBytes:e.mask.numBytes,maxValue:e.mask.maxValue}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,numBytes:e.pixels.numBytes,maxValue:e.pixels.maxValue,noDataValue:e.noDataValue}}},n=function(e){for(var t=e.pixels.numBlocksX*e.pixels.numBlocksY,r={},n=0;n<t;n++){var a=e.pixels.blocks[n];0===a.encoding?r.float32=!0:1===a.encoding?r[a.bitsPerPixel]=!0:r[0]=!0}return Object.keys(r)},a=function(e,t,r){var n={},a=new Uint8Array(e,t,10);if(n.fileIdentifierString=String.fromCharCode.apply(null,a),"CntZImage"!==n.fileIdentifierString.trim())throw"Unexpected file identifier string: "+n.fileIdentifierString;t+=10;var i=new DataView(e,t,24);if(n.fileVersion=i.getInt32(0,!0),n.imageType=i.getInt32(4,!0),n.height=i.getUint32(8,!0),n.width=i.getUint32(12,!0),n.maxZError=i.getFloat64(16,!0),t+=24,!r)if(i=new DataView(e,t,16),n.mask={},n.mask.numBlocksY=i.getUint32(0,!0),n.mask.numBlocksX=i.getUint32(4,!0),n.mask.numBytes=i.getUint32(8,!0),n.mask.maxValue=i.getFloat32(12,!0),t+=16,n.mask.numBytes>0){var o=new Uint8Array(Math.ceil(n.width*n.height/8)),s=(i=new DataView(e,t,n.mask.numBytes)).getInt16(0,!0),l=2,f=0;do{if(s>0)for(;s--;)o[f++]=i.getUint8(l++);else{var c=i.getUint8(l++);for(s=-s;s--;)o[f++]=c}s=i.getInt16(l,!0),l+=2}while(l<n.mask.numBytes);if(-32768!==s||f<o.length)throw"Unexpected end of mask RLE encoding";n.mask.bitset=o,t+=n.mask.numBytes}else 0==(n.mask.numBytes|n.mask.numBlocksY|n.mask.maxValue)&&(n.mask.bitset=new Uint8Array(Math.ceil(n.width*n.height/8)));i=new DataView(e,t,16),n.pixels={},n.pixels.numBlocksY=i.getUint32(0,!0),n.pixels.numBlocksX=i.getUint32(4,!0),n.pixels.numBytes=i.getUint32(8,!0),n.pixels.maxValue=i.getFloat32(12,!0),t+=16;var u=n.pixels.numBlocksX,d=n.pixels.numBlocksY,h=u+(n.width%u>0?1:0),p=d+(n.height%d>0?1:0);n.pixels.blocks=new Array(h*p);for(var m=0,g=0;g<p;g++)for(var y=0;y<h;y++){var _=0,b=e.byteLength-t;i=new DataView(e,t,Math.min(10,b));var v={};n.pixels.blocks[m++]=v;var w=i.getUint8(0);if(_++,v.encoding=63&w,v.encoding>3)throw"Invalid block encoding ("+v.encoding+")";if(2!==v.encoding){if(0!==w&&2!==w){if(w>>=6,v.offsetType=w,2===w)v.offset=i.getInt8(1),_++;else if(1===w)v.offset=i.getInt16(1,!0),_+=2;else{if(0!==w)throw"Invalid block offset type";v.offset=i.getFloat32(1,!0),_+=4}if(1===v.encoding)if(w=i.getUint8(_),_++,v.bitsPerPixel=63&w,w>>=6,v.numValidPixelsType=w,2===w)v.numValidPixels=i.getUint8(_),_++;else if(1===w)v.numValidPixels=i.getUint16(_,!0),_+=2;else{if(0!==w)throw"Invalid valid pixel count type";v.numValidPixels=i.getUint32(_,!0),_+=4}}var k;if(t+=_,3!==v.encoding)if(0===v.encoding){var T=(n.pixels.numBytes-1)/4;if(T!==Math.floor(T))throw"uncompressed block has invalid length";k=new ArrayBuffer(4*T),new Uint8Array(k).set(new Uint8Array(e,t,4*T));var E=new Float32Array(k);v.rawData=E,t+=4*T}else if(1===v.encoding){var x=Math.ceil(v.numValidPixels*v.bitsPerPixel/8),S=Math.ceil(x/4);k=new ArrayBuffer(4*S),new Uint8Array(k).set(new Uint8Array(e,t,x)),v.stuffedData=new Uint32Array(k),t+=x}}else t++}return n.eofOffset=t,n},i=function(e,t,r,n,a,i,o){var s,l,f,c=(1<<t)-1,u=0,d=0,h=Math.ceil((o-n)/a),p=4*e.length-Math.ceil(t*r/8);for(e[e.length-1]<<=8*p,s=0;s<r;s++){if(0===d&&(f=e[u++],d=32),d>=t)l=f>>>d-t&c,d-=t;else{var m=t-d;l=(f&c)<<m&c,l+=(f=e[u++])>>>(d=32-m)}i[s]=l<h?n+l*a:o}return i},e),y=(o=function(e,t,r,n,a,i,o,s){var l,f,c,u,d,h=(1<<r)-1,p=0,m=0,g=4*e.length-Math.ceil(r*n/8);if(e[e.length-1]<<=8*g,a)for(l=0;l<n;l++)0===m&&(c=e[p++],m=32),m>=r?(f=c>>>m-r&h,m-=r):(f=(c&h)<<(u=r-m)&h,f+=(c=e[p++])>>>(m=32-u)),t[l]=a[f];else for(d=Math.ceil((s-i)/o),l=0;l<n;l++)0===m&&(c=e[p++],m=32),m>=r?(f=c>>>m-r&h,m-=r):(f=(c&h)<<(u=r-m)&h,f+=(c=e[p++])>>>(m=32-u)),t[l]=f<d?i+f*o:s},s=function(e,t,r,n,a,i){var o,s=(1<<t)-1,l=0,f=0,c=0,u=0,d=0,h=[],p=4*e.length-Math.ceil(t*r/8);e[e.length-1]<<=8*p;var m=Math.ceil((i-n)/a);for(f=0;f<r;f++)0===u&&(o=e[l++],u=32),u>=t?(d=o>>>u-t&s,u-=t):(d=(o&s)<<(c=t-u)&s,d+=(o=e[l++])>>>(u=32-c)),h[f]=d<m?n+d*a:i;return h.unshift(n),h},l=function(e,t,r,n,a,i,o,s){var l,f,c,u,d=(1<<r)-1,h=0,p=0,m=0;if(a)for(l=0;l<n;l++)0===p&&(c=e[h++],p=32,m=0),p>=r?(f=c>>>m&d,p-=r,m+=r):(f=c>>>m&d,p=32-(u=r-p),f|=((c=e[h++])&(1<<u)-1)<<r-u,m=u),t[l]=a[f];else{var g=Math.ceil((s-i)/o);for(l=0;l<n;l++)0===p&&(c=e[h++],p=32,m=0),p>=r?(f=c>>>m&d,p-=r,m+=r):(f=c>>>m&d,p=32-(u=r-p),f|=((c=e[h++])&(1<<u)-1)<<r-u,m=u),t[l]=f<g?i+f*o:s}return t},f=function(e,t,r,n,a,i){var o,s=(1<<t)-1,l=0,f=0,c=0,u=0,d=0,h=0,p=[],m=Math.ceil((i-n)/a);for(f=0;f<r;f++)0===u&&(o=e[l++],u=32,h=0),u>=t?(d=o>>>h&s,u-=t,h+=t):(d=o>>>h&s,u=32-(c=t-u),d|=((o=e[l++])&(1<<c)-1)<<t-c,h=c),p[f]=d<m?n+d*a:i;return p.unshift(n),p},c=function(e,t,r,n){var a,i,o,s,l=(1<<r)-1,f=0,c=0,u=4*e.length-Math.ceil(r*n/8);for(e[e.length-1]<<=8*u,a=0;a<n;a++)0===c&&(o=e[f++],c=32),c>=r?(i=o>>>c-r&l,c-=r):(i=(o&l)<<(s=r-c)&l,i+=(o=e[f++])>>>(c=32-s)),t[a]=i;return t},u=function(e,t,r,n){var a,i,o,s,l=(1<<r)-1,f=0,c=0,u=0;for(a=0;a<n;a++)0===c&&(o=e[f++],c=32,u=0),c>=r?(i=o>>>u&l,c-=r,u+=r):(i=o>>>u&l,c=32-(s=r-c),i|=((o=e[f++])&(1<<s)-1)<<r-s,u=s),t[a]=i;return t},d={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(e){for(var t=65535,r=65535,n=e.length,a=Math.floor(n/2),i=0;a;){var o=a>=359?359:a;a-=o;do{t+=e[i++]<<8,r+=t+=e[i++]}while(--o);t=(65535&t)+(t>>>16),r=(65535&r)+(r>>>16)}return 1&n&&(r+=t+=e[i]<<8),((r=(65535&r)+(r>>>16))<<16|(t=(65535&t)+(t>>>16)))>>>0},readHeaderInfo:function(e,t){var r=t.ptr,n=new Uint8Array(e,r,6),a={};if(a.fileIdentifierString=String.fromCharCode.apply(null,n),0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;r+=6;var i,o=new DataView(e,r,8),s=o.getInt32(0,!0);if(a.fileVersion=s,r+=4,s>=3&&(a.checksum=o.getUint32(4,!0),r+=4),o=new DataView(e,r,12),a.height=o.getUint32(0,!0),a.width=o.getUint32(4,!0),r+=8,s>=4?(a.numDims=o.getUint32(8,!0),r+=4):a.numDims=1,o=new DataView(e,r,40),a.numValidPixel=o.getUint32(0,!0),a.microBlockSize=o.getInt32(4,!0),a.blobSize=o.getInt32(8,!0),a.imageType=o.getInt32(12,!0),a.maxZError=o.getFloat64(16,!0),a.zMin=o.getFloat64(24,!0),a.zMax=o.getFloat64(32,!0),r+=40,t.headerInfo=a,t.ptr=r,s>=3&&(i=s>=4?52:48,this.computeChecksumFletcher32(new Uint8Array(e,r-i,a.blobSize-14))!==a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(e,t){var r=t.headerInfo,n=this.getDataTypeArray(r.imageType),a=r.numDims*this.getDataTypeSize(r.imageType),i=this.readSubArray(e,t.ptr,n,a),o=this.readSubArray(e,t.ptr+a,n,a);t.ptr+=2*a;var s,l=!0;for(s=0;s<r.numDims;s++)if(i[s]!==o[s]){l=!1;break}return r.minValues=i,r.maxValues=o,l},readSubArray:function(e,t,r,n){var a;if(r===Uint8Array)a=new Uint8Array(e,t,n);else{var i=new ArrayBuffer(n);new Uint8Array(i).set(new Uint8Array(e,t,n)),a=new r(i)}return a},readMask:function(e,t){var r,n,a=t.ptr,i=t.headerInfo,o=i.width*i.height,s=i.numValidPixel,l=new DataView(e,a,4),f={};if(f.numBytes=l.getUint32(0,!0),a+=4,(0===s||o===s)&&0!==f.numBytes)throw"invalid mask";if(0===s)r=new Uint8Array(Math.ceil(o/8)),f.bitset=r,n=new Uint8Array(o),t.pixels.resultMask=n,a+=f.numBytes;else if(f.numBytes>0){r=new Uint8Array(Math.ceil(o/8));var c=(l=new DataView(e,a,f.numBytes)).getInt16(0,!0),u=2,d=0,h=0;do{if(c>0)for(;c--;)r[d++]=l.getUint8(u++);else for(h=l.getUint8(u++),c=-c;c--;)r[d++]=h;c=l.getInt16(u,!0),u+=2}while(u<f.numBytes);if(-32768!==c||d<r.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(o);var p=0,m=0;for(m=0;m<o;m++)7&m?(p=r[m>>3],p<<=7&m):p=r[m>>3],128&p&&(n[m]=1);t.pixels.resultMask=n,f.bitset=r,a+=f.numBytes}return t.ptr=a,t.mask=f,!0},readDataOneSweep:function(e,t,r,n){var a,i=t.ptr,o=t.headerInfo,s=o.numDims,l=o.width*o.height,f=o.imageType,c=o.numValidPixel*d.getDataTypeSize(f)*s,u=t.pixels.resultMask;if(r===Uint8Array)a=new Uint8Array(e,i,c);else{var h=new ArrayBuffer(c);new Uint8Array(h).set(new Uint8Array(e,i,c)),a=new r(h)}if(a.length===l*s)t.pixels.resultPixels=n?d.swapDimensionOrder(a,l,s,r,!0):a;else{t.pixels.resultPixels=new r(l*s);var p=0,m=0,g=0,y=0;if(s>1){if(n){for(m=0;m<l;m++)if(u[m])for(y=m,g=0;g<s;g++,y+=l)t.pixels.resultPixels[y]=a[p++]}else for(m=0;m<l;m++)if(u[m])for(y=m*s,g=0;g<s;g++)t.pixels.resultPixels[y+g]=a[p++]}else for(m=0;m<l;m++)u[m]&&(t.pixels.resultPixels[m]=a[p++])}return i+=c,t.ptr=i,!0},readHuffmanTree:function(e,t){var r=this.HUFFMAN_LUT_BITS_MAX,n=new DataView(e,t.ptr,16);if(t.ptr+=16,n.getInt32(0,!0)<2)throw"unsupported Huffman version";var a=n.getInt32(4,!0),i=n.getInt32(8,!0),o=n.getInt32(12,!0);if(i>=o)return!1;var s=new Uint32Array(o-i);d.decodeBits(e,t,s);var l,f,c,u,p=[];for(l=i;l<o;l++)p[f=l-(l<a?0:a)]={first:s[l-i],second:null};var m=e.byteLength-t.ptr,g=Math.ceil(m/4),y=new ArrayBuffer(4*g);new Uint8Array(y).set(new Uint8Array(e,t.ptr,m));var _,b=new Uint32Array(y),v=0,w=0;for(_=b[0],l=i;l<o;l++)(u=p[f=l-(l<a?0:a)].first)>0&&(p[f].second=_<<v>>>32-u,32-v>=u?32===(v+=u)&&(v=0,_=b[++w]):(v+=u-32,_=b[++w],p[f].second|=_>>>32-v));var k=0,T=0,E=new h;for(l=0;l<p.length;l++)void 0!==p[l]&&(k=Math.max(k,p[l].first));T=k>=r?r:k;var x,S,D,A,M,I=[];for(l=i;l<o;l++)if((u=p[f=l-(l<a?0:a)].first)>0)if(x=[u,f],u<=T)for(S=p[f].second<<T-u,D=1<<T-u,c=0;c<D;c++)I[S|c]=x;else for(S=p[f].second,M=E,A=u-1;A>=0;A--)S>>>A&1?(M.right||(M.right=new h),M=M.right):(M.left||(M.left=new h),M=M.left),0!==A||M.val||(M.val=x[1]);return{decodeLut:I,numBitsLUTQick:T,numBitsLUT:k,tree:E,stuffedData:b,srcPtr:w,bitPos:v}},readHuffman:function(e,t,r,n){var a,i,o,s,l,f,c,u,h,p=t.headerInfo.numDims,m=t.headerInfo.height,g=t.headerInfo.width,y=g*m,_=this.readHuffmanTree(e,t),b=_.decodeLut,v=_.tree,w=_.stuffedData,k=_.srcPtr,T=_.bitPos,E=_.numBitsLUTQick,x=_.numBitsLUT,S=0===t.headerInfo.imageType?128:0,D=t.pixels.resultMask,A=0;T>0&&(k++,T=0);var M,I=w[k],R=1===t.encodeMode,O=new r(y*p),C=O;if(p<2||R){for(M=0;M<p;M++)if(p>1&&(C=new r(O.buffer,y*M,y),A=0),t.headerInfo.numValidPixel===g*m)for(u=0,f=0;f<m;f++)for(c=0;c<g;c++,u++){if(i=0,l=s=I<<T>>>32-E,32-T<E&&(l=s|=w[k+1]>>>64-T-E),b[l])i=b[l][1],T+=b[l][0];else for(l=s=I<<T>>>32-x,32-T<x&&(l=s|=w[k+1]>>>64-T-x),a=v,h=0;h<x;h++)if(!(a=s>>>x-h-1&1?a.right:a.left).left&&!a.right){i=a.val,T=T+h+1;break}T>=32&&(T-=32,I=w[++k]),o=i-S,R?(o+=c>0?A:f>0?C[u-g]:A,o&=255,C[u]=o,A=o):C[u]=o}else for(u=0,f=0;f<m;f++)for(c=0;c<g;c++,u++)if(D[u]){if(i=0,l=s=I<<T>>>32-E,32-T<E&&(l=s|=w[k+1]>>>64-T-E),b[l])i=b[l][1],T+=b[l][0];else for(l=s=I<<T>>>32-x,32-T<x&&(l=s|=w[k+1]>>>64-T-x),a=v,h=0;h<x;h++)if(!(a=s>>>x-h-1&1?a.right:a.left).left&&!a.right){i=a.val,T=T+h+1;break}T>=32&&(T-=32,I=w[++k]),o=i-S,R?(c>0&&D[u-1]?o+=A:f>0&&D[u-g]?o+=C[u-g]:o+=A,o&=255,C[u]=o,A=o):C[u]=o}}else for(u=0,f=0;f<m;f++)for(c=0;c<g;c++)if(u=f*g+c,!D||D[u])for(M=0;M<p;M++,u+=y){if(i=0,l=s=I<<T>>>32-E,32-T<E&&(l=s|=w[k+1]>>>64-T-E),b[l])i=b[l][1],T+=b[l][0];else for(l=s=I<<T>>>32-x,32-T<x&&(l=s|=w[k+1]>>>64-T-x),a=v,h=0;h<x;h++)if(!(a=s>>>x-h-1&1?a.right:a.left).left&&!a.right){i=a.val,T=T+h+1;break}T>=32&&(T-=32,I=w[++k]),o=i-S,C[u]=o}t.ptr=t.ptr+4*(k+1)+(T>0?4:0),t.pixels.resultPixels=O,p>1&&!n&&(t.pixels.resultPixels=d.swapDimensionOrder(O,y,p,r))},decodeBits:function(e,t,r,n,a){var i=t.headerInfo,d=i.fileVersion,h=0,p=e.byteLength-t.ptr>=5?5:e.byteLength-t.ptr,m=new DataView(e,t.ptr,p),g=m.getUint8(0);h++;var y=g>>6,_=0===y?4:3-y,b=(32&g)>0,v=31&g,w=0;if(1===_)w=m.getUint8(h),h++;else if(2===_)w=m.getUint16(h,!0),h+=2;else{if(4!==_)throw"Invalid valid pixel count type";w=m.getUint32(h,!0),h+=4}var k,T,E,x,S,D,A,M,I,R=2*i.maxZError,O=i.numDims>1?i.maxValues[a]:i.zMax;if(b){for(t.counter.lut++,M=m.getUint8(h),h++,x=Math.ceil((M-1)*v/8),S=Math.ceil(x/4),T=new ArrayBuffer(4*S),E=new Uint8Array(T),t.ptr+=h,E.set(new Uint8Array(e,t.ptr,x)),A=new Uint32Array(T),t.ptr+=x,I=0;M-1>>>I;)I++;x=Math.ceil(w*I/8),S=Math.ceil(x/4),T=new ArrayBuffer(4*S),(E=new Uint8Array(T)).set(new Uint8Array(e,t.ptr,x)),k=new Uint32Array(T),t.ptr+=x,D=d>=3?f(A,v,M-1,n,R,O):s(A,v,M-1,n,R,O),d>=3?l(k,r,I,w,D):o(k,r,I,w,D)}else t.counter.bitstuffer++,I=v,t.ptr+=h,I>0&&(x=Math.ceil(w*I/8),S=Math.ceil(x/4),T=new ArrayBuffer(4*S),(E=new Uint8Array(T)).set(new Uint8Array(e,t.ptr,x)),k=new Uint32Array(T),t.ptr+=x,d>=3?null==n?u(k,r,I,w):l(k,r,I,w,!1,n,R,O):null==n?c(k,r,I,w):o(k,r,I,w,!1,n,R,O))},readTiles:function(e,t,r,n){var a=t.headerInfo,i=a.width,o=a.height,s=i*o,l=a.microBlockSize,f=a.imageType,c=d.getDataTypeSize(f),u=Math.ceil(i/l),h=Math.ceil(o/l);t.pixels.numBlocksY=h,t.pixels.numBlocksX=u,t.pixels.ptr=0;var p,m,g,y,_,b,v,w,k,T,E=0,x=0,S=0,D=0,A=0,M=0,I=0,R=0,O=0,C=0,P=0,L=0,U=0,B=0,$=0,N=new r(l*l),z=o%l||l,Z=i%l||l,G=a.numDims,j=t.pixels.resultMask,V=t.pixels.resultPixels,F=a.fileVersion>=5?14:15,K=a.zMax;for(S=0;S<h;S++)for(A=S!==h-1?l:z,D=0;D<u;D++)for(C=S*i*l+D*l,P=i-(M=D!==u-1?l:Z),w=0;w<G;w++){if(G>1?(T=V,C=S*i*l+D*l,V=new r(t.pixels.resultPixels.buffer,s*w*c,s),K=a.maxValues[w]):T=null,I=e.byteLength-t.ptr,m={},$=0,R=(p=new DataView(e,t.ptr,Math.min(10,I))).getUint8(0),$++,k=a.fileVersion>=5?4&R:0,O=R>>6&255,(R>>2&F)!=(D*l>>3&F))throw"integrity issue";if(k&&0===w)throw"integrity issue";if((_=3&R)>3)throw t.ptr+=$,"Invalid block encoding ("+_+")";if(2!==_)if(0===_){if(k)throw"integrity issue";if(t.counter.uncompressed++,t.ptr+=$,L=(L=A*M*c)<(U=e.byteLength-t.ptr)?L:U,g=new ArrayBuffer(L%c==0?L:L+c-L%c),new Uint8Array(g).set(new Uint8Array(e,t.ptr,L)),y=new r(g),B=0,j)for(E=0;E<A;E++){for(x=0;x<M;x++)j[C]&&(V[C]=y[B++]),C++;C+=P}else for(E=0;E<A;E++){for(x=0;x<M;x++)V[C++]=y[B++];C+=P}t.ptr+=B*c}else if(b=d.getDataTypeUsed(k&&f<6?4:f,O),v=d.getOnePixel(m,$,b,p),$+=d.getDataTypeSize(b),3===_)if(t.ptr+=$,t.counter.constantoffset++,j)for(E=0;E<A;E++){for(x=0;x<M;x++)j[C]&&(V[C]=k?Math.min(K,T[C]+v):v),C++;C+=P}else for(E=0;E<A;E++){for(x=0;x<M;x++)V[C]=k?Math.min(K,T[C]+v):v,C++;C+=P}else if(t.ptr+=$,d.decodeBits(e,t,N,v,w),$=0,k)if(j)for(E=0;E<A;E++){for(x=0;x<M;x++)j[C]&&(V[C]=N[$++]+T[C]),C++;C+=P}else for(E=0;E<A;E++){for(x=0;x<M;x++)V[C]=N[$++]+T[C],C++;C+=P}else if(j)for(E=0;E<A;E++){for(x=0;x<M;x++)j[C]&&(V[C]=N[$++]),C++;C+=P}else for(E=0;E<A;E++){for(x=0;x<M;x++)V[C++]=N[$++];C+=P}else{if(k)if(j)for(E=0;E<A;E++)for(x=0;x<M;x++)j[C]&&(V[C]=T[C]),C++;else for(E=0;E<A;E++)for(x=0;x<M;x++)V[C]=T[C],C++;t.counter.constant++,t.ptr+=$}}G>1&&!n&&(t.pixels.resultPixels=d.swapDimensionOrder(t.pixels.resultPixels,s,G,r))},formatFileInfo:function(e){return{fileIdentifierString:e.headerInfo.fileIdentifierString,fileVersion:e.headerInfo.fileVersion,imageType:e.headerInfo.imageType,height:e.headerInfo.height,width:e.headerInfo.width,numValidPixel:e.headerInfo.numValidPixel,microBlockSize:e.headerInfo.microBlockSize,blobSize:e.headerInfo.blobSize,maxZError:e.headerInfo.maxZError,pixelType:d.getPixelType(e.headerInfo.imageType),eofOffset:e.eofOffset,mask:e.mask?{numBytes:e.mask.numBytes}:null,pixels:{numBlocksX:e.pixels.numBlocksX,numBlocksY:e.pixels.numBlocksY,maxValue:e.headerInfo.zMax,minValue:e.headerInfo.zMin,noDataValue:e.noDataValue}}},constructConstantSurface:function(e,t){var r=e.headerInfo.zMax,n=e.headerInfo.zMin,a=e.headerInfo.maxValues,i=e.headerInfo.numDims,o=e.headerInfo.height*e.headerInfo.width,s=0,l=0,f=0,c=e.pixels.resultMask,u=e.pixels.resultPixels;if(c)if(i>1){if(t)for(s=0;s<i;s++)for(f=s*o,r=a[s],l=0;l<o;l++)c[l]&&(u[f+l]=r);else for(l=0;l<o;l++)if(c[l])for(f=l*i,s=0;s<i;s++)u[f+i]=a[s]}else for(l=0;l<o;l++)c[l]&&(u[l]=r);else if(i>1&&n!==r)if(t)for(s=0;s<i;s++)for(f=s*o,r=a[s],l=0;l<o;l++)u[f+l]=r;else for(l=0;l<o;l++)for(f=l*i,s=0;s<i;s++)u[f+s]=a[s];else for(l=0;l<o*i;l++)u[l]=r},getDataTypeArray:function(e){var t;switch(e){case 0:t=Int8Array;break;case 1:t=Uint8Array;break;case 2:t=Int16Array;break;case 3:t=Uint16Array;break;case 4:t=Int32Array;break;case 5:t=Uint32Array;break;case 6:t=Float32Array;break;case 7:t=Float64Array;break;default:t=Float32Array}return t},getPixelType:function(e){var t;switch(e){case 0:t="S8";break;case 1:t="U8";break;case 2:t="S16";break;case 3:t="U16";break;case 4:t="S32";break;case 5:t="U32";break;case 6:t="F32";break;case 7:t="F64";break;default:t="F32"}return t},isValidPixelValue:function(e,t){if(null==t)return!1;var r;switch(e){case 0:r=t>=-128&&t<=127;break;case 1:r=t>=0&&t<=255;break;case 2:r=t>=-32768&&t<=32767;break;case 3:r=t>=0&&t<=65536;break;case 4:r=t>=-2147483648&&t<=2147483647;break;case 5:r=t>=0&&t<=4294967296;break;case 6:r=t>=-34027999387901484e22&&t<=34027999387901484e22;break;case 7:r=t>=-17976931348623157e292&&t<=17976931348623157e292;break;default:r=!1}return r},getDataTypeSize:function(e){var t=0;switch(e){case 0:case 1:t=1;break;case 2:case 3:t=2;break;case 4:case 5:case 6:t=4;break;case 7:t=8;break;default:t=e}return t},getDataTypeUsed:function(e,t){var r=e;switch(e){case 2:case 4:r=e-t;break;case 3:case 5:r=e-2*t;break;case 6:r=0===t?e:1===t?2:1;break;case 7:r=0===t?e:e-2*t+1;break;default:r=e}return r},getOnePixel:function(e,t,r,n){var a=0;switch(r){case 0:a=n.getInt8(t);break;case 1:a=n.getUint8(t);break;case 2:a=n.getInt16(t,!0);break;case 3:a=n.getUint16(t,!0);break;case 4:a=n.getInt32(t,!0);break;case 5:a=n.getUInt32(t,!0);break;case 6:a=n.getFloat32(t,!0);break;case 7:a=n.getFloat64(t,!0);break;default:throw"the decoder does not understand this pixel type"}return a},swapDimensionOrder:function(e,t,r,n,a){var i=0,o=0,s=0,l=0,f=e;if(r>1)if(f=new n(t*r),a)for(i=0;i<t;i++)for(l=i,s=0;s<r;s++,l+=t)f[l]=e[o++];else for(i=0;i<t;i++)for(l=i,s=0;s<r;s++,l+=t)f[o++]=e[l];return f}},h=function(e,t,r){this.val=e,this.left=t,this.right=r},{decode:function(e,t){var r=(t=t||{}).noDataValue,n=0,a={};a.ptr=t.inputOffset||0,a.pixels={},d.readHeaderInfo(e,a);var i=a.headerInfo,o=i.fileVersion,s=d.getDataTypeArray(i.imageType);if(o>5)throw"unsupported lerc version 2."+o;d.readMask(e,a),i.numValidPixel===i.width*i.height||a.pixels.resultMask||(a.pixels.resultMask=t.maskData);var l=i.width*i.height;a.pixels.resultPixels=new s(l*i.numDims),a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var f,c=!t.returnPixelInterleavedDims;if(0!==i.numValidPixel)if(i.zMax===i.zMin)d.constructConstantSurface(a,c);else if(o>=4&&d.checkMinMaxRanges(e,a))d.constructConstantSurface(a,c);else{var u=new DataView(e,a.ptr,2),h=u.getUint8(0);if(a.ptr++,h)d.readDataOneSweep(e,a,s,c);else if(o>1&&i.imageType<=1&&Math.abs(i.maxZError-.5)<1e-5){var p=u.getUint8(1);if(a.ptr++,a.encodeMode=p,p>2||o<4&&p>1)throw"Invalid Huffman flag "+p;p?d.readHuffman(e,a,s,c):d.readTiles(e,a,s,c)}else d.readTiles(e,a,s,c)}a.eofOffset=a.ptr,t.inputOffset?(f=a.headerInfo.blobSize+t.inputOffset-a.ptr,Math.abs(f)>=1&&(a.eofOffset=t.inputOffset+a.headerInfo.blobSize)):(f=a.headerInfo.blobSize-a.ptr,Math.abs(f)>=1&&(a.eofOffset=a.headerInfo.blobSize));var m={width:i.width,height:i.height,pixelData:a.pixels.resultPixels,minValue:i.zMin,maxValue:i.zMax,validPixelCount:i.numValidPixel,dimCount:i.numDims,dimStats:{minValues:i.minValues,maxValues:i.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&d.isValidPixelValue(i.imageType,r)){var g=a.pixels.resultMask;for(n=0;n<l;n++)g[n]||(m.pixelData[n]=r);m.noDataValue=r}return a.noDataValue=r,t.returnFileInfo&&(m.fileInfo=d.formatFileInfo(a)),m},getBandCount:function(e){for(var t=0,r=0,n={ptr:0,pixels:{}};r<e.byteLength-58;)d.readHeaderInfo(e,n),r+=n.headerInfo.blobSize,t++,n.ptr=r;return t}}),_=(p=new ArrayBuffer(4),m=new Uint8Array(p),new Uint32Array(p)[0]=1,1===m[0]),b={decode:function(e,t){if(!_)throw"Big endian system is not supported.";var r,n,a=(t=t||{}).inputOffset||0,i=new Uint8Array(e,a,10),o=String.fromCharCode.apply(null,i);if("CntZImage"===o.trim())r=g,n=1;else{if("Lerc2"!==o.substring(0,5))throw"Unexpected file identifier string: "+o;r=y,n=2}for(var s,l,f,c,u,d,h=0,p=e.byteLength-10,m=[],b={width:0,height:0,pixels:[],pixelType:t.pixelType,mask:null,statistics:[]},v=0;a<p;){var w=r.decode(e,{inputOffset:a,encodedMaskData:s,maskData:f,returnMask:0===h,returnEncodedMask:0===h,returnFileInfo:!0,returnPixelInterleavedDims:t.returnPixelInterleavedDims,pixelType:t.pixelType||null,noDataValue:t.noDataValue||null});a=w.fileInfo.eofOffset,f=w.maskData,0===h&&(s=w.encodedMaskData,b.width=w.width,b.height=w.height,b.dimCount=w.dimCount||1,b.pixelType=w.pixelType||w.fileInfo.pixelType,b.mask=f),n>1&&(f&&m.push(f),w.fileInfo.mask&&w.fileInfo.mask.numBytes>0&&v++),h++,b.pixels.push(w.pixelData),b.statistics.push({minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue,dimStats:w.dimStats})}if(n>1&&v>1){for(d=b.width*b.height,b.bandMasks=m,(f=new Uint8Array(d)).set(m[0]),c=1;c<m.length;c++)for(l=m[c],u=0;u<d;u++)f[u]=f[u]&l[u];b.maskData=f}return b}};module.exports?module.exports=b:this.Lerc=b}();var Lerc=LercDecode.exports,fieldTagNames={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},fieldTags={};for(var key in fieldTagNames)fieldTagNames.hasOwnProperty(key)&&(fieldTags[fieldTagNames[key]]=parseInt(key,10));fieldTags.BitsPerSample,fieldTags.ExtraSamples,fieldTags.SampleFormat,fieldTags.StripByteCounts,fieldTags.StripOffsets,fieldTags.StripRowCounts,fieldTags.TileByteCounts,fieldTags.TileOffsets,fieldTags.SubIFDs;var fieldTypeNames={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},fieldTypes={};for(var _key in fieldTypeNames)fieldTypeNames.hasOwnProperty(_key)&&(fieldTypes[fieldTypeNames[_key]]=parseInt(_key,10));var LercParameters={Version:0,AddCompression:1},LercAddCompression={None:0,Deflate:1},geoKeyNames={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},geoKeys={};for(var _key2 in geoKeyNames)geoKeyNames.hasOwnProperty(_key2)&&(geoKeys[geoKeyNames[_key2]]=parseInt(_key2,10));var LercDecoder=function(e){_inherits(r,BaseDecoder);var t=_createSuper(r);function r(e){var n;return _classCallCheck(this,r),(n=t.call(this)).planarConfiguration=void 0!==e.PlanarConfiguration?e.PlanarConfiguration:1,n.samplesPerPixel=void 0!==e.SamplesPerPixel?e.SamplesPerPixel:1,n.addCompression=e.LercParameters[LercParameters.AddCompression],n}return _createClass(r,[{key:"decodeBlock",value:function(e){switch(this.addCompression){case LercAddCompression.None:break;case LercAddCompression.Deflate:e=inflate_1(new Uint8Array(e)).buffer;break;default:throw new Error("Unsupported LERC additional compression method identifier: ".concat(this.addCompression))}return Lerc.decode(e,{returnPixelInterleavedDims:1===this.planarConfiguration}).pixels[0].buffer}}]),r}(),lerc=Object.freeze({__proto__:null,default:LercDecoder});`,t2=new Blob([e2],{type:"application/javascript"}),r2=URL.createObjectURL(t2);function i2(){return new Worker(r2)}var n2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Fd;function a2(){return Fd||(Fd=new Ew(void 0,i2())),Fd}function s2(r){try{return r.getBoundingBox()}catch(e){var t=r.fileDirectory;return[0,0,t.ImageWidth,t.ImageLength]}}function o2(r){try{return r.getOrigin().slice(0,2)}catch(t){return[0,r.fileDirectory.ImageLength]}}function l2(r,t){try{return r.getResolution(t)[0]}catch(e){return t.fileDirectory.ImageWidth/r.fileDirectory.ImageWidth}}function h2(r){var t=r.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey){var e="EPSG:"+t.ProjectedCSTypeGeoKey,n=Fn(e);if(!n){var s=Ym(t.ProjLinearUnitsGeoKey);s&&(n=new Jc({code:e,units:s}))}return n}if(t.GeographicTypeGeoKey){var e="EPSG:"+t.GeographicTypeGeoKey,n=Fn(e);if(!n){var s=Ym(t.GeogAngularUnitsGeoKey);s&&(n=new Jc({code:e,units:s}))}return n}return null}function c2(r){return r.getImageCount().then(function(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=r.getImage(n);return Promise.all(e)})}function u2(r){var t;return r.overviews?t=Qw(r.url,r.overviews):t=Jw(r.url),t.then(c2)}function vu(r,t,e,n,s){if(Array.isArray(r)){var u=r.length;if(!Array.isArray(t)||u!=t.length){var g=new Error(n);throw s(g),g}for(var h=0;h<u;++h)vu(r[h],t[h],e,n,s);return}if(t=t,Math.abs(r-t)>e*r)throw new Error(n)}function f2(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function d2(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}var l_=function(r){n2(t,r);function t(e){var n=r.call(this,{state:zn.LOADING,tileGrid:null,projection:null,opaque:e.opaque,transition:e.transition})||this;n.sourceInfo_=e.sources;var s=n.sourceInfo_.length;n.sourceImagery_=new Array(s),n.resolutionFactors_=new Array(s),n.samplesPerPixel_,n.nodataValues_,n.normalize_=e.normalize!==!1,n.addAlpha_=!1,n.error_=null,n.readMethod_=e.convertToRGB?"readRGB":"readRasters",n.setKey(n.sourceInfo_.map(function(b){return b.url}).join(","));for(var u=n,g=new Array(s),h=0;h<s;++h)g[h]=u2(n.sourceInfo_[h]);return Promise.all(g).then(function(b){u.configure_(b)}).catch(function(b){console.error(b),u.error_=b,u.setState(zn.ERROR)}),n}return t.prototype.getError=function(){return this.error_},t.prototype.configure_=function(e){for(var n,s,u,g,h=new Array(e.length),b=new Array(e.length),T=0,C=e.length,P=function(lt){var ct=e[lt],Rt=ct.length,Bt=void 0,Kt=void 0,Ht=new Array(Rt),At=new Array(Rt);b[lt]=new Array(Rt);for(var qe=0;qe<Rt;++qe){var Ut=ct[qe],Zt=Ut.getGDALNoData();b[lt][qe]=Zt===null?NaN:Zt;var Er=R.sourceInfo_[lt].bands;h[lt]=Er?Er.length:Ut.getSamplesPerPixel();var nr=Rt-(qe+1);Bt||(Bt=s2(Ut)),Kt||(Kt=o2(Ut)),At[nr]=l2(Ut,ct[0]),Ht[nr]=[Ut.getTileWidth(),Ut.getTileHeight()]}if(n?nd(n,Bt,n):n=Bt,!s)s=Kt;else{var qr="Origin mismatch for source "+lt+", got ["+Kt+"] but expected ["+s+"]";vu(s,Kt,0,qr,R.viewRejector)}if(!g)g=At,R.resolutionFactors_[lt]=1;else{g.length-T>At.length&&(T=g.length-At.length);var Fi=g[g.length-1]/At[At.length-1];R.resolutionFactors_[lt]=Fi;var ci=At.map(function(Ur){return Ur*=Fi}),qr="Resolution mismatch for source "+lt+", got ["+ci+"] but expected ["+g+"]";vu(g.slice(T,g.length),ci,.005,qr,R.viewRejector)}u?vu(u.slice(T,u.length),Ht,0,"Tile size mismatch for source "+lt,R.viewRejector):u=Ht,R.sourceImagery_[lt]=ct.reverse()},R=this,U=0;U<C;++U)P(U);for(var j=0,H=this.sourceImagery_.length;j<H;++j)for(var re=this.sourceImagery_[j];re.length<g.length;)re.unshift(void 0);if(!this.getProjection())for(var ge=e[0],j=ge.length-1;j>=0;--j){var ce=ge[j],be=h2(ce);if(be){this.projection=be;break}}this.samplesPerPixel_=h,this.nodataValues_=b;e:for(var U=0;U<C;++U){if(this.sourceInfo_[U].nodata!==void 0){this.addAlpha_=!0;break}var we=b[U],Ae=this.sourceInfo_[U].bands;if(Ae){for(var j=0;j<Ae.length;++j)if(!isNaN(we[Ae[j]-1])){this.addAlpha_=!0;break e}continue}for(var De=0;De<we.length;++De)if(!isNaN(we[De])){this.addAlpha_=!0;break e}}var it=this.addAlpha_?1:0;this.bandCount=h.reduce(function(lt,ct){return lt+=ct,lt},0)+it;var ze=new dd({extent:n,minZoom:T,origin:s,resolutions:g,tileSizes:u});this.tileGrid=ze,this.setLoader(this.loadTile_.bind(this)),this.setState(zn.READY),this.viewResolver({projection:this.projection,resolutions:g,center:iu(mh(n),this.projection),extent:pg(n,this.projection),zoom:0})},t.prototype.loadTile_=function(e,n,s){for(var u=yn(this.tileGrid.getTileSize(e)),g=this.sourceImagery_.length,h=new Array(g),b=this.addAlpha_,T=this.bandCount,C=this.samplesPerPixel_,P=this.nodataValues_,R=this.sourceInfo_,U=function(be){var we=R[be],Ae=j.resolutionFactors_[be],De=[Math.round(n*(u[0]*Ae)),Math.round(s*(u[1]*Ae)),Math.round((n+1)*(u[0]*Ae)),Math.round((s+1)*(u[1]*Ae))],it=j.sourceImagery_[be][e],ze=void 0;we.bands&&(ze=we.bands.map(function(ct){return ct-1}));var lt=void 0;isNaN(we.nodata)?ze?lt=ze.map(function(ct){return P[be][ct]}):lt=P[be]:lt=we.nodata,h[be]=it[j.readMethod_]({window:De,width:u[0],height:u[1],samples:ze,fillValue:lt,pool:a2(),interleave:!1})},j=this,H=0;H<g;++H)U(H);var re=u[0]*u[1],ge=re*T,ce=this.normalize_;return Promise.all(h).then(function(be){var we;ce?we=new Uint8Array(ge):we=new Float32Array(ge);for(var Ae=0,De=0;De<re;++De){for(var it=b,ze=0;ze<g;++ze){var lt=R[ze],ct=lt.min,Rt=lt.max,Bt=void 0,Kt=void 0;ce&&(ct===void 0&&(ct=f2(be[ze][0])),Rt===void 0&&(Rt=d2(be[ze][0])),Bt=255/(Rt-ct),Kt=-ct*Bt);for(var Ht=0;Ht<C[ze];++Ht){var At=be[ze][Ht][De],qe=void 0;if(ce?qe=oi(Bt*At+Kt,0,255):qe=At,!b)we[Ae]=qe;else{var Ut=lt.nodata;if(Ut===void 0){var Zt=void 0;lt.bands?Zt=lt.bands[Ht]-1:Zt=Ht,Ut=P[ze][Zt]}At!==Ut&&(it=!1,we[Ae]=qe)}Ae++}}b&&(it||(we[Ae]=255),Ae++)}return we})},t}(P1);l_.prototype.getView;var UP=l_,Ho=typeof navigator!="undefined"&&typeof navigator.userAgent!="undefined"?navigator.userAgent.toLowerCase():"",p2=Ho.indexOf("firefox")!==-1;Ho.indexOf("safari")!==-1&&Ho.indexOf("chrom")==-1;var m2=Ho.indexOf("webkit")!==-1&&Ho.indexOf("edge")==-1,g2=Ho.indexOf("macintosh")!==-1,h_=typeof devicePixelRatio!="undefined"?devicePixelRatio:1,_2=typeof WorkerGlobalScope!="undefined"&&typeof OffscreenCanvas!="undefined"&&self instanceof WorkerGlobalScope,y2=typeof Image!="undefined"&&Image.prototype.decode,c_=function(){var r=!1;try{var t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch(e){}return r}(),u_=new Array(6);function Wo(){return[1,0,0,1,0,0]}function Bd(r){return Nd(r,1,0,0,1,0,0)}function f_(r,t){var e=r[0],n=r[1],s=r[2],u=r[3],g=r[4],h=r[5],b=t[0],T=t[1],C=t[2],P=t[3],R=t[4],U=t[5];return r[0]=e*b+s*T,r[1]=n*b+u*T,r[2]=e*C+s*P,r[3]=n*C+u*P,r[4]=e*R+s*U+g,r[5]=n*R+u*U+h,r}function Nd(r,t,e,n,s,u,g){return r[0]=t,r[1]=e,r[2]=n,r[3]=s,r[4]=u,r[5]=g,r}function d_(r,t){var e=t[0],n=t[1];return t[0]=r[0]*e+r[2]*n+r[4],t[1]=r[1]*e+r[3]*n+r[5],t}function v2(r,t){var e=Math.cos(t),n=Math.sin(t);return f_(r,Nd(u_,e,n,-n,e,0,0))}function x2(r,t,e){return f_(r,Nd(u_,t,0,0,e,0,0))}function xu(r,t,e,n,s,u,g,h){var b=Math.sin(u),T=Math.cos(u);return r[0]=n*T,r[1]=s*b,r[2]=-n*b,r[3]=s*T,r[4]=g*n*T-h*n*b+t,r[5]=g*s*b+h*s*T+e,r}function b2(r,t){var e=w2(t);Yt(e!==0,32);var n=t[0],s=t[1],u=t[2],g=t[3],h=t[4],b=t[5];return r[0]=g/e,r[1]=-s/e,r[2]=-u/e,r[3]=n/e,r[4]=(u*b-g*h)/e,r[5]=-(n*b-s*h)/e,r}function w2(r){return r[0]*r[3]-r[1]*r[2]}var p_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,m_=/^([a-z]*)$|^hsla?\(.*\)$/i;function E2(r){return typeof r=="string"?r:A2(r)}function g_(r){var t=document.createElement("div");if(t.style.color=r,t.style.color!==""){document.body.appendChild(t);var e=getComputedStyle(t).color;return document.body.removeChild(t),e}else return""}var T2=function(){var r=1024,t={},e=0;return function(n){var s;if(t.hasOwnProperty(n))s=t[n];else{if(e>=r){var u=0;for(var g in t)(u++&3)==0&&(delete t[g],--e)}s=S2(n),t[n]=s,++e}return s}}();function M2(r){return Array.isArray(r)?r:T2(r)}function S2(r){var t,e,n,s,u;if(m_.exec(r)&&(r=g_(r)),p_.exec(r)){var g=r.length-1,h=void 0;g<=4?h=1:h=2;var b=g===4||g===8;t=parseInt(r.substr(1+0*h,h),16),e=parseInt(r.substr(1+1*h,h),16),n=parseInt(r.substr(1+2*h,h),16),b?s=parseInt(r.substr(1+3*h,h),16):s=255,h==1&&(t=(t<<4)+t,e=(e<<4)+e,n=(n<<4)+n,b&&(s=(s<<4)+s)),u=[t,e,n,s/255]}else r.indexOf("rgba(")==0?(u=r.slice(5,-1).split(",").map(Number),__(u)):r.indexOf("rgb(")==0?(u=r.slice(4,-1).split(",").map(Number),u.push(1),__(u)):Yt(!1,14);return u}function __(r){return r[0]=oi(r[0]+.5|0,0,255),r[1]=oi(r[1]+.5|0,0,255),r[2]=oi(r[2]+.5|0,0,255),r[3]=oi(r[3],0,1),r}function A2(r){var t=r[0];t!=(t|0)&&(t=t+.5|0);var e=r[1];e!=(e|0)&&(e=e+.5|0);var n=r[2];n!=(n|0)&&(n=n+.5|0);var s=r[3]===void 0?1:r[3];return"rgba("+t+","+e+","+n+","+s+")"}function C2(r){return m_.test(r)&&(r=g_(r)),p_.test(r)||r.indexOf("rgba(")===0||r.indexOf("rgb(")===0}var I2=function(){function r(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return r.prototype.clear=function(){this.cache_={},this.cacheSize_=0},r.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},r.prototype.expire=function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var n=this.cache_[e];(t++&3)==0&&!n.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}},r.prototype.get=function(t,e,n){var s=y_(t,e,n);return s in this.cache_?this.cache_[s]:null},r.prototype.set=function(t,e,n,s){var u=y_(t,e,n);this.cache_[u]=s,++this.cacheSize_},r.prototype.setSize=function(t){this.maxCacheSize_=t,this.expire()},r}();function y_(r,t,e){var n=e?E2(e):"null";return t+":"+r+":"+n}var v_=new I2,ir={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source"},P2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),R2=function(r){P2(t,r);function t(e){var n=r.call(this)||this;n.on,n.once,n.un;var s=vi({},e);return typeof e.properties=="object"&&(delete s.properties,vi(s,e.properties)),s[ir.OPACITY]=e.opacity!==void 0?e.opacity:1,Yt(typeof s[ir.OPACITY]=="number",64),s[ir.VISIBLE]=e.visible!==void 0?e.visible:!0,s[ir.Z_INDEX]=e.zIndex,s[ir.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,s[ir.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,s[ir.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,s[ir.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,n.className_=s.className!==void 0?e.className:"ol-layer",delete s.className,n.setProperties(s),n.state_=null,n}return t.prototype.getClassName=function(){return this.className_},t.prototype.getLayerState=function(e){var n=this.state_||{layer:this,managed:e===void 0?!0:e},s=this.getZIndex();return n.opacity=oi(Math.round(this.getOpacity()*100)/100,0,1),n.sourceState=this.getSourceState(),n.visible=this.getVisible(),n.extent=this.getExtent(),n.zIndex=s===void 0&&!n.managed?1/0:s,n.maxResolution=this.getMaxResolution(),n.minResolution=Math.max(this.getMinResolution(),0),n.minZoom=this.getMinZoom(),n.maxZoom=this.getMaxZoom(),this.state_=n,n},t.prototype.getLayersArray=function(e){return lr()},t.prototype.getLayerStatesArray=function(e){return lr()},t.prototype.getExtent=function(){return this.get(ir.EXTENT)},t.prototype.getMaxResolution=function(){return this.get(ir.MAX_RESOLUTION)},t.prototype.getMinResolution=function(){return this.get(ir.MIN_RESOLUTION)},t.prototype.getMinZoom=function(){return this.get(ir.MIN_ZOOM)},t.prototype.getMaxZoom=function(){return this.get(ir.MAX_ZOOM)},t.prototype.getOpacity=function(){return this.get(ir.OPACITY)},t.prototype.getSourceState=function(){return lr()},t.prototype.getVisible=function(){return this.get(ir.VISIBLE)},t.prototype.getZIndex=function(){return this.get(ir.Z_INDEX)},t.prototype.setExtent=function(e){this.set(ir.EXTENT,e)},t.prototype.setMaxResolution=function(e){this.set(ir.MAX_RESOLUTION,e)},t.prototype.setMinResolution=function(e){this.set(ir.MIN_RESOLUTION,e)},t.prototype.setMaxZoom=function(e){this.set(ir.MAX_ZOOM,e)},t.prototype.setMinZoom=function(e){this.set(ir.MIN_ZOOM,e)},t.prototype.setOpacity=function(e){Yt(typeof e=="number",64),this.set(ir.OPACITY,e)},t.prototype.setVisible=function(e){this.set(ir.VISIBLE,e)},t.prototype.setZIndex=function(e){this.set(ir.Z_INDEX,e)},t.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),r.prototype.disposeInternal.call(this)},t}(_a),x_=R2,zs={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},k2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),D2=function(r){k2(t,r);function t(e){var n=this,s=vi({},e);delete s.source,n=r.call(this,s)||this,n.on,n.once,n.un,n.mapPrecomposeKey_=null,n.mapRenderKey_=null,n.sourceChangeKey_=null,n.renderer_=null,e.render&&(n.render=e.render),e.map&&n.setMap(e.map),n.addChangeListener(ir.SOURCE,n.handleSourcePropertyChange_);var u=e.source?e.source:null;return n.setSource(u),n}return t.prototype.getLayersArray=function(e){var n=e||[];return n.push(this),n},t.prototype.getLayerStatesArray=function(e){var n=e||[];return n.push(this.getLayerState()),n},t.prototype.getSource=function(){return this.get(ir.SOURCE)||null},t.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():zn.UNDEFINED},t.prototype.handleSourceChange_=function(){this.changed()},t.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(jr(this.sourceChangeKey_),this.sourceChangeKey_=null);var e=this.getSource();e&&(this.sourceChangeKey_=hr(e,wt.CHANGE,this.handleSourceChange_,this)),this.changed()},t.prototype.getFeatures=function(e){return this.renderer_?this.renderer_.getFeatures(e):new Promise(function(n){return n([])})},t.prototype.render=function(e,n){var s=this.getRenderer();if(s.prepareFrame(e))return s.renderFrame(e,n)},t.prototype.setMap=function(e){this.mapPrecomposeKey_&&(jr(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(jr(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=hr(e,zs.PRECOMPOSE,function(n){var s=n,u=s.frameState.layerStatesArray,g=this.getLayerState(!1);Yt(!u.some(function(h){return h.layer===g.layer}),67),u.push(g)},this),this.mapRenderKey_=hr(this,wt.CHANGE,e.render,e),this.changed())},t.prototype.setSource=function(e){this.set(ir.SOURCE,e)},t.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},t.prototype.hasRenderer=function(){return!!this.renderer_},t.prototype.createRenderer=function(){return null},t.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),r.prototype.disposeInternal.call(this)},t}(x_);function bu(r,t){if(!r.visible)return!1;var e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;var n=t.zoom;return n>r.minZoom&&n<=r.maxZoom}var b_=D2,L2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),O2=function(r){L2(t,r);function t(e){var n=r.call(this)||this;return n.map_=e,n}return t.prototype.dispatchRenderEvent=function(e,n){lr()},t.prototype.calculateMatrices2D=function(e){var n=e.viewState,s=e.coordinateToPixelTransform,u=e.pixelToCoordinateTransform;xu(s,e.size[0]/2,e.size[1]/2,1/n.resolution,-1/n.resolution,-n.rotation,-n.center[0],-n.center[1]),b2(u,s)},t.prototype.forEachFeatureAtCoordinate=function(e,n,s,u,g,h,b,T){var C,P=n.viewState;function R(At,qe,Ut,Zt){return g.call(h,qe,At?Ut:null,Zt)}var U=P.projection,j=Wx(e.slice(),U),H=[[0,0]];if(U.canWrapX()&&u){var re=U.getExtent(),ge=qa(re);H.push([-ge,0],[ge,0])}for(var ce=n.layerStatesArray,be=ce.length,we=[],Ae=[],De=0;De<H.length;De++)for(var it=be-1;it>=0;--it){var ze=ce[it],lt=ze.layer;if(lt.hasRenderer()&&bu(ze,P)&&b.call(T,lt)){var ct=lt.getRenderer(),Rt=lt.getSource();if(ct&&Rt){var Bt=Rt.getWrapX()?j:e,Kt=R.bind(null,ze.managed);Ae[0]=Bt[0]+H[De][0],Ae[1]=Bt[1]+H[De][1],C=ct.forEachFeatureAtCoordinate(Ae,n,s,Kt,we)}if(C)return C}}if(we.length!==0){var Ht=1/we.length;return we.forEach(function(At,qe){return At.distanceSq+=qe*Ht}),we.sort(function(At,qe){return At.distanceSq-qe.distanceSq}),we.some(function(At){return C=At.callback(At.feature,At.layer,At.geometry)}),C}},t.prototype.forEachLayerAtPixel=function(e,n,s,u,g){return lr()},t.prototype.hasFeatureAtCoordinate=function(e,n,s,u,g,h){var b=this.forEachFeatureAtCoordinate(e,n,s,u,hh,this,g,h);return b!==void 0},t.prototype.getMap=function(){return this.map_},t.prototype.renderFrame=function(e){lr()},t.prototype.scheduleExpireIconCache=function(e){v_.canExpireCache()&&e.postRenderFunctions.push(z2)},t}(Kc);function z2(r,t){v_.expire()}var F2=O2,B2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),N2=function(r){B2(t,r);function t(e,n,s,u){var g=r.call(this,e)||this;return g.inversePixelTransform=n,g.frameState=s,g.context=u,g}return t}(As),w_=N2,wu="ol-hidden",Eu="ol-unselectable",Ud="ol-control",E_="ol-collapsed";function U2(r,t,e,n){var s;return e&&e.length?s=e.shift():_2?s=new OffscreenCanvas(r||300,t||300):(s=document.createElement("canvas"),s.style.all="unset"),r&&(s.width=r),t&&(s.height=t),s.getContext("2d",n)}function T_(r,t){var e=t.parentNode;e&&e.replaceChild(r,t)}function Gd(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function G2(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function V2(r,t){for(var e=r.childNodes,n=0;;++n){var s=e[n],u=t[n];if(!s&&!u)break;if(s!==u){if(!s){r.appendChild(u);continue}if(!u){r.removeChild(s),--n;continue}r.insertBefore(u,s)}}}var $2=new _a,j2=new Io;j2.setSize=function(){console.warn("labelCache is deprecated.")};var Z2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),q2=function(r){Z2(t,r);function t(e){var n=r.call(this,e)||this;n.fontChangeListenerKey_=hr($2,Ro.PROPERTYCHANGE,e.redrawText.bind(e)),n.element_=document.createElement("div");var s=n.element_.style;s.position="absolute",s.width="100%",s.height="100%",s.zIndex="0",n.element_.className=Eu+" ol-layers";var u=e.getViewport();return u.insertBefore(n.element_,u.firstChild||null),n.children_=[],n.renderedVisible_=!0,n}return t.prototype.dispatchRenderEvent=function(e,n){var s=this.getMap();if(s.hasListener(e)){var u=new w_(e,void 0,n);s.dispatchEvent(u)}},t.prototype.disposeInternal=function(){jr(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),r.prototype.disposeInternal.call(this)},t.prototype.renderFrame=function(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(zs.PRECOMPOSE,e);var n=e.layerStatesArray.sort(function(R,U){return R.zIndex-U.zIndex}),s=e.viewState;this.children_.length=0;for(var u=[],g=null,h=0,b=n.length;h<b;++h){var T=n[h];if(e.layerIndex=h,!(!bu(T,s)||T.sourceState!=zn.READY&&T.sourceState!=zn.UNDEFINED)){var C=T.layer,P=C.render(e,g);!P||(P!==g&&(this.children_.push(P),g=P),"getDeclutter"in C&&u.push(C))}}for(var h=u.length-1;h>=0;--h)u[h].renderDeclutter(e);V2(this.element_,this.children_),this.dispatchRenderEvent(zs.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)},t.prototype.forEachLayerAtPixel=function(e,n,s,u,g){for(var h=n.viewState,b=n.layerStatesArray,T=b.length,C=T-1;C>=0;--C){var P=b[C],R=P.layer;if(R.hasRenderer()&&bu(P,h)&&g(R)){var U=R.getRenderer(),j=U.getDataAtPixel(e,n,s);if(j){var H=u(R,j);if(H)return H}}}},t}(F2),X2=q2,nn={ADD:"add",REMOVE:"remove"},M_=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),S_={LENGTH:"length"},Tu=function(r){M_(t,r);function t(e,n,s){var u=r.call(this,e)||this;return u.element=n,u.index=s,u}return t}(As),K2=function(r){M_(t,r);function t(e,n){var s=r.call(this)||this;s.on,s.once,s.un;var u=n||{};if(s.unique_=!!u.unique,s.array_=e||[],s.unique_)for(var g=0,h=s.array_.length;g<h;++g)s.assertUnique_(s.array_[g],g);return s.updateLength_(),s}return t.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},t.prototype.extend=function(e){for(var n=0,s=e.length;n<s;++n)this.push(e[n]);return this},t.prototype.forEach=function(e){for(var n=this.array_,s=0,u=n.length;s<u;++s)e(n[s],s,n)},t.prototype.getArray=function(){return this.array_},t.prototype.item=function(e){return this.array_[e]},t.prototype.getLength=function(){return this.get(S_.LENGTH)},t.prototype.insertAt=function(e,n){this.unique_&&this.assertUnique_(n),this.array_.splice(e,0,n),this.updateLength_(),this.dispatchEvent(new Tu(nn.ADD,n,e))},t.prototype.pop=function(){return this.removeAt(this.getLength()-1)},t.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var n=this.getLength();return this.insertAt(n,e),this.getLength()},t.prototype.remove=function(e){for(var n=this.array_,s=0,u=n.length;s<u;++s)if(n[s]===e)return this.removeAt(s)},t.prototype.removeAt=function(e){var n=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new Tu(nn.REMOVE,n,e)),n},t.prototype.setAt=function(e,n){var s=this.getLength();if(e<s){this.unique_&&this.assertUnique_(n,e);var u=this.array_[e];this.array_[e]=n,this.dispatchEvent(new Tu(nn.REMOVE,u,e)),this.dispatchEvent(new Tu(nn.ADD,n,e))}else{for(var g=s;g<e;++g)this.insertAt(g,void 0);this.insertAt(e,n)}},t.prototype.updateLength_=function(){this.set(S_.LENGTH,this.array_.length)},t.prototype.assertUnique_=function(e,n){for(var s=0,u=this.array_.length;s<u;++s)if(this.array_[s]===e&&s!==n)throw new tg(58)},t}(_a),xn=K2,H2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Vd={LAYERS:"layers"},W2=function(r){H2(t,r);function t(e){var n=this,s=e||{},u=vi({},s);delete u.layers;var g=s.layers;return n=r.call(this,u)||this,n.on,n.once,n.un,n.layersListenerKeys_=[],n.listenerKeys_={},n.addChangeListener(Vd.LAYERS,n.handleLayersChanged_),g?Array.isArray(g)?g=new xn(g.slice(),{unique:!0}):Yt(typeof g.getArray=="function",43):g=new xn(void 0,{unique:!0}),n.setLayers(g),n}return t.prototype.handleLayerChange_=function(){this.changed()},t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(jr),this.layersListenerKeys_.length=0;var e=this.getLayers();this.layersListenerKeys_.push(hr(e,nn.ADD,this.handleLayersAdd_,this),hr(e,nn.REMOVE,this.handleLayersRemove_,this));for(var n in this.listenerKeys_)this.listenerKeys_[n].forEach(jr);uh(this.listenerKeys_);for(var s=e.getArray(),u=0,g=s.length;u<g;u++){var h=s[u];this.listenerKeys_[ga(h)]=[hr(h,Ro.PROPERTYCHANGE,this.handleLayerChange_,this),hr(h,wt.CHANGE,this.handleLayerChange_,this)]}this.changed()},t.prototype.handleLayersAdd_=function(e){var n=e.element;this.listenerKeys_[ga(n)]=[hr(n,Ro.PROPERTYCHANGE,this.handleLayerChange_,this),hr(n,wt.CHANGE,this.handleLayerChange_,this)],this.changed()},t.prototype.handleLayersRemove_=function(e){var n=e.element,s=ga(n);this.listenerKeys_[s].forEach(jr),delete this.listenerKeys_[s],this.changed()},t.prototype.getLayers=function(){return this.get(Vd.LAYERS)},t.prototype.setLayers=function(e){this.set(Vd.LAYERS,e)},t.prototype.getLayersArray=function(e){var n=e!==void 0?e:[];return this.getLayers().forEach(function(s){s.getLayersArray(n)}),n},t.prototype.getLayerStatesArray=function(e){var n=e!==void 0?e:[],s=n.length;this.getLayers().forEach(function(C){C.getLayerStatesArray(n)});var u=this.getLayerState(),g=u.zIndex;!e&&u.zIndex===void 0&&(g=0);for(var h=s,b=n.length;h<b;h++){var T=n[h];T.opacity*=u.opacity,T.visible=T.visible&&u.visible,T.maxResolution=Math.min(T.maxResolution,u.maxResolution),T.minResolution=Math.max(T.minResolution,u.minResolution),T.minZoom=Math.max(T.minZoom,u.minZoom),T.maxZoom=Math.min(T.maxZoom,u.maxZoom),u.extent!==void 0&&(T.extent!==void 0?T.extent=nd(T.extent,u.extent):T.extent=u.extent),T.zIndex===void 0&&(T.zIndex=g)}return n},t.prototype.getSourceState=function(){return zn.READY},t}(x_),Y2=W2,J2=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Q2=function(r){J2(t,r);function t(e,n,s){var u=r.call(this,e)||this;return u.map=n,u.frameState=s!==void 0?s:null,u}return t}(As),Mu=Q2,eE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),tE=function(r){eE(t,r);function t(e,n,s,u,g){var h=r.call(this,e,n,g)||this;return h.originalEvent=s,h.pixel_=null,h.coordinate_=null,h.dragging=u!==void 0?u:!1,h}return Object.defineProperty(t.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(e){this.pixel_=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(e){this.coordinate_=e},enumerable:!1,configurable:!0}),t.prototype.preventDefault=function(){r.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},t.prototype.stopPropagation=function(){r.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},t}(Mu),Xa=tE,dr={SINGLECLICK:"singleclick",CLICK:wt.CLICK,DBLCLICK:wt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},$d={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},rE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),iE=function(r){rE(t,r);function t(e,n){var s=r.call(this,e)||this;s.map_=e,s.clickTimeoutId_,s.emulateClicks_=!1,s.dragging_=!1,s.dragListenerKeys_=[],s.moveTolerance_=n===void 0?1:n,s.down_=null;var u=s.map_.getViewport();return s.activePointers_=0,s.trackedTouches_={},s.element_=u,s.pointerdownListenerKey_=hr(u,$d.POINTERDOWN,s.handlePointerDown_,s),s.originalPointerMoveEvent_,s.relayedListenerKey_=hr(u,$d.POINTERMOVE,s.relayEvent_,s),s.boundHandleTouchMove_=s.handleTouchMove_.bind(s),s.element_.addEventListener(wt.TOUCHMOVE,s.boundHandleTouchMove_,c_?{passive:!1}:!1),s}return t.prototype.emulateClick_=function(e){var n=new Xa(dr.CLICK,this.map_,e);this.dispatchEvent(n),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,n=new Xa(dr.DBLCLICK,this.map_,e),this.dispatchEvent(n)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var s=new Xa(dr.SINGLECLICK,this.map_,e);this.dispatchEvent(s)}.bind(this),250)},t.prototype.updateActivePointers_=function(e){var n=e;n.type==dr.POINTERUP||n.type==dr.POINTERCANCEL?delete this.trackedTouches_[n.pointerId]:n.type==dr.POINTERDOWN&&(this.trackedTouches_[n.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},t.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var n=new Xa(dr.POINTERUP,this.map_,e);this.dispatchEvent(n),this.emulateClicks_&&!n.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(jr),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},t.prototype.isMouseActionButton_=function(e){return e.button===0},t.prototype.handlePointerDown_=function(e){this.emulateClicks_=this.activePointers_===0,this.updateActivePointers_(e);var n=new Xa(dr.POINTERDOWN,this.map_,e);this.dispatchEvent(n),this.down_={};for(var s in e){var u=e[s];this.down_[s]=typeof u=="function"?ch:u}if(this.dragListenerKeys_.length===0){var g=this.map_.getOwnerDocument();this.dragListenerKeys_.push(hr(g,dr.POINTERMOVE,this.handlePointerMove_,this),hr(g,dr.POINTERUP,this.handlePointerUp_,this),hr(this.element_,dr.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==g&&this.dragListenerKeys_.push(hr(this.element_.getRootNode(),dr.POINTERUP,this.handlePointerUp_,this))}},t.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var n=new Xa(dr.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(n)}},t.prototype.relayEvent_=function(e){this.originalPointerMoveEvent_=e;var n=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Xa(e.type,this.map_,e,n))},t.prototype.handleTouchMove_=function(e){var n=this.originalPointerMoveEvent_;(!n||n.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()},t.prototype.isMoving_=function(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_},t.prototype.disposeInternal=function(){this.relayedListenerKey_&&(jr(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(wt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(jr(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(jr),this.dragListenerKeys_.length=0,this.element_=null,r.prototype.disposeInternal.call(this)},t}(Io),nE=iE,Su={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},xi={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Au=1/0,aE=function(){function r(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return r.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,uh(this.queuedElements_)},r.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var s=this.keyFunction_(n);return delete this.queuedElements_[s],n},r.prototype.enqueue=function(t){Yt(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=Au?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1},r.prototype.getCount=function(){return this.elements_.length},r.prototype.getLeftChildIndex_=function(t){return t*2+1},r.prototype.getRightChildIndex_=function(t){return t*2+2},r.prototype.getParentIndex_=function(t){return t-1>>1},r.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)},r.prototype.isEmpty=function(){return this.elements_.length===0},r.prototype.isKeyQueued=function(t){return t in this.queuedElements_},r.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))},r.prototype.siftUp_=function(t){for(var e=this.elements_,n=this.priorities_,s=e.length,u=e[t],g=n[t],h=t;t<s>>1;){var b=this.getLeftChildIndex_(t),T=this.getRightChildIndex_(t),C=T<s&&n[T]<n[b]?T:b;e[t]=e[C],n[t]=n[C],t=C}e[t]=u,n[t]=g,this.siftDown_(h,t)},r.prototype.siftDown_=function(t,e){for(var n=this.elements_,s=this.priorities_,u=n[e],g=s[e];e>t;){var h=this.getParentIndex_(e);if(s[h]>g)n[e]=n[h],s[e]=s[h],e=h;else break}n[e]=u,s[e]=g},r.prototype.reprioritize=function(){var t=this.priorityFunction_,e=this.elements_,n=this.priorities_,s=0,u=e.length,g,h,b;for(h=0;h<u;++h)g=e[h],b=t(g),b==Au?delete this.queuedElements_[this.keyFunction_(g)]:(n[s]=b,e[s++]=g);e.length=s,n.length=s,this.heapify_()},r}(),sE=aE,oE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),lE=function(r){oE(t,r);function t(e,n){var s=r.call(this,function(u){return e.apply(null,u)},function(u){return u[0].getKey()})||this;return s.boundHandleTileChange_=s.handleTileChange.bind(s),s.tileChangeCallback_=n,s.tilesLoading_=0,s.tilesLoadingKeys_={},s}return t.prototype.enqueue=function(e){var n=r.prototype.enqueue.call(this,e);if(n){var s=e[0];s.addEventListener(wt.CHANGE,this.boundHandleTileChange_)}return n},t.prototype.getTilesLoading=function(){return this.tilesLoading_},t.prototype.handleTileChange=function(e){var n=e.target,s=n.getState();if(s===jt.LOADED||s===jt.ERROR||s===jt.EMPTY){n.removeEventListener(wt.CHANGE,this.boundHandleTileChange_);var u=n.getKey();u in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[u],--this.tilesLoading_),this.tileChangeCallback_()}},t.prototype.loadMoreTiles=function(e,n){for(var s=0,u,g,h;this.tilesLoading_<e&&s<n&&this.getCount()>0;)g=this.dequeue()[0],h=g.getKey(),u=g.getState(),u===jt.IDLE&&!(h in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[h]=!0,++this.tilesLoading_,++s,g.load())},t}(sE),hE=lE;function cE(r,t,e,n,s){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return Au;var u=r.viewState.center,g=n[0]-u[0],h=n[1]-u[1];return 65536*Math.log(s)+Math.sqrt(g*g+h*h)/s}var an={ANIMATING:0,INTERACTING:1},Gn={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function A_(r,t,e){return function(n,s,u,g,h){if(n){var b=t?0:u[0]*s,T=t?0:u[1]*s,C=h?h[0]:0,P=h?h[1]:0,R=r[0]+b/2+C,U=r[2]-b/2+C,j=r[1]+T/2+P,H=r[3]-T/2+P;R>U&&(R=(U+R)/2,U=R),j>H&&(j=(H+j)/2,H=j);var re=oi(n[0],R,U),ge=oi(n[1],j,H),ce=30*s;return g&&e&&(re+=-ce*Math.log(1+Math.max(0,R-n[0])/ce)+ce*Math.log(1+Math.max(0,n[0]-U)/ce),ge+=-ce*Math.log(1+Math.max(0,j-n[1])/ce)+ce*Math.log(1+Math.max(0,n[1]-H)/ce)),[re,ge]}else return}}function uE(r){return r}function jd(r,t,e,n){var s=qa(t)/e[0],u=Za(t)/e[1];return n?Math.min(r,Math.max(s,u)):Math.min(r,Math.min(s,u))}function Zd(r,t,e){var n=Math.min(r,t),s=50;return n*=Math.log(1+s*Math.max(0,r/t-1))/s+1,e&&(n=Math.max(n,e),n/=Math.log(1+s*Math.max(0,e/r-1))/s+1),oi(n,e/2,t*2)}function fE(r,t,e,n){return function(s,u,g,h){if(s!==void 0){var b=r[0],T=r[r.length-1],C=e?jd(b,e,g,n):b;if(h){var P=t!==void 0?t:!0;return P?Zd(s,C,T):oi(s,T,C)}var R=Math.min(C,s),U=Math.floor(Jf(r,R,u));return r[U]>C&&U<r.length-1?r[U+1]:r[U]}else return}}function dE(r,t,e,n,s,u){return function(g,h,b,T){if(g!==void 0){var C=s?jd(t,s,b,u):t,P=e!==void 0?e:0;if(T){var R=n!==void 0?n:!0;return R?Zd(g,C,P):oi(g,P,C)}var U=1e-9,j=Math.ceil(Math.log(t/C)/Math.log(r)-U),H=-h*(.5-U)+.5,re=Math.min(C,g),ge=Math.floor(Math.log(t/re)/Math.log(r)+H),ce=Math.max(j,ge),be=t/Math.pow(r,ce);return oi(be,P,C)}else return}}function C_(r,t,e,n,s){return function(u,g,h,b){if(u!==void 0){var T=n?jd(r,n,h,s):r,C=e!==void 0?e:!0;return!C||!b?oi(u,t,T):Zd(u,T,t)}else return}}function qd(r){if(r!==void 0)return 0}function I_(r){if(r!==void 0)return r}function pE(r){var t=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function mE(r){var t=r||Ex(5);return function(e,n){if(n)return e;if(e!==void 0)return Math.abs(e)<=t?0:e}}var Wi={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function gE(r,t,e,n,s,u){for(var g=u||[],h=0,b=t;b<e;b+=n){var T=r[b],C=r[b+1];g[h++]=s[0]*T+s[2]*C+s[4],g[h++]=s[1]*T+s[3]*C+s[5]}return u&&g.length!=h&&(g.length=h),g}function _E(r,t,e,n,s,u,g){for(var h=g||[],b=Math.cos(s),T=Math.sin(s),C=u[0],P=u[1],R=0,U=t;U<e;U+=n){var j=r[U]-C,H=r[U+1]-P;h[R++]=C+j*b-H*T,h[R++]=P+j*T+H*b;for(var re=U+2;re<U+n;++re)h[R++]=r[re]}return g&&h.length!=R&&(h.length=R),h}function yE(r,t,e,n,s,u,g,h){for(var b=h||[],T=g[0],C=g[1],P=0,R=t;R<e;R+=n){var U=r[R]-T,j=r[R+1]-C;b[P++]=T+s*U,b[P++]=C+u*j;for(var H=R+2;H<R+n;++H)b[P++]=r[H]}return h&&b.length!=P&&(b.length=P),b}function vE(r,t,e,n,s,u,g){for(var h=g||[],b=0,T=t;T<e;T+=n){h[b++]=r[T]+s,h[b++]=r[T+1]+u;for(var C=T+2;C<T+n;++C)h[b++]=r[C]}return g&&h.length!=b&&(h.length=b),h}var xE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),P_=Wo(),bE=function(r){xE(t,r);function t(){var e=r.call(this)||this;return e.extent_=rd(),e.extentRevision_=-1,e.simplifiedGeometryMaxMinSquaredTolerance=0,e.simplifiedGeometryRevision=0,e.simplifyTransformedInternal=ex(function(n,s,u){if(!u)return this.getSimplifiedGeometry(s);var g=this.clone();return g.applyTransform(u),g.getSimplifiedGeometry(s)}),e}return t.prototype.simplifyTransformed=function(e,n){return this.simplifyTransformedInternal(this.getRevision(),e,n)},t.prototype.clone=function(){return lr()},t.prototype.closestPointXY=function(e,n,s,u){return lr()},t.prototype.containsXY=function(e,n){var s=this.getClosestPoint([e,n]);return s[0]===e&&s[1]===n},t.prototype.getClosestPoint=function(e,n){var s=n||[NaN,NaN];return this.closestPointXY(e[0],e[1],s,1/0),s},t.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])},t.prototype.computeExtent=function(e){return lr()},t.prototype.getExtent=function(e){if(this.extentRevision_!=this.getRevision()){var n=this.computeExtent(this.extent_);(isNaN(n[0])||isNaN(n[1]))&&tu(n),this.extentRevision_=this.getRevision()}return qx(this.extent_,e)},t.prototype.rotate=function(e,n){lr()},t.prototype.scale=function(e,n,s){lr()},t.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)},t.prototype.getSimplifiedGeometry=function(e){return lr()},t.prototype.getType=function(){return lr()},t.prototype.applyTransform=function(e){lr()},t.prototype.intersectsExtent=function(e){return lr()},t.prototype.translate=function(e,n){lr()},t.prototype.transform=function(e,n){var s=Fn(e),u=s.getUnits()==fh.TILE_PIXELS?function(g,h,b){var T=s.getExtent(),C=s.getWorldExtent(),P=Za(C)/Za(T);return xu(P_,C[0],C[3],P,-P,0,0,0),gE(g,0,g.length,b,P_,h),ud(s,n)(g,h,b)}:ud(s,n);return this.applyTransform(u),this},t}(_a),wE=bE,EE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),TE=function(r){EE(t,r);function t(){var e=r.call(this)||this;return e.layout=Wi.XY,e.stride=2,e.flatCoordinates=null,e}return t.prototype.computeExtent=function(e){return Vx(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)},t.prototype.getCoordinates=function(){return lr()},t.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},t.prototype.getFlatCoordinates=function(){return this.flatCoordinates},t.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},t.prototype.getLayout=function(){return this.layout},t.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var n=this.getSimplifiedGeometryInternal(e),s=n.getFlatCoordinates();return s.length<this.flatCoordinates.length?n:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)},t.prototype.getSimplifiedGeometryInternal=function(e){return this},t.prototype.getStride=function(){return this.stride},t.prototype.setFlatCoordinates=function(e,n){this.stride=R_(e),this.layout=e,this.flatCoordinates=n},t.prototype.setCoordinates=function(e,n){lr()},t.prototype.setLayout=function(e,n,s){var u;if(e)u=R_(e);else{for(var g=0;g<s;++g)if(n.length===0){this.layout=Wi.XY,this.stride=2;return}else n=n[0];u=n.length,e=ME(u)}this.layout=e,this.stride=u},t.prototype.applyTransform=function(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},t.prototype.rotate=function(e,n){var s=this.getFlatCoordinates();if(s){var u=this.getStride();_E(s,0,s.length,u,e,n,s),this.changed()}},t.prototype.scale=function(e,n,s){var u=n;u===void 0&&(u=e);var g=s;g||(g=mh(this.getExtent()));var h=this.getFlatCoordinates();if(h){var b=this.getStride();yE(h,0,h.length,b,e,u,g,h),this.changed()}},t.prototype.translate=function(e,n){var s=this.getFlatCoordinates();if(s){var u=this.getStride();vE(s,0,s.length,u,e,n,s),this.changed()}},t}(wE);function ME(r){var t;return r==2?t=Wi.XY:r==3?t=Wi.XYZ:r==4&&(t=Wi.XYZM),t}function R_(r){var t;return r==Wi.XY?t=2:r==Wi.XYZ||r==Wi.XYM?t=3:r==Wi.XYZM&&(t=4),t}var Xd=TE;function k_(r,t,e,n,s,u,g){var h=r[t],b=r[t+1],T=r[e]-h,C=r[e+1]-b,P;if(T===0&&C===0)P=t;else{var R=((s-h)*T+(u-b)*C)/(T*T+C*C);if(R>1)P=e;else if(R>0){for(var U=0;U<n;++U)g[U]=Tx(r[t+U],r[e+U],R);g.length=n;return}else P=t}for(var U=0;U<n;++U)g[U]=r[P+U];g.length=n}function D_(r,t,e,n,s){var u=r[t],g=r[t+1];for(t+=n;t<e;t+=n){var h=r[t],b=r[t+1],T=ko(u,g,h,b);T>s&&(s=T),u=h,g=b}return s}function SE(r,t,e,n,s){for(var u=0,g=e.length;u<g;++u){var h=e[u];s=D_(r,t,h,n,s),t=h}return s}function L_(r,t,e,n,s,u,g,h,b,T,C){if(t==e)return T;var P,R;if(s===0)if(R=ko(g,h,r[t],r[t+1]),R<T){for(P=0;P<n;++P)b[P]=r[t+P];return b.length=n,R}else return T;for(var U=C||[NaN,NaN],j=t+n;j<e;)if(k_(r,j-n,j,n,g,h,U),R=ko(g,h,U[0],U[1]),R<T){for(T=R,P=0;P<n;++P)b[P]=U[P];b.length=n,j+=n}else j+=n*Math.max((Math.sqrt(R)-Math.sqrt(T))/s|0,1);if(u&&(k_(r,e-n,t,n,g,h,U),R=ko(g,h,U[0],U[1]),R<T)){for(T=R,P=0;P<n;++P)b[P]=U[P];b.length=n}return T}function AE(r,t,e,n,s,u,g,h,b,T,C){for(var P=C||[NaN,NaN],R=0,U=e.length;R<U;++R){var j=e[R];T=L_(r,t,j,n,s,u,g,h,b,T,P),t=j}return T}function CE(r,t,e,n){for(var s=0,u=e.length;s<u;++s)r[t++]=e[s];return t}function O_(r,t,e,n){for(var s=0,u=e.length;s<u;++s)for(var g=e[s],h=0;h<n;++h)r[t++]=g[h];return t}function IE(r,t,e,n,s){for(var u=s||[],g=0,h=0,b=e.length;h<b;++h){var T=O_(r,t,e[h],n);u[g++]=T,t=T}return u.length=g,u}function PE(r,t,e,n,s,u,g){var h=(e-t)/n;if(h<3){for(;t<e;t+=n)u[g++]=r[t],u[g++]=r[t+1];return g}var b=new Array(h);b[0]=1,b[h-1]=1;for(var T=[t,e-n],C=0;T.length>0;){for(var P=T.pop(),R=T.pop(),U=0,j=r[R],H=r[R+1],re=r[P],ge=r[P+1],ce=R+n;ce<P;ce+=n){var be=r[ce],we=r[ce+1],Ae=bx(be,we,j,H,re,ge);Ae>U&&(C=ce,U=Ae)}U>s&&(b[(C-t)/n]=1,R+n<C&&T.push(R,C),C+n<P&&T.push(C,P))}for(var ce=0;ce<h;++ce)b[ce]&&(u[g++]=r[t+ce*n],u[g++]=r[t+ce*n+1]);return g}function Yo(r,t){return t*Math.round(r/t)}function RE(r,t,e,n,s,u,g){if(t==e)return g;var h=Yo(r[t],s),b=Yo(r[t+1],s);t+=n,u[g++]=h,u[g++]=b;var T,C;do if(T=Yo(r[t],s),C=Yo(r[t+1],s),t+=n,t==e)return u[g++]=T,u[g++]=C,g;while(T==h&&C==b);for(;t<e;){var P=Yo(r[t],s),R=Yo(r[t+1],s);if(t+=n,!(P==T&&R==C)){var U=T-h,j=C-b,H=P-h,re=R-b;if(U*re==j*H&&(U<0&&H<U||U==H||U>0&&H>U)&&(j<0&&re<j||j==re||j>0&&re>j)){T=P,C=R;continue}u[g++]=T,u[g++]=C,h=T,b=C,T=P,C=R}}return u[g++]=T,u[g++]=C,g}function kE(r,t,e,n,s,u,g,h){for(var b=0,T=e.length;b<T;++b){var C=e[b];g=RE(r,t,C,n,s,u,g),h.push(g),t=C}return g}function z_(r,t,e,n,s){for(var u=s!==void 0?s:[],g=0,h=t;h<e;h+=n)u[g++]=r.slice(h,h+n);return u.length=g,u}function DE(r,t,e,n,s){for(var u=s!==void 0?s:[],g=0,h=0,b=e.length;h<b;++h){var T=e[h];u[g++]=z_(r,t,T,n,u[g]),t=T}return u.length=g,u}function F_(r,t,e,n){for(var s=0,u=r[e-n],g=r[e-n+1];t<e;t+=n){var h=r[t],b=r[t+1];s+=g*h-u*b,u=h,g=b}return s/2}function LE(r,t,e,n){for(var s=0,u=0,g=e.length;u<g;++u){var h=e[u];s+=F_(r,t,h,n),t=h}return s}var OE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),zE=function(r){OE(t,r);function t(e,n){var s=r.call(this)||this;return s.maxDelta_=-1,s.maxDeltaRevision_=-1,n!==void 0&&!Array.isArray(e[0])?s.setFlatCoordinates(n,e):s.setCoordinates(e,n),s}return t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)},t.prototype.closestPointXY=function(e,n,s,u){return u<rg(this.getExtent(),e,n)?u:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(D_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),L_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,n,s,u))},t.prototype.getArea=function(){return F_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getCoordinates=function(){return z_(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[];return n.length=PE(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,n,0),new t(n,Wi.XY)},t.prototype.getType=function(){return ru.LINEAR_RING},t.prototype.intersectsExtent=function(e){return!1},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=O_(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Xd),B_=zE,FE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),BE=function(r){FE(t,r);function t(e,n){var s=r.call(this)||this;return s.setCoordinates(e,n),s}return t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,s,u){var g=this.flatCoordinates,h=ko(e,n,g[0],g[1]);if(h<u){for(var b=this.stride,T=0;T<b;++T)s[T]=g[T];return s.length=b,h}else return u},t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},t.prototype.computeExtent=function(e){return Gx(this.flatCoordinates,e)},t.prototype.getType=function(){return ru.POINT},t.prototype.intersectsExtent=function(e){return ig(e,this.flatCoordinates[0],this.flatCoordinates[1])},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=CE(this.flatCoordinates,0,e,this.stride),this.changed()},t}(Xd),NE=BE;function UE(r,t,e,n,s){var u=jx(s,function(g){return!Fs(r,t,e,n,g[0],g[1])});return!u}function Fs(r,t,e,n,s,u){for(var g=0,h=r[e-n],b=r[e-n+1];t<e;t+=n){var T=r[t],C=r[t+1];b<=u?C>u&&(T-h)*(u-b)-(s-h)*(C-b)>0&&g++:C<=u&&(T-h)*(u-b)-(s-h)*(C-b)<0&&g--,h=T,b=C}return g!==0}function N_(r,t,e,n,s,u){if(e.length===0||!Fs(r,t,e[0],n,s,u))return!1;for(var g=1,h=e.length;g<h;++g)if(Fs(r,e[g-1],e[g],n,s,u))return!1;return!0}function GE(r,t,e,n,s,u,g){for(var h,b,T,C,P,R,U,j=s[u+1],H=[],re=0,ge=e.length;re<ge;++re){var ce=e[re];for(C=r[ce-n],R=r[ce-n+1],h=t;h<ce;h+=n)P=r[h],U=r[h+1],(j<=R&&U<=j||R<=j&&j<=U)&&(T=(j-R)/(U-R)*(P-C)+C,H.push(T)),C=P,R=U}var be=NaN,we=-1/0;for(H.sort(Yf),C=H[0],h=1,b=H.length;h<b;++h){P=H[h];var Ae=Math.abs(P-C);Ae>we&&(T=(C+P)/2,N_(r,t,e,n,T,j)&&(be=T,we=Ae)),C=P}return isNaN(be)&&(be=s[u]),g?(g.push(be,j,we),g):[be,j,we]}function VE(r,t,e,n,s){var u;for(t+=n;t<e;t+=n)if(u=s(r.slice(t-n,t),r.slice(t,t+n)),u)return u;return!1}function U_(r,t,e,n,s){var u=sg(rd(),r,t,e,n);return cg(s,u)?Ux(s,u)||u[0]>=s[0]&&u[2]<=s[2]||u[1]>=s[1]&&u[3]<=s[3]?!0:VE(r,t,e,n,function(g,h){return Xx(s,g,h)}):!1}function $E(r,t,e,n,s){return!!(U_(r,t,e,n,s)||Fs(r,t,e,n,s[0],s[1])||Fs(r,t,e,n,s[0],s[3])||Fs(r,t,e,n,s[2],s[1])||Fs(r,t,e,n,s[2],s[3]))}function jE(r,t,e,n,s){if(!$E(r,t,e[0],n,s))return!1;if(e.length===1)return!0;for(var u=1,g=e.length;u<g;++u)if(UE(r,e[u-1],e[u],n,s)&&!U_(r,e[u-1],e[u],n,s))return!1;return!0}function ZE(r,t,e,n){for(;t<e-n;){for(var s=0;s<n;++s){var u=r[t+s];r[t+s]=r[e-n+s],r[e-n+s]=u}t+=n,e-=n}}function G_(r,t,e,n){for(var s=0,u=r[e-n],g=r[e-n+1];t<e;t+=n){var h=r[t],b=r[t+1];s+=(h-u)*(b+g),u=h,g=b}return s===0?void 0:s>0}function qE(r,t,e,n,s){for(var u=s!==void 0?s:!1,g=0,h=e.length;g<h;++g){var b=e[g],T=G_(r,t,b,n);if(g===0){if(u&&T||!u&&!T)return!1}else if(u&&!T||!u&&T)return!1;t=b}return!0}function V_(r,t,e,n,s){for(var u=s!==void 0?s:!1,g=0,h=e.length;g<h;++g){var b=e[g],T=G_(r,t,b,n),C=g===0?u&&T||!u&&!T:u&&!T||!u&&T;C&&ZE(r,t,b,n),t=b}return t}var XE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),$_=function(r){XE(t,r);function t(e,n,s){var u=r.call(this)||this;return u.ends_=[],u.flatInteriorPointRevision_=-1,u.flatInteriorPoint_=null,u.maxDelta_=-1,u.maxDeltaRevision_=-1,u.orientedRevision_=-1,u.orientedFlatCoordinates_=null,n!==void 0&&s?(u.setFlatCoordinates(n,e),u.ends_=s):u.setCoordinates(e,n),u}return t.prototype.appendLinearRing=function(e){this.flatCoordinates?Jv(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},t.prototype.clone=function(){var e=new t(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e},t.prototype.closestPointXY=function(e,n,s,u){return u<rg(this.getExtent(),e,n)?u:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(SE(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),AE(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,n,s,u))},t.prototype.containsXY=function(e,n){return N_(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,n)},t.prototype.getArea=function(){return LE(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},t.prototype.getCoordinates=function(e){var n;return e!==void 0?(n=this.getOrientedFlatCoordinates().slice(),V_(n,0,this.ends_,this.stride,e)):n=this.flatCoordinates,DE(n,0,this.ends_,this.stride)},t.prototype.getEnds=function(){return this.ends_},t.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=mh(this.getExtent());this.flatInteriorPoint_=GE(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},t.prototype.getInteriorPoint=function(){return new NE(this.getFlatInteriorPoint(),Wi.XYM)},t.prototype.getLinearRingCount=function(){return this.ends_.length},t.prototype.getLinearRing=function(e){return e<0||this.ends_.length<=e?null:new B_(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)},t.prototype.getLinearRings=function(){for(var e=this.layout,n=this.flatCoordinates,s=this.ends_,u=[],g=0,h=0,b=s.length;h<b;++h){var T=s[h],C=new B_(n.slice(g,T),e);u.push(C),g=T}return u},t.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;qE(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=V_(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},t.prototype.getSimplifiedGeometryInternal=function(e){var n=[],s=[];return n.length=kE(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),n,0,s),new t(n,Wi.XY,s)},t.prototype.getType=function(){return ru.POLYGON},t.prototype.intersectsExtent=function(e){return jE(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)},t.prototype.setCoordinates=function(e,n){this.setLayout(n,e,2),this.flatCoordinates||(this.flatCoordinates=[]);var s=IE(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()},t}(Xd);function j_(r){var t=r[0],e=r[1],n=r[2],s=r[3],u=[t,e,t,s,n,s,n,e,t,e];return new $_(u,Wi.XY,[u.length])}var KE=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Kd=0,HE=function(r){KE(t,r);function t(e){var n=r.call(this)||this;n.on,n.once,n.un;var s=vi({},e);return n.hints_=[0,0],n.animations_=[],n.updateAnimationKey_,n.projection_=cd(s.projection,"EPSG:3857"),n.viewportSize_=[100,100],n.targetCenter_=null,n.targetResolution_,n.targetRotation_,n.nextCenter_=null,n.nextResolution_,n.nextRotation_,n.cancelAnchor_=void 0,s.center&&(s.center=ya(s.center,n.projection_)),s.extent&&(s.extent=gh(s.extent,n.projection_)),n.applyOptions_(s),n}return t.prototype.applyOptions_=function(e){var n={},s=YE(e);this.maxResolution_=s.maxResolution,this.minResolution_=s.minResolution,this.zoomFactor_=s.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=s.minZoom;var u=WE(e),g=s.constraint,h=JE(e);this.constraints_={center:u,resolution:g,rotation:h},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom),this.setProperties(n),this.options_=e},Object.defineProperty(t.prototype,"padding",{get:function(){return this.padding_},set:function(e){var n=this.padding_;this.padding_=e;var s=this.getCenter();if(s){var u=e||[0,0,0,0];n=n||[0,0,0,0];var g=this.getResolution(),h=g/2*(u[3]-n[3]+n[1]-u[1]),b=g/2*(u[0]-n[0]+n[2]-u[2]);this.setCenterInternal([s[0]+h,s[1]-b])}},enumerable:!1,configurable:!0}),t.prototype.getUpdatedOptions_=function(e){var n=vi({},this.options_);return n.resolution!==void 0?n.resolution=this.getResolution():n.zoom=this.getZoom(),n.center=this.getCenterInternal(),n.rotation=this.getRotation(),vi({},n,e)},t.prototype.animate=function(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var n=new Array(arguments.length),s=0;s<n.length;++s){var u=arguments[s];u.center&&(u=vi({},u),u.center=ya(u.center,this.getProjection())),u.anchor&&(u=vi({},u),u.anchor=ya(u.anchor,this.getProjection())),n[s]=u}this.animateInternal.apply(this,n)},t.prototype.animateInternal=function(e){var n=arguments.length,s;n>1&&typeof arguments[n-1]=="function"&&(s=arguments[n-1],--n);for(var u=0;u<n&&!this.isDef();++u){var g=arguments[u];g.center&&this.setCenterInternal(g.center),g.zoom!==void 0?this.setZoom(g.zoom):g.resolution&&this.setResolution(g.resolution),g.rotation!==void 0&&this.setRotation(g.rotation)}if(u===n){s&&Cu(s,!0);return}for(var h=Date.now(),b=this.targetCenter_.slice(),T=this.targetResolution_,C=this.targetRotation_,P=[];u<n;++u){var R=arguments[u],U={start:h,complete:!1,anchor:R.anchor,duration:R.duration!==void 0?R.duration:1e3,easing:R.easing||ox,callback:s};if(R.center&&(U.sourceCenter=b,U.targetCenter=R.center.slice(),b=U.targetCenter),R.zoom!==void 0?(U.sourceResolution=T,U.targetResolution=this.getResolutionForZoom(R.zoom),T=U.targetResolution):R.resolution&&(U.sourceResolution=T,U.targetResolution=R.resolution,T=U.targetResolution),R.rotation!==void 0){U.sourceRotation=C;var j=ed(R.rotation-C+Math.PI,2*Math.PI)-Math.PI;U.targetRotation=C+j,C=U.targetRotation}QE(U)?U.complete=!0:h+=U.duration,P.push(U)}this.animations_.push(P),this.setHint(an.ANIMATING,1),this.updateAnimations_()},t.prototype.getAnimating=function(){return this.hints_[an.ANIMATING]>0},t.prototype.getInteracting=function(){return this.hints_[an.INTERACTING]>0},t.prototype.cancelAnimations=function(){this.setHint(an.ANIMATING,-this.hints_[an.ANIMATING]);for(var e,n=0,s=this.animations_.length;n<s;++n){var u=this.animations_[n];if(u[0].callback&&Cu(u[0].callback,!1),!e)for(var g=0,h=u.length;g<h;++g){var b=u[g];if(!b.complete){e=b.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},t.prototype.updateAnimations_=function(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!!this.getAnimating()){for(var e=Date.now(),n=!1,s=this.animations_.length-1;s>=0;--s){for(var u=this.animations_[s],g=!0,h=0,b=u.length;h<b;++h){var T=u[h];if(!T.complete){var C=e-T.start,P=T.duration>0?C/T.duration:1;P>=1?(T.complete=!0,P=1):g=!1;var R=T.easing(P);if(T.sourceCenter){var U=T.sourceCenter[0],j=T.sourceCenter[1],H=T.targetCenter[0],re=T.targetCenter[1];this.nextCenter_=T.targetCenter;var ge=U+R*(H-U),ce=j+R*(re-j);this.targetCenter_=[ge,ce]}if(T.sourceResolution&&T.targetResolution){var be=R===1?T.targetResolution:T.sourceResolution+R*(T.targetResolution-T.sourceResolution);if(T.anchor){var we=this.getViewportSize_(this.getRotation()),Ae=this.constraints_.resolution(be,0,we,!0);this.targetCenter_=this.calculateCenterZoom(Ae,T.anchor)}this.nextResolution_=T.targetResolution,this.targetResolution_=be,this.applyTargetState_(!0)}if(T.sourceRotation!==void 0&&T.targetRotation!==void 0){var De=R===1?ed(T.targetRotation+Math.PI,2*Math.PI)-Math.PI:T.sourceRotation+R*(T.targetRotation-T.sourceRotation);if(T.anchor){var it=this.constraints_.rotation(De,!0);this.targetCenter_=this.calculateCenterRotate(it,T.anchor)}this.nextRotation_=T.targetRotation,this.targetRotation_=De}if(this.applyTargetState_(!0),n=!0,!T.complete)break}}if(g){this.animations_[s]=null,this.setHint(an.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var ze=u[0].callback;ze&&Cu(ze,!0)}}this.animations_=this.animations_.filter(Boolean),n&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},t.prototype.calculateCenterRotate=function(e,n){var s,u=this.getCenterInternal();return u!==void 0&&(s=[u[0]-n[0],u[1]-n[1]],ld(s,e-this.getRotation()),Kx(s,n)),s},t.prototype.calculateCenterZoom=function(e,n){var s,u=this.getCenterInternal(),g=this.getResolution();if(u!==void 0&&g!==void 0){var h=n[0]-e*(n[0]-u[0])/g,b=n[1]-e*(n[1]-u[1])/g;s=[h,b]}return s},t.prototype.getViewportSize_=function(e){var n=this.viewportSize_;if(e){var s=n[0],u=n[1];return[Math.abs(s*Math.cos(e))+Math.abs(u*Math.sin(e)),Math.abs(s*Math.sin(e))+Math.abs(u*Math.cos(e))]}else return n},t.prototype.setViewportSize=function(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},t.prototype.getCenter=function(){var e=this.getCenterInternal();return e&&iu(e,this.getProjection())},t.prototype.getCenterInternal=function(){return this.get(Gn.CENTER)},t.prototype.getConstraints=function(){return this.constraints_},t.prototype.getConstrainResolution=function(){return this.options_.constrainResolution},t.prototype.getHints=function(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()},t.prototype.calculateExtent=function(e){var n=this.calculateExtentInternal(e);return pg(n,this.getProjection())},t.prototype.calculateExtentInternal=function(e){var n=e||this.getViewportSizeMinusPadding_(),s=this.getCenterInternal();Yt(s,1);var u=this.getResolution();Yt(u!==void 0,2);var g=this.getRotation();return Yt(g!==void 0,3),id(s,u,g,n)},t.prototype.getMaxResolution=function(){return this.maxResolution_},t.prototype.getMinResolution=function(){return this.minResolution_},t.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},t.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))},t.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},t.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))},t.prototype.setConstrainResolution=function(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))},t.prototype.getProjection=function(){return this.projection_},t.prototype.getResolution=function(){return this.get(Gn.RESOLUTION)},t.prototype.getResolutions=function(){return this.resolutions_},t.prototype.getResolutionForExtent=function(e,n){return this.getResolutionForExtentInternal(gh(e,this.getProjection()),n)},t.prototype.getResolutionForExtentInternal=function(e,n){var s=n||this.getViewportSizeMinusPadding_(),u=qa(e)/s[0],g=Za(e)/s[1];return Math.max(u,g)},t.prototype.getResolutionForValueFunction=function(e){var n=e||2,s=this.getConstrainedResolution(this.maxResolution_),u=this.minResolution_,g=Math.log(s/u)/Math.log(n);return function(h){var b=s/Math.pow(n,h*g);return b}},t.prototype.getRotation=function(){return this.get(Gn.ROTATION)},t.prototype.getValueForResolutionFunction=function(e){var n=Math.log(e||2),s=this.getConstrainedResolution(this.maxResolution_),u=this.minResolution_,g=Math.log(s/u)/n;return function(h){var b=Math.log(s/h)/n/g;return b}},t.prototype.getViewportSizeMinusPadding_=function(e){var n=this.getViewportSize_(e),s=this.padding_;return s&&(n=[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]),n},t.prototype.getState=function(){var e=this.getProjection(),n=this.getResolution(),s=this.getRotation(),u=this.getCenterInternal(),g=this.padding_;if(g){var h=this.getViewportSizeMinusPadding_();u=Hd(u,this.getViewportSize_(),[h[0]/2+g[3],h[1]/2+g[0]],n,s)}return{center:u.slice(0),projection:e!==void 0?e:null,resolution:n,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:s,zoom:this.getZoom()}},t.prototype.getZoom=function(){var e,n=this.getResolution();return n!==void 0&&(e=this.getZoomForResolution(n)),e},t.prototype.getZoomForResolution=function(e){var n=this.minZoom_||0,s,u;if(this.resolutions_){var g=Jf(this.resolutions_,e,1);n=g,s=this.resolutions_[g],g==this.resolutions_.length-1?u=2:u=s/this.resolutions_[g+1]}else s=this.maxResolution_,u=this.zoomFactor_;return n+Math.log(s/e)/Math.log(u)},t.prototype.getResolutionForZoom=function(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var n=oi(Math.floor(e),0,this.resolutions_.length-2),s=this.resolutions_[n]/this.resolutions_[n+1];return this.resolutions_[n]/Math.pow(s,oi(e-n,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)},t.prototype.fit=function(e,n){var s;if(Yt(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function",24),Array.isArray(e)){Yt(!sd(e),25);var u=gh(e,this.getProjection());s=j_(u)}else if(e.getType()===ru.CIRCLE){var u=gh(e.getExtent(),this.getProjection());s=j_(u),s.rotate(this.getRotation(),mh(u))}else{var g=a1();g?s=e.clone().transform(g,this.getProjection()):s=e}this.fitInternal(s,n)},t.prototype.rotatedExtentForGeometry=function(e){for(var n=this.getRotation(),s=Math.cos(n),u=Math.sin(-n),g=e.getFlatCoordinates(),h=e.getStride(),b=1/0,T=1/0,C=-1/0,P=-1/0,R=0,U=g.length;R<U;R+=h){var j=g[R]*s-g[R+1]*u,H=g[R]*u+g[R+1]*s;b=Math.min(b,j),T=Math.min(T,H),C=Math.max(C,j),P=Math.max(P,H)}return[b,T,C,P]},t.prototype.fitInternal=function(e,n){var s=n||{},u=s.size;u||(u=this.getViewportSizeMinusPadding_());var g=s.padding!==void 0?s.padding:[0,0,0,0],h=s.nearest!==void 0?s.nearest:!1,b;s.minResolution!==void 0?b=s.minResolution:s.maxZoom!==void 0?b=this.getResolutionForZoom(s.maxZoom):b=0;var T=this.rotatedExtentForGeometry(e),C=this.getResolutionForExtentInternal(T,[u[0]-g[1]-g[3],u[1]-g[0]-g[2]]);C=isNaN(C)?b:Math.max(C,b),C=this.getConstrainedResolution(C,h?0:1);var P=this.getRotation(),R=Math.sin(P),U=Math.cos(P),j=mh(T);j[0]+=(g[1]-g[3])/2*C,j[1]+=(g[0]-g[2])/2*C;var H=j[0]*U-j[1]*R,re=j[1]*U+j[0]*R,ge=this.getConstrainedCenter([H,re],C),ce=s.callback?s.callback:ch;s.duration!==void 0?this.animateInternal({resolution:C,center:ge,duration:s.duration,easing:s.easing},ce):(this.targetResolution_=C,this.targetCenter_=ge,this.applyTargetState_(!1,!0),Cu(ce,!0))},t.prototype.centerOn=function(e,n,s){this.centerOnInternal(ya(e,this.getProjection()),n,s)},t.prototype.centerOnInternal=function(e,n,s){this.setCenterInternal(Hd(e,n,s,this.getResolution(),this.getRotation()))},t.prototype.calculateCenterShift=function(e,n,s,u){var g,h=this.padding_;if(h&&e){var b=this.getViewportSizeMinusPadding_(-s),T=Hd(e,u,[b[0]/2+h[3],b[1]/2+h[0]],n,s);g=[e[0]-T[0],e[1]-T[1]]}return g},t.prototype.isDef=function(){return!!this.getCenterInternal()&&this.getResolution()!==void 0},t.prototype.adjustCenter=function(e){var n=iu(this.targetCenter_,this.getProjection());this.setCenter([n[0]+e[0],n[1]+e[1]])},t.prototype.adjustCenterInternal=function(e){var n=this.targetCenter_;this.setCenterInternal([n[0]+e[0],n[1]+e[1]])},t.prototype.adjustResolution=function(e,n){var s=n&&ya(n,this.getProjection());this.adjustResolutionInternal(e,s)},t.prototype.adjustResolutionInternal=function(e,n){var s=this.getAnimating()||this.getInteracting(),u=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(this.targetResolution_*e,0,u,s);n&&(this.targetCenter_=this.calculateCenterZoom(g,n)),this.targetResolution_*=e,this.applyTargetState_()},t.prototype.adjustZoom=function(e,n){this.adjustResolution(Math.pow(this.zoomFactor_,-e),n)},t.prototype.adjustRotation=function(e,n){n&&(n=ya(n,this.getProjection())),this.adjustRotationInternal(e,n)},t.prototype.adjustRotationInternal=function(e,n){var s=this.getAnimating()||this.getInteracting(),u=this.constraints_.rotation(this.targetRotation_+e,s);n&&(this.targetCenter_=this.calculateCenterRotate(u,n)),this.targetRotation_+=e,this.applyTargetState_()},t.prototype.setCenter=function(e){this.setCenterInternal(ya(e,this.getProjection()))},t.prototype.setCenterInternal=function(e){this.targetCenter_=e,this.applyTargetState_()},t.prototype.setHint=function(e,n){return this.hints_[e]+=n,this.changed(),this.hints_[e]},t.prototype.setResolution=function(e){this.targetResolution_=e,this.applyTargetState_()},t.prototype.setRotation=function(e){this.targetRotation_=e,this.applyTargetState_()},t.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))},t.prototype.applyTargetState_=function(e,n){var s=this.getAnimating()||this.getInteracting()||n,u=this.constraints_.rotation(this.targetRotation_,s),g=this.getViewportSize_(u),h=this.constraints_.resolution(this.targetResolution_,0,g,s),b=this.constraints_.center(this.targetCenter_,h,g,s,this.calculateCenterShift(this.targetCenter_,h,u,g));this.get(Gn.ROTATION)!==u&&this.set(Gn.ROTATION,u),this.get(Gn.RESOLUTION)!==h&&this.set(Gn.RESOLUTION,h),(!this.get(Gn.CENTER)||!od(this.get(Gn.CENTER),b))&&this.set(Gn.CENTER,b),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0},t.prototype.resolveConstraints=function(e,n,s){var u=e!==void 0?e:200,g=n||0,h=this.constraints_.rotation(this.targetRotation_),b=this.getViewportSize_(h),T=this.constraints_.resolution(this.targetResolution_,g,b),C=this.constraints_.center(this.targetCenter_,T,b,!1,this.calculateCenterShift(this.targetCenter_,T,h,b));if(u===0&&!this.cancelAnchor_){this.targetResolution_=T,this.targetRotation_=h,this.targetCenter_=C,this.applyTargetState_();return}var P=s||(u===0?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==T||this.getRotation()!==h||!this.getCenterInternal()||!od(this.getCenterInternal(),C))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:h,center:C,resolution:T,duration:u,easing:Po,anchor:P}))},t.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(an.INTERACTING,1)},t.prototype.endInteraction=function(e,n,s){var u=s&&ya(s,this.getProjection());this.endInteractionInternal(e,n,u)},t.prototype.endInteractionInternal=function(e,n,s){this.setHint(an.INTERACTING,-1),this.resolveConstraints(e,n,s)},t.prototype.getConstrainedCenter=function(e,n){var s=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,n||this.getResolution(),s)},t.prototype.getConstrainedZoom=function(e,n){var s=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(s,n))},t.prototype.getConstrainedResolution=function(e,n){var s=n||0,u=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,s,u)},t}(_a);function Cu(r,t){setTimeout(function(){r(t)},0)}function WE(r){if(r.extent!==void 0){var t=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return A_(r.extent,r.constrainOnlyCenter,t)}var e=cd(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&e.isGlobal()){var n=e.getExtent().slice();return n[0]=-1/0,n[2]=1/0,A_(n,!1,!1)}return uE}function YE(r){var t,e,n,s=28,u=2,g=r.minZoom!==void 0?r.minZoom:Kd,h=r.maxZoom!==void 0?r.maxZoom:s,b=r.zoomFactor!==void 0?r.zoomFactor:u,T=r.multiWorld!==void 0?r.multiWorld:!1,C=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,P=r.showFullExtent!==void 0?r.showFullExtent:!1,R=cd(r.projection,"EPSG:3857"),U=R.getExtent(),j=r.constrainOnlyCenter,H=r.extent;if(!T&&!H&&R.isGlobal()&&(j=!1,H=U),r.resolutions!==void 0){var re=r.resolutions;e=re[g],n=re[h]!==void 0?re[h]:re[re.length-1],r.constrainResolution?t=fE(re,C,!j&&H,P):t=C_(e,n,C,!j&&H,P)}else{var ge=U?Math.max(qa(U),Za(U)):360*ja[fh.DEGREES]/R.getMetersPerUnit(),ce=ge/fd/Math.pow(u,Kd),be=ce/Math.pow(u,s-Kd);e=r.maxResolution,e!==void 0?g=0:e=ce/Math.pow(b,g),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(b,h):n=ce/Math.pow(b,h):n=be),h=g+Math.floor(Math.log(e/n)/Math.log(b)),n=e/Math.pow(b,h-g),r.constrainResolution?t=dE(b,e,n,C,!j&&H,P):t=C_(e,n,C,!j&&H,P)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:g,zoomFactor:b}}function JE(r){var t=r.enableRotation!==void 0?r.enableRotation:!0;if(t){var e=r.constrainRotation;return e===void 0||e===!0?mE():e===!1?I_:typeof e=="number"?pE(e):I_}else return qd}function QE(r){return!(r.sourceCenter&&r.targetCenter&&!od(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Hd(r,t,e,n,s){var u=Math.cos(-s),g=Math.sin(-s),h=r[0]*u-r[1]*g,b=r[1]*u+r[0]*g;h+=(t[0]/2-e[0])*n,b+=(e[1]-t[1]/2)*n,g=-g;var T=h*u-b*g,C=b*u+h*g;return[T,C]}var Bs=HE,eT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),tT=function(r){eT(t,r);function t(e){var n=r.call(this)||this;n.on,n.once,n.un;var s=rT(e);n.boundHandleBrowserEvent_=n.handleBrowserEvent.bind(n),n.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,n.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:h_,n.postRenderTimeoutHandle_,n.animationDelayKey_,n.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(n),n.coordinateToPixelTransform_=Wo(),n.pixelToCoordinateTransform_=Wo(),n.frameIndex_=0,n.frameState_=null,n.previousExtent_=null,n.viewPropertyListenerKey_=null,n.viewChangeListenerKey_=null,n.layerGroupPropertyListenerKeys_=null,n.viewport_=document.createElement("div"),n.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),n.viewport_.style.position="relative",n.viewport_.style.overflow="hidden",n.viewport_.style.width="100%",n.viewport_.style.height="100%",n.overlayContainer_=document.createElement("div"),n.overlayContainer_.style.position="absolute",n.overlayContainer_.style.zIndex="0",n.overlayContainer_.style.width="100%",n.overlayContainer_.style.height="100%",n.overlayContainer_.style.pointerEvents="none",n.overlayContainer_.className="ol-overlaycontainer",n.viewport_.appendChild(n.overlayContainer_),n.overlayContainerStopEvent_=document.createElement("div"),n.overlayContainerStopEvent_.style.position="absolute",n.overlayContainerStopEvent_.style.zIndex="0",n.overlayContainerStopEvent_.style.width="100%",n.overlayContainerStopEvent_.style.height="100%",n.overlayContainerStopEvent_.style.pointerEvents="none",n.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",n.viewport_.appendChild(n.overlayContainerStopEvent_),n.mapBrowserEventHandler_=null,n.moveTolerance_=e.moveTolerance,n.keyboardEventTarget_=s.keyboardEventTarget,n.keyHandlerKeys_=null,n.controls=s.controls||new xn,n.interactions=s.interactions||new xn,n.overlays_=s.overlays,n.overlayIdIndex_={},n.renderer_=null,n.handleResize_,n.postRenderFunctions_=[],n.tileQueue_=new hE(n.getTilePriority.bind(n),n.handleTileChange_.bind(n)),n.addChangeListener(xi.LAYERGROUP,n.handleLayerGroupChanged_),n.addChangeListener(xi.VIEW,n.handleViewChanged_),n.addChangeListener(xi.SIZE,n.handleSizeChanged_),n.addChangeListener(xi.TARGET,n.handleTargetChanged_),n.setProperties(s.values);var u=n;return e.view&&!(e.view instanceof Bs)&&e.view.then(function(g){u.setView(new Bs(g))}),n.controls.addEventListener(nn.ADD,function(g){g.element.setMap(this)}.bind(n)),n.controls.addEventListener(nn.REMOVE,function(g){g.element.setMap(null)}.bind(n)),n.interactions.addEventListener(nn.ADD,function(g){g.element.setMap(this)}.bind(n)),n.interactions.addEventListener(nn.REMOVE,function(g){g.element.setMap(null)}.bind(n)),n.overlays_.addEventListener(nn.ADD,function(g){this.addOverlayInternal_(g.element)}.bind(n)),n.overlays_.addEventListener(nn.REMOVE,function(g){var h=g.element,b=h.getId();b!==void 0&&delete this.overlayIdIndex_[b.toString()],g.element.setMap(null)}.bind(n)),n.controls.forEach(function(g){g.setMap(this)}.bind(n)),n.interactions.forEach(function(g){g.setMap(this)}.bind(n)),n.overlays_.forEach(n.addOverlayInternal_.bind(n)),n}return t.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},t.prototype.addControl=function(e){this.getControls().push(e)},t.prototype.addInteraction=function(e){this.getInteractions().push(e)},t.prototype.addLayer=function(e){var n=this.getLayerGroup().getLayers();n.push(e)},t.prototype.addOverlay=function(e){this.getOverlays().push(e)},t.prototype.addOverlayInternal_=function(e){var n=e.getId();n!==void 0&&(this.overlayIdIndex_[n.toString()]=e),e.setMap(this)},t.prototype.disposeInternal=function(){this.setTarget(null),r.prototype.disposeInternal.call(this)},t.prototype.forEachFeatureAtPixel=function(e,n,s){if(!!this.frameState_){var u=this.getCoordinateFromPixelInternal(e);s=s!==void 0?s:{};var g=s.hitTolerance!==void 0?s.hitTolerance:0,h=s.layerFilter!==void 0?s.layerFilter:hh,b=s.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(u,this.frameState_,g,b,n,null,h,null)}},t.prototype.getFeaturesAtPixel=function(e,n){var s=[];return this.forEachFeatureAtPixel(e,function(u){s.push(u)},n),s},t.prototype.forEachLayerAtPixel=function(e,n,s){if(!!this.frameState_){var u=s||{},g=u.hitTolerance!==void 0?u.hitTolerance:0,h=u.layerFilter||hh;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,g,n,h)}},t.prototype.hasFeatureAtPixel=function(e,n){if(!this.frameState_)return!1;var s=this.getCoordinateFromPixelInternal(e);n=n!==void 0?n:{};var u=n.layerFilter!==void 0?n.layerFilter:hh,g=n.hitTolerance!==void 0?n.hitTolerance:0,h=n.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(s,this.frameState_,g,h,u,null)},t.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))},t.prototype.getEventCoordinateInternal=function(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))},t.prototype.getEventPixel=function(e){var n=this.viewport_.getBoundingClientRect(),s="changedTouches"in e?e.changedTouches[0]:e;return[s.clientX-n.left,s.clientY-n.top]},t.prototype.getTarget=function(){return this.get(xi.TARGET)},t.prototype.getTargetElement=function(){var e=this.getTarget();return e!==void 0?typeof e=="string"?document.getElementById(e):e:null},t.prototype.getCoordinateFromPixel=function(e){return iu(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())},t.prototype.getCoordinateFromPixelInternal=function(e){var n=this.frameState_;return n?d_(n.pixelToCoordinateTransform,e.slice()):null},t.prototype.getControls=function(){return this.controls},t.prototype.getOverlays=function(){return this.overlays_},t.prototype.getOverlayById=function(e){var n=this.overlayIdIndex_[e.toString()];return n!==void 0?n:null},t.prototype.getInteractions=function(){return this.interactions},t.prototype.getLayerGroup=function(){return this.get(xi.LAYERGROUP)},t.prototype.setLayers=function(e){var n=this.getLayerGroup();if(e instanceof xn){n.setLayers(e);return}var s=n.getLayers();s.clear(),s.extend(e)},t.prototype.getLayers=function(){var e=this.getLayerGroup().getLayers();return e},t.prototype.getLoading=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),n=0,s=e.length;n<s;++n){var u=e[n].layer,g=u.getSource();if(g&&g.loading)return!0}return!1},t.prototype.getPixelFromCoordinate=function(e){var n=ya(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(n)},t.prototype.getPixelFromCoordinateInternal=function(e){var n=this.frameState_;return n?d_(n.coordinateToPixelTransform,e.slice(0,2)):null},t.prototype.getRenderer=function(){return this.renderer_},t.prototype.getSize=function(){return this.get(xi.SIZE)},t.prototype.getView=function(){return this.get(xi.VIEW)},t.prototype.getViewport=function(){return this.viewport_},t.prototype.getOverlayContainer=function(){return this.overlayContainer_},t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.prototype.getOwnerDocument=function(){var e=this.getTargetElement();return e?e.ownerDocument:document},t.prototype.getTilePriority=function(e,n,s,u){return cE(this.frameState_,e,n,s,u)},t.prototype.handleBrowserEvent=function(e,n){var s=n||e.type,u=new Xa(s,this,e);this.handleMapBrowserEvent(u)},t.prototype.handleMapBrowserEvent=function(e){if(!!this.frameState_){var n=e.originalEvent,s=n.type;if(s===$d.POINTERDOWN||s===wt.WHEEL||s===wt.KEYDOWN){var u=this.getOwnerDocument(),g=this.viewport_.getRootNode?this.viewport_.getRootNode():u,h=n.target;if(this.overlayContainerStopEvent_.contains(h)||!(g===u?u.documentElement:g).contains(h))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1)for(var b=this.getInteractions().getArray().slice(),T=b.length-1;T>=0;T--){var C=b[T];if(!(C.getMap()!==this||!C.getActive()||!this.getTargetElement())){var P=C.handleEvent(e);if(!P||e.propagationStopped)break}}}},t.prototype.handlePostRender=function(){var e=this.frameState_,n=this.tileQueue_;if(!n.isEmpty()){var s=this.maxTilesLoading_,u=s;if(e){var g=e.viewHints;if(g[an.ANIMATING]||g[an.INTERACTING]){var h=Date.now()-e.time>8;s=h?0:8,u=h?0:2}}n.getTilesLoading()<s&&(n.reprioritize(),n.loadMoreTiles(s,u))}e&&this.hasListener(zs.RENDERCOMPLETE)&&!e.animate&&!this.tileQueue_.getTilesLoading()&&!this.getLoading()&&this.renderer_.dispatchRenderEvent(zs.RENDERCOMPLETE,e);for(var b=this.postRenderFunctions_,T=0,C=b.length;T<C;++T)b[T](this,e);b.length=0},t.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},t.prototype.handleTargetChanged_=function(){var e;if(this.getTarget()&&(e=this.getTargetElement()),this.mapBrowserEventHandler_){for(var n=0,s=this.keyHandlerKeys_.length;n<s;++n)jr(this.keyHandlerKeys_[n]);this.keyHandlerKeys_=null,this.viewport_.removeEventListener(wt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(wt.WHEEL,this.boundHandleBrowserEvent_),this.handleResize_!==void 0&&(removeEventListener(wt.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Gd(this.viewport_)}if(!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new nE(this,this.moveTolerance_);for(var u in dr)this.mapBrowserEventHandler_.addEventListener(dr[u],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(wt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(wt.WHEEL,this.boundHandleBrowserEvent_,c_?{passive:!1}:!1);var g=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[hr(g,wt.KEYDOWN,this.handleBrowserEvent,this),hr(g,wt.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(wt.RESIZE,this.handleResize_,!1))}this.updateSize()},t.prototype.handleTileChange_=function(){this.render()},t.prototype.handleViewPropertyChanged_=function(){this.render()},t.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(jr(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(jr(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var e=this.getView();e&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=hr(e,Ro.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=hr(e,wt.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()},t.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(jr),this.layerGroupPropertyListenerKeys_=null);var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[hr(e,Ro.PROPERTYCHANGE,this.render,this),hr(e,wt.CHANGE,this.render,this)]),this.render()},t.prototype.isRendered=function(){return!!this.frameState_},t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},t.prototype.redrawText=function(){for(var e=this.getLayerGroup().getLayerStatesArray(),n=0,s=e.length;n<s;++n){var u=e[n].layer;u.hasRenderer()&&u.getRenderer().handleFontsChanged()}},t.prototype.render=function(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},t.prototype.removeControl=function(e){return this.getControls().remove(e)},t.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)},t.prototype.removeLayer=function(e){var n=this.getLayerGroup().getLayers();return n.remove(e)},t.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)},t.prototype.renderFrame_=function(e){var n=this,s=this.getSize(),u=this.getView(),g=this.frameState_,h=null;if(s!==void 0&&vg(s)&&u&&u.isDef()){var b=u.getHints(this.frameState_?this.frameState_.viewHints:void 0),T=u.getState();if(h={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:id(T.center,T.resolution,T.rotation,s),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:s,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:T,viewHints:b,wantedTiles:{}},T.nextCenter&&T.nextResolution){var C=isNaN(T.nextRotation)?T.rotation:T.nextRotation;h.nextExtent=id(T.nextCenter,T.nextResolution,C,s)}}if(this.frameState_=h,this.renderer_.renderFrame(h),h){if(h.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,h.postRenderFunctions),g){var P=!this.previousExtent_||!sd(this.previousExtent_)&&!ag(h.extent,this.previousExtent_);P&&(this.dispatchEvent(new Mu(Su.MOVESTART,this,g)),this.previousExtent_=tu(this.previousExtent_))}var R=this.previousExtent_&&!h.viewHints[an.ANIMATING]&&!h.viewHints[an.INTERACTING]&&!ag(h.extent,this.previousExtent_);R&&(this.dispatchEvent(new Mu(Su.MOVEEND,this,h)),Bx(h.extent,this.previousExtent_))}this.dispatchEvent(new Mu(Su.POSTRENDER,this,h)),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){n.postRenderTimeoutHandle_=void 0,n.handlePostRender()},0))},t.prototype.setLayerGroup=function(e){this.set(xi.LAYERGROUP,e)},t.prototype.setSize=function(e){this.set(xi.SIZE,e)},t.prototype.setTarget=function(e){this.set(xi.TARGET,e)},t.prototype.setView=function(e){if(!e||e instanceof Bs){this.set(xi.VIEW,e);return}this.set(xi.VIEW,new Bs);var n=this;e.then(function(s){n.setView(new Bs(s))})},t.prototype.updateSize=function(){var e=this.getTargetElement(),n=void 0;if(e){var s=getComputedStyle(e),u=e.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),g=e.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(u)&&!isNaN(g)&&(n=[u,g],!vg(n)&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(n),this.updateViewportSize_()},t.prototype.updateViewportSize_=function(){var e=this.getView();if(e){var n=void 0,s=getComputedStyle(this.viewport_);s.width&&s.height&&(n=[parseInt(s.width,10),parseInt(s.height,10)]),e.setViewportSize(n)}},t}(_a);function rT(r){var t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);var e={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new Y2({layers:r.layers});e[xi.LAYERGROUP]=n,e[xi.TARGET]=r.target,e[xi.VIEW]=r.view instanceof Bs?r.view:new Bs;var s;r.controls!==void 0&&(Array.isArray(r.controls)?s=new xn(r.controls.slice()):(Yt(typeof r.controls.getArray=="function",47),s=r.controls));var u;r.interactions!==void 0&&(Array.isArray(r.interactions)?u=new xn(r.interactions.slice()):(Yt(typeof r.interactions.getArray=="function",48),u=r.interactions));var g;return r.overlays!==void 0?Array.isArray(r.overlays)?g=new xn(r.overlays.slice()):(Yt(typeof r.overlays.getArray=="function",49),g=r.overlays):g=new xn,{controls:s,interactions:u,keyboardEventTarget:t,overlays:g,values:e}}var iT=tT,nT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),aT=function(r){nT(t,r);function t(e){var n=r.call(this)||this,s=e.element;return s&&!e.target&&!s.style.pointerEvents&&(s.style.pointerEvents="auto"),n.element=s||null,n.target_=null,n.map_=null,n.listenerKeys=[],e.render&&(n.render=e.render),e.target&&n.setTarget(e.target),n}return t.prototype.disposeInternal=function(){Gd(this.element),r.prototype.disposeInternal.call(this)},t.prototype.getMap=function(){return this.map_},t.prototype.setMap=function(e){this.map_&&Gd(this.element);for(var n=0,s=this.listenerKeys.length;n<s;++n)jr(this.listenerKeys[n]);if(this.listenerKeys.length=0,this.map_=e,this.map_){var u=this.target_?this.target_:e.getOverlayContainerStopEvent();u.appendChild(this.element),this.render!==ch&&this.listenerKeys.push(hr(e,Su.POSTRENDER,this.render,this)),e.render()}},t.prototype.render=function(e){},t.prototype.setTarget=function(e){this.target_=typeof e=="string"?document.getElementById(e):e},t}(_a),Wd=aT,sT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),oT=function(r){sT(t,r);function t(e){var n=this,s=e||{};n=r.call(this,{element:document.createElement("div"),render:s.render,target:s.target})||this,n.ulElement_=document.createElement("ul"),n.collapsed_=s.collapsed!==void 0?s.collapsed:!0,n.userCollapsed_=n.collapsed_,n.overrideCollapsible_=s.collapsible!==void 0,n.collapsible_=s.collapsible!==void 0?s.collapsible:!0,n.collapsible_||(n.collapsed_=!1);var u=s.className!==void 0?s.className:"ol-attribution",g=s.tipLabel!==void 0?s.tipLabel:"Attributions",h=s.expandClassName!==void 0?s.expandClassName:u+"-expand",b=s.collapseLabel!==void 0?s.collapseLabel:"\u203A",T=s.collapseClassName!==void 0?s.collapseClassName:u+"-collpase";typeof b=="string"?(n.collapseLabel_=document.createElement("span"),n.collapseLabel_.textContent=b,n.collapseLabel_.className=T):n.collapseLabel_=b;var C=s.label!==void 0?s.label:"i";typeof C=="string"?(n.label_=document.createElement("span"),n.label_.textContent=C,n.label_.className=h):n.label_=C;var P=n.collapsible_&&!n.collapsed_?n.collapseLabel_:n.label_;n.toggleButton_=document.createElement("button"),n.toggleButton_.setAttribute("type","button"),n.toggleButton_.setAttribute("aria-expanded",String(!n.collapsed_)),n.toggleButton_.title=g,n.toggleButton_.appendChild(P),n.toggleButton_.addEventListener(wt.CLICK,n.handleClick_.bind(n),!1);var R=u+" "+Eu+" "+Ud+(n.collapsed_&&n.collapsible_?" "+E_:"")+(n.collapsible_?"":" ol-uncollapsible"),U=n.element;return U.className=R,U.appendChild(n.toggleButton_),U.appendChild(n.ulElement_),n.renderedAttributions_=[],n.renderedVisible_=!0,n}return t.prototype.collectSourceAttributions_=function(e){for(var n={},s=[],u=!0,g=e.layerStatesArray,h=0,b=g.length;h<b;++h){var T=g[h];if(!!bu(T,e.viewState)){var C=T.layer.getSource();if(!!C){var P=C.getAttributions();if(!!P){var R=P(e);if(!!R)if(u=u&&C.getAttributionsCollapsible()!==!1,Array.isArray(R))for(var U=0,j=R.length;U<j;++U)R[U]in n||(s.push(R[U]),n[R[U]]=!0);else R in n||(s.push(R),n[R]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(u),s},t.prototype.updateElement_=function(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var n=this.collectSourceAttributions_(e),s=n.length>0;if(this.renderedVisible_!=s&&(this.element.style.display=s?"":"none",this.renderedVisible_=s),!Zm(n,this.renderedAttributions_)){G2(this.ulElement_);for(var u=0,g=n.length;u<g;++u){var h=document.createElement("li");h.innerHTML=n[u],this.ulElement_.appendChild(h)}this.renderedAttributions_=n}},t.prototype.handleClick_=function(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},t.prototype.handleToggle_=function(){this.element.classList.toggle(E_),this.collapsed_?T_(this.collapseLabel_,this.label_):T_(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},t.prototype.getCollapsible=function(){return this.collapsible_},t.prototype.setCollapsible=function(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},t.prototype.setCollapsed=function(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()},t.prototype.getCollapsed=function(){return this.collapsed_},t.prototype.render=function(e){this.updateElement_(e.frameState)},t}(Wd),lT=oT,hT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),cT=function(r){hT(t,r);function t(e){var n=this,s=e||{};n=r.call(this,{element:document.createElement("div"),render:s.render,target:s.target})||this;var u=s.className!==void 0?s.className:"ol-rotate",g=s.label!==void 0?s.label:"\u21E7",h=s.compassClassName!==void 0?s.compassClassName:"ol-compass";n.label_=null,typeof g=="string"?(n.label_=document.createElement("span"),n.label_.className=h,n.label_.textContent=g):(n.label_=g,n.label_.classList.add(h));var b=s.tipLabel?s.tipLabel:"Reset rotation",T=document.createElement("button");T.className=u+"-reset",T.setAttribute("type","button"),T.title=b,T.appendChild(n.label_),T.addEventListener(wt.CLICK,n.handleClick_.bind(n),!1);var C=u+" "+Eu+" "+Ud,P=n.element;return P.className=C,P.appendChild(T),n.callResetNorth_=s.resetNorth?s.resetNorth:void 0,n.duration_=s.duration!==void 0?s.duration:250,n.autoHide_=s.autoHide!==void 0?s.autoHide:!0,n.rotation_=void 0,n.autoHide_&&n.element.classList.add(wu),n}return t.prototype.handleClick_=function(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},t.prototype.resetNorth_=function(){var e=this.getMap(),n=e.getView();if(!!n){var s=n.getRotation();s!==void 0&&(this.duration_>0&&s%(2*Math.PI)!=0?n.animate({rotation:0,duration:this.duration_,easing:Po}):n.setRotation(0))}},t.prototype.render=function(e){var n=e.frameState;if(!!n){var s=n.viewState.rotation;if(s!=this.rotation_){var u="rotate("+s+"rad)";if(this.autoHide_){var g=this.element.classList.contains(wu);!g&&s===0?this.element.classList.add(wu):g&&s!==0&&this.element.classList.remove(wu)}this.label_.style.transform=u}this.rotation_=s}},t}(Wd),uT=cT,fT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),dT=function(r){fT(t,r);function t(e){var n=this,s=e||{};n=r.call(this,{element:document.createElement("div"),target:s.target})||this;var u=s.className!==void 0?s.className:"ol-zoom",g=s.delta!==void 0?s.delta:1,h=s.zoomInClassName!==void 0?s.zoomInClassName:u+"-in",b=s.zoomOutClassName!==void 0?s.zoomOutClassName:u+"-out",T=s.zoomInLabel!==void 0?s.zoomInLabel:"+",C=s.zoomOutLabel!==void 0?s.zoomOutLabel:"\u2013",P=s.zoomInTipLabel!==void 0?s.zoomInTipLabel:"Zoom in",R=s.zoomOutTipLabel!==void 0?s.zoomOutTipLabel:"Zoom out",U=document.createElement("button");U.className=h,U.setAttribute("type","button"),U.title=P,U.appendChild(typeof T=="string"?document.createTextNode(T):T),U.addEventListener(wt.CLICK,n.handleClick_.bind(n,g),!1);var j=document.createElement("button");j.className=b,j.setAttribute("type","button"),j.title=R,j.appendChild(typeof C=="string"?document.createTextNode(C):C),j.addEventListener(wt.CLICK,n.handleClick_.bind(n,-g),!1);var H=u+" "+Eu+" "+Ud,re=n.element;return re.className=H,re.appendChild(U),re.appendChild(j),n.duration_=s.duration!==void 0?s.duration:250,n}return t.prototype.handleClick_=function(e,n){n.preventDefault(),this.zoomByDelta_(e)},t.prototype.zoomByDelta_=function(e){var n=this.getMap(),s=n.getView();if(!!s){var u=s.getZoom();if(u!==void 0){var g=s.getConstrainedZoom(u+e);this.duration_>0?(s.getAnimating()&&s.cancelAnimations(),s.animate({zoom:g,duration:this.duration_,easing:Po})):s.setZoom(g)}}},t}(Wd),pT=dT;function mT(r){var t=r||{},e=new xn,n=t.zoom!==void 0?t.zoom:!0;n&&e.push(new pT(t.zoomOptions));var s=t.rotate!==void 0?t.rotate:!0;s&&e.push(new uT(t.rotateOptions));var u=t.attribution!==void 0?t.attribution:!0;return u&&e.push(new lT(t.attributionOptions)),e}var Z_={ACTIVE:"active"},gT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),_T=function(r){gT(t,r);function t(e){var n=r.call(this)||this;return n.on,n.once,n.un,e&&e.handleEvent&&(n.handleEvent=e.handleEvent),n.map_=null,n.setActive(!0),n}return t.prototype.getActive=function(){return this.get(Z_.ACTIVE)},t.prototype.getMap=function(){return this.map_},t.prototype.handleEvent=function(e){return!0},t.prototype.setActive=function(e){this.set(Z_.ACTIVE,e)},t.prototype.setMap=function(e){this.map_=e},t}(_a);function yT(r,t,e){var n=r.getCenterInternal();if(n){var s=[n[0]+t[0],n[1]+t[1]];r.animateInternal({duration:e!==void 0?e:250,easing:lx,center:r.getConstrainedCenter(s)})}}function Yd(r,t,e,n){var s=r.getZoom();if(s!==void 0){var u=r.getConstrainedZoom(s+t),g=r.getResolutionForZoom(u);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:g,anchor:e,duration:n!==void 0?n:250,easing:Po})}}var Th=_T,vT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),xT=function(r){vT(t,r);function t(e){var n=r.call(this)||this,s=e||{};return n.delta_=s.delta?s.delta:1,n.duration_=s.duration!==void 0?s.duration:250,n}return t.prototype.handleEvent=function(e){var n=!1;if(e.type==dr.DBLCLICK){var s=e.originalEvent,u=e.map,g=e.coordinate,h=s.shiftKey?-this.delta_:this.delta_,b=u.getView();Yd(b,h,g,this.duration_),s.preventDefault(),n=!0}return!n},t}(Th),bT=xT,wT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),ET=function(r){wT(t,r);function t(e){var n=this,s=e||{};return n=r.call(this,s)||this,s.handleDownEvent&&(n.handleDownEvent=s.handleDownEvent),s.handleDragEvent&&(n.handleDragEvent=s.handleDragEvent),s.handleMoveEvent&&(n.handleMoveEvent=s.handleMoveEvent),s.handleUpEvent&&(n.handleUpEvent=s.handleUpEvent),s.stopDown&&(n.stopDown=s.stopDown),n.handlingDownUpSequence=!1,n.trackedPointers_={},n.targetPointers=[],n}return t.prototype.getPointerCount=function(){return this.targetPointers.length},t.prototype.handleDownEvent=function(e){return!1},t.prototype.handleDragEvent=function(e){},t.prototype.handleEvent=function(e){if(!e.originalEvent)return!0;var n=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==dr.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==dr.POINTERUP){var s=this.handleUpEvent(e);this.handlingDownUpSequence=s&&this.targetPointers.length>0}}else if(e.type==dr.POINTERDOWN){var u=this.handleDownEvent(e);this.handlingDownUpSequence=u,n=this.stopDown(u)}else e.type==dr.POINTERMOVE&&this.handleMoveEvent(e);return!n},t.prototype.handleMoveEvent=function(e){},t.prototype.handleUpEvent=function(e){return!1},t.prototype.stopDown=function(e){return e},t.prototype.updateTrackedPointers_=function(e){if(TT(e)){var n=e.originalEvent,s=n.pointerId.toString();e.type==dr.POINTERUP?delete this.trackedPointers_[s]:e.type==dr.POINTERDOWN?this.trackedPointers_[s]=n:s in this.trackedPointers_&&(this.trackedPointers_[s]=n),this.targetPointers=tx(this.trackedPointers_)}},t}(Th);function Jd(r){for(var t=r.length,e=0,n=0,s=0;s<t;s++)e+=r[s].clientX,n+=r[s].clientY;return[e/t,n/t]}function TT(r){var t=r.type;return t===dr.POINTERDOWN||t===dr.POINTERDRAG||t===dr.POINTERUP}var Mh=ET;function Qd(r){var t=arguments;return function(e){for(var n=!0,s=0,u=t.length;s<u&&(n=n&&t[s](e),!!n);++s);return n}}var MT=function(r){var t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ST=function(r){return r.target.getTargetElement().contains(document.activeElement)},q_=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?ST(r):!0},AT=hh,X_=function(r){var t=r.originalEvent;return t.button==0&&!(m2&&g2&&t.ctrlKey)},K_=function(r){var t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},CT=function(r){var t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},H_=function(r){var t=r.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"},ep=function(r){var t=r.originalEvent;return Yt(t!==void 0,56),t.pointerType=="mouse"},IT=function(r){var t=r.originalEvent;return Yt(t!==void 0,56),t.isPrimary&&t.button===0},PT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),RT=function(r){PT(t,r);function t(e){var n=r.call(this,{stopDown:Hc})||this,s=e||{};n.kinetic_=s.kinetic,n.lastCentroid=null,n.lastPointersCount_,n.panning_=!1;var u=s.condition?s.condition:Qd(K_,IT);return n.condition_=s.onFocusOnly?Qd(q_,u):u,n.noKinetic_=!1,n}return t.prototype.handleDragEvent=function(e){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var n=this.targetPointers,s=Jd(n);if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){var u=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],g=e.map,h=g.getView();Hx(u,h.getResolution()),ld(u,h.getRotation()),h.adjustCenterInternal(u)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,e.originalEvent.preventDefault()},t.prototype.handleUpEvent=function(e){var n=e.map,s=n.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var u=this.kinetic_.getDistance(),g=this.kinetic_.getAngle(),h=s.getCenterInternal(),b=n.getPixelFromCoordinateInternal(h),T=n.getCoordinateFromPixelInternal([b[0]-u*Math.cos(g),b[1]-u*Math.sin(g)]);s.animateInternal({center:s.getConstrainedCenter(T),duration:500,easing:Po})}return this.panning_&&(this.panning_=!1,s.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>0&&this.condition_(e)){var n=e.map,s=n.getView();return this.lastCentroid=null,s.getAnimating()&&s.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},t}(Mh),kT=RT,DT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),LT=function(r){DT(t,r);function t(e){var n=this,s=e||{};return n=r.call(this,{stopDown:Hc})||this,n.condition_=s.condition?s.condition:MT,n.lastAngle_=void 0,n.duration_=s.duration!==void 0?s.duration:250,n}return t.prototype.handleDragEvent=function(e){if(!!ep(e)){var n=e.map,s=n.getView();if(s.getConstraints().rotation!==qd){var u=n.getSize(),g=e.pixel,h=Math.atan2(u[1]/2-g[1],g[0]-u[0]/2);if(this.lastAngle_!==void 0){var b=h-this.lastAngle_;s.adjustRotationInternal(-b)}this.lastAngle_=h}}},t.prototype.handleUpEvent=function(e){if(!ep(e))return!0;var n=e.map,s=n.getView();return s.endInteraction(this.duration_),!1},t.prototype.handleDownEvent=function(e){if(!ep(e))return!1;if(X_(e)&&this.condition_(e)){var n=e.map;return n.getView().beginInteraction(),this.lastAngle_=void 0,!0}else return!1},t}(Mh),OT=LT,zT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),FT=function(r){zT(t,r);function t(e){var n=r.call(this)||this;return n.geometry_=null,n.element_=document.createElement("div"),n.element_.style.position="absolute",n.element_.style.pointerEvents="auto",n.element_.className="ol-box "+e,n.map_=null,n.startPixel_=null,n.endPixel_=null,n}return t.prototype.disposeInternal=function(){this.setMap(null)},t.prototype.render_=function(){var e=this.startPixel_,n=this.endPixel_,s="px",u=this.element_.style;u.left=Math.min(e[0],n[0])+s,u.top=Math.min(e[1],n[1])+s,u.width=Math.abs(n[0]-e[0])+s,u.height=Math.abs(n[1]-e[1])+s},t.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var n=this.element_.style;n.left="inherit",n.top="inherit",n.width="inherit",n.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},t.prototype.setPixels=function(e,n){this.startPixel_=e,this.endPixel_=n,this.createOrUpdateGeometry(),this.render_()},t.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,n=this.endPixel_,s=[e,[e[0],n[1]],n,[n[0],e[1]]],u=s.map(this.map_.getCoordinateFromPixelInternal,this.map_);u[4]=u[0].slice(),this.geometry_?this.geometry_.setCoordinates([u]):this.geometry_=new $_([u])},t.prototype.getGeometry=function(){return this.geometry_},t}(Kc),BT=FT,W_=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Iu={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},tp=function(r){W_(t,r);function t(e,n,s){var u=r.call(this,e)||this;return u.coordinate=n,u.mapBrowserEvent=s,u}return t}(As),NT=function(r){W_(t,r);function t(e){var n=r.call(this)||this;n.on,n.once,n.un;var s=e||{};return n.box_=new BT(s.className||"ol-dragbox"),n.minArea_=s.minArea!==void 0?s.minArea:64,s.onBoxEnd&&(n.onBoxEnd=s.onBoxEnd),n.startPixel_=null,n.condition_=s.condition?s.condition:X_,n.boxEndCondition_=s.boxEndCondition?s.boxEndCondition:n.defaultBoxEndCondition,n}return t.prototype.defaultBoxEndCondition=function(e,n,s){var u=s[0]-n[0],g=s[1]-n[1];return u*u+g*g>=this.minArea_},t.prototype.getGeometry=function(){return this.box_.getGeometry()},t.prototype.handleDragEvent=function(e){this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new tp(Iu.BOXDRAG,e.coordinate,e))},t.prototype.handleUpEvent=function(e){this.box_.setMap(null);var n=this.boxEndCondition_(e,this.startPixel_,e.pixel);return n&&this.onBoxEnd(e),this.dispatchEvent(new tp(n?Iu.BOXEND:Iu.BOXCANCEL,e.coordinate,e)),!1},t.prototype.handleDownEvent=function(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new tp(Iu.BOXSTART,e.coordinate,e)),!0):!1},t.prototype.onBoxEnd=function(e){},t}(Mh),UT=NT,GT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),VT=function(r){GT(t,r);function t(e){var n=this,s=e||{},u=s.condition?s.condition:CT;return n=r.call(this,{condition:u,className:s.className||"ol-dragzoom",minArea:s.minArea})||this,n.duration_=s.duration!==void 0?s.duration:200,n.out_=s.out!==void 0?s.out:!1,n}return t.prototype.onBoxEnd=function(e){var n=this.getMap(),s=n.getView(),u=this.getGeometry();if(this.out_){var g=s.rotatedExtentForGeometry(u),h=s.getResolutionForExtentInternal(g),b=s.getResolution()/h;u=u.clone(),u.scale(b*b)}s.fitInternal(u,{duration:this.duration_,easing:Po})},t}(UT),$T=VT,Ns={LEFT:37,UP:38,RIGHT:39,DOWN:40},jT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),ZT=function(r){jT(t,r);function t(e){var n=r.call(this)||this,s=e||{};return n.defaultCondition_=function(u){return K_(u)&&H_(u)},n.condition_=s.condition!==void 0?s.condition:n.defaultCondition_,n.duration_=s.duration!==void 0?s.duration:100,n.pixelDelta_=s.pixelDelta!==void 0?s.pixelDelta:128,n}return t.prototype.handleEvent=function(e){var n=!1;if(e.type==wt.KEYDOWN){var s=e.originalEvent,u=s.keyCode;if(this.condition_(e)&&(u==Ns.DOWN||u==Ns.LEFT||u==Ns.RIGHT||u==Ns.UP)){var g=e.map,h=g.getView(),b=h.getResolution()*this.pixelDelta_,T=0,C=0;u==Ns.DOWN?C=-b:u==Ns.LEFT?T=-b:u==Ns.RIGHT?T=b:C=b;var P=[T,C];ld(P,h.getRotation()),yT(h,P,this.duration_),s.preventDefault(),n=!0}}return!n},t}(Th),qT=ZT,XT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),KT=function(r){XT(t,r);function t(e){var n=r.call(this)||this,s=e||{};return n.condition_=s.condition?s.condition:H_,n.delta_=s.delta?s.delta:1,n.duration_=s.duration!==void 0?s.duration:100,n}return t.prototype.handleEvent=function(e){var n=!1;if(e.type==wt.KEYDOWN||e.type==wt.KEYPRESS){var s=e.originalEvent,u=s.charCode;if(this.condition_(e)&&(u=="+".charCodeAt(0)||u=="-".charCodeAt(0))){var g=e.map,h=u=="+".charCodeAt(0)?this.delta_:-this.delta_,b=g.getView();Yd(b,h,void 0,this.duration_),s.preventDefault(),n=!0}}return!n},t}(Th),HT=KT,WT=function(){function r(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}return r.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},r.prototype.update=function(t,e){this.points_.push(t,e,Date.now())},r.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var n=e-3;n>0&&this.points_[n+2]>t;)n-=3;var s=this.points_[e+2]-this.points_[n+2];if(s<1e3/60)return!1;var u=this.points_[e]-this.points_[n],g=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(g,u),this.initialVelocity_=Math.sqrt(u*u+g*g)/s,this.initialVelocity_>this.minVelocity_},r.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},r.prototype.getAngle=function(){return this.angle_},r}(),YT=WT,JT=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),rp={TRACKPAD:"trackpad",WHEEL:"wheel"},QT=function(r){JT(t,r);function t(e){var n=this,s=e||{};n=r.call(this,s)||this,n.totalDelta_=0,n.lastDelta_=0,n.maxDelta_=s.maxDelta!==void 0?s.maxDelta:1,n.duration_=s.duration!==void 0?s.duration:250,n.timeout_=s.timeout!==void 0?s.timeout:80,n.useAnchor_=s.useAnchor!==void 0?s.useAnchor:!0,n.constrainResolution_=s.constrainResolution!==void 0?s.constrainResolution:!1;var u=s.condition?s.condition:AT;return n.condition_=s.onFocusOnly?Qd(q_,u):u,n.lastAnchor_=null,n.startTime_=void 0,n.timeoutId_,n.mode_=void 0,n.trackpadEventGap_=400,n.trackpadTimeoutId_,n.deltaPerZoom_=300,n}return t.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var e=this.getMap().getView();e.endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},t.prototype.handleEvent=function(e){if(!this.condition_(e))return!0;var n=e.type;if(n!==wt.WHEEL)return!0;var s=e.map,u=e.originalEvent;u.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);var g;if(e.type==wt.WHEEL&&(g=u.deltaY,p2&&u.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(g/=h_),u.deltaMode===WheelEvent.DOM_DELTA_LINE&&(g*=40)),g===0)return!1;this.lastDelta_=g;var h=Date.now();this.startTime_===void 0&&(this.startTime_=h),(!this.mode_||h-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(g)<4?rp.TRACKPAD:rp.WHEEL);var b=s.getView();if(this.mode_===rp.TRACKPAD&&!(b.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(b.getAnimating()&&b.cancelAnimations(),b.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),b.adjustZoom(-g/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=h,!1;this.totalDelta_+=g;var T=Math.max(this.timeout_-(h-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,s),T),!1},t.prototype.handleWheelZoom_=function(e){var n=e.getView();n.getAnimating()&&n.cancelAnimations();var s=-oi(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(n.getConstrainResolution()||this.constrainResolution_)&&(s=s?s>0?1:-1:0),Yd(n,s,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},t.prototype.setMouseAnchor=function(e){this.useAnchor_=e,e||(this.lastAnchor_=null)},t}(Th),eM=QT,tM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),rM=function(r){tM(t,r);function t(e){var n=this,s=e||{},u=s;return u.stopDown||(u.stopDown=Hc),n=r.call(this,u)||this,n.anchor_=null,n.lastAngle_=void 0,n.rotating_=!1,n.rotationDelta_=0,n.threshold_=s.threshold!==void 0?s.threshold:.3,n.duration_=s.duration!==void 0?s.duration:250,n}return t.prototype.handleDragEvent=function(e){var n=0,s=this.targetPointers[0],u=this.targetPointers[1],g=Math.atan2(u.clientY-s.clientY,u.clientX-s.clientX);if(this.lastAngle_!==void 0){var h=g-this.lastAngle_;this.rotationDelta_+=h,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),n=h}this.lastAngle_=g;var b=e.map,T=b.getView();if(T.getConstraints().rotation!==qd){var C=b.getViewport().getBoundingClientRect(),P=Jd(this.targetPointers);P[0]-=C.left,P[1]-=C.top,this.anchor_=b.getCoordinateFromPixelInternal(P),this.rotating_&&(b.render(),T.adjustRotationInternal(n,this.anchor_))}},t.prototype.handleUpEvent=function(e){if(this.targetPointers.length<2){var n=e.map,s=n.getView();return s.endInteraction(this.duration_),!1}else return!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var n=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}else return!1},t}(Mh),iM=rM,nM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),aM=function(r){nM(t,r);function t(e){var n=this,s=e||{},u=s;return u.stopDown||(u.stopDown=Hc),n=r.call(this,u)||this,n.anchor_=null,n.duration_=s.duration!==void 0?s.duration:400,n.lastDistance_=void 0,n.lastScaleDelta_=1,n}return t.prototype.handleDragEvent=function(e){var n=1,s=this.targetPointers[0],u=this.targetPointers[1],g=s.clientX-u.clientX,h=s.clientY-u.clientY,b=Math.sqrt(g*g+h*h);this.lastDistance_!==void 0&&(n=this.lastDistance_/b),this.lastDistance_=b;var T=e.map,C=T.getView();n!=1&&(this.lastScaleDelta_=n);var P=T.getViewport().getBoundingClientRect(),R=Jd(this.targetPointers);R[0]-=P.left,R[1]-=P.top,this.anchor_=T.getCoordinateFromPixelInternal(R),T.render(),C.adjustResolutionInternal(n,this.anchor_)},t.prototype.handleUpEvent=function(e){if(this.targetPointers.length<2){var n=e.map,s=n.getView(),u=this.lastScaleDelta_>1?1:-1;return s.endInteraction(this.duration_,u),!1}else return!0},t.prototype.handleDownEvent=function(e){if(this.targetPointers.length>=2){var n=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||n.getView().beginInteraction(),!0}else return!1},t}(Mh),sM=aM,sn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},oM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),lM=function(r){oM(t,r);function t(e){var n=r.call(this)||this;return n.boundHandleImageChange_=n.handleImageChange_.bind(n),n.layer_=e,n.declutterExecutorGroup=null,n}return t.prototype.getFeatures=function(e){return lr()},t.prototype.prepareFrame=function(e){return lr()},t.prototype.renderFrame=function(e,n){return lr()},t.prototype.loadedTileCallback=function(e,n,s){e[n]||(e[n]={}),e[n][s.tileCoord.toString()]=s},t.prototype.createLoadedTileFinder=function(e,n,s){return function(u,g){var h=this.loadedTileCallback.bind(this,s,u);return e.forEachLoadedTile(n,u,g,h)}.bind(this)},t.prototype.forEachFeatureAtCoordinate=function(e,n,s,u,g){},t.prototype.getDataAtPixel=function(e,n,s){return null},t.prototype.getLayer=function(){return this.layer_},t.prototype.handleFontsChanged=function(){},t.prototype.handleImageChange_=function(e){var n=e.target;n.getState()===sn.LOADED&&this.renderIfReadyAndVisible()},t.prototype.loadImage=function(e){var n=e.getState();return n!=sn.LOADED&&n!=sn.ERROR&&e.addEventListener(wt.CHANGE,this.boundHandleImageChange_),n==sn.IDLE&&(e.load(),n=e.getState()),n==sn.LOADED},t.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&e.getSourceState()==zn.READY&&e.changed()},t}(Km),hM=lM,cM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),uM=function(r){cM(t,r);function t(e,n,s,u){var g=r.call(this)||this;return g.extent=e,g.pixelRatio_=s,g.resolution=n,g.state=u,g}return t.prototype.changed=function(){this.dispatchEvent(wt.CHANGE)},t.prototype.getExtent=function(){return this.extent},t.prototype.getImage=function(){return lr()},t.prototype.getPixelRatio=function(){return this.pixelRatio_},t.prototype.getResolution=function(){return this.resolution},t.prototype.getState=function(){return this.state},t.prototype.load=function(){lr()},t}(Io),fM=uM,dM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();(function(r){dM(t,r);function t(e,n,s,u,g,h){var b=r.call(this,e,n,s,sn.IDLE)||this;return b.src_=u,b.image_=new Image,g!==null&&(b.image_.crossOrigin=g),b.unlisten_=null,b.state=sn.IDLE,b.imageLoadFunction_=h,b}return t.prototype.getImage=function(){return this.image_},t.prototype.handleImageError_=function(){this.state=sn.ERROR,this.unlistenImage_(),this.changed()},t.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=Za(this.extent)/this.image_.height),this.state=sn.LOADED,this.unlistenImage_(),this.changed()},t.prototype.load=function(){(this.state==sn.IDLE||this.state==sn.ERROR)&&(this.state=sn.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Y_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.setImage=function(e){this.image_=e,this.resolution=Za(this.extent)/this.image_.height},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t})(fM);function Y_(r,t,e){var n=r;if(n.src&&y2){var s=n.decode(),u=!0,g=function(){u=!1};return s.then(function(){u&&t()}).catch(function(b){u&&(b.name==="EncodingError"&&b.message==="Invalid image type."?t():e())}),g}var h=[Wc(n,wt.LOAD,t),Wc(n,wt.ERROR,e)];return function(){h.forEach(jr)}}function pM(r){var t=r||{},e=new xn,n=new YT(-.005,.05,100),s=t.altShiftDragRotate!==void 0?t.altShiftDragRotate:!0;s&&e.push(new OT);var u=t.doubleClickZoom!==void 0?t.doubleClickZoom:!0;u&&e.push(new bT({delta:t.zoomDelta,duration:t.zoomDuration}));var g=t.dragPan!==void 0?t.dragPan:!0;g&&e.push(new kT({onFocusOnly:t.onFocusOnly,kinetic:n}));var h=t.pinchRotate!==void 0?t.pinchRotate:!0;h&&e.push(new iM);var b=t.pinchZoom!==void 0?t.pinchZoom:!0;b&&e.push(new sM({duration:t.zoomDuration}));var T=t.keyboard!==void 0?t.keyboard:!0;T&&(e.push(new qT),e.push(new HT({delta:t.zoomDelta,duration:t.zoomDuration})));var C=t.mouseWheelZoom!==void 0?t.mouseWheelZoom:!0;C&&e.push(new eM({onFocusOnly:t.onFocusOnly,duration:t.zoomDuration}));var P=t.shiftDragZoom!==void 0?t.shiftDragZoom:!0;return P&&e.push(new $T({duration:t.zoomDuration})),e}var mM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),gM=function(r){mM(t,r);function t(e){var n=this;return e=vi({},e),e.controls||(e.controls=mT()),e.interactions||(e.interactions=pM({onFocusOnly:!0})),n=r.call(this,e)||this,n}return t.prototype.createRenderer=function(){return new X2(this)},t}(iT),GP=gM,Pu={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},_M=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),yM=function(r){_M(t,r);function t(e){var n=this,s=e||{},u=vi({},s);return delete u.preload,delete u.useInterimTilesOnError,n=r.call(this,u)||this,n.on,n.once,n.un,n.setPreload(s.preload!==void 0?s.preload:0),n.setUseInterimTilesOnError(s.useInterimTilesOnError!==void 0?s.useInterimTilesOnError:!0),n}return t.prototype.getPreload=function(){return this.get(Pu.PRELOAD)},t.prototype.setPreload=function(e){this.set(Pu.PRELOAD,e)},t.prototype.getUseInterimTilesOnError=function(){return this.get(Pu.USE_INTERIM_TILES_ON_ERROR)},t.prototype.setUseInterimTilesOnError=function(e){this.set(Pu.USE_INTERIM_TILES_ON_ERROR,e)},t}(b_),vM=yM,xM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),bM=function(r){xM(t,r);function t(e,n,s,u,g,h){var b=r.call(this,e,n,h)||this;return b.crossOrigin_=u,b.src_=s,b.key=s,b.image_=new Image,u!==null&&(b.image_.crossOrigin=u),b.unlisten_=null,b.tileLoadFunction_=g,b}return t.prototype.getImage=function(){return this.image_},t.prototype.setImage=function(e){this.image_=e,this.state=jt.LOADED,this.unlistenImage_(),this.changed()},t.prototype.handleImageError_=function(){this.state=jt.ERROR,this.unlistenImage_(),this.image_=wM(),this.changed()},t.prototype.handleImageLoad_=function(){var e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=jt.LOADED:this.state=jt.EMPTY,this.unlistenImage_(),this.changed()},t.prototype.load=function(){this.state==jt.ERROR&&(this.state=jt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==jt.IDLE&&(this.state=jt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Y_(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},t.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},t}(Xm);function wM(){var r=U2(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}var EM=bM,ip=34962,np=34963,TM=35040,ap=35044,MM=35048,SM=5121,AM=5123,CM=5125,J_=5126,Q_=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function IM(r,t){for(var e=Q_.length,n=0;n<e;++n)try{var s=r.getContext(Q_[n],t);if(s)return s}catch(u){}return null}var PM={STATIC_DRAW:ap,STREAM_DRAW:TM,DYNAMIC_DRAW:MM},RM=function(){function r(t,e){this.array=null,this.type=t,Yt(t===ip||t===np,62),this.usage=e!==void 0?e:PM.STATIC_DRAW}return r.prototype.ofSize=function(t){this.array=new(sp(this.type))(t)},r.prototype.fromArray=function(t){var e=sp(this.type);this.array=e.from?e.from(t):new e(t)},r.prototype.fromArrayBuffer=function(t){this.array=new(sp(this.type))(t)},r.prototype.getType=function(){return this.type},r.prototype.getArray=function(){return this.array},r.prototype.getUsage=function(){return this.usage},r.prototype.getSize=function(){return this.array?this.array.length:0},r}();function sp(r){switch(r){case ip:return Float32Array;case np:return Uint32Array;default:return Float32Array}}var ey=RM,kM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();function ty(r,t){r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)}function DM(r,t,e){ty(r,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)}function ry(r,t,e,n,s){var u=r.getGL();ty(u,t);var g;switch(s){case 1:{g=u.LUMINANCE;break}case 2:{g=u.LUMINANCE_ALPHA;break}case 3:{g=u.RGB;break}case 4:{g=u.RGBA;break}default:throw new Error("Unsupported number of bands: "+s)}var h;e instanceof Float32Array?(h=u.FLOAT,r.getExtension("OES_texture_float"),r.getExtension("OES_texture_float_linear")):h=u.UNSIGNED_BYTE,u.texImage2D(u.TEXTURE_2D,0,g,n[0],n[1],0,g,h,e)}var LM=function(r){kM(t,r);function t(e,n,s){var u=r.call(this)||this;u.tile,u.textures=[],u.handleTileChange_=u.handleTileChange_.bind(u),u.size=yn(n.getTileSize(e.tileCoord[0])),u.bandCount=NaN,u.helper_=s;var g=new ey(ip,ap);return g.fromArray([0,1,1,1,1,0,0,0]),s.flushBufferData(g),u.coords=g,u.setTile(e),u}return t.prototype.setTile=function(e){e!==this.tile&&(this.tile&&this.tile.removeEventListener(wt.CHANGE,this.handleTileChange_),this.tile=e,this.textures.length=0,this.loaded=e.getState()===jt.LOADED,this.loaded?this.uploadTile_():e.addEventListener(wt.CHANGE,this.handleTileChange_))},t.prototype.uploadTile_=function(){var e=this.helper_,n=e.getGL(),s=this.tile;if(s instanceof EM){var u=n.createTexture();this.textures.push(u),this.bandCount=4,DM(n,u,s.getImage());return}var g=s.getData(),h=g instanceof Float32Array,b=this.size[0]*this.size[1];this.bandCount=g.byteLength/(h?4:1)/b;var T=Math.ceil(this.bandCount/4);if(T===1){var u=n.createTexture();this.textures.push(u),ry(e,u,g,this.size,this.bandCount);return}for(var C=h?Float32Array:Uint8Array,P=new Array(T),R=0;R<T;++R){var u=n.createTexture();this.textures.push(u);var U=R<T-1?4:this.bandCount%4;P[R]=new C(b*U)}for(var j=b*this.bandCount,H=0;H<j;++H){var re=H%this.bandCount,ge=re%4,R=Math.floor(re/4),U=R<T-1?4:this.bandCount%4,ce=Math.floor(H/this.bandCount);P[R][ce*U+ge]=g[H]}for(var R=0;R<T;++R){var U=R<T-1?4:this.bandCount%4,u=this.textures[R],be=P[R];ry(e,u,be,this.size,U)}},t.prototype.handleTileChange_=function(){this.tile.getState()===jt.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(wt.CHANGE))},t.prototype.disposeInternal=function(){var e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var n=0;n<this.textures.length;++n)e.deleteTexture(this.textures[n]);this.tile.removeEventListener(wt.CHANGE,this.handleTileChange_)},t}(Io),OM=LM,Ru={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},zM=`
  precision mediump float;
  
  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;
  
  uniform vec2 u_screenSize;
   
  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,FM=`
  precision mediump float;
   
  uniform sampler2D u_image;
   
  varying vec2 v_texCoord;
   
  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord);
  }
`,BM=function(){function r(t){this.gl_=t.webGlContext;var e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||zM),e.compileShader(n);var s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,t.fragmentShader||FM),e.compileShader(s),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,s),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();var u=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(u),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(function(g){this.uniforms_.push({value:t.uniforms[g],location:e.getUniformLocation(this.renderTargetProgram_,g)})}.bind(this))}return r.prototype.getGL=function(){return this.gl_},r.prototype.init=function(t){var e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;var s=0,u=e.RGBA,g=0,h=e.RGBA,b=e.UNSIGNED_BYTE,T=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,s,u,n[0],n[1],g,h,b,T),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}},r.prototype.apply=function(t,e){var n=this.getGL(),s=t.size;n.bindFramebuffer(n.FRAMEBUFFER,e?e.getFrameBuffer():null),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.renderTargetTexture_),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.bindBuffer(n.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),n.useProgram(this.renderTargetProgram_),n.enableVertexAttribArray(this.renderTargetAttribLocation_),n.vertexAttribPointer(this.renderTargetAttribLocation_,2,n.FLOAT,!1,0,0),n.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),n.uniform1i(this.renderTargetTextureLocation_,0),this.applyUniforms(t),n.drawArrays(n.TRIANGLES,0,6)},r.prototype.getFrameBuffer=function(){return this.frameBuffer_},r.prototype.applyUniforms=function(t){var e=this.getGL(),n,s=1;this.uniforms_.forEach(function(u){if(n=typeof u.value=="function"?u.value(t):u.value,n instanceof HTMLCanvasElement||n instanceof ImageData)u.texture||(u.texture=e.createTexture()),e.activeTexture(e["TEXTURE"+s]),e.bindTexture(e.TEXTURE_2D,u.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(u.location,s++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(u.location,n[0],n[1]);return;case 3:e.uniform3f(u.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(u.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(u.location,n)})},r}(),iy=BM;function ny(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ku(r,t){return r[0]=t[0],r[1]=t[1],r[4]=t[2],r[5]=t[3],r[12]=t[4],r[13]=t[5],r}var NM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Sh={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution"},Ah={UNSIGNED_BYTE:SM,UNSIGNED_SHORT:AM,UNSIGNED_INT:CM,FLOAT:J_},UM=function(r){NM(t,r);function t(e){var n=r.call(this)||this,s=e||{};n.boundHandleWebGLContextLost_=n.handleWebGLContextLost.bind(n),n.boundHandleWebGLContextRestored_=n.handleWebGLContextRestored.bind(n),n.canvas_=document.createElement("canvas"),n.canvas_.style.position="absolute",n.canvas_.style.left="0",n.gl_=IM(n.canvas_);var u=n.getGL();if(n.bufferCache_={},n.extensionCache_={},n.currentProgram_=null,n.canvas_.addEventListener(Ru.LOST,n.boundHandleWebGLContextLost_),n.canvas_.addEventListener(Ru.RESTORED,n.boundHandleWebGLContextRestored_),n.offsetRotateMatrix_=Wo(),n.offsetScaleMatrix_=Wo(),n.tmpMat4_=ny(),n.uniformLocations_={},n.attribLocations_={},n.uniforms_=[],s.uniforms)for(var g in s.uniforms)n.uniforms_.push({name:g,value:s.uniforms[g]});return n.postProcessPasses_=s.postProcesses?s.postProcesses.map(function(h){return new iy({webGlContext:u,scaleRatio:h.scaleRatio,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,uniforms:h.uniforms})}):[new iy({webGlContext:u})],n.shaderCompileErrors_=null,n.startTime_=Date.now(),n}return t.prototype.getExtension=function(e){if(e in this.extensionCache_)return this.extensionCache_[e];var n=this.gl_.getExtension(e);return this.extensionCache_[e]=n,n},t.prototype.bindBuffer=function(e){var n=this.getGL(),s=ga(e),u=this.bufferCache_[s];if(!u){var g=n.createBuffer();u={buffer:e,webGlBuffer:g},this.bufferCache_[s]=u}n.bindBuffer(e.getType(),u.webGlBuffer)},t.prototype.flushBufferData=function(e){var n=this.getGL();this.bindBuffer(e),n.bufferData(e.getType(),e.getArray(),e.getUsage())},t.prototype.deleteBuffer=function(e){var n=this.getGL(),s=ga(e),u=this.bufferCache_[s];u&&!n.isContextLost()&&n.deleteBuffer(u.webGlBuffer),delete this.bufferCache_[s]},t.prototype.disposeInternal=function(){this.canvas_.removeEventListener(Ru.LOST,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(Ru.RESTORED,this.boundHandleWebGLContextRestored_);var e=this.gl_.getExtension("WEBGL_lose_context");e&&e.loseContext(),delete this.gl_,delete this.canvas_},t.prototype.prepareDraw=function(e,n){var s=this.getGL(),u=this.getCanvas(),g=e.size,h=e.pixelRatio;u.width=g[0]*h,u.height=g[1]*h,u.style.width=g[0]+"px",u.style.height=g[1]+"px",s.useProgram(this.currentProgram_);for(var b=this.postProcessPasses_.length-1;b>=0;b--)this.postProcessPasses_[b].init(e);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),s.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.prepareDrawToRenderTarget=function(e,n,s){var u=this.getGL(),g=n.getSize();u.bindFramebuffer(u.FRAMEBUFFER,n.getFramebuffer()),u.viewport(0,0,g[0],g[1]),u.bindTexture(u.TEXTURE_2D,n.getTexture()),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT),u.enable(u.BLEND),u.blendFunc(u.ONE,s?u.ZERO:u.ONE_MINUS_SRC_ALPHA),u.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.drawElements=function(e,n){var s=this.getGL();this.getExtension("OES_element_index_uint");var u=s.UNSIGNED_INT,g=4,h=n-e,b=e*g;s.drawElements(s.TRIANGLES,h,u,b)},t.prototype.finalizeDraw=function(e){for(var n=0;n<this.postProcessPasses_.length;n++)this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1]||null)},t.prototype.getCanvas=function(){return this.canvas_},t.prototype.getGL=function(){return this.gl_},t.prototype.applyFrameState=function(e){var n=e.size,s=e.viewState.rotation,u=Bd(this.offsetScaleMatrix_);x2(u,2/n[0],2/n[1]);var g=Bd(this.offsetRotateMatrix_);s!==0&&v2(g,-s),this.setUniformMatrixValue(Sh.OFFSET_SCALE_MATRIX,ku(this.tmpMat4_,u)),this.setUniformMatrixValue(Sh.OFFSET_ROTATION_MATRIX,ku(this.tmpMat4_,g)),this.setUniformFloatValue(Sh.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Sh.ZOOM,e.viewState.zoom),this.setUniformFloatValue(Sh.RESOLUTION,e.viewState.resolution)},t.prototype.applyUniforms=function(e){var n=this.getGL(),s,u=0;this.uniforms_.forEach(function(g){if(s=typeof g.value=="function"?g.value(e):g.value,s instanceof HTMLCanvasElement||s instanceof HTMLImageElement||s instanceof ImageData){g.texture||(g.prevValue=void 0,g.texture=n.createTexture()),n.activeTexture(n["TEXTURE"+u]),n.bindTexture(n.TEXTURE_2D,g.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var h=!(s instanceof HTMLImageElement)||s.complete;h&&g.prevValue!==s&&(g.prevValue=s,n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,s)),n.uniform1i(this.getUniformLocation(g.name),u++)}else if(Array.isArray(s)&&s.length===6)this.setUniformMatrixValue(g.name,ku(this.tmpMat4_,s));else if(Array.isArray(s)&&s.length<=4)switch(s.length){case 2:n.uniform2f(this.getUniformLocation(g.name),s[0],s[1]);return;case 3:n.uniform3f(this.getUniformLocation(g.name),s[0],s[1],s[2]);return;case 4:n.uniform4f(this.getUniformLocation(g.name),s[0],s[1],s[2],s[3]);return;default:return}else typeof s=="number"&&n.uniform1f(this.getUniformLocation(g.name),s)}.bind(this))},t.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;var n=this.getGL();return n.useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},!0},t.prototype.compileShader=function(e,n){var s=this.getGL(),u=s.createShader(n);return s.shaderSource(u,e),s.compileShader(u),u},t.prototype.getProgram=function(e,n){var s=this.getGL(),u=this.compileShader(e,s.FRAGMENT_SHADER),g=this.compileShader(n,s.VERTEX_SHADER),h=s.createProgram();if(s.attachShader(h,u),s.attachShader(h,g),s.linkProgram(h),!s.getShaderParameter(u,s.COMPILE_STATUS)){var b="Fragment shader compliation failed: "+s.getShaderInfoLog(u);throw new Error(b)}if(s.deleteShader(u),!s.getShaderParameter(g,s.COMPILE_STATUS)){var b="Vertex shader compilation failed: "+s.getShaderInfoLog(g);throw new Error(b)}if(s.deleteShader(g),!s.getProgramParameter(h,s.LINK_STATUS)){var b="GL program linking failed: "+s.getShaderInfoLog(g);throw new Error(b)}return h},t.prototype.getUniformLocation=function(e){return this.uniformLocations_[e]===void 0&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]},t.prototype.getAttributeLocation=function(e){return this.attribLocations_[e]===void 0&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]},t.prototype.makeProjectionTransform=function(e,n){var s=e.size,u=e.viewState.rotation,g=e.viewState.resolution,h=e.viewState.center;return Bd(n),xu(n,0,0,2/(g*s[0]),2/(g*s[1]),-u,-h[0],-h[1]),n},t.prototype.setUniformFloatValue=function(e,n){this.getGL().uniform1f(this.getUniformLocation(e),n)},t.prototype.setUniformMatrixValue=function(e,n){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,n)},t.prototype.enableAttributeArray_=function(e,n,s,u,g){var h=this.getAttributeLocation(e);h<0||(this.getGL().enableVertexAttribArray(h),this.getGL().vertexAttribPointer(h,n,s,!1,u,g))},t.prototype.enableAttributes=function(e){for(var n=GM(e),s=0,u=0;u<e.length;u++){var g=e[u];this.enableAttributeArray_(g.name,g.size,g.type||J_,n,s),s+=g.size*ay(g.type)}},t.prototype.handleWebGLContextLost=function(){uh(this.bufferCache_),this.currentProgram_=null},t.prototype.handleWebGLContextRestored=function(){},t.prototype.createTexture=function(e,n,s){var u=this.getGL(),g=s||u.createTexture(),h=0,b=u.RGBA,T=0,C=u.RGBA,P=u.UNSIGNED_BYTE;return u.bindTexture(u.TEXTURE_2D,g),n?u.texImage2D(u.TEXTURE_2D,h,b,C,P,n):u.texImage2D(u.TEXTURE_2D,h,b,e[0],e[1],T,C,P,null),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),g},t}(Kc);function GM(r){for(var t=0,e=0;e<r.length;e++){var n=r[e];t+=n.size*ay(n.type)}return t}function ay(r){switch(r){case Ah.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Ah.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Ah.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Ah.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var VM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),$M=function(r){VM(t,r);function t(e,n){var s=r.call(this,e)||this,u=n||{};return s.helper=new UM({postProcesses:u.postProcesses,uniforms:u.uniforms}),u.className!==void 0&&(s.helper.getCanvas().className=u.className),s}return t.prototype.disposeInternal=function(){this.helper.dispose(),delete this.helper,r.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,n){var s=this.getLayer();if(s.hasListener(e)){var u=new w_(e,null,n,null);s.dispatchEvent(u)}},t.prototype.preRender=function(e){this.dispatchRenderEvent_(zs.PRERENDER,e)},t.prototype.postRender=function(e){this.dispatchRenderEvent_(zs.POSTRENDER,e)},t}(hM),jM=$M,ZM=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Ir={TILE_TEXTURE_PREFIX:"u_tileTexture",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},Du={TEXTURE_COORD:"a_textureCoord"},qM=[{name:Du.TEXTURE_COORD,size:2,type:Ah.FLOAT}],XM={};function KM(r){return 2*(1-1/(r+1))-1}function sy(r,t,e){e in r||(r[e]=[]),r[e].push(t)}function op(r,t){var e=r.layerStatesArray[r.layerIndex];return e.extent&&(t=nd(t,gh(e.extent,r.viewState.projection))),t}var oy=function(r){ZM(t,r);function t(e,n){var s=r.call(this,e,{uniforms:n.uniforms,className:n.className})||this;s.tileTransform_=Wo(),s.tempMat4_=ny(),s.tempTileRange_=new yg(0,0,0,0),s.tempTileCoord_=nu(0,0,0),s.tempSize_=[0,0],s.program_=s.helper.getProgram(n.fragmentShader,n.vertexShader);var u=new ey(np,ap);u.fromArray([0,1,3,1,2,3]),s.helper.flushBufferData(u),s.indices_=u;var g=n.cacheSize!==void 0?n.cacheSize:512;return s.tileTextureCache_=new gg(g),s.renderedOpacity_=NaN,s}return t.prototype.isDrawableTile=function(e){var n=this.getLayer(),s=e.getState(),u=n.getUseInterimTilesOnError();return s==jt.LOADED||s==jt.EMPTY||s==jt.ERROR&&!u},t.prototype.prepareFrame=function(e){if(sd(op(e,e.extent)))return!1;var n=this.getLayer().getSource();return n?n.getState()===zn.READY:!1},t.prototype.enqueueTiles=function(e,n,s,u){var g=e.viewState,h=this.getLayer(),b=h.getSource(),T=b.getTileGridForProjection(g.projection),C=this.tileTextureCache_,P=T.getTileRangeForExtentAndZ(n,s),R=ga(b);R in e.wantedTiles||(e.wantedTiles[R]={});for(var U=e.wantedTiles[R],j=T.getResolution(s),H=P.minX;H<=P.maxX;++H)for(var re=P.minY;re<=P.maxY;++re){var ge=nu(s,H,re,this.tempTileCoord_),ce=su(ge),be=void 0,we=void 0;C.containsKey(ce)&&(be=C.get(ce),we=be.tile),(!be||be.tile.key!==b.getKey())&&(we=b.getTile(s,H,re,e.pixelRatio,g.projection),be?be.setTile(this.isDrawableTile(we)?we:we.getInterimTile()):(be=new OM(we,T,this.helper),C.set(ce,be))),sy(u,be,s);var Ae=we.getKey();U[Ae]=!0,we.getState()===jt.IDLE&&(e.tileQueue.isKeyQueued(Ae)||e.tileQueue.enqueue([we,R,T.getTileCoordCenter(ge),j]))}},t.prototype.renderFrame=function(e){this.preRender(e);var n=e.viewState,s=e.layerStatesArray[e.layerIndex],u=op(e,e.extent),g=this.getLayer(),h=g.getSource(),b=h.getTileGridForProjection(n.projection),T=b.getZForResolution(n.resolution,h.zDirection),C={};if(e.nextExtent){var P=b.getZForResolution(n.nextResolution,h.zDirection),R=op(e,e.nextExtent);this.enqueueTiles(e,R,P,C)}this.enqueueTiles(e,u,T,C);for(var U={},j=ga(this),H=e.time,re=!1,ge=C[T],ce=0,be=ge.length;ce<be;++ce){var we=ge[ce],Ae=we.tile,De=Ae.tileCoord;if(we.loaded){var it=Ae.getAlpha(j,H);if(it===1){Ae.endTransition(j);continue}re=!0;var ze=su(De);U[ze]=it}var lt=this.findAltTiles_(b,De,T+1,C);if(!lt)for(var ct=T-1;ct>=b.minZoom;--ct){var Rt=this.findAltTiles_(b,De,ct,C);if(Rt)break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(e,!re);for(var Bt=Object.keys(C).map(Number).sort(Yf),Kt=this.helper.getGL(),Ht=n.center[0],At=n.center[1],qe=0,Ut=Bt.length;qe<Ut;++qe)for(var Zt=Bt[qe],Er=b.getResolution(Zt),nr=yn(b.getTileSize(Zt),this.tempSize_),qr=b.getOrigin(Zt),Fi=(Ht-qr[0])/(nr[0]*Er),ci=(qr[1]-At)/(nr[1]*Er),Nr=n.resolution/Er,Ur=KM(Zt),Rr=C[Zt],ce=0,be=Rr.length;ce<be;++ce){var we=Rr[ce];if(!!we.loaded){var Ae=we.tile,De=Ae.tileCoord,ze=su(De),ri=De[1],ui=De[2];xu(this.tileTransform_,0,0,2/(e.size[0]*Nr/nr[0]),-2/(e.size[1]*Nr/nr[1]),n.rotation,-(Fi-ri),-(ci-ui)),this.helper.setUniformMatrixValue(Ir.TILE_TRANSFORM,ku(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(we.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(qM);for(var Gr=0;Gr<we.textures.length;++Gr){var qn="TEXTURE"+Gr,Xn=Ir.TILE_TEXTURE_PREFIX+Gr;Kt.activeTexture(Kt[qn]),Kt.bindTexture(Kt.TEXTURE_2D,we.textures[Gr]),Kt.uniform1i(this.helper.getUniformLocation(Xn),Gr)}var it=ze in U?U[ze]:1;it<1&&(e.animate=!0),this.helper.setUniformFloatValue(Ir.TRANSITION_ALPHA,it),this.helper.setUniformFloatValue(Ir.DEPTH,Ur),this.helper.setUniformFloatValue(Ir.TEXTURE_PIXEL_WIDTH,nr[0]),this.helper.setUniformFloatValue(Ir.TEXTURE_PIXEL_HEIGHT,nr[1]),this.helper.setUniformFloatValue(Ir.RESOLUTION,n.resolution),this.helper.setUniformFloatValue(Ir.ZOOM,n.zoom),this.helper.drawElements(0,this.indices_.getSize())}}this.helper.finalizeDraw(e);var Kn=this.helper.getCanvas(),wi=s.opacity;this.renderedOpacity_!==wi&&(Kn.style.opacity=String(wi),this.renderedOpacity_=wi);for(var kr=this.tileTextureCache_;kr.canExpireCache();){var we=kr.pop();we.dispose()}var Hn=function(Wn,En){h.expireCache(h.getProjection(),XM)};return e.postRenderFunctions.push(Hn),this.postRender(e),Kn},t.prototype.findAltTiles_=function(e,n,s,u){var g=e.getTileRangeForTileCoordAndZ(n,s,this.tempTileRange_);if(!g)return!1;for(var h=!0,b=this.tileTextureCache_,T=g.minX;T<=g.maxX;++T)for(var C=g.minY;C<=g.maxY;++C){var P=au(s,T,C),R=!1;if(b.containsKey(P)){var U=b.get(P);U.loaded&&(sy(u,U,s),R=!0)}R||(h=!1)}return h},t.prototype.disposeInternal=function(){var e=this.helper,n=e.getGL();e.deleteBuffer(this.indices_),delete this.indices_,n.deleteProgram(this.program_),delete this.program_;var s=this.tileTextureCache_;s.forEach(function(u){u.dispose()}),s.clear(),delete this.tileTextureCache_,r.prototype.disposeInternal.call(this)},t}(jM);oy.prototype.getLayer;var HM=oy,rt={NUMBER:1,STRING:2,COLOR:4,BOOLEAN:8,NUMBER_ARRAY:16,ANY:31,NONE:0},Pt={};function Vn(r){if(typeof r=="number")return rt.NUMBER;if(typeof r=="boolean")return rt.BOOLEAN;if(typeof r=="string")return C2(r)?rt.COLOR|rt.STRING:rt.STRING;if(!Array.isArray(r))throw new Error("Unhandled value type: "+JSON.stringify(r));var t=r,e=t.every(function(s){return typeof s=="number"});if(e)return t.length===3||t.length===4?rt.COLOR|rt.NUMBER_ARRAY:rt.NUMBER_ARRAY;if(typeof t[0]!="string")throw new Error("Expected an expression operator but received: "+JSON.stringify(t));var n=Pt[t[0]];if(n===void 0)throw new Error("Unrecognized expression operator: "+JSON.stringify(t));return n.getReturnType(t.slice(1))}function WM(r){return xx(r)%1==0}function Lu(r){var t=r.toString();return t.indexOf(".")===-1?t+".0":t}function ly(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec"+r.length+"("+r.map(Lu).join(", ")+")"}function YM(r){var t=M2(r).slice();return t.length<4&&t.push(1),ly(t.map(function(e,n){return n<3?e/255:e}))}function hy(r,t){return r.stringLiteralsMap[t]===void 0&&(r.stringLiteralsMap[t]=Object.keys(r.stringLiteralsMap).length),r.stringLiteralsMap[t]}function JM(r,t){return Lu(hy(r,t))}function ot(r,t,e){if(Array.isArray(t)&&typeof t[0]=="string"){var n=Pt[t[0]];if(n===void 0)throw new Error("Unrecognized expression operator: "+JSON.stringify(t));return n.toGlsl(r,t.slice(1),e)}var s=Vn(t);if((s&rt.NUMBER)>0)return Lu(t);if((s&rt.BOOLEAN)>0)return t.toString();if((s&rt.STRING)>0&&(e===void 0||e==rt.STRING))return JM(r,t.toString());if((s&rt.COLOR)>0&&(e===void 0||e==rt.COLOR))return YM(t);if((s&rt.NUMBER_ARRAY)>0)return ly(t);throw new Error("Unexpected expression "+t+" (expected type "+e+")")}function lp(r){if(!(Vn(r)&rt.NUMBER))throw new Error("A numeric value was expected, got "+JSON.stringify(r)+" instead")}function ei(r){for(var t=0;t<r.length;t++)lp(r[t])}function cy(r){if(!(Vn(r)&rt.STRING))throw new Error("A string value was expected, got "+JSON.stringify(r)+" instead")}function hp(r){if(!(Vn(r)&rt.BOOLEAN))throw new Error("A boolean value was expected, got "+JSON.stringify(r)+" instead")}function Pr(r,t){if(r.length!==t)throw new Error("Exactly "+t+" arguments were expected, got "+r.length+" instead")}function Ka(r,t){if(r.length<t)throw new Error("At least "+t+" arguments were expected, got "+r.length+" instead")}function Ou(r,t){if(r.length>t)throw new Error("At most "+t+" arguments were expected, got "+r.length+" instead")}function uy(r){if(r.length%2!=0)throw new Error("An even amount of arguments was expected, got "+r+" instead")}function QM(r){if(r.length%2==0)throw new Error("An odd amount of arguments was expected, got "+r+" instead")}function cp(r,t){if(!WM(t))throw new Error("Could not infer only one type from the following expression: "+JSON.stringify(r))}Pt.get={getReturnType:function(r){return rt.ANY},toGlsl:function(r,t){Pr(t,1),cy(t[0]);var e=t[0].toString();r.attributes.indexOf(e)===-1&&r.attributes.push(e);var n=r.inFragmentShader?"v_":"a_";return n+e}};function fy(r){return"u_var_"+r}Pt.var={getReturnType:function(r){return rt.ANY},toGlsl:function(r,t){Pr(t,1),cy(t[0]);var e=t[0].toString();return r.variables.indexOf(e)===-1&&r.variables.push(e),fy(e)}};Pt.band={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){Ka(t,1),Ou(t,3);var e=t[0];if(typeof e!="number")throw new Error("Band index must be a number");var n=e-1,s=Math.floor(n/4),u=n%4;if(e===r.bandCount&&u===1&&(u=3),t.length===1)return"color"+s+"["+u+"]";var g=t[1],h=t[2]||0;lp(g),lp(h);var b=Ir.TILE_TEXTURE_PREFIX+s;return"texture2D("+b+", v_textureCoord + vec2("+ot(r,g)+" / "+Ir.TEXTURE_PIXEL_WIDTH+", "+ot(r,h)+" / "+Ir.TEXTURE_PIXEL_HEIGHT+"))["+u+"]"}};Pt.time={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,0),"u_time"}};Pt.zoom={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,0),"u_zoom"}};Pt.resolution={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,0),"u_resolution"}};Pt["*"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" * "+ot(r,t[1])+")"}};Pt["/"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" / "+ot(r,t[1])+")"}};Pt["+"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" + "+ot(r,t[1])+")"}};Pt["-"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" - "+ot(r,t[1])+")"}};Pt.clamp={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){Pr(t,3),ei(t);var e=ot(r,t[1]),n=ot(r,t[2]);return"clamp("+ot(r,t[0])+", "+e+", "+n+")"}};Pt["%"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"mod("+ot(r,t[0])+", "+ot(r,t[1])+")"}};Pt["^"]={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,2),ei(t),"pow("+ot(r,t[0])+", "+ot(r,t[1])+")"}};Pt.abs={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,1),ei(t),"abs("+ot(r,t[0])+")"}};Pt.sin={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,1),ei(t),"sin("+ot(r,t[0])+")"}};Pt.cos={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Pr(t,1),ei(t),"cos("+ot(r,t[0])+")"}};Pt.atan={getReturnType:function(r){return rt.NUMBER},toGlsl:function(r,t){return Ka(t,1),Ou(t,2),ei(t),t.length===2?"atan("+ot(r,t[0])+", "+ot(r,t[1])+")":"atan("+ot(r,t[0])+")"}};Pt[">"]={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" > "+ot(r,t[1])+")"}};Pt[">="]={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" >= "+ot(r,t[1])+")"}};Pt["<"]={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" < "+ot(r,t[1])+")"}};Pt["<="]={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){return Pr(t,2),ei(t),"("+ot(r,t[0])+" <= "+ot(r,t[1])+")"}};function dy(r){return{getReturnType:function(t){return rt.BOOLEAN},toGlsl:function(t,e){Pr(e,2);for(var n=rt.ANY,s=0;s<e.length;s++)n&=Vn(e[s]);if(n===rt.NONE)throw new Error("All arguments should be of compatible type, got "+JSON.stringify(e)+" instead");return n&=~rt.COLOR,"("+ot(t,e[0],n)+" "+r+" "+ot(t,e[1],n)+")"}}}Pt["=="]=dy("==");Pt["!="]=dy("!=");Pt["!"]={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){return Pr(t,1),hp(t[0]),"(!"+ot(r,t[0])+")"}};function py(r){return{getReturnType:function(t){return rt.BOOLEAN},toGlsl:function(t,e){Ka(e,2);for(var n=0;n<e.length;n++)hp(e[n]);var s="";return s=e.map(function(u){return ot(t,u)}).join(" "+r+" "),s="("+s+")",s}}}Pt.all=py("&&");Pt.any=py("||");Pt.between={getReturnType:function(r){return rt.BOOLEAN},toGlsl:function(r,t){Pr(t,3),ei(t);var e=ot(r,t[1]),n=ot(r,t[2]),s=ot(r,t[0]);return"("+s+" >= "+e+" && "+s+" <= "+n+")"}};Pt.array={getReturnType:function(r){return rt.NUMBER_ARRAY},toGlsl:function(r,t){Ka(t,2),Ou(t,4),ei(t);var e=t.map(function(n){return ot(r,n,rt.NUMBER)});return"vec"+t.length+"("+e.join(", ")+")"}};Pt.color={getReturnType:function(r){return rt.COLOR},toGlsl:function(r,t){Ka(t,3),Ou(t,4),ei(t);var e=t;t.length===3&&e.push(1);var n=t.map(function(s,u){return ot(r,s,rt.NUMBER)+(u<3?" / 255.0":"")});return"vec"+t.length+"("+n.join(", ")+")"}};Pt.interpolate={getReturnType:function(r){for(var t=rt.COLOR|rt.NUMBER,e=3;e<r.length;e+=2)t=t&Vn(r[e]);return t},toGlsl:function(r,t,e){uy(t),Ka(t,6);var n=t[0],s;switch(n[0]){case"linear":s=1;break;case"exponential":s=n[1];break;default:s=null}if(!s)throw new Error('Invalid interpolation type for "interpolate" operator, received: '+JSON.stringify(n));var u=e!==void 0?e:rt.ANY,g=Pt.interpolate.getReturnType(t)&u;cp(t,g);for(var h=ot(r,t[1]),b=Lu(s),T="",C=2;C<t.length-2;C+=2){var P=ot(r,t[C]),R=T||ot(r,t[C+1],g),U=ot(r,t[C+2]),j=ot(r,t[C+3],g);T="mix("+R+", "+j+", pow(clamp(("+h+" - "+P+") / ("+U+" - "+P+"), 0.0, 1.0), "+b+"))"}return T}};Pt.match={getReturnType:function(r){for(var t=rt.ANY,e=2;e<r.length;e+=2)t=t&Vn(r[e]);return t=t&Vn(r[r.length-1]),t},toGlsl:function(r,t,e){uy(t),Ka(t,4);var n=e!==void 0?e:rt.ANY,s=Pt.match.getReturnType(t)&n;cp(t,s);for(var u=ot(r,t[0]),g=ot(r,t[t.length-1],s),h=null,b=t.length-3;b>=1;b-=2){var T=ot(r,t[b]),C=ot(r,t[b+1],s);h="("+u+" == "+T+" ? "+C+" : "+(h||g)+")"}return h}};Pt.case={getReturnType:function(r){for(var t=rt.ANY,e=1;e<r.length;e+=2)t=t&Vn(r[e]);return t=t&Vn(r[r.length-1]),t},toGlsl:function(r,t,e){QM(t),Ka(t,3);var n=e!==void 0?e:rt.ANY,s=Pt.case.getReturnType(t)&n;cp(t,s);for(var u=0;u<t.length-1;u+=2)hp(t[u]);for(var g=ot(r,t[t.length-1],s),h=null,u=t.length-3;u>=0;u-=2){var b=ot(r,t[u]),T=ot(r,t[u+1],s);h="("+b+" ? "+T+" : "+(h||g)+")"}return h}};var eS=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&(n[u]=s[u])},r(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");r(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}();function tS(r,t){var e=`
    attribute vec2 `+Du.TEXTURE_COORD+`;
    uniform mat4 `+Ir.TILE_TRANSFORM+`;
    uniform float `+Ir.DEPTH+`;

    varying vec2 v_textureCoord;

    void main() {
      v_textureCoord = `+Du.TEXTURE_COORD+`;
      gl_Position = `+Ir.TILE_TRANSFORM+" * vec4("+Du.TEXTURE_COORD+", "+Ir.DEPTH+`, 1.0);
    }
  `,n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},bandCount:t},s=[];if(r.color!==void 0){var u=ot(n,r.color,rt.COLOR);s.push("color = "+u+";")}if(r.contrast!==void 0){var g=ot(n,r.contrast,rt.NUMBER);s.push("color.rgb = clamp(("+g+" + 1.0) * color.rgb - ("+g+" / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(r.exposure!==void 0){var h=ot(n,r.exposure,rt.NUMBER);s.push("color.rgb = clamp(("+h+" + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(r.saturation!==void 0){var b=ot(n,r.saturation,rt.NUMBER);s.push(`
      float saturation = `+b+` + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){var T=ot(n,r.gamma,rt.NUMBER);s.push("color.rgb = pow(color.rgb, vec3(1.0 / "+T+"));")}if(r.brightness!==void 0){var C=ot(n,r.brightness,rt.NUMBER);s.push("color.rgb = clamp(color.rgb + "+C+", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}var P={},R=n.variables.length;if(R>1&&!r.variables)throw new Error("Missing variables in style (expected "+n.variables+")");for(var U=function(Ae){var De=n.variables[Ae];if(!(De in r.variables))throw new Error("Missing '"+De+"' in style variables");var it=fy(De);P[it]=function(){var ze=r.variables[De];return typeof ze=="string"&&(ze=hy(n,ze)),ze!==void 0?ze:-9999999}},j=0;j<R;++j)U(j);for(var H=Object.keys(P).map(function(Ae){return"uniform float "+Ae+";"}),re=Math.ceil(t/4),ge=new Array(re),ce=0;ce<re;++ce){var be=Ir.TILE_TEXTURE_PREFIX+ce;H.push("uniform sampler2D "+be+";"),ge[ce]="vec4 color"+ce+" = texture2D("+be+", v_textureCoord);"}var we=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    uniform float `+Ir.TRANSITION_ALPHA+`;
    uniform float `+Ir.TEXTURE_PIXEL_WIDTH+`;
    uniform float `+Ir.TEXTURE_PIXEL_HEIGHT+`;
    uniform float `+Ir.RESOLUTION+`;
    uniform float `+Ir.ZOOM+`;

    `+H.join(`
`)+`

    void main() {
      `+ge.join(`
`)+`

      vec4 color = color0;

      `+s.join(`
`)+`

      if (color.a == 0.0) {
        discard;
      }

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= `+Ir.TRANSITION_ALPHA+`;
    }`;return{vertexShader:e,fragmentShader:we,uniforms:P}}var my=function(r){eS(t,r);function t(e){var n=this,s=e?vi({},e):{},u=s.style||{};delete s.style;var g=s.cacheSize;return delete s.cacheSize,n=r.call(this,s)||this,n.style_=u,n.cacheSize_=g,n}return t.prototype.createRenderer=function(){var e=this.getSource(),n=tS(this.style_,"bandCount"in e?e.bandCount:4);return this.styleVariables_=this.style_.variables||{},new HM(this,{vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms,className:this.getClassName(),cacheSize:this.cacheSize_})},t.prototype.updateStyleVariables=function(e){vi(this.styleVariables_,e),this.changed()},t}(vM);my.prototype.dispose;var VP=my,gy={exports:{}};(function(r,t){(function(e,n){r.exports=n()})(F1,function(){var e,n,s;function u(h,b){if(!e)e=b;else if(!n)n=b;else{var T="var sharedChunk = {}; ("+e+")(sharedChunk); ("+n+")(sharedChunk);",C={};e(C),s=b(C),typeof window!="undefined"&&(s.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}u(["exports"],function(h){var b=T;function T(o,i,l,f){this.cx=3*o,this.bx=3*(l-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=l,this.p2y=f}function C(o,i,l,f){const p=new b(o,i,l,f);return function(y){return p.solve(y)}}T.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var l=o,f=0;f<8;f++){var p=this.sampleCurveX(l)-o;if(Math.abs(p)<i)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=p/y}var v=0,w=1;for(l=o,f=0;f<20&&(p=this.sampleCurveX(l),!(Math.abs(p-o)<i));f++)o>p?v=l:w=l,l=.5*(w-v)+v;return l},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};const P=C(.25,.1,.25,1);function R(o,i,l){return Math.min(l,Math.max(i,o))}function U(o,i,l){const f=l-i,p=((o-i)%f+f)%f+i;return p===i?l:p}function j(o,...i){for(const l of i)for(const f in l)o[f]=l[f];return o}let H=1;function re(o,i){o.forEach(l=>{i[l]&&(i[l]=i[l].bind(i))})}function ge(o,i,l){const f={};for(const p in o)f[p]=i.call(l||this,o[p],p,o);return f}function ce(o,i,l){const f={};for(const p in o)i.call(l||this,o[p],p,o)&&(f[p]=o[p]);return f}function be(o){return Array.isArray(o)?o.map(be):typeof o=="object"&&o?ge(o,be):o}const we={};function Ae(o){we[o]||(typeof console!="undefined"&&console.warn(o),we[o]=!0)}function De(o,i,l){return(l.y-o.y)*(i.x-o.x)>(i.y-o.y)*(l.x-o.x)}function it(o){let i=0;for(let l,f,p=0,y=o.length,v=y-1;p<y;v=p++)l=o[p],f=o[v],i+=(f.x-l.x)*(l.y+f.y);return i}function ze(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function lt(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,p,y)=>{const v=p||y;return i[f]=!v||v.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i}let ct,Rt,Bt=null;function Kt(o){if(Bt==null){const i=o.navigator?o.navigator.userAgent:null;Bt=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Bt}function Ht(o){return typeof ImageBitmap!="undefined"&&o instanceof ImageBitmap}const At={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(o){const i=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(o,i=0){const l=window.document.createElement("canvas"),f=l.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return l.width=o.width,l.height=o.height,f.drawImage(o,0,0,o.width,o.height),f.getImageData(-i,-i,o.width+2*i,o.height+2*i)},resolveURL:o=>(ct||(ct=document.createElement("a")),ct.href=o,ct.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Rt==null&&(Rt=matchMedia("(prefers-reduced-motion: reduce)")),Rt.matches)}};var qe=Ut;function Ut(o,i){this.x=o,this.y=i}Ut.prototype={clone:function(){return new Ut(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,l=o.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),l=Math.sin(o),f=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=f,this},_rotateAround:function(o,i){var l=Math.cos(o),f=Math.sin(o),p=i.y+f*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-f*(this.y-i.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ut.convert=function(o){return o instanceof Ut?o:Array.isArray(o)?new Ut(o[0],o[1]):o};const Zt={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Er="mapbox-tiles";let nr,qr,Fi=500,ci=50;function Nr(){typeof caches=="undefined"||nr||(nr=caches.open(Er))}let Ur=1/0;const Rr={supported:!1,testSupport:function(o){!Gr&&ui&&(qn?Xn(o):ri=o)}};let ri,ui,Gr=!1,qn=!1;function Xn(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,ui),o.isContextLost())return;Rr.supported=!0}catch(l){}o.deleteTexture(i),Gr=!0}typeof document!="undefined"&&(ui=document.createElement("img"),ui.onload=function(){ri&&Xn(ri),ri=null,qn=!0},ui.onerror=function(){Gr=!0,ri=null},ui.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Kn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Kn);class wi extends Error{constructor(i,l,f,p){super(`AJAXError: ${l} (${i}): ${f}`),this.status=i,this.statusText=l,this.url=f,this.body=p}}const kr=ze()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Hn(o,i){const l=new AbortController,f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:kr(),signal:l.signal});let p=!1,y=!1;return o.type==="json"&&f.headers.set("Accept","application/json"),((v,w,M)=>{if(y)return;const I=Date.now();fetch(f).then(L=>L.ok?((z,B,G)=>{(o.type==="arrayBuffer"?z.arrayBuffer():o.type==="json"?z.json():z.text()).then(V=>{y||(B&&G&&function(J,ee,le){if(Nr(),!nr)return;const de={status:ee.status,statusText:ee.statusText,headers:new Headers};ee.headers.forEach((ye,Ce)=>de.headers.set(Ce,ye));const fe=lt(ee.headers.get("Cache-Control")||"");fe["no-store"]||(fe["max-age"]&&de.headers.set("Expires",new Date(le+1e3*fe["max-age"]).toUTCString()),new Date(de.headers.get("Expires")).getTime()-le<42e4||function(ye,Ce){if(qr===void 0)try{new Response(new ReadableStream),qr=!0}catch(Te){qr=!1}qr?Ce(ye.body):ye.blob().then(Ce)}(ee,ye=>{const Ce=new Response(ye,de);Nr(),nr&&nr.then(Te=>Te.put(function(je){const et=je.indexOf("?");return et<0?je:je.slice(0,et)}(J.url),Ce)).catch(Te=>Ae(Te.message))}))}(f,B,G),p=!0,i(null,V,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(V=>{y||i(new Error(V.message))})})(L,null,I):L.blob().then(z=>i(new wi(L.status,L.statusText,o.url,z)))).catch(L=>{L.code!==20&&i(new Error(L.message))})})(),{cancel:()=>{y=!0,p||l.abort()}}}const Wn=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){if(ze()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i);if(!ze()){const f=o.url.substring(0,o.url.indexOf("://"));return(Zt.REGISTERED_PROTOCOLS[f]||Hn)(o,i)}}if(!(/^file:/.test(l=o.url)||/^file:/.test(kr())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Hn(o,i);if(ze()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var l;return function(f,p){const y=new XMLHttpRequest;y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const v in f.headers)y.setRequestHeader(v,f.headers[v]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let v=y.response;if(f.type==="json")try{v=JSON.parse(y.response)}catch(w){return p(w)}p(null,v,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const v=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});p(new wi(y.status,y.statusText,f.url,v))}},y.send(f.body),{cancel:()=>y.abort()}}(o,i)},En=function(o,i){return Wn(j(o,{type:"arrayBuffer"}),i)};function hn(o){const i=window.document.createElement("a");return i.href=o,i.protocol===window.document.location.protocol&&i.host===window.document.location.host}const Ja="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ei,Vi;Ei=[],Vi=0;const Vs=function(o,i){if(Rr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Vi>=Zt.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Ei.push(y),y}Vi++;let l=!1;const f=()=>{if(!l)for(l=!0,Vi--;Ei.length&&Vi<Zt.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Ei.shift(),{requestParameters:v,callback:w,cancelled:M}=y;M||(y.cancel=Vs(v,w).cancel)}},p=En(o,(y,v,w,M)=>{f(),y?i(y):v&&function(I,L,z,B){typeof createImageBitmap=="function"?function(G,V){const J=new Blob([new Uint8Array(G)],{type:"image/png"});createImageBitmap(J).then(ee=>{V(null,ee)}).catch(ee=>{V(new Error(`Could not load image because of ${ee.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(I,L):function(G,V,J,ee){const le=new Image;le.onload=()=>{V(null,le),URL.revokeObjectURL(le.src),le.onload=null,window.requestAnimationFrame(()=>{le.src=Ja})},le.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const de=new Blob([new Uint8Array(G)],{type:"image/png"});le.cacheControl=J,le.expires=ee,le.src=G.byteLength?URL.createObjectURL(de):Ja}(I,L,z,B)}(v,i,w,M)});return{cancel:()=>{p.cancel(),f()}}};function cn(o,i,l){l[o]&&l[o].indexOf(i)!==-1||(l[o]=l[o]||[],l[o].push(i))}function Ct(o,i,l){if(l&&l[o]){const f=l[o].indexOf(i);f!==-1&&l[o].splice(f,1)}}class Tn{constructor(i,l={}){j(this,l),this.type=i}}class Mn extends Tn{constructor(i,l={}){super("error",j({error:i},l))}}class Qa{on(i,l){return this._listeners=this._listeners||{},cn(i,l,this._listeners),this}off(i,l){return Ct(i,l,this._listeners),Ct(i,l,this._oneTimeListeners),this}once(i,l){return this._oneTimeListeners=this._oneTimeListeners||{},cn(i,l,this._oneTimeListeners),this}fire(i,l){typeof i=="string"&&(i=new Tn(i,l||{}));const f=i.type;if(this.listens(f)){i.target=this;const p=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const w of p)w.call(this,i);const y=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const w of y)Ct(f,w,this._oneTimeListeners),w.call(this,i);const v=this._eventedParent;v&&(j(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(i))}else i instanceof Mn&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Be{constructor(i,l,f,p){this.message=(i?`${i}: `:"")+f,p&&(this.identifier=p),l!=null&&l.__line__&&(this.line=l.__line__)}}function Yn(o){const i=o.value;return i?[new Be(o.key,i,"constants have been deprecated as of v8")]:[]}function Yi(o,...i){for(const l of i)for(const f in l)o[f]=l[f];return o}function Jt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function fi(o){if(Array.isArray(o))return o.map(fi);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const l in o)i[l]=fi(o[l]);return i}return Jt(o)}class di extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class Sn{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[f,p]of l)this.bindings[f]=p}concat(i){return new Sn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Xr={kind:"null"},ke={kind:"number"},pt={kind:"string"},ft={kind:"boolean"},pi={kind:"color"},$i={kind:"object"},dt={kind:"value"},Jn={kind:"collator"},un={kind:"formatted"},Bi={kind:"resolvedImage"};function ii(o,i){return{kind:"array",itemType:o,N:i}}function Lt(o){if(o.kind==="array"){const i=Lt(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const $s=[Xr,ke,pt,ft,pi,un,$i,ii(dt),Bi];function Kr(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Kr(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const l of $s)if(!Kr(l,i))return null}}return`Expected ${Lt(o)} but found ${Lt(i)} instead.`}function Qn(o,i){return i.some(l=>l.kind===o.kind)}function pr(o,i){return i.some(l=>l==="null"?o===null:l==="array"?Array.isArray(o):l==="object"?o&&!Array.isArray(o)&&typeof o=="object":l===typeof o)}var An,Cn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ea(o){return(o=Math.round(o))<0?0:o>255?255:o}function Ta(o){return ea(o[o.length-1]==="%"?parseFloat(o)/100*255:parseInt(o))}function X(o){return(i=o[o.length-1]==="%"?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function k(o,i,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?o+(i-o)*l*6:2*l<1?i:3*l<2?o+(i-o)*(2/3-l)*6:o}try{An={}.parseCSSColor=function(o){var i,l=o.replace(/ /g,"").toLowerCase();if(l in Cn)return Cn[l].slice();if(l[0]==="#")return l.length===4?(i=parseInt(l.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:l.length===7&&(i=parseInt(l.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var f=l.indexOf("("),p=l.indexOf(")");if(f!==-1&&p+1===l.length){var y=l.substr(0,f),v=l.substr(f+1,p-(f+1)).split(","),w=1;switch(y){case"rgba":if(v.length!==4)return null;w=X(v.pop());case"rgb":return v.length!==3?null:[Ta(v[0]),Ta(v[1]),Ta(v[2]),w];case"hsla":if(v.length!==4)return null;w=X(v.pop());case"hsl":if(v.length!==3)return null;var M=(parseFloat(v[0])%360+360)%360/360,I=X(v[1]),L=X(v[2]),z=L<=.5?L*(I+1):L+I-L*I,B=2*L-z;return[ea(255*k(B,z,M+1/3)),ea(255*k(B,z,M)),ea(255*k(B,z,M-1/3)),w];default:return null}}return null}}catch(o){}class O{constructor(i,l,f,p=1){this.r=i,this.g=l,this.b=f,this.a=p}static parse(i){if(!i)return;if(i instanceof O)return i;if(typeof i!="string")return;const l=An(i);return l?new O(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[i,l,f,p]=this.toArray();return`rgba(${Math.round(i)},${Math.round(l)},${Math.round(f)},${p})`}toArray(){const{r:i,g:l,b:f,a:p}=this;return p===0?[0,0,0,0]:[255*i/p,255*l/p,255*f/p,p]}}O.black=new O(0,0,0,1),O.white=new O(1,1,1,1),O.transparent=new O(0,0,0,0),O.red=new O(1,0,0,1);class ${constructor(i,l,f){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class K{constructor(i,l,f,p,y){this.text=i,this.image=l,this.scale=f,this.fontStack=p,this.textColor=y}}class W{constructor(i){this.sections=i}static fromString(i){return new W([new K(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof W?i:W.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const l of this.sections){if(l.image){i.push(["image",l.image.name]);continue}i.push(l.text);const f={};l.fontStack&&(f["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(f["font-scale"]=l.scale),l.textColor&&(f["text-color"]=["rgba"].concat(l.textColor.toArray())),i.push(f)}return i}}class ae{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new ae({name:i,available:!1}):null}serialize(){return["image",this.name]}}function te(o,i,l,f){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[o,i,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[o,i,l,f]:[o,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ie(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof O||o instanceof $||o instanceof W||o instanceof ae)return!0;if(Array.isArray(o)){for(const i of o)if(!ie(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!ie(o[i]))return!1;return!0}return!1}function oe(o){if(o===null)return Xr;if(typeof o=="string")return pt;if(typeof o=="boolean")return ft;if(typeof o=="number")return ke;if(o instanceof O)return pi;if(o instanceof $)return Jn;if(o instanceof W)return un;if(o instanceof ae)return Bi;if(Array.isArray(o)){const i=o.length;let l;for(const f of o){const p=oe(f);if(l){if(l===p)continue;l=dt;break}l=p}return ii(l||dt,i)}return $i}function _e(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof O||o instanceof W||o instanceof ae?o.toString():JSON.stringify(o)}class Se{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!ie(i[1]))return l.error("invalid value");const f=i[1];let p=oe(f);const y=l.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Se(p,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof O?["rgba"].concat(this.value.toArray()):this.value instanceof W?this.value.serialize():this.value}}class me{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const He={string:pt,number:ke,boolean:ft,object:$i};class Ne{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f,p=1;const y=i[0];if(y==="array"){let w,M;if(i.length>2){const I=i[1];if(typeof I!="string"||!(I in He)||I==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=He[I],p++}else w=dt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);M=i[2],p++}f=ii(w,M)}else f=He[y];const v=[];for(;p<i.length;p++){const w=l.parse(i[p],p,dt);if(!w)return null;v.push(w)}return new Ne(f,v)}evaluate(i){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(i);if(!Kr(this.type,oe(f)))return f;if(l===this.args.length-1)throw new me(`Expected value to be of type ${Lt(this.type)}, but found ${Lt(oe(f))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,l=[i.kind];if(i.kind==="array"){const f=i.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){l.push(f.kind);const p=i.N;(typeof p=="number"||this.args.length>1)&&l.push(p)}}return l.concat(this.args.map(f=>f.serialize()))}}class Ye{constructor(i){this.type=un,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const p=[];let y=!1;for(let v=1;v<=i.length-1;++v){const w=i[v];if(y&&typeof w=="object"&&!Array.isArray(w)){y=!1;let M=null;if(w["font-scale"]&&(M=l.parse(w["font-scale"],1,ke),!M))return null;let I=null;if(w["text-font"]&&(I=l.parse(w["text-font"],1,ii(pt)),!I))return null;let L=null;if(w["text-color"]&&(L=l.parse(w["text-color"],1,pi),!L))return null;const z=p[p.length-1];z.scale=M,z.font=I,z.textColor=L}else{const M=l.parse(i[v],1,dt);if(!M)return null;const I=M.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:M,scale:null,font:null,textColor:null})}}return new Ye(p)}evaluate(i){return new W(this.sections.map(l=>{const f=l.content.evaluate(i);return oe(f)===Bi?new K("",f,null,null,null):new K(_e(f),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const l of this.sections){i.push(l.content.serialize());const f={};l.scale&&(f["font-scale"]=l.scale.serialize()),l.font&&(f["text-font"]=l.font.serialize()),l.textColor&&(f["text-color"]=l.textColor.serialize()),i.push(f)}return i}}class nt{constructor(i){this.type=Bi,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const f=l.parse(i[1],1,pt);return f?new nt(f):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),f=ae.fromString(l);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(l)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const It={"to-boolean":ft,"to-color":pi,"to-number":ke,"to-string":pt};class Et{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[0];if((f==="to-boolean"||f==="to-string")&&i.length!==2)return l.error("Expected one argument.");const p=It[f],y=[];for(let v=1;v<i.length;v++){const w=l.parse(i[v],v,dt);if(!w)return null;y.push(w)}return new Et(p,y)}evaluate(i){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(i));if(this.type.kind==="color"){let l,f;for(const p of this.args){if(l=p.evaluate(i),f=null,l instanceof O)return l;if(typeof l=="string"){const y=i.parseColor(l);if(y)return y}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:te(l[0],l[1],l[2],l[3]),!f))return new O(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new me(f||`Could not parse color from value '${typeof l=="string"?l:String(JSON.stringify(l))}'`)}if(this.type.kind==="number"){let l=null;for(const f of this.args){if(l=f.evaluate(i),l===null)return 0;const p=Number(l);if(!isNaN(p))return p}throw new me(`Could not convert ${JSON.stringify(l)} to number.`)}return this.type.kind==="formatted"?W.fromString(_e(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?ae.fromString(_e(this.args[0].evaluate(i))):_e(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ye([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new nt(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(l=>{i.push(l.serialize())}),i}}const yt=["Unknown","Point","LineString","Polygon"];class mt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=O.parse(i)),l}}class gt{constructor(i,l,f,p){this.name=i,this.type=l,this._evaluate=f,this.args=p}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,l){const f=i[0],p=gt.definitions[f];if(!p)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=v.filter(([I])=>!Array.isArray(I)||I.length===i.length-1);let M=null;for(const[I,L]of w){M=new qs(l.registry,l.path,null,l.scope);const z=[];let B=!1;for(let G=1;G<i.length;G++){const V=i[G],J=Array.isArray(I)?I[G-1]:I.type,ee=M.parse(V,1+z.length,J);if(!ee){B=!0;break}z.push(ee)}if(!B)if(Array.isArray(I)&&I.length!==z.length)M.error(`Expected ${I.length} arguments, but found ${z.length} instead.`);else{for(let G=0;G<z.length;G++){const V=Array.isArray(I)?I[G]:I.type,J=z[G];M.concat(G+1).checkSubtype(V,J.type)}if(M.errors.length===0)return new gt(f,y,L,z)}}if(w.length===1)l.errors.push(...M.errors);else{const I=(w.length?w:v).map(([z])=>{return B=z,Array.isArray(B)?`(${B.map(Lt).join(", ")})`:`(${Lt(B.type)}...)`;var B}).join(" | "),L=[];for(let z=1;z<i.length;z++){const B=l.parse(i[z],1+L.length);if(!B)return null;L.push(Lt(B.type))}l.error(`Expected arguments of type ${I}, but found (${L.join(", ")}) instead.`)}return null}static register(i,l){gt.definitions=l;for(const f in l)i[f]=gt}}class ar{constructor(i,l,f){this.type=Jn,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const p=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,ft);if(!p)return null;const y=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,ft);if(!y)return null;let v=null;return f.locale&&(v=l.parse(f.locale,1,pt),!v)?null:new ar(p,y,v)}evaluate(i){return new $(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const mr=8192;function zr(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function In(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Ji(o,i){const l=(180+o[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(l*p*mr),Math.round(f*p*mr)]}function ol(o,i,l){const f=o[0]-i[0],p=o[1]-i[1],y=o[0]-l[0],v=o[1]-l[1];return f*v-y*p==0&&f*y<=0&&p*v<=0}function es(o,i){let l=!1;for(let v=0,w=i.length;v<w;v++){const M=i[v];for(let I=0,L=M.length;I<L-1;I++){if(ol(o,M[I],M[I+1]))return!1;(p=M[I])[1]>(f=o)[1]!=(y=M[I+1])[1]>f[1]&&f[0]<(y[0]-p[0])*(f[1]-p[1])/(y[1]-p[1])+p[0]&&(l=!l)}}var f,p,y;return l}function Wt(o,i){for(let l=0;l<i.length;l++)if(es(o,i[l]))return!0;return!1}function Gh(o,i,l,f){const p=f[0]-l[0],y=f[1]-l[1],v=(o[0]-l[0])*y-p*(o[1]-l[1]),w=(i[0]-l[0])*y-p*(i[1]-l[1]);return v>0&&w<0||v<0&&w>0}function Vh(o,i,l){for(const I of l)for(let L=0;L<I.length-1;++L)if((w=[(v=I[L+1])[0]-(y=I[L])[0],v[1]-y[1]])[0]*(M=[(p=i)[0]-(f=o)[0],p[1]-f[1]])[1]-w[1]*M[0]!=0&&Gh(f,p,y,v)&&Gh(y,v,f,p))return!0;var f,p,y,v,w,M;return!1}function $h(o,i){for(let l=0;l<o.length;++l)if(!es(o[l],i))return!1;for(let l=0;l<o.length-1;++l)if(Vh(o[l],o[l+1],i))return!1;return!0}function jh(o,i){for(let l=0;l<i.length;l++)if($h(o,i[l]))return!0;return!1}function js(o,i,l){const f=[];for(let p=0;p<o.length;p++){const y=[];for(let v=0;v<o[p].length;v++){const w=Ji(o[p][v],l);zr(i,w),y.push(w)}f.push(y)}return f}function Zh(o,i,l){const f=[];for(let p=0;p<o.length;p++){const y=js(o[p],i,l);f.push(y)}return f}function ll(o,i,l,f){if(o[0]<l[0]||o[0]>l[2]){const p=.5*f;let y=o[0]-l[0]>p?-f:l[0]-o[0]>p?f:0;y===0&&(y=o[0]-l[2]>p?-f:l[2]-o[0]>p?f:0),o[0]+=y}zr(i,o)}function hl(o,i,l,f){const p=Math.pow(2,f.z)*mr,y=[f.x*mr,f.y*mr],v=[];for(const w of o)for(const M of w){const I=[M.x+y[0],M.y+y[1]];ll(I,i,l,p),v.push(I)}return v}function qh(o,i,l,f){const p=Math.pow(2,f.z)*mr,y=[f.x*mr,f.y*mr],v=[];for(const M of o){const I=[];for(const L of M){const z=[L.x+y[0],L.y+y[1]];zr(i,z),I.push(z)}v.push(I)}if(i[2]-i[0]<=p/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const M of v)for(const I of M)ll(I,i,l,p)}var w;return v}class ta{constructor(i,l){this.type=ft,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(ie(i[1])){const f=i[1];if(f.type==="FeatureCollection")for(let p=0;p<f.features.length;++p){const y=f.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ta(f,f.features[p].geometry)}else if(f.type==="Feature"){const p=f.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ta(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ta(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(f.type==="Polygon"){const w=js(f.coordinates,y,v),M=hl(l.geometry(),p,y,v);if(!In(p,y))return!1;for(const I of M)if(!es(I,w))return!1}if(f.type==="MultiPolygon"){const w=Zh(f.coordinates,y,v),M=hl(l.geometry(),p,y,v);if(!In(p,y))return!1;for(const I of M)if(!Wt(I,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=l.canonicalID();if(f.type==="Polygon"){const w=js(f.coordinates,y,v),M=qh(l.geometry(),p,y,v);if(!In(p,y))return!1;for(const I of M)if(!$h(I,w))return!1}if(f.type==="MultiPolygon"){const w=Zh(f.coordinates,y,v),M=qh(l.geometry(),p,y,v);if(!In(p,y))return!1;for(const I of M)if(!jh(I,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Zs(o){if(o instanceof gt&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof ta)return!1;let i=!0;return o.eachChild(l=>{i&&!Zs(l)&&(i=!1)}),i}function ts(o){if(o instanceof gt&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(l=>{i&&!ts(l)&&(i=!1)}),i}function rs(o,i){if(o instanceof gt&&i.indexOf(o.name)>=0)return!1;let l=!0;return o.eachChild(f=>{l&&!rs(f,i)&&(l=!1)}),l}class is{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=i[1];return l.scope.has(f)?new is(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class qs{constructor(i,l=[],f,p=new Sn,y=[]){this.registry=i,this.path=l,this.key=l.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=y,this.expectedType=f}parse(i,l,f,p,y={}){return l?this.concat(l,f,p)._parse(i,y):this._parse(i,y)}_parse(i,l){function f(p,y,v){return v==="assert"?new Ne(y,[p]):v==="coerce"?new Et(y,[p]):p}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=i[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let v=y.parse(i,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,M=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||M.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(w,M))return null}else v=f(v,w,l.typeAnnotation||"coerce");else v=f(v,w,l.typeAnnotation||"assert")}if(!(v instanceof Se)&&v.type.kind!=="resolvedImage"&&cl(v)){const w=new mt;try{v=new Se(v.type,v.evaluate(w))}catch(M){return this.error(M.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,f){const p=typeof i=="number"?this.path.concat(i):this.path,y=f?this.scope.concat(f):this.scope;return new qs(this.registry,p,l||null,y,this.errors)}error(i,...l){const f=`${this.key}${l.map(p=>`[${p}]`).join("")}`;this.errors.push(new di(f,i))}checkSubtype(i,l){const f=Kr(i,l);return f&&this.error(f),f}}function cl(o){if(o instanceof is)return cl(o.boundExpression);if(o instanceof gt&&o.name==="error"||o instanceof ar||o instanceof ta)return!1;const i=o instanceof Et||o instanceof Ne;let l=!0;return o.eachChild(f=>{l=i?l&&cl(f):l&&f instanceof Se}),!!l&&Zs(o)&&rs(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ma(o,i){const l=o.length-1;let f,p,y=0,v=l,w=0;for(;y<=v;)if(w=Math.floor((y+v)/2),f=o[w],p=o[w+1],f<=i){if(w===l||i<p)return w;y=w+1}else{if(!(f>i))throw new me("Input is not a number.");v=w-1}return 0}class ns{constructor(i,l,f){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(i[1],1,ke);if(!f)return null;const p=[];let y=null;l.expectedType&&l.expectedType.kind!=="value"&&(y=l.expectedType);for(let v=1;v<i.length;v+=2){const w=v===1?-1/0:i[v],M=i[v+1],I=v,L=v+1;if(typeof w!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const z=l.parse(M,L,y);if(!z)return null;y=y||z.type,p.push([w,z])}return new ns(y,f,p)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return f[0].evaluate(i);const y=l.length;return p>=l[y-1]?f[y-1].evaluate(i):f[Ma(l,p)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&i.push(this.labels[l]),i.push(this.outputs[l].serialize());return i}}function Tr(o,i,l){return o*(1-l)+i*l}var Xs=Object.freeze({__proto__:null,number:Tr,color:function(o,i,l){return new O(Tr(o.r,i.r,l),Tr(o.g,i.g,l),Tr(o.b,i.b,l),Tr(o.a,i.a,l))},array:function(o,i,l){return o.map((f,p)=>Tr(f,i[p],l))}});const ul=.95047,fl=1.08883,Xh=4/29,dl=6/29,pl=3*dl*dl,Kh=Math.PI/180,Hu=180/Math.PI;function ml(o){return o>.008856451679035631?Math.pow(o,1/3):o/pl+Xh}function gl(o){return o>dl?o*o*o:pl*(o-Xh)}function _l(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function yl(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Hh(o){const i=yl(o.r),l=yl(o.g),f=yl(o.b),p=ml((.4124564*i+.3575761*l+.1804375*f)/ul),y=ml((.2126729*i+.7151522*l+.072175*f)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-ml((.0193339*i+.119192*l+.9503041*f)/fl)),alpha:o.a}}function Wh(o){let i=(o.l+16)/116,l=isNaN(o.a)?i:i+o.a/500,f=isNaN(o.b)?i:i-o.b/200;return i=1*gl(i),l=ul*gl(l),f=fl*gl(f),new O(_l(3.2404542*l-1.5371385*i-.4985314*f),_l(-.969266*l+1.8760108*i+.041556*f),_l(.0556434*l-.2040259*i+1.0572252*f),o.alpha)}function Ot(o,i,l){const f=i-o;return o+l*(f>180||f<-180?f-360*Math.round(f/360):f)}const as={forward:Hh,reverse:Wh,interpolate:function(o,i,l){return{l:Tr(o.l,i.l,l),a:Tr(o.a,i.a,l),b:Tr(o.b,i.b,l),alpha:Tr(o.alpha,i.alpha,l)}}},ss={forward:function(o){const{l:i,a:l,b:f}=Hh(o),p=Math.atan2(f,l)*Hu;return{h:p<0?p+360:p,c:Math.sqrt(l*l+f*f),l:i,alpha:o.a}},reverse:function(o){const i=o.h*Kh,l=o.c;return Wh({l:o.l,a:Math.cos(i)*l,b:Math.sin(i)*l,alpha:o.alpha})},interpolate:function(o,i,l){return{h:Ot(o.h,i.h,l),c:Tr(o.c,i.c,l),l:Tr(o.l,i.l,l),alpha:Tr(o.alpha,i.alpha,l)}}};var Yh=Object.freeze({__proto__:null,lab:as,hcl:ss});class Ti{constructor(i,l,f,p,y){this.type=i,this.operator=l,this.interpolation=f,this.input=p,this.labels=[],this.outputs=[];for(const[v,w]of y)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(i,l,f,p){let y=0;if(i.name==="exponential")y=vl(l,i.base,f,p);else if(i.name==="linear")y=vl(l,1,f,p);else if(i.name==="cubic-bezier"){const v=i.controlPoints;y=new b(v[0],v[1],v[2],v[3]).solve(vl(l,1,f,p))}return y}static parse(i,l){let[f,p,y,...v]=i;if(!Array.isArray(p)||p.length===0)return l.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(L=>typeof L!="number"||L<0||L>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(y=l.parse(y,2,ke),!y)return null;const w=[];let M=null;f==="interpolate-hcl"||f==="interpolate-lab"?M=pi:l.expectedType&&l.expectedType.kind!=="value"&&(M=l.expectedType);for(let I=0;I<v.length;I+=2){const L=v[I],z=v[I+1],B=I+3,G=I+4;if(typeof L!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=L)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const V=l.parse(z,G,M);if(!V)return null;M=M||V.type,w.push([L,V])}return M.kind==="number"||M.kind==="color"||M.kind==="array"&&M.itemType.kind==="number"&&typeof M.N=="number"?new Ti(M,f,p,y,w):l.error(`Type ${Lt(M)} is not interpolatable.`)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const p=this.input.evaluate(i);if(p<=l[0])return f[0].evaluate(i);const y=l.length;if(p>=l[y-1])return f[y-1].evaluate(i);const v=Ma(l,p),w=Ti.interpolationFactor(this.interpolation,p,l[v],l[v+1]),M=f[v].evaluate(i),I=f[v+1].evaluate(i);return this.operator==="interpolate"?Xs[this.type.kind.toLowerCase()](M,I,w):this.operator==="interpolate-hcl"?ss.reverse(ss.interpolate(ss.forward(M),ss.forward(I),w)):as.reverse(as.interpolate(as.forward(M),as.forward(I),w))}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,i,this.input.serialize()];for(let f=0;f<this.labels.length;f++)l.push(this.labels[f],this.outputs[f].serialize());return l}}function vl(o,i,l,f){const p=f-l,y=o-l;return p===0?0:i===1?y/p:(Math.pow(i,y)-1)/(Math.pow(i,p)-1)}class Ks{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let f=null;const p=l.expectedType;p&&p.kind!=="value"&&(f=p);const y=[];for(const w of i.slice(1)){const M=l.parse(w,1+y.length,f,void 0,{typeAnnotation:"omit"});if(!M)return null;f=f||M.type,y.push(M)}const v=p&&y.some(w=>Kr(p,w.type));return new Ks(v?dt:f,y)}evaluate(i){let l,f=null,p=0;for(const y of this.args)if(p++,f=y.evaluate(i),f&&f instanceof ae&&!f.available&&(l||(l=f.name),f=null,p===this.args.length&&(f=l)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class Hs{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let y=1;y<i.length-1;y+=2){const v=i[y];if(typeof v!="string")return l.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return l.error("Variable names must contain only alphanumeric characters or '_'.",y);const w=l.parse(i[y+1],y+1);if(!w)return null;f.push([v,w])}const p=l.parse(i[i.length-1],i.length-1,l.expectedType,f);return p?new Hs(f,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[l,f]of this.bindings)i.push(l,f.serialize());return i.push(this.result.serialize()),i}}class xl{constructor(i,l,f){this.type=i,this.index=l,this.input=f}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,ke),p=l.parse(i[2],2,ii(l.expectedType||dt));return f&&p?new xl(p.type.itemType,f,p):null}evaluate(i){const l=this.index.evaluate(i),f=this.input.evaluate(i);if(l<0)throw new me(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new me(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new me(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bl{constructor(i,l){this.type=ft,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,dt),p=l.parse(i[2],2,dt);return f&&p?Qn(f.type,[ft,pt,ke,Xr,dt])?new bl(f,p):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(f.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!pr(l,["boolean","string","number","null"]))throw new me(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(oe(l))} instead.`);if(!pr(f,["string","array"]))throw new me(`Expected second argument to be of type array or string, but found ${Lt(oe(f))} instead.`);return f.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ws{constructor(i,l,f){this.type=ke,this.needle=i,this.haystack=l,this.fromIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,dt),p=l.parse(i[2],2,dt);if(!f||!p)return null;if(!Qn(f.type,[ft,pt,ke,Xr,dt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(f.type)} instead`);if(i.length===4){const y=l.parse(i[3],3,ke);return y?new Ws(f,p,y):null}return new Ws(f,p)}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!pr(l,["boolean","string","number","null"]))throw new me(`Expected first argument to be of type boolean, string, number or null, but found ${Lt(oe(l))} instead.`);if(!pr(f,["string","array"]))throw new me(`Expected second argument to be of type array or string, but found ${Lt(oe(f))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return f.indexOf(l,p)}return f.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wl{constructor(i,l,f,p,y,v){this.inputType=i,this.type=l,this.input=f,this.cases=p,this.outputs=y,this.otherwise=v}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let f,p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const y={},v=[];for(let I=2;I<i.length-1;I+=2){let L=i[I];const z=i[I+1];Array.isArray(L)||(L=[L]);const B=l.concat(I);if(L.length===0)return B.error("Expected at least one branch label.");for(const V of L){if(typeof V!="number"&&typeof V!="string")return B.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return B.error("Numeric branch labels must be integer values.");if(f){if(B.checkSubtype(f,oe(V)))return null}else f=oe(V);if(y[String(V)]!==void 0)return B.error("Branch labels must be unique.");y[String(V)]=v.length}const G=l.parse(z,I,p);if(!G)return null;p=p||G.type,v.push(G)}const w=l.parse(i[1],1,dt);if(!w)return null;const M=l.parse(i[i.length-1],i.length-1,p);return M?w.type.kind!=="value"&&l.concat(1).checkSubtype(f,w.type)?null:new wl(f,p,w,y,v,M):null}evaluate(i){const l=this.input.evaluate(i);return(oe(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),f=[],p={};for(const v of l){const w=p[this.cases[v]];w===void 0?(p[this.cases[v]]=f.length,f.push([this.cases[v],[v]])):f[w][1].push(v)}const y=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,w]of f)i.push(w.length===1?y(w[0]):w.map(y)),i.push(this.outputs[v].serialize());return i.push(this.otherwise.serialize()),i}}class El{constructor(i,l,f){this.type=i,this.branches=l,this.otherwise=f}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const p=[];for(let v=1;v<i.length-1;v+=2){const w=l.parse(i[v],v,ft);if(!w)return null;const M=l.parse(i[v+1],v+1,f);if(!M)return null;p.push([w,M]),f=f||M.type}const y=l.parse(i[i.length-1],i.length-1,f);return y?new El(f,p,y):null}evaluate(i){for(const[l,f]of this.branches)if(l.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,f]of this.branches)i(l),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(l=>{i.push(l.serialize())}),i}}class Ys{constructor(i,l,f,p){this.type=i,this.input=l,this.beginIndex=f,this.endIndex=p}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,dt),p=l.parse(i[2],2,ke);if(!f||!p)return null;if(!Qn(f.type,[ii(dt),pt,dt]))return l.error(`Expected first argument to be of type array or string, but found ${Lt(f.type)} instead`);if(i.length===4){const y=l.parse(i[3],3,ke);return y?new Ys(f.type,f,p,y):null}return new Ys(f.type,f,p)}evaluate(i){const l=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!pr(l,["string","array"]))throw new me(`Expected first argument to be of type array or string, but found ${Lt(oe(l))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return l.slice(f,p)}return l.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Jh(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Qh(o,i,l,f){return f.compare(i,l)===0}function Sa(o,i,l){const f=o!=="=="&&o!=="!=";return class _y{constructor(y,v,w){this.type=ft,this.lhs=y,this.rhs=v,this.collator=w,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const w=y[0];let M=v.parse(y[1],1,dt);if(!M)return null;if(!Jh(w,M.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${Lt(M.type)}'.`);let I=v.parse(y[2],2,dt);if(!I)return null;if(!Jh(w,I.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${Lt(I.type)}'.`);if(M.type.kind!==I.type.kind&&M.type.kind!=="value"&&I.type.kind!=="value")return v.error(`Cannot compare types '${Lt(M.type)}' and '${Lt(I.type)}'.`);f&&(M.type.kind==="value"&&I.type.kind!=="value"?M=new Ne(I.type,[M]):M.type.kind!=="value"&&I.type.kind==="value"&&(I=new Ne(M.type,[I])));let L=null;if(y.length===4){if(M.type.kind!=="string"&&I.type.kind!=="string"&&M.type.kind!=="value"&&I.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(L=v.parse(y[3],3,Jn),!L)return null}return new _y(M,I,L)}evaluate(y){const v=this.lhs.evaluate(y),w=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){const M=oe(v),I=oe(w);if(M.kind!==I.kind||M.kind!=="string"&&M.kind!=="number")throw new me(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${M.kind}, ${I.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const M=oe(v),I=oe(w);if(M.kind!=="string"||I.kind!=="string")return i(y,v,w)}return this.collator?l(y,v,w,this.collator.evaluate(y)):i(y,v,w)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[o];return this.eachChild(v=>{y.push(v.serialize())}),y}}}const Wu=Sa("==",function(o,i,l){return i===l},Qh),Yu=Sa("!=",function(o,i,l){return i!==l},function(o,i,l,f){return!Qh(0,i,l,f)}),Ju=Sa("<",function(o,i,l){return i<l},function(o,i,l,f){return f.compare(i,l)<0}),Qu=Sa(">",function(o,i,l){return i>l},function(o,i,l,f){return f.compare(i,l)>0}),ef=Sa("<=",function(o,i,l){return i<=l},function(o,i,l,f){return f.compare(i,l)<=0}),tf=Sa(">=",function(o,i,l){return i>=l},function(o,i,l,f){return f.compare(i,l)>=0});class Tl{constructor(i,l,f,p,y){this.type=pt,this.number=i,this.locale=l,this.currency=f,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const f=l.parse(i[1],1,ke);if(!f)return null;const p=i[2];if(typeof p!="object"||Array.isArray(p))return l.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=l.parse(p.locale,1,pt),!y))return null;let v=null;if(p.currency&&(v=l.parse(p.currency,1,pt),!v))return null;let w=null;if(p["min-fraction-digits"]&&(w=l.parse(p["min-fraction-digits"],1,ke),!w))return null;let M=null;return p["max-fraction-digits"]&&(M=l.parse(p["max-fraction-digits"],1,ke),!M)?null:new Tl(f,y,v,w,M)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Ml{constructor(i){this.type=ke,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=l.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Lt(f.type)} instead.`):new Ml(f):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new me(`Expected value to be of type string or array, but found ${Lt(oe(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(l=>{i.push(l.serialize())}),i}}const Aa={"==":Wu,"!=":Yu,">":Qu,"<":Ju,">=":tf,"<=":ef,array:Ne,at:xl,boolean:Ne,case:El,coalesce:Ks,collator:ar,format:Ye,image:nt,in:bl,"index-of":Ws,interpolate:Ti,"interpolate-hcl":Ti,"interpolate-lab":Ti,length:Ml,let:Hs,literal:Se,match:wl,number:Ne,"number-format":Tl,object:Ne,slice:Ys,step:ns,string:Ne,"to-boolean":Et,"to-color":Et,"to-number":Et,"to-string":Et,var:is,within:ta};function ec(o,[i,l,f,p]){i=i.evaluate(o),l=l.evaluate(o),f=f.evaluate(o);const y=p?p.evaluate(o):1,v=te(i,l,f,y);if(v)throw new me(v);return new O(i/255*y,l/255*y,f/255*y,y)}function tc(o,i){return o in i}function Sl(o,i){const l=i[o];return l===void 0?null:l}function ra(o){return{type:o}}function rc(o){return{result:"success",value:o}}function Ca(o){return{result:"error",value:o}}function ia(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function ic(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Al(o){return!!o.expression&&o.expression.interpolated}function Gt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function gr(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function rf(o){return o}function zt(o,i){const l=i.type==="color",f=o.stops&&typeof o.stops[0][0]=="object",p=f||!(f||o.property!==void 0),y=o.type||(Al(i)?"exponential":"interval");if(l&&((o=Yi({},o)).stops&&(o.stops=o.stops.map(I=>[I[0],O.parse(I[1])])),o.default=O.parse(o.default?o.default:i.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Yh[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let v,w,M;if(y==="exponential")v=os;else if(y==="interval")v=_r;else if(y==="categorical"){v=xr,w=Object.create(null);for(const I of o.stops)w[I[0]]=I[1];M=typeof o.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);v=nc}if(f){const I={},L=[];for(let G=0;G<o.stops.length;G++){const V=o.stops[G],J=V[0].zoom;I[J]===void 0&&(I[J]={zoom:J,type:o.type,property:o.property,default:o.default,stops:[]},L.push(J)),I[J].stops.push([V[0].value,V[1]])}const z=[];for(const G of L)z.push([I[G].zoom,zt(I[G],i)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Ti.interpolationFactor.bind(void 0,B),zoomStops:z.map(G=>G[0]),evaluate:({zoom:G},V)=>os({stops:z,base:o.base},i,G).evaluate(G,V)}}if(p){const I=y==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Ti.interpolationFactor.bind(void 0,I),zoomStops:o.stops.map(L=>L[0]),evaluate:({zoom:L})=>v(o,i,L,w,M)}}return{kind:"source",evaluate(I,L){const z=L&&L.properties?L.properties[o.property]:void 0;return z===void 0?na(o.default,i.default):v(o,i,z,w,M)}}}function na(o,i,l){return o!==void 0?o:i!==void 0?i:l!==void 0?l:void 0}function xr(o,i,l,f,p){return na(typeof l===p?f[l]:void 0,o.default,i.default)}function _r(o,i,l){if(Gt(l)!=="number")return na(o.default,i.default);const f=o.stops.length;if(f===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[f-1][0])return o.stops[f-1][1];const p=Ma(o.stops.map(y=>y[0]),l);return o.stops[p][1]}function os(o,i,l){const f=o.base!==void 0?o.base:1;if(Gt(l)!=="number")return na(o.default,i.default);const p=o.stops.length;if(p===1||l<=o.stops[0][0])return o.stops[0][1];if(l>=o.stops[p-1][0])return o.stops[p-1][1];const y=Ma(o.stops.map(L=>L[0]),l),v=function(L,z,B,G){const V=G-B,J=L-B;return V===0?0:z===1?J/V:(Math.pow(z,J)-1)/(Math.pow(z,V)-1)}(l,f,o.stops[y][0],o.stops[y+1][0]),w=o.stops[y][1],M=o.stops[y+1][1];let I=Xs[i.type]||rf;if(o.colorSpace&&o.colorSpace!=="rgb"){const L=Yh[o.colorSpace];I=(z,B)=>L.reverse(L.interpolate(L.forward(z),L.forward(B),v))}return typeof w.evaluate=="function"?{evaluate(...L){const z=w.evaluate.apply(void 0,L),B=M.evaluate.apply(void 0,L);if(z!==void 0&&B!==void 0)return I(z,B,v)}}:I(w,M,v)}function nc(o,i,l){return i.type==="color"?l=O.parse(l):i.type==="formatted"?l=W.fromString(l.toString()):i.type==="resolvedImage"?l=ae.fromString(l.toString()):Gt(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0),na(l,o.default,i.default)}gt.register(Aa,{error:[{kind:"error"},[pt],(o,[i])=>{throw new me(i.evaluate(o))}],typeof:[pt,[dt],(o,[i])=>Lt(oe(i.evaluate(o)))],"to-rgba":[ii(ke,4),[pi],(o,[i])=>i.evaluate(o).toArray()],rgb:[pi,[ke,ke,ke],ec],rgba:[pi,[ke,ke,ke,ke],ec],has:{type:ft,overloads:[[[pt],(o,[i])=>tc(i.evaluate(o),o.properties())],[[pt,$i],(o,[i,l])=>tc(i.evaluate(o),l.evaluate(o))]]},get:{type:dt,overloads:[[[pt],(o,[i])=>Sl(i.evaluate(o),o.properties())],[[pt,$i],(o,[i,l])=>Sl(i.evaluate(o),l.evaluate(o))]]},"feature-state":[dt,[pt],(o,[i])=>Sl(i.evaluate(o),o.featureState||{})],properties:[$i,[],o=>o.properties()],"geometry-type":[pt,[],o=>o.geometryType()],id:[dt,[],o=>o.id()],zoom:[ke,[],o=>o.globals.zoom],"heatmap-density":[ke,[],o=>o.globals.heatmapDensity||0],"line-progress":[ke,[],o=>o.globals.lineProgress||0],accumulated:[dt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[ke,ra(ke),(o,i)=>{let l=0;for(const f of i)l+=f.evaluate(o);return l}],"*":[ke,ra(ke),(o,i)=>{let l=1;for(const f of i)l*=f.evaluate(o);return l}],"-":{type:ke,overloads:[[[ke,ke],(o,[i,l])=>i.evaluate(o)-l.evaluate(o)],[[ke],(o,[i])=>-i.evaluate(o)]]},"/":[ke,[ke,ke],(o,[i,l])=>i.evaluate(o)/l.evaluate(o)],"%":[ke,[ke,ke],(o,[i,l])=>i.evaluate(o)%l.evaluate(o)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(o,[i,l])=>Math.pow(i.evaluate(o),l.evaluate(o))],sqrt:[ke,[ke],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[ke,[ke],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[ke,[ke],(o,[i])=>Math.log(i.evaluate(o))],log2:[ke,[ke],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[ke,[ke],(o,[i])=>Math.sin(i.evaluate(o))],cos:[ke,[ke],(o,[i])=>Math.cos(i.evaluate(o))],tan:[ke,[ke],(o,[i])=>Math.tan(i.evaluate(o))],asin:[ke,[ke],(o,[i])=>Math.asin(i.evaluate(o))],acos:[ke,[ke],(o,[i])=>Math.acos(i.evaluate(o))],atan:[ke,[ke],(o,[i])=>Math.atan(i.evaluate(o))],min:[ke,ra(ke),(o,i)=>Math.min(...i.map(l=>l.evaluate(o)))],max:[ke,ra(ke),(o,i)=>Math.max(...i.map(l=>l.evaluate(o)))],abs:[ke,[ke],(o,[i])=>Math.abs(i.evaluate(o))],round:[ke,[ke],(o,[i])=>{const l=i.evaluate(o);return l<0?-Math.round(-l):Math.round(l)}],floor:[ke,[ke],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[ke,[ke],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[ft,[pt,dt],(o,[i,l])=>o.properties()[i.value]===l.value],"filter-id-==":[ft,[dt],(o,[i])=>o.id()===i.value],"filter-type-==":[ft,[pt],(o,[i])=>o.geometryType()===i.value],"filter-<":[ft,[pt,dt],(o,[i,l])=>{const f=o.properties()[i.value],p=l.value;return typeof f==typeof p&&f<p}],"filter-id-<":[ft,[dt],(o,[i])=>{const l=o.id(),f=i.value;return typeof l==typeof f&&l<f}],"filter->":[ft,[pt,dt],(o,[i,l])=>{const f=o.properties()[i.value],p=l.value;return typeof f==typeof p&&f>p}],"filter-id->":[ft,[dt],(o,[i])=>{const l=o.id(),f=i.value;return typeof l==typeof f&&l>f}],"filter-<=":[ft,[pt,dt],(o,[i,l])=>{const f=o.properties()[i.value],p=l.value;return typeof f==typeof p&&f<=p}],"filter-id-<=":[ft,[dt],(o,[i])=>{const l=o.id(),f=i.value;return typeof l==typeof f&&l<=f}],"filter->=":[ft,[pt,dt],(o,[i,l])=>{const f=o.properties()[i.value],p=l.value;return typeof f==typeof p&&f>=p}],"filter-id->=":[ft,[dt],(o,[i])=>{const l=o.id(),f=i.value;return typeof l==typeof f&&l>=f}],"filter-has":[ft,[dt],(o,[i])=>i.value in o.properties()],"filter-has-id":[ft,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[ft,[ii(pt)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[ft,[ii(dt)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[ft,[pt,ii(dt)],(o,[i,l])=>l.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[ft,[pt,ii(dt)],(o,[i,l])=>function(f,p,y,v){for(;y<=v;){const w=y+v>>1;if(p[w]===f)return!0;p[w]>f?v=w-1:y=w+1}return!1}(o.properties()[i.value],l.value,0,l.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(o,[i,l])=>i.evaluate(o)&&l.evaluate(o)],[ra(ft),(o,i)=>{for(const l of i)if(!l.evaluate(o))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(o,[i,l])=>i.evaluate(o)||l.evaluate(o)],[ra(ft),(o,i)=>{for(const l of i)if(l.evaluate(o))return!0;return!1}]]},"!":[ft,[ft],(o,[i])=>!i.evaluate(o)],"is-supported-script":[ft,[pt],(o,[i])=>{const l=o.globals&&o.globals.isSupportedScript;return!l||l(i.evaluate(o))}],upcase:[pt,[pt],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[pt,[pt],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[pt,ra(dt),(o,i)=>i.map(l=>_e(l.evaluate(o))).join("")],"resolved-locale":[pt,[Jn],(o,[i])=>i.evaluate(o).resolvedLocale()]});class Cl{constructor(i,l){this.expression=i,this._warningHistory={},this._evaluator=new mt,this._defaultValue=l?function(f){return f.type==="color"&&gr(f.default)?new O(0,0,0,0):f.type==="color"?O.parse(f.default)||null:f.default===void 0?null:f.default}(l):null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,f,p,y,v){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(i,l,f,p,y,v){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new me(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console!="undefined"&&console.warn(w.message)),this._defaultValue}}}function Js(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Aa}function Qs(o,i){const l=new qs(Aa,[],i?function(p){const y={color:pi,string:pt,number:ke,enum:pt,boolean:ft,formatted:un,resolvedImage:Bi};return p.type==="array"?ii(y[p.value]||dt,p.length):y[p.type]}(i):void 0),f=l.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?rc(new Cl(f,i)):Ca(l.errors)}class Il{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!ts(l.expression)}evaluateWithoutErrorHandling(i,l,f,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,p,y,v)}evaluate(i,l,f,p,y,v){return this._styleExpression.evaluate(i,l,f,p,y,v)}}class eo{constructor(i,l,f,p){this.kind=i,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!ts(l.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,l,f,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,p,y,v)}evaluate(i,l,f,p,y,v){return this._styleExpression.evaluate(i,l,f,p,y,v)}interpolationFactor(i,l,f){return this.interpolationType?Ti.interpolationFactor(this.interpolationType,i,l,f):0}}function Pl(o,i){const l=Qs(o,i);if(l.result==="error")return l;const f=l.value.expression,p=Zs(f);if(!p&&!ia(i))return Ca([new di("","data expressions not supported")]);const y=rs(f,["zoom"]);if(!y&&!ic(i))return Ca([new di("","zoom expressions not supported")]);const v=Ia(f);return v||y?v instanceof di?Ca([v]):v instanceof Ti&&!Al(i)?Ca([new di("",'"interpolate" expressions cannot be used with this property')]):rc(v?new eo(p?"camera":"composite",l.value,v.labels,v instanceof Ti?v.interpolation:void 0):new Il(p?"constant":"source",l.value)):Ca([new di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ls{constructor(i,l){this._parameters=i,this._specification=l,Yi(this,zt(this._parameters,this._specification))}static deserialize(i){return new ls(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ia(o){let i=null;if(o instanceof Hs)i=Ia(o.result);else if(o instanceof Ks){for(const l of o.args)if(i=Ia(l),i)break}else(o instanceof ns||o instanceof Ti)&&o.input instanceof gt&&o.input.name==="zoom"&&(i=o);return i instanceof di||o.eachChild(l=>{const f=Ia(l);f instanceof di?i=f:!i&&f?i=new di("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new di("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function ji(o){const i=o.key,l=o.value,f=o.valueSpec||{},p=o.objectElementValidators||{},y=o.style,v=o.styleSpec;let w=[];const M=Gt(l);if(M!=="object")return[new Be(i,l,`object expected, ${M} found`)];for(const I in l){const L=I.split(".")[0],z=f[L]||f["*"];let B;if(p[L])B=p[L];else if(f[L])B=yr;else if(p["*"])B=p["*"];else{if(!f["*"]){w.push(new Be(i,l[I],`unknown property "${I}"`));continue}B=yr}w=w.concat(B({key:(i&&`${i}.`)+I,value:l[I],valueSpec:z,style:y,styleSpec:v,object:l,objectKey:I},l))}for(const I in f)p[I]||f[I].required&&f[I].default===void 0&&l[I]===void 0&&w.push(new Be(i,l,`missing required property "${I}"`));return w}function ac(o){const i=o.value,l=o.valueSpec,f=o.style,p=o.styleSpec,y=o.key,v=o.arrayElementValidator||yr;if(Gt(i)!=="array")return[new Be(y,i,`array expected, ${Gt(i)} found`)];if(l.length&&i.length!==l.length)return[new Be(y,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Be(y,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let w={type:l.value,values:l.values};p.$version<7&&(w.function=l.function),Gt(l.value)==="object"&&(w=l.value);let M=[];for(let I=0;I<i.length;I++)M=M.concat(v({array:i,arrayIndex:I,value:i[I],valueSpec:w,style:f,styleSpec:p,key:`${y}[${I}]`}));return M}function sc(o){const i=o.key,l=o.value,f=o.valueSpec;let p=Gt(l);return p==="number"&&l!=l&&(p="NaN"),p!=="number"?[new Be(i,l,`number expected, ${p} found`)]:"minimum"in f&&l<f.minimum?[new Be(i,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new Be(i,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function oc(o){const i=o.valueSpec,l=Jt(o.value.type);let f,p,y,v={};const w=l!=="categorical"&&o.value.property===void 0,M=!w,I=Gt(o.value.stops)==="array"&&Gt(o.value.stops[0])==="array"&&Gt(o.value.stops[0][0])==="object",L=ji({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(G){if(l==="identity")return[new Be(G.key,G.value,'identity function may not have a "stops" property')];let V=[];const J=G.value;return V=V.concat(ac({key:G.key,value:J,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:z})),Gt(J)==="array"&&J.length===0&&V.push(new Be(G.key,J,"array must have at least one stop")),V},default:function(G){return yr({key:G.key,value:G.value,valueSpec:i,style:G.style,styleSpec:G.styleSpec})}}});return l==="identity"&&w&&L.push(new Be(o.key,o.value,'missing required property "property"')),l==="identity"||o.value.stops||L.push(new Be(o.key,o.value,'missing required property "stops"')),l==="exponential"&&o.valueSpec.expression&&!Al(o.valueSpec)&&L.push(new Be(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(M&&!ia(o.valueSpec)?L.push(new Be(o.key,o.value,"property functions not supported")):w&&!ic(o.valueSpec)&&L.push(new Be(o.key,o.value,"zoom functions not supported"))),l!=="categorical"&&!I||o.value.property!==void 0||L.push(new Be(o.key,o.value,'"property" property is required')),L;function z(G){let V=[];const J=G.value,ee=G.key;if(Gt(J)!=="array")return[new Be(ee,J,`array expected, ${Gt(J)} found`)];if(J.length!==2)return[new Be(ee,J,`array length 2 expected, length ${J.length} found`)];if(I){if(Gt(J[0])!=="object")return[new Be(ee,J,`object expected, ${Gt(J[0])} found`)];if(J[0].zoom===void 0)return[new Be(ee,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new Be(ee,J,"object stop key must have value")];if(y&&y>Jt(J[0].zoom))return[new Be(ee,J[0].zoom,"stop zoom values must appear in ascending order")];Jt(J[0].zoom)!==y&&(y=Jt(J[0].zoom),p=void 0,v={}),V=V.concat(ji({key:`${ee}[0]`,value:J[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:sc,value:B}}))}else V=V.concat(B({key:`${ee}[0]`,value:J[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},J));return Js(fi(J[1]))?V.concat([new Be(`${ee}[1]`,J[1],"expressions are not allowed in function stops.")]):V.concat(yr({key:`${ee}[1]`,value:J[1],valueSpec:i,style:G.style,styleSpec:G.styleSpec}))}function B(G,V){const J=Gt(G.value),ee=Jt(G.value),le=G.value!==null?G.value:V;if(f){if(J!==f)return[new Be(G.key,le,`${J} stop domain type must match previous stop domain type ${f}`)]}else f=J;if(J!=="number"&&J!=="string"&&J!=="boolean")return[new Be(G.key,le,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&l!=="categorical"){let de=`number expected, ${J} found`;return ia(i)&&l===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(G.key,le,de)]}return l!=="categorical"||J!=="number"||isFinite(ee)&&Math.floor(ee)===ee?l!=="categorical"&&J==="number"&&p!==void 0&&ee<p?[new Be(G.key,le,"stop domain values must appear in ascending order")]:(p=ee,l==="categorical"&&ee in v?[new Be(G.key,le,"stop domain values must be unique")]:(v[ee]=!0,[])):[new Be(G.key,le,`integer expected, found ${ee}`)]}}function Pa(o){const i=(o.expressionContext==="property"?Pl:Qs)(fi(o.value),o.valueSpec);if(i.result==="error")return i.value.map(f=>new Be(`${o.key}${f.key}`,o.value,f.message));const l=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!l.outputDefined())return[new Be(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!ts(l))return[new Be(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!ts(l))return[new Be(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!rs(l,["zoom","feature-state"]))return[new Be(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Zs(l))return[new Be(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function to(o){const i=o.key,l=o.value,f=o.valueSpec,p=[];return Array.isArray(f.values)?f.values.indexOf(Jt(l))===-1&&p.push(new Be(i,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(Jt(l))===-1&&p.push(new Be(i,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),p}function Rl(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Rl(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const nf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ro(o){if(o==null)return{filter:()=>!0,needGeometry:!1};Rl(o)||(o=io(o));const i=Qs(o,nf);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,p)=>i.value.evaluate(l,f,{},p),needGeometry:hs(o)}}function lc(o,i){return o<i?-1:o>i?1:0}function hs(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let i=1;i<o.length;i++)if(hs(o[i]))return!0;return!1}function io(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?no(o[1],o[2],"=="):i==="!="?Ra(no(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?no(o[1],o[2],i):i==="any"?(l=o.slice(1),["any"].concat(l.map(io))):i==="all"?["all"].concat(o.slice(1).map(io)):i==="none"?["all"].concat(o.slice(1).map(io).map(Ra)):i==="in"?hc(o[1],o.slice(2)):i==="!in"?Ra(hc(o[1],o.slice(2))):i==="has"?ao(o[1]):i==="!has"?Ra(ao(o[1])):i!=="within"||o;var l}function no(o,i,l){switch(o){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,o,i]}}function hc(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",o,["literal",i.sort(lc)]]:["filter-in-small",o,["literal",i]]}}function ao(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ra(o){return["!",o]}function cs(o){return Rl(fi(o.value))?Pa(Yi({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):so(o)}function so(o){const i=o.value,l=o.key;if(Gt(i)!=="array")return[new Be(l,i,`array expected, ${Gt(i)} found`)];const f=o.styleSpec;let p,y=[];if(i.length<1)return[new Be(l,i,"filter array must have at least 1 element")];switch(y=y.concat(to({key:`${l}[0]`,value:i[0],valueSpec:f.filter_operator,style:o.style,styleSpec:o.styleSpec})),Jt(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Jt(i[1])==="$type"&&y.push(new Be(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&y.push(new Be(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(p=Gt(i[1]),p!=="string"&&y.push(new Be(`${l}[1]`,i[1],`string expected, ${p} found`)));for(let v=2;v<i.length;v++)p=Gt(i[v]),Jt(i[1])==="$type"?y=y.concat(to({key:`${l}[${v}]`,value:i[v],valueSpec:f.geometry_type,style:o.style,styleSpec:o.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new Be(`${l}[${v}]`,i[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<i.length;v++)y=y.concat(so({key:`${l}[${v}]`,value:i[v],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":p=Gt(i[1]),i.length!==2?y.push(new Be(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new Be(`${l}[1]`,i[1],`string expected, ${p} found`));break;case"within":p=Gt(i[1]),i.length!==2?y.push(new Be(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):p!=="object"&&y.push(new Be(`${l}[1]`,i[1],`object expected, ${p} found`))}return y}function cc(o,i){const l=o.key,f=o.style,p=o.styleSpec,y=o.value,v=o.objectKey,w=p[`${i}_${o.layerType}`];if(!w)return[];const M=v.match(/^(.*)-transition$/);if(i==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return yr({key:l,value:y,valueSpec:p.transition,style:f,styleSpec:p});const I=o.valueSpec||w[v];if(!I)return[new Be(l,y,`unknown property "${v}"`)];let L;if(Gt(y)==="string"&&ia(I)&&!I.tokens&&(L=/^{([^}]+)}$/.exec(y)))return[new Be(l,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const z=[];return o.layerType==="symbol"&&(v==="text-field"&&f&&!f.glyphs&&z.push(new Be(l,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&gr(fi(y))&&Jt(y.type)==="identity"&&z.push(new Be(l,y,'"text-font" does not support identity functions'))),z.concat(yr({key:o.key,value:y,valueSpec:I,style:f,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:v}))}function us(o){return cc(o,"paint")}function uc(o){return cc(o,"layout")}function fc(o){let i=[];const l=o.value,f=o.key,p=o.style,y=o.styleSpec;l.type||l.ref||i.push(new Be(f,l,'either "type" or "ref" is required'));let v=Jt(l.type);const w=Jt(l.ref);if(l.id){const M=Jt(l.id);for(let I=0;I<o.arrayIndex;I++){const L=p.layers[I];Jt(L.id)===M&&i.push(new Be(f,l.id,`duplicate layer id "${l.id}", previously used at line ${L.id.__line__}`))}}if("ref"in l){let M;["type","source","source-layer","filter","layout"].forEach(I=>{I in l&&i.push(new Be(f,l[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{Jt(I.id)===w&&(M=I)}),M?M.ref?i.push(new Be(f,l.ref,"ref cannot reference another ref layer")):v=Jt(M.type):i.push(new Be(f,l.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(l.source){const M=p.sources&&p.sources[l.source],I=M&&Jt(M.type);M?I==="vector"&&v==="raster"?i.push(new Be(f,l.source,`layer "${l.id}" requires a raster source`)):I==="raster"&&v!=="raster"?i.push(new Be(f,l.source,`layer "${l.id}" requires a vector source`)):I!=="vector"||l["source-layer"]?I==="raster-dem"&&v!=="hillshade"?i.push(new Be(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!l.paint||!l.paint["line-gradient"]||I==="geojson"&&M.lineMetrics||i.push(new Be(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Be(f,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Be(f,l.source,`source "${l.source}" not found`))}else i.push(new Be(f,l,'missing required property "source"'));return i=i.concat(ji({key:f,value:l,valueSpec:y.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>yr({key:`${f}.type`,value:l.type,valueSpec:y.layer.type,style:o.style,styleSpec:o.styleSpec,object:l,objectKey:"type"}),filter:cs,layout:M=>ji({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>uc(Yi({layerType:v},I))}}),paint:M=>ji({layer:l,key:M.key,value:M.value,style:M.style,styleSpec:M.styleSpec,objectElementValidators:{"*":I=>us(Yi({layerType:v},I))}})}})),i}function ka(o){const i=o.value,l=o.key,f=Gt(i);return f!=="string"?[new Be(l,i,`string expected, ${f} found`)]:[]}const dc={promoteId:function({key:o,value:i}){if(Gt(i)==="string")return ka({key:o,value:i});{const l=[];for(const f in i)l.push(...ka({key:`${o}.${f}`,value:i[f]}));return l}}};function pc(o){const i=o.value,l=o.key,f=o.styleSpec,p=o.style;if(!i.type)return[new Be(l,i,'"type" is required')];const y=Jt(i.type);let v;switch(y){case"vector":case"raster":case"raster-dem":return v=ji({key:l,value:i,valueSpec:f[`source_${y.replace("-","_")}`],style:o.style,styleSpec:f,objectElementValidators:dc}),v;case"geojson":if(v=ji({key:l,value:i,valueSpec:f.source_geojson,style:p,styleSpec:f,objectElementValidators:dc}),i.cluster)for(const w in i.clusterProperties){const[M,I]=i.clusterProperties[w],L=typeof M=="string"?[M,["accumulated"],["get",w]]:M;v.push(...Pa({key:`${l}.${w}.map`,value:I,expressionContext:"cluster-map"})),v.push(...Pa({key:`${l}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return ji({key:l,value:i,valueSpec:f.source_video,style:p,styleSpec:f});case"image":return ji({key:l,value:i,valueSpec:f.source_image,style:p,styleSpec:f});case"canvas":return[new Be(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return to({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:f})}}function fs(o){const i=o.value,l=o.styleSpec,f=l.light,p=o.style;let y=[];const v=Gt(i);if(i===void 0)return y;if(v!=="object")return y=y.concat([new Be("light",i,`object expected, ${v} found`)]),y;for(const w in i){const M=w.match(/^(.*)-transition$/);y=y.concat(M&&f[M[1]]&&f[M[1]].transition?yr({key:w,value:i[w],valueSpec:l.transition,style:p,styleSpec:l}):f[w]?yr({key:w,value:i[w],valueSpec:f[w],style:p,styleSpec:l}):[new Be(w,i[w],`unknown property "${w}"`)])}return y}const ds={"*":()=>[],array:ac,boolean:function(o){const i=o.value,l=o.key,f=Gt(i);return f!=="boolean"?[new Be(l,i,`boolean expected, ${f} found`)]:[]},number:sc,color:function(o){const i=o.key,l=o.value,f=Gt(l);return f!=="string"?[new Be(i,l,`color expected, ${f} found`)]:An(l)===null?[new Be(i,l,`color expected, "${l}" found`)]:[]},constants:Yn,enum:to,filter:cs,function:oc,layer:fc,object:ji,source:pc,light:fs,string:ka,formatted:function(o){return ka(o).length===0?[]:Pa(o)},resolvedImage:function(o){return ka(o).length===0?[]:Pa(o)}};function yr(o){const i=o.value,l=o.valueSpec,f=o.styleSpec;return l.expression&&gr(Jt(i))?oc(o):l.expression&&Js(fi(i))?Pa(o):l.type&&ds[l.type]?ds[l.type](o):ji(Yi({},o,{valueSpec:l.type?f[l.type]:l}))}function oo(o){const i=o.value,l=o.key,f=ka(o);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new Be(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new Be(l,i,'"glyphs" url must include a "{range}" token'))),f}function aa(o,i=xe){let l=[];return l=l.concat(yr({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:oo,"*":()=>[]}})),o.constants&&(l=l.concat(Yn({key:"constants",value:o.constants,style:o,styleSpec:i}))),mc(l)}function mc(o){return[].concat(o).sort((i,l)=>i.line-l.line)}function Da(o){return function(...i){return mc(o.apply(this,i))}}aa.source=Da(pc),aa.light=Da(fs),aa.layer=Da(fc),aa.filter=Da(cs),aa.paintProperty=Da(us),aa.layoutProperty=Da(uc);const ps=aa,kl=ps.light,af=ps.paintProperty,Dl=ps.layoutProperty;function gc(o,i){let l=!1;if(i&&i.length)for(const f of i)o.fire(new Mn(new Error(f.message))),l=!0;return l}class ms{constructor(i,l,f){const p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const v=new Int32Array(this.arrayBuffer);i=v[0],this.d=(l=v[1])+2*(f=v[2]);for(let M=0;M<this.d*this.d;M++){const I=v[3+M],L=v[3+M+1];p.push(I===L?null:v.subarray(I,L))}const w=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=f,this.scale=l/i,this.uid=0;const y=f/l*i;this.min=-y,this.max=i+y}insert(i,l,f,p,y){this._forEachCell(l,f,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,f,p,y,v){this.cells[y].push(v)}query(i,l,f,p,y){const v=this.min,w=this.max;if(i<=v&&l<=v&&w<=f&&w<=p&&!y)return Array.prototype.slice.call(this.keys);{const M=[];return this._forEachCell(i,l,f,p,this._queryCell,M,{},y),M}}_queryCell(i,l,f,p,y,v,w,M){const I=this.cells[y];if(I!==null){const L=this.keys,z=this.bboxes;for(let B=0;B<I.length;B++){const G=I[B];if(w[G]===void 0){const V=4*G;(M?M(z[V+0],z[V+1],z[V+2],z[V+3]):i<=z[V+2]&&l<=z[V+3]&&f>=z[V+0]&&p>=z[V+1])?(w[G]=!0,v.push(L[G])):w[G]=!1}}}}_forEachCell(i,l,f,p,y,v,w,M){const I=this._convertToCellCoord(i),L=this._convertToCellCoord(l),z=this._convertToCellCoord(f),B=this._convertToCellCoord(p);for(let G=I;G<=z;G++)for(let V=L;V<=B;V++){const J=this.d*V+G;if((!M||M(this._convertFromCellCoord(G),this._convertFromCellCoord(V),this._convertFromCellCoord(G+1),this._convertFromCellCoord(V+1)))&&y.call(this,i,l,f,p,J,v,w,M))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let f=0;for(let v=0;v<this.cells.length;v++)f+=this.cells[v].length;const p=new Int32Array(l+f+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=l;for(let v=0;v<i.length;v++){const w=i[v];p[3+v]=y,p.set(w,y),y+=w.length}return p[3+i.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+i.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(i,l){const f=i.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(i){return new ms(i.buffer)}}const Pn={};function Xe(o,i,l={}){Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Pn[o]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}Xe("Object",Object),Xe("TransferableGridIndex",ms),Xe("Color",O),Xe("Error",Error),Xe("AJAXError",wi),Xe("ResolvedImage",ae),Xe("StylePropertyFunction",ls),Xe("StyleExpression",Cl,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",eo),Xe("ZoomConstantExpression",Il),Xe("CompoundExpression",gt,{omit:["_evaluate"]});for(const o in Aa)Aa[o]._classRegistryKey||Xe(`Expression_${o}`,Aa[o]);function Ll(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function La(o,i){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob)return o;if(Ll(o)||Ht(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const l=o;return i&&i.push(l.buffer),l}if(o instanceof ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const l=[];for(const f of o)l.push(La(f,i));return l}if(typeof o=="object"){const l=o.constructor,f=l._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");const p=l.serialize?l.serialize(o,i):{};if(!l.serialize){for(const y in o){if(!o.hasOwnProperty(y)||Pn[f].omit.indexOf(y)>=0)continue;const v=o[y];p[y]=Pn[f].shallow.indexOf(y)>=0?v:La(v,i)}o instanceof Error&&(p.message=o.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(p.$name=f),p}throw new Error("can't serialize object of type "+typeof o)}function gs(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||Ll(o)||Ht(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(gs);if(typeof o=="object"){const i=o.$name||"Object";if(!Pn[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=Pn[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(o);const f=Object.create(l.prototype);for(const p of Object.keys(o)){if(p==="$name")continue;const y=o[p];f[p]=Pn[i].shallow.indexOf(p)>=0?y:gs(y)}return f}throw new Error("can't deserialize object of type "+typeof o)}class lo{constructor(){this.first=!0}update(i,l){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const Fe={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function ho(o){for(const i of o)if(Ol(i.charCodeAt(0)))return!0;return!1}function sf(o){for(const i of o)if(!_c(i.charCodeAt(0)))return!1;return!0}function _c(o){return!(Fe.Arabic(o)||Fe["Arabic Supplement"](o)||Fe["Arabic Extended-A"](o)||Fe["Arabic Presentation Forms-A"](o)||Fe["Arabic Presentation Forms-B"](o))}function Ol(o){return!(o!==746&&o!==747&&(o<4352||!(Fe["Bopomofo Extended"](o)||Fe.Bopomofo(o)||Fe["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Fe["CJK Compatibility Ideographs"](o)||Fe["CJK Compatibility"](o)||Fe["CJK Radicals Supplement"](o)||Fe["CJK Strokes"](o)||!(!Fe["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Fe["CJK Unified Ideographs Extension A"](o)||Fe["CJK Unified Ideographs"](o)||Fe["Enclosed CJK Letters and Months"](o)||Fe["Hangul Compatibility Jamo"](o)||Fe["Hangul Jamo Extended-A"](o)||Fe["Hangul Jamo Extended-B"](o)||Fe["Hangul Jamo"](o)||Fe["Hangul Syllables"](o)||Fe.Hiragana(o)||Fe["Ideographic Description Characters"](o)||Fe.Kanbun(o)||Fe["Kangxi Radicals"](o)||Fe["Katakana Phonetic Extensions"](o)||Fe.Katakana(o)&&o!==12540||!(!Fe["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Fe["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Fe["Unified Canadian Aboriginal Syllabics"](o)||Fe["Unified Canadian Aboriginal Syllabics Extended"](o)||Fe["Vertical Forms"](o)||Fe["Yijing Hexagram Symbols"](o)||Fe["Yi Syllables"](o)||Fe["Yi Radicals"](o))))}function co(o){return!(Ol(o)||function(i){return!!(Fe["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Fe["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Fe["Letterlike Symbols"](i)||Fe["Number Forms"](i)||Fe["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Fe["Control Pictures"](i)&&i!==9251||Fe["Optical Character Recognition"](i)||Fe["Enclosed Alphanumerics"](i)||Fe["Geometric Shapes"](i)||Fe["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Fe["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Fe["CJK Symbols and Punctuation"](i)||Fe.Katakana(i)||Fe["Private Use Area"](i)||Fe["CJK Compatibility Forms"](i)||Fe["Small Form Variants"](i)||Fe["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}function yc(o){return o>=1424&&o<=2303||Fe["Arabic Presentation Forms-A"](o)||Fe["Arabic Presentation Forms-B"](o)}function of(o,i){return!(!i&&yc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Fe.Khmer(o))}function lf(o){for(const i of o)if(yc(i.charCodeAt(0)))return!0;return!1}const zl="deferred",uo="loading",Fl="loaded";let Bl=null,mi="unavailable",Rn=null;const vc=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(mi="error"),Bl&&Bl(o)};function Nl(){Ul.fire(new Tn("pluginStateChange",{pluginStatus:mi,pluginURL:Rn}))}const Ul=new Qa,Oa=function(){return mi},xc=function(){if(mi!==zl||!Rn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");mi=uo,Nl(),Rn&&En({url:Rn},o=>{o?vc(o):(mi=Fl,Nl())})},gi={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>mi===Fl||gi.applyArabicShaping!=null,isLoading:()=>mi===uo,setState(o){mi=o.pluginStatus,Rn=o.pluginURL},isParsed:()=>gi.applyArabicShaping!=null&&gi.processBidirectionalText!=null&&gi.processStyledBidirectionalText!=null,getPluginURL:()=>Rn};class Qt{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lo,this.transition={})}isSupportedScript(i){return function(l,f){for(const p of l)if(!of(p.charCodeAt(0),f))return!1;return!0}(i,gi.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class fo{constructor(i,l){this.property=i,this.value=l,this.expression=function(f,p){if(gr(f))return new ls(f,p);if(Js(f)){const y=Pl(f,p);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=f;return typeof f=="string"&&p.type==="color"&&(y=O.parse(f)),{kind:"constant",evaluate:()=>y}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,f){return this.property.possiblyEvaluate(this,i,l,f)}}class Gl{constructor(i){this.property=i,this.value=new fo(i,void 0)}transitioned(i,l){return new bc(this.property,this.value,l,j({},i.transition,this.transition),i.now)}untransitioned(){return new bc(this.property,this.value,null,{},0)}}class Vl{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return be(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Gl(this._values[i].property)),this._values[i].value=new fo(this._values[i].property,l===null?void 0:be(l))}getTransition(i){return be(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Gl(this._values[i].property)),this._values[i].transition=be(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f);const p=this.getTransition(l);p!==void 0&&(i[`${l}-transition`]=p)}return i}transitioned(i,l){const f=new wc(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].transitioned(i,l._values[p]);return f}untransitioned(){const i=new wc(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class bc{constructor(i,l,f,p,y){this.property=i,this.value=l,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,i.specification.transition&&(p.delay||p.duration)&&(this.prior=f)}possiblyEvaluate(i,l,f){const p=i.now||0,y=this.value.possiblyEvaluate(i,l,f),v=this.prior;if(v){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return v.possiblyEvaluate(i,l,f);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(i,l,f),y,function(M){if(M<=0)return 0;if(M>=1)return 1;const I=M*M,L=I*M;return 4*(M<.5?L:3*(M-I)+L-.75)}(w))}}return y}}class wc{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,f){const p=new po(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(i,l,f);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class hf{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return be(this._values[i].value)}setValue(i,l){this._values[i]=new fo(this._values[i].property,l===null?void 0:be(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f)}return i}possiblyEvaluate(i,l,f){const p=new po(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(i,l,f);return p}}class Qi{constructor(i,l,f){this.property=i,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,f,p){return this.property.evaluate(this.value,this.parameters,i,l,f,p)}}class po{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Je{constructor(i){this.specification=i}possiblyEvaluate(i,l){return i.expression.evaluate(l)}interpolate(i,l,f){const p=Xs[this.specification.type];return p?p(i,l,f):i}}class st{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,f,p){return new Qi(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},f,p)}:i.expression,l)}interpolate(i,l,f){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Qi(this,{kind:"constant",value:void 0},i.parameters);const p=Xs[this.specification.type];return p?new Qi(this,{kind:"constant",value:p(i.value.value,l.value.value,f)},i.parameters):i}evaluate(i,l,f,p,y,v){return i.kind==="constant"?i.value:i.evaluate(l,f,p,y,v)}}class za extends st{possiblyEvaluate(i,l,f,p){if(i.value===void 0)return new Qi(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const y=i.expression.evaluate(l,null,{},f,p),v=i.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,w=this._calculate(v,v,v,l);return new Qi(this,{kind:"constant",value:w},l)}if(i.expression.kind==="camera"){const y=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Qi(this,{kind:"constant",value:y},l)}return new Qi(this,i.expression,l)}evaluate(i,l,f,p,y,v){if(i.kind==="source"){const w=i.evaluate(l,f,p,y,v);return this._calculate(w,w,w,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},f,p),i.evaluate({zoom:Math.floor(l.zoom)},f,p),i.evaluate({zoom:Math.floor(l.zoom)+1},f,p),l):i.value}_calculate(i,l,f,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class mo{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,p){if(i.value!==void 0){if(i.expression.kind==="constant"){const y=i.expression.evaluate(l,null,{},f,p);return this._calculate(y,y,y,l)}return this._calculate(i.expression.evaluate(new Qt(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Qt(Math.floor(l.zoom),l)),i.expression.evaluate(new Qt(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,f,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class _s{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,p){return!!i.expression.evaluate(l,null,{},f,p)}interpolate(){return!1}}class _i{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const f=i[l];f.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new fo(f,void 0),y=this.defaultTransitionablePropertyValues[l]=new Gl(f);this.defaultTransitioningPropertyValues[l]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate({})}}}Xe("DataDrivenProperty",st),Xe("DataConstantProperty",Je),Xe("CrossFadedDataDrivenProperty",za),Xe("CrossFadedProperty",mo),Xe("ColorRampProperty",_s);const fn="-transition";class Mi extends Qa{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=(i=i).metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new hf(l.layout)),l.paint)){this._transitionablePaint=new Vl(l.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new po(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,f={}){l!=null&&this._validate(Dl,`layers.${this.id}.layout.${i}`,i,l,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(fn)?this._transitionablePaint.getTransition(i.slice(0,-fn.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,f={}){if(l!=null&&this._validate(af,`layers.${this.id}.paint.${i}`,i,l,f))return!1;if(i.endsWith(fn))return this._transitionablePaint.setTransition(i.slice(0,-fn.length),l||void 0),!1;{const p=this._transitionablePaint._values[i],y=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const M=this._transitionablePaint._values[i].value;return M.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(i,w,M)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ce(i,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(i,l,f,p,y={}){return(!y||y.validate!==!1)&&gc(this,i.call(ps,{key:l,layerType:this.type,objectKey:f,value:p,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Qi&&ia(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const ys={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class go{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ur(o,i=1){let l=0,f=0;return{members:o.map(p=>{const y=ys[p.type].BYTES_PER_ELEMENT,v=l=Ec(l,Math.max(i,y)),w=p.components||1;return f=Math.max(f,y),l+=y*w,{name:p.name,type:p.type,components:w,offset:v}}),size:Ec(l,Math.max(f,i)),alignment:i}}function Ec(o,i){return Math.ceil(o/i)*i}class vs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const p=2*i;return this.int16[p+0]=l,this.int16[p+1]=f,i}}vs.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",vs);class _o extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,f,p)}emplace(i,l,f,p,y){const v=4*i;return this.int16[v+0]=l,this.int16[v+1]=f,this.int16[v+2]=p,this.int16[v+3]=y,i}}_o.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",_o);class xs extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,p,y,v)}emplace(i,l,f,p,y,v,w){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.int16[M+2]=p,this.int16[M+3]=y,this.int16[M+4]=v,this.int16[M+5]=w,i}}xs.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4i12",xs);class m extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,p,y,v)}emplace(i,l,f,p,y,v,w){const M=4*i,I=8*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.uint8[I+4]=p,this.uint8[I+5]=y,this.uint8[I+6]=v,this.uint8[I+7]=w,i}}m.prototype.bytesPerElement=8,Xe("StructArrayLayout2i4ub8",m);class a extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const p=2*i;return this.float32[p+0]=l,this.float32[p+1]=f,i}}a.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",a);class c extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v,w,M,I,L){const z=this.length;return this.resize(z+1),this.emplace(z,i,l,f,p,y,v,w,M,I,L)}emplace(i,l,f,p,y,v,w,M,I,L,z){const B=10*i;return this.uint16[B+0]=l,this.uint16[B+1]=f,this.uint16[B+2]=p,this.uint16[B+3]=y,this.uint16[B+4]=v,this.uint16[B+5]=w,this.uint16[B+6]=M,this.uint16[B+7]=I,this.uint16[B+8]=L,this.uint16[B+9]=z,i}}c.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",c);class d extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v,w,M,I,L,z,B){const G=this.length;return this.resize(G+1),this.emplace(G,i,l,f,p,y,v,w,M,I,L,z,B)}emplace(i,l,f,p,y,v,w,M,I,L,z,B,G){const V=12*i;return this.int16[V+0]=l,this.int16[V+1]=f,this.int16[V+2]=p,this.int16[V+3]=y,this.uint16[V+4]=v,this.uint16[V+5]=w,this.uint16[V+6]=M,this.uint16[V+7]=I,this.int16[V+8]=L,this.int16[V+9]=z,this.int16[V+10]=B,this.int16[V+11]=G,i}}d.prototype.bytesPerElement=24,Xe("StructArrayLayout4i4ui4i24",d);class _ extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,f)}emplace(i,l,f,p){const y=3*i;return this.float32[y+0]=l,this.float32[y+1]=f,this.float32[y+2]=p,i}}_.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",_);class x extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}x.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",x);class E extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v,w,M,I){const L=this.length;return this.resize(L+1),this.emplace(L,i,l,f,p,y,v,w,M,I)}emplace(i,l,f,p,y,v,w,M,I,L){const z=10*i,B=5*i;return this.int16[z+0]=l,this.int16[z+1]=f,this.int16[z+2]=p,this.int16[z+3]=y,this.int16[z+4]=v,this.int16[z+5]=w,this.uint32[B+3]=M,this.uint16[z+8]=I,this.uint16[z+9]=L,i}}E.prototype.bytesPerElement=20,Xe("StructArrayLayout6i1ul2ui20",E);class S extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,p,y,v)}emplace(i,l,f,p,y,v,w){const M=6*i;return this.int16[M+0]=l,this.int16[M+1]=f,this.int16[M+2]=p,this.int16[M+3]=y,this.int16[M+4]=v,this.int16[M+5]=w,i}}S.prototype.bytesPerElement=12,Xe("StructArrayLayout2i2i2i12",S);class A extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,f,p,y)}emplace(i,l,f,p,y,v){const w=4*i,M=8*i;return this.float32[w+0]=l,this.float32[w+1]=f,this.float32[w+2]=p,this.int16[M+6]=y,this.int16[M+7]=v,i}}A.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",A);class D extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,f,p)}emplace(i,l,f,p,y){const v=12*i,w=3*i;return this.uint8[v+0]=l,this.uint8[v+1]=f,this.float32[w+1]=p,this.float32[w+2]=y,i}}D.prototype.bytesPerElement=12,Xe("StructArrayLayout2ub2f12",D);class F extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,f)}emplace(i,l,f,p){const y=3*i;return this.uint16[y+0]=l,this.uint16[y+1]=f,this.uint16[y+2]=p,i}}F.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",F);class N extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le){const de=this.length;return this.resize(de+1),this.emplace(de,i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le)}emplace(i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le,de){const fe=24*i,ye=12*i,Ce=48*i;return this.int16[fe+0]=l,this.int16[fe+1]=f,this.uint16[fe+2]=p,this.uint16[fe+3]=y,this.uint32[ye+2]=v,this.uint32[ye+3]=w,this.uint32[ye+4]=M,this.uint16[fe+10]=I,this.uint16[fe+11]=L,this.uint16[fe+12]=z,this.float32[ye+7]=B,this.float32[ye+8]=G,this.uint8[Ce+36]=V,this.uint8[Ce+37]=J,this.uint8[Ce+38]=ee,this.uint32[ye+10]=le,this.int16[fe+22]=de,i}}N.prototype.bytesPerElement=48,Xe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",N);class Z extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le,de,fe,ye,Ce,Te,je,et,Ue,Ge,Oe,Ze){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le,de,fe,ye,Ce,Te,je,et,Ue,Ge,Oe,Ze)}emplace(i,l,f,p,y,v,w,M,I,L,z,B,G,V,J,ee,le,de,fe,ye,Ce,Te,je,et,Ue,Ge,Oe,Ze,Ve){const Pe=34*i,at=17*i;return this.int16[Pe+0]=l,this.int16[Pe+1]=f,this.int16[Pe+2]=p,this.int16[Pe+3]=y,this.int16[Pe+4]=v,this.int16[Pe+5]=w,this.int16[Pe+6]=M,this.int16[Pe+7]=I,this.uint16[Pe+8]=L,this.uint16[Pe+9]=z,this.uint16[Pe+10]=B,this.uint16[Pe+11]=G,this.uint16[Pe+12]=V,this.uint16[Pe+13]=J,this.uint16[Pe+14]=ee,this.uint16[Pe+15]=le,this.uint16[Pe+16]=de,this.uint16[Pe+17]=fe,this.uint16[Pe+18]=ye,this.uint16[Pe+19]=Ce,this.uint16[Pe+20]=Te,this.uint16[Pe+21]=je,this.uint16[Pe+22]=et,this.uint32[at+12]=Ue,this.float32[at+13]=Ge,this.float32[at+14]=Oe,this.float32[at+15]=Ze,this.float32[at+16]=Ve,i}}Z.prototype.bytesPerElement=68,Xe("StructArrayLayout8i15ui1ul4f68",Z);class Y extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Y.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",Y);class q extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,f)}emplace(i,l,f,p){const y=3*i;return this.int16[y+0]=l,this.int16[y+1]=f,this.int16[y+2]=p,i}}q.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",q);class Q extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const p=this.length;return this.resize(p+1),this.emplace(p,i,l,f)}emplace(i,l,f,p){const y=4*i;return this.uint32[2*i+0]=l,this.uint16[y+2]=f,this.uint16[y+3]=p,i}}Q.prototype.bytesPerElement=8,Xe("StructArrayLayout1ul2ui8",Q);class ne extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const p=2*i;return this.uint16[p+0]=l,this.uint16[p+1]=f,i}}ne.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",ne);class se extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}se.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",se);class ue extends cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,l,f,p)}emplace(i,l,f,p,y){const v=4*i;return this.float32[v+0]=l,this.float32[v+1]=f,this.float32[v+2]=p,this.float32[v+3]=y,i}}ue.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",ue);class he extends go{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new qe(this.anchorPointX,this.anchorPointY)}}he.prototype.size=20;class Ee extends E{get(i){return new he(this,i)}}Xe("CollisionBoxArray",Ee);class pe extends go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}pe.prototype.size=48;class ve extends N{get(i){return new pe(this,i)}}Xe("PlacedSymbolArray",ve);class Ie extends go{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Ie.prototype.size=68;class Re extends Z{get(i){return new Ie(this,i)}}Xe("SymbolInstanceArray",Re);class Me extends Y{getoffsetX(i){return this.float32[1*i+0]}}Xe("GlyphOffsetArray",Me);class We extends q{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Xe("SymbolLineVertexArray",We);class $e extends go{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$e.prototype.size=8;class ht extends Q{get(i){return new $e(this,i)}}Xe("FeatureIndexArray",ht);class Dt extends vs{}class vt extends vs{}class xt extends xs{}class fr extends m{}class ut extends a{}class Tt extends c{}class sr extends d{}class Vr extends _{}class Si extends x{}class Ai extends S{}class Zi extends D{}class Ci extends F{}class qi extends ne{}const kn=ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:sa}=kn;class Vt{constructor(i=[]){this.segments=i}prepareSegment(i,l,f,p){let y=this.segments[this.segments.length-1];return i>Vt.MAX_VERTEX_ARRAY_LENGTH&&Ae(`Max vertices per segment is ${Vt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>Vt.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,f,p){return new Vt([{vertexOffset:i,primitiveOffset:l,vertexLength:f,primitiveLength:p,vaos:{},sortKey:0}])}}function Dr(o,i){return 256*(o=R(Math.floor(o),0,255))+R(Math.floor(i),0,255)}Vt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",Vt);const kt=ur([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mr={exports:{}},Ii={exports:{}};Ii.exports=function(o,i){var l,f,p,y,v,w,M,I;for(f=o.length-(l=3&o.length),p=i,v=3432918353,w=461845907,I=0;I<f;)M=255&o.charCodeAt(I)|(255&o.charCodeAt(++I))<<8|(255&o.charCodeAt(++I))<<16|(255&o.charCodeAt(++I))<<24,++I,p=27492+(65535&(y=5*(65535&(p=(p^=M=(65535&(M=(M=(65535&M)*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&o.charCodeAt(I+2))<<16;case 2:M^=(255&o.charCodeAt(I+1))<<8;case 1:p^=M=(65535&(M=(M=(65535&(M^=255&o.charCodeAt(I)))*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*w+(((M>>>16)*w&65535)<<16)&4294967295}return p^=o.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var er={exports:{}};er.exports=function(o,i){for(var l,f=o.length,p=i^f,y=0;f>=4;)l=1540483477*(65535&(l=255&o.charCodeAt(y)|(255&o.charCodeAt(++y))<<8|(255&o.charCodeAt(++y))<<16|(255&o.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&o.charCodeAt(y+2))<<16;case 2:p^=(255&o.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&o.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var oa=Ii.exports,la=er.exports;Mr.exports=oa,Mr.exports.murmur3=oa,Mr.exports.murmur2=la;var Fa=Mr.exports;class yo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,f,p){this.ids.push(Tc(i)),this.positions.push(l,f,p)}getPositions(i){const l=Tc(i);let f=0,p=this.ids.length-1;for(;f<p;){const v=f+p>>1;this.ids[v]>=l?p=v:f=v+1}const y=[];for(;this.ids[f]===l;)y.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return y}static serialize(i,l){const f=new Float64Array(i.ids),p=new Uint32Array(i.positions);return $l(f,p,0,f.length-1),l&&l.push(f.buffer,p.buffer),{ids:f,positions:p}}static deserialize(i){const l=new yo;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function Tc(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Fa(String(o))}function $l(o,i,l,f){for(;l<f;){const p=o[l+f>>1];let y=l-1,v=f+1;for(;;){do y++;while(o[y]<p);do v--;while(o[v]>p);if(y>=v)break;Dn(o,y,v),Dn(i,3*y,3*v),Dn(i,3*y+1,3*v+1),Dn(i,3*y+2,3*v+2)}v-l<f-v?($l(o,i,l,v),l=v+1):($l(o,i,v+1,f),f=v)}}function Dn(o,i,l){const f=o[i];o[i]=o[l],o[l]=f}Xe("FeaturePositionMap",yo);class ha{constructor(i,l){this.gl=i.gl,this.location=l}}class ca extends ha{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class vo extends ha{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class wp extends ha{constructor(i,l){super(i,l),this.current=O.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const a0=new Float32Array(16);function cf(o){return[Dr(255*o.r,255*o.g),Dr(255*o.b,255*o.a)]}class jl{constructor(i,l,f){this.value=i,this.uniformNames=l.map(p=>`u_${p}`),this.type=f}setUniform(i,l,f){i.set(f.constantOr(this.value))}getBinding(i,l,f){return this.type==="color"?new wp(i,l):new ca(i,l)}}class xo{constructor(i,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,f,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&i.set(y)}getBinding(i,l,f){return f.substr(0,9)==="u_pattern"?new vo(i,l):new ca(i,l)}}class ua{constructor(i,l,f,p){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(y=>({name:`a_${y}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,l,f,p,y){const v=this.paintVertexArray.length,w=this.expression.evaluate(new Qt(0),l,{},p,[],y);this.paintVertexArray.resize(i),this._setPaintValue(v,i,w)}updatePaintArray(i,l,f,p){const y=this.expression.evaluate({zoom:0},f,p);this._setPaintValue(i,l,y)}_setPaintValue(i,l,f){if(this.type==="color"){const p=cf(f);for(let y=i;y<l;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=i;p<l;p++)this.paintVertexArray.emplace(p,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dn{constructor(i,l,f,p,y,v){this.expression=i,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=f,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,l,f,p,y){const v=this.expression.evaluate(new Qt(this.zoom),l,{},p,[],y),w=this.expression.evaluate(new Qt(this.zoom+1),l,{},p,[],y),M=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(M,i,v,w)}updatePaintArray(i,l,f,p){const y=this.expression.evaluate({zoom:this.zoom},f,p),v=this.expression.evaluate({zoom:this.zoom+1},f,p);this._setPaintValue(i,l,y,v)}_setPaintValue(i,l,f,p){if(this.type==="color"){const y=cf(f),v=cf(p);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,y[0],y[1],v[0],v[1])}else{for(let y=i;y<l;y++)this.paintVertexArray.emplace(y,f,p);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,p=R(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(p)}getBinding(i,l,f){return new ca(i,l)}}class Ba{constructor(i,l,f,p,y,v){this.expression=i,this.type=l,this.useIntegerZoom=f,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(i,l,f){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(p,i,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(i,l,f,p,y){this._setPaintValues(i,l,f.patterns&&f.patterns[this.layerId],y)}_setPaintValues(i,l,f,p){if(!p||!f)return;const{min:y,mid:v,max:w}=f,M=p[y],I=p[v],L=p[w];if(M&&I&&L)for(let z=i;z<l;z++)this.zoomInPaintVertexArray.emplace(z,I.tl[0],I.tl[1],I.br[0],I.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],I.pixelRatio,M.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,I.tl[0],I.tl[1],I.br[0],I.br[1],L.tl[0],L.tl[1],L.br[0],L.br[1],I.pixelRatio,L.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ep{constructor(i,l,f){this.binders={},this._buffers=[];const p=[];for(const y in i.paint._values){if(!f(y))continue;const v=i.paint.get(y);if(!(v instanceof Qi&&ia(v.property.specification)))continue;const w=s0(y,i.type),M=v.value,I=v.property.specification.type,L=v.property.useIntegerZoom,z=v.property.specification["property-type"],B=z==="cross-faded"||z==="cross-faded-data-driven";if(M.kind==="constant")this.binders[y]=B?new xo(M.value,w):new jl(M.value,w,I),p.push(`/u_${y}`);else if(M.kind==="source"||B){const G=Tp(y,I,"source");this.binders[y]=B?new Ba(M,I,L,l,G,i.id):new ua(M,w,I,G),p.push(`/a_${y}`)}else{const G=Tp(y,I,"composite");this.binders[y]=new dn(M,w,I,L,l,G),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof ua||l instanceof dn?l.maxValue:0}populatePaintArrays(i,l,f,p,y){for(const v in this.binders){const w=this.binders[v];(w instanceof ua||w instanceof dn||w instanceof Ba)&&w.populatePaintArray(i,l,f,p,y)}}setConstantPatternPositions(i,l){for(const f in this.binders){const p=this.binders[f];p instanceof xo&&p.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,f,p,y){let v=!1;for(const w in i){const M=l.getPositions(w);for(const I of M){const L=f.feature(I.index);for(const z in this.binders){const B=this.binders[z];if((B instanceof ua||B instanceof dn||B instanceof Ba)&&B.expression.isStateDependent===!0){const G=p.paint.get(z);B.expression=G.value,B.updatePaintArray(I.start,I.end,L,i[w],y),v=!0}}}}return v}defines(){const i=[];for(const l in this.binders){const f=this.binders[l];(f instanceof jl||f instanceof xo)&&i.push(...f.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof ua||f instanceof dn)for(let p=0;p<f.paintVertexAttributes.length;p++)i.push(f.paintVertexAttributes[p].name);else if(f instanceof Ba)for(let p=0;p<kt.members.length;p++)i.push(kt.members[p].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof jl||f instanceof xo||f instanceof dn)for(const p of f.uniformNames)i.push(p)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const f=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof jl||y instanceof xo||y instanceof dn){for(const v of y.uniformNames)if(l[v]){const w=y.getBinding(i,l[v],v);f.push({name:v,property:p,binding:w})}}}return f}setUniforms(i,l,f,p){for(const{name:y,property:v,binding:w}of l)this.binders[v].setUniform(w,p,f.get(v),y)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(i&&f instanceof Ba){const p=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(f instanceof ua||f instanceof dn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const l in this.binders){const f=this.binders[l];(f instanceof ua||f instanceof dn||f instanceof Ba)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof ua||l instanceof dn||l instanceof Ba)&&l.destroy()}}}class bs{constructor(i,l,f=()=>!0){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new Ep(p,l,f);this.needsUpload=!1,this._featureMap=new yo,this._bufferOffset=0}populatePaintArrays(i,l,f,p,y,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,l,p,y,v);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,f,p){for(const y of f)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(i,this._featureMap,l,y,p)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function s0(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function Tp(o,i,l){const f={color:{source:a,composite:ue},number:{source:Y,composite:a}},p=function(y){return{"line-pattern":{source:Tt,composite:Tt},"fill-pattern":{source:Tt,composite:Tt},"fill-extrusion-pattern":{source:Tt,composite:Tt}}[y]}(o);return p&&p[l]||f[i][l]}Xe("ConstantBinder",jl),Xe("CrossFadedConstantBinder",xo),Xe("SourceExpressionBinder",ua),Xe("CrossFadedCompositeBinder",Ba),Xe("CompositeExpressionBinder",dn),Xe("ProgramConfiguration",Ep,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",bs);var Lr=8192;const uf=Math.pow(2,14)-1,Mp=-uf-1;function ws(o){const i=Lr/o.extent,l=o.loadGeometry();for(let f=0;f<l.length;f++){const p=l[f];for(let y=0;y<p.length;y++){const v=p[y],w=Math.round(v.x*i),M=Math.round(v.y*i);v.x=R(w,Mp,uf),v.y=R(M,Mp,uf),(w<v.x||w>v.x+1||M<v.y||M>v.y+1)&&Ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Es(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?ws(o):[]}}function Mc(o,i,l,f,p){o.emplaceBack(2*i+(f+1)/2,2*l+(p+1)/2)}class ff{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Dt,this.indexArray=new Ci,this.segments=new Vt,this.programConfigurations=new bs(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){const p=this.layers[0],y=[];let v=null,w=!1;p.type==="circle"&&(v=p.layout.get("circle-sort-key"),w=!v.isConstant());for(const{feature:M,id:I,index:L,sourceLayerIndex:z}of i){const B=this.layers[0]._featureFilter.needGeometry,G=Es(M,B);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),G,f))continue;const V=w?v.evaluate(G,{},f):void 0,J={id:I,properties:M.properties,type:M.type,sourceLayerIndex:z,index:L,geometry:B?G.geometry:ws(M),patterns:{},sortKey:V};y.push(J)}w&&y.sort((M,I)=>M.sortKey-I.sortKey);for(const M of y){const{geometry:I,index:L,sourceLayerIndex:z}=M,B=i[L].feature;this.addFeature(M,I,L,f),l.featureIndex.insert(B,I,L,z,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,sa),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,f,p){for(const y of l)for(const v of y){const w=v.x,M=v.y;if(w<0||w>=Lr||M<0||M>=Lr)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),L=I.vertexLength;Mc(this.layoutVertexArray,w,M,-1,-1),Mc(this.layoutVertexArray,w,M,1,-1),Mc(this.layoutVertexArray,w,M,1,1),Mc(this.layoutVertexArray,w,M,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+3,L+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},p)}}function Sp(o,i){for(let l=0;l<o.length;l++)if(bo(i,o[l]))return!0;for(let l=0;l<i.length;l++)if(bo(o,i[l]))return!0;return!!df(o,i)}function o0(o,i,l){return!!bo(o,i)||!!pf(i,o,l)}function Ap(o,i){if(o.length===1)return Ip(i,o[0]);for(let l=0;l<i.length;l++){const f=i[l];for(let p=0;p<f.length;p++)if(bo(o,f[p]))return!0}for(let l=0;l<o.length;l++)if(Ip(i,o[l]))return!0;for(let l=0;l<i.length;l++)if(df(o,i[l]))return!0;return!1}function l0(o,i,l){if(o.length>1){if(df(o,i))return!0;for(let f=0;f<i.length;f++)if(pf(i[f],o,l))return!0}for(let f=0;f<o.length;f++)if(pf(o[f],i,l))return!0;return!1}function df(o,i){if(o.length===0||i.length===0)return!1;for(let l=0;l<o.length-1;l++){const f=o[l],p=o[l+1];for(let y=0;y<i.length-1;y++)if(h0(f,p,i[y],i[y+1]))return!0}return!1}function h0(o,i,l,f){return De(o,l,f)!==De(i,l,f)&&De(o,i,l)!==De(o,i,f)}function pf(o,i,l){const f=l*l;if(i.length===1)return o.distSqr(i[0])<f;for(let p=1;p<i.length;p++)if(Cp(o,i[p-1],i[p])<f)return!0;return!1}function Cp(o,i,l){const f=i.distSqr(l);if(f===0)return o.distSqr(i);const p=((o.x-i.x)*(l.x-i.x)+(o.y-i.y)*(l.y-i.y))/f;return o.distSqr(p<0?i:p>1?l:l.sub(i)._mult(p)._add(i))}function Ip(o,i){let l,f,p,y=!1;for(let v=0;v<o.length;v++){l=o[v];for(let w=0,M=l.length-1;w<l.length;M=w++)f=l[w],p=l[M],f.y>i.y!=p.y>i.y&&i.x<(p.x-f.x)*(i.y-f.y)/(p.y-f.y)+f.x&&(y=!y)}return y}function bo(o,i){let l=!1;for(let f=0,p=o.length-1;f<o.length;p=f++){const y=o[f],v=o[p];y.y>i.y!=v.y>i.y&&i.x<(v.x-y.x)*(i.y-y.y)/(v.y-y.y)+y.x&&(l=!l)}return l}function c0(o,i,l){const f=l[0],p=l[2];if(o.x<f.x&&i.x<f.x||o.x>p.x&&i.x>p.x||o.y<f.y&&i.y<f.y||o.y>p.y&&i.y>p.y)return!1;const y=De(o,i,l[0]);return y!==De(o,i,l[1])||y!==De(o,i,l[2])||y!==De(o,i,l[3])}function Zl(o,i,l){const f=i.paint.get(o).value;return f.kind==="constant"?f.value:l.programConfigurations.get(i.id).getMaxValue(o)}function Sc(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ac(o,i,l,f,p){if(!i[0]&&!i[1])return o;const y=qe.convert(i)._mult(p);l==="viewport"&&y._rotate(-f);const v=[];for(let w=0;w<o.length;w++)v.push(o[w].sub(y));return v}Xe("CircleBucket",ff,{omit:["layers"]});const u0=new _i({"circle-sort-key":new st(xe.layout_circle["circle-sort-key"])});var f0={paint:new _i({"circle-radius":new st(xe.paint_circle["circle-radius"]),"circle-color":new st(xe.paint_circle["circle-color"]),"circle-blur":new st(xe.paint_circle["circle-blur"]),"circle-opacity":new st(xe.paint_circle["circle-opacity"]),"circle-translate":new Je(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new Je(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Je(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Je(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(xe.paint_circle["circle-stroke-opacity"])}),layout:u0},Ts=typeof Float32Array!="undefined"?Float32Array:Array;function mf(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Pp(o,i,l){var f=i[0],p=i[1],y=i[2],v=i[3],w=i[4],M=i[5],I=i[6],L=i[7],z=i[8],B=i[9],G=i[10],V=i[11],J=i[12],ee=i[13],le=i[14],de=i[15],fe=l[0],ye=l[1],Ce=l[2],Te=l[3];return o[0]=fe*f+ye*w+Ce*z+Te*J,o[1]=fe*p+ye*M+Ce*B+Te*ee,o[2]=fe*y+ye*I+Ce*G+Te*le,o[3]=fe*v+ye*L+Ce*V+Te*de,o[4]=(fe=l[4])*f+(ye=l[5])*w+(Ce=l[6])*z+(Te=l[7])*J,o[5]=fe*p+ye*M+Ce*B+Te*ee,o[6]=fe*y+ye*I+Ce*G+Te*le,o[7]=fe*v+ye*L+Ce*V+Te*de,o[8]=(fe=l[8])*f+(ye=l[9])*w+(Ce=l[10])*z+(Te=l[11])*J,o[9]=fe*p+ye*M+Ce*B+Te*ee,o[10]=fe*y+ye*I+Ce*G+Te*le,o[11]=fe*v+ye*L+Ce*V+Te*de,o[12]=(fe=l[12])*f+(ye=l[13])*w+(Ce=l[14])*z+(Te=l[15])*J,o[13]=fe*p+ye*M+Ce*B+Te*ee,o[14]=fe*y+ye*I+Ce*G+Te*le,o[15]=fe*v+ye*L+Ce*V+Te*de,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var d0=Pp;function gf(){var o=new Ts(4);return Ts!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function Cc(o,i,l,f){var p=new Ts(4);return p[0]=o,p[1]=i,p[2]=l,p[3]=f,p}function Ic(o,i,l){var f=i[0],p=i[1],y=i[2],v=i[3];return o[0]=l[0]*f+l[4]*p+l[8]*y+l[12]*v,o[1]=l[1]*f+l[5]*p+l[9]*y+l[13]*v,o[2]=l[2]*f+l[6]*p+l[10]*y+l[14]*v,o[3]=l[3]*f+l[7]*p+l[11]*y+l[15]*v,o}function Rp(o,i){const l=Ic(gf(),Cc(o.x,o.y,0,1),i);return new qe(l[0]/l[3],l[1]/l[3])}gf();class kp extends ff{}Xe("HeatmapBucket",kp,{omit:["layers"]});var p0={paint:new _i({"heatmap-radius":new st(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Je(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _s(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Je(xe.paint_heatmap["heatmap-opacity"])})};function _f(o,{width:i,height:l},f,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*l*f)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${i*l*f}`)}else p=new Uint8Array(i*l*f);return o.width=i,o.height=l,o.data=p,o}function Dp(o,{width:i,height:l},f){if(i===o.width&&l===o.height)return;const p=_f({},{width:i,height:l},f);yf(o,p,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,l)},f),o.width=i,o.height=l,o.data=p.data}function yf(o,i,l,f,p,y){if(p.width===0||p.height===0)return i;if(p.width>o.width||p.height>o.height||l.x>o.width-p.width||l.y>o.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||f.x>i.width-p.width||f.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=o.data,w=i.data;for(let M=0;M<p.height;M++){const I=((l.y+M)*o.width+l.x)*y,L=((f.y+M)*i.width+f.x)*y;for(let z=0;z<p.width*y;z++)w[L+z]=v[I+z]}return i}class ql{constructor(i,l){_f(this,i,1,l)}resize(i){Dp(this,i,1)}clone(){return new ql({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,p,y){yf(i,l,f,p,y,1)}}class Xi{constructor(i,l){_f(this,i,4,l)}resize(i){Dp(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,p,y){yf(i,l,f,p,y,4)}}function Lp(o){const i={},l=o.resolution||256,f=o.clips?o.clips.length:1,p=o.image||new Xi({width:l,height:f}),y=(v,w,M)=>{i[o.evaluationKey]=M;const I=o.expression.evaluate(i);p.data[v+w+0]=Math.floor(255*I.r/I.a),p.data[v+w+1]=Math.floor(255*I.g/I.a),p.data[v+w+2]=Math.floor(255*I.b/I.a),p.data[v+w+3]=Math.floor(255*I.a)};if(o.clips)for(let v=0,w=0;v<f;++v,w+=4*l)for(let M=0,I=0;M<l;M++,I+=4){const L=M/(l-1),{start:z,end:B}=o.clips[v];y(w,I,z*(1-L)+B*L)}else for(let v=0,w=0;v<l;v++,w+=4)y(0,w,v/(l-1));return p}Xe("AlphaImage",ql),Xe("RGBAImage",Xi);var m0={paint:new _i({"hillshade-illumination-direction":new Je(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Je(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Je(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Je(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Je(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Je(xe.paint_hillshade["hillshade-accent-color"])})};const g0=ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:_0}=g0;var vf={exports:{}};function Pc(o,i,l){l=l||2;var f,p,y,v,w,M,I,L=i&&i.length,z=L?i[0]*l:o.length,B=Op(o,0,z,l,!0),G=[];if(!B||B.next===B.prev)return G;if(L&&(B=function(J,ee,le,de){var fe,ye,Ce,Te=[];for(fe=0,ye=ee.length;fe<ye;fe++)(Ce=Op(J,ee[fe]*de,fe<ye-1?ee[fe+1]*de:J.length,de,!1))===Ce.next&&(Ce.steiner=!0),Te.push(M0(Ce));for(Te.sort(w0),fe=0;fe<Te.length;fe++)le=Na(le=E0(Te[fe],le),le.next);return le}(o,i,B,l)),o.length>80*l){f=y=o[0],p=v=o[1];for(var V=l;V<z;V+=l)(w=o[V])<f&&(f=w),(M=o[V+1])<p&&(p=M),w>y&&(y=w),M>v&&(v=M);I=(I=Math.max(y-f,v-p))!==0?1/I:0}return Xl(B,G,l,f,p,I),G}function Op(o,i,l,f,p){var y,v;if(p===wf(o,i,l,f)>0)for(y=i;y<l;y+=f)v=Bp(y,o[y],o[y+1],v);else for(y=l-f;y>=i;y-=f)v=Bp(y,o[y],o[y+1],v);return v&&Rc(v,v.next)&&(Hl(v),v=v.next),v}function Na(o,i){if(!o)return o;i||(i=o);var l,f=o;do if(l=!1,f.steiner||!Rc(f,f.next)&&br(f.prev,f,f.next)!==0)f=f.next;else{if(Hl(f),(f=i=f.prev)===f.next)break;l=!0}while(l||f!==i);return i}function Xl(o,i,l,f,p,y,v){if(o){!v&&y&&function(L,z,B,G){var V=L;do V.z===null&&(V.z=xf(V.x,V.y,z,B,G)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==L);V.prevZ.nextZ=null,V.prevZ=null,function(J){var ee,le,de,fe,ye,Ce,Te,je,et=1;do{for(le=J,J=null,ye=null,Ce=0;le;){for(Ce++,de=le,Te=0,ee=0;ee<et&&(Te++,de=de.nextZ);ee++);for(je=et;Te>0||je>0&&de;)Te!==0&&(je===0||!de||le.z<=de.z)?(fe=le,le=le.nextZ,Te--):(fe=de,de=de.nextZ,je--),ye?ye.nextZ=fe:J=fe,fe.prevZ=ye,ye=fe;le=de}ye.nextZ=null,et*=2}while(Ce>1)}(V)}(o,f,p,y);for(var w,M,I=o;o.prev!==o.next;)if(w=o.prev,M=o.next,y?v0(o,f,p,y):y0(o))i.push(w.i/l),i.push(o.i/l),i.push(M.i/l),Hl(o),o=M.next,I=M.next;else if((o=M)===I){v?v===1?Xl(o=x0(Na(o),i,l),i,l,f,p,y,2):v===2&&b0(o,i,l,f,p,y):Xl(Na(o),i,l,f,p,y,1);break}}}function y0(o){var i=o.prev,l=o,f=o.next;if(br(i,l,f)>=0)return!1;for(var p=o.next.next;p!==o.prev;){if(wo(i.x,i.y,l.x,l.y,f.x,f.y,p.x,p.y)&&br(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function v0(o,i,l,f){var p=o.prev,y=o,v=o.next;if(br(p,y,v)>=0)return!1;for(var w=p.x>y.x?p.x>v.x?p.x:v.x:y.x>v.x?y.x:v.x,M=p.y>y.y?p.y>v.y?p.y:v.y:y.y>v.y?y.y:v.y,I=xf(p.x<y.x?p.x<v.x?p.x:v.x:y.x<v.x?y.x:v.x,p.y<y.y?p.y<v.y?p.y:v.y:y.y<v.y?y.y:v.y,i,l,f),L=xf(w,M,i,l,f),z=o.prevZ,B=o.nextZ;z&&z.z>=I&&B&&B.z<=L;){if(z!==o.prev&&z!==o.next&&wo(p.x,p.y,y.x,y.y,v.x,v.y,z.x,z.y)&&br(z.prev,z,z.next)>=0||(z=z.prevZ,B!==o.prev&&B!==o.next&&wo(p.x,p.y,y.x,y.y,v.x,v.y,B.x,B.y)&&br(B.prev,B,B.next)>=0))return!1;B=B.nextZ}for(;z&&z.z>=I;){if(z!==o.prev&&z!==o.next&&wo(p.x,p.y,y.x,y.y,v.x,v.y,z.x,z.y)&&br(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;B&&B.z<=L;){if(B!==o.prev&&B!==o.next&&wo(p.x,p.y,y.x,y.y,v.x,v.y,B.x,B.y)&&br(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function x0(o,i,l){var f=o;do{var p=f.prev,y=f.next.next;!Rc(p,y)&&zp(p,f,f.next,y)&&Kl(p,y)&&Kl(y,p)&&(i.push(p.i/l),i.push(f.i/l),i.push(y.i/l),Hl(f),Hl(f.next),f=o=y),f=f.next}while(f!==o);return Na(f)}function b0(o,i,l,f,p,y){var v=o;do{for(var w=v.next.next;w!==v.prev;){if(v.i!==w.i&&S0(v,w)){var M=Fp(v,w);return v=Na(v,v.next),M=Na(M,M.next),Xl(v,i,l,f,p,y),void Xl(M,i,l,f,p,y)}w=w.next}v=v.next}while(v!==o)}function w0(o,i){return o.x-i.x}function E0(o,i){var l=function(y,v){var w,M=v,I=y.x,L=y.y,z=-1/0;do{if(L<=M.y&&L>=M.next.y&&M.next.y!==M.y){var B=M.x+(L-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(B<=I&&B>z){if(z=B,B===I){if(L===M.y)return M;if(L===M.next.y)return M.next}w=M.x<M.next.x?M:M.next}}M=M.next}while(M!==v);if(!w)return null;if(I===z)return w;var G,V=w,J=w.x,ee=w.y,le=1/0;M=w;do I>=M.x&&M.x>=J&&I!==M.x&&wo(L<ee?I:z,L,J,ee,L<ee?z:I,L,M.x,M.y)&&(G=Math.abs(L-M.y)/(I-M.x),Kl(M,y)&&(G<le||G===le&&(M.x>w.x||M.x===w.x&&T0(w,M)))&&(w=M,le=G)),M=M.next;while(M!==V);return w}(o,i);if(!l)return i;var f=Fp(l,o),p=Na(l,l.next);return Na(f,f.next),i===l?p:i}function T0(o,i){return br(o.prev,o,i.prev)<0&&br(i.next,o,o.next)<0}function xf(o,i,l,f,p){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-l)*p)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-f)*p)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function M0(o){var i=o,l=o;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==o);return l}function wo(o,i,l,f,p,y,v,w){return(p-v)*(i-w)-(o-v)*(y-w)>=0&&(o-v)*(f-w)-(l-v)*(i-w)>=0&&(l-v)*(y-w)-(p-v)*(f-w)>=0}function S0(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(l,f){var p=l;do{if(p.i!==l.i&&p.next.i!==l.i&&p.i!==f.i&&p.next.i!==f.i&&zp(p,p.next,l,f))return!0;p=p.next}while(p!==l);return!1}(o,i)&&(Kl(o,i)&&Kl(i,o)&&function(l,f){var p=l,y=!1,v=(l.x+f.x)/2,w=(l.y+f.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&v<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==l);return y}(o,i)&&(br(o.prev,o,i.prev)||br(o,i.prev,i))||Rc(o,i)&&br(o.prev,o,o.next)>0&&br(i.prev,i,i.next)>0)}function br(o,i,l){return(i.y-o.y)*(l.x-i.x)-(i.x-o.x)*(l.y-i.y)}function Rc(o,i){return o.x===i.x&&o.y===i.y}function zp(o,i,l,f){var p=Dc(br(o,i,l)),y=Dc(br(o,i,f)),v=Dc(br(l,f,o)),w=Dc(br(l,f,i));return p!==y&&v!==w||!(p!==0||!kc(o,l,i))||!(y!==0||!kc(o,f,i))||!(v!==0||!kc(l,o,f))||!(w!==0||!kc(l,i,f))}function kc(o,i,l){return i.x<=Math.max(o.x,l.x)&&i.x>=Math.min(o.x,l.x)&&i.y<=Math.max(o.y,l.y)&&i.y>=Math.min(o.y,l.y)}function Dc(o){return o>0?1:o<0?-1:0}function Kl(o,i){return br(o.prev,o,o.next)<0?br(o,i,o.next)>=0&&br(o,o.prev,i)>=0:br(o,i,o.prev)<0||br(o,o.next,i)<0}function Fp(o,i){var l=new bf(o.i,o.x,o.y),f=new bf(i.i,i.x,i.y),p=o.next,y=i.prev;return o.next=i,i.prev=o,l.next=p,p.prev=l,f.next=l,l.prev=f,y.next=f,f.prev=y,f}function Bp(o,i,l,f){var p=new bf(o,i,l);return f?(p.next=f.next,p.prev=f,f.next.prev=p,f.next=p):(p.prev=p,p.next=p),p}function Hl(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function bf(o,i,l){this.i=o,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wf(o,i,l,f){for(var p=0,y=i,v=l-f;y<l;y+=f)p+=(o[v]-o[y])*(o[y+1]+o[v+1]),v=y;return p}vf.exports=Pc,vf.exports.default=Pc,Pc.deviation=function(o,i,l,f){var p=i&&i.length,y=Math.abs(wf(o,0,p?i[0]*l:o.length,l));if(p)for(var v=0,w=i.length;v<w;v++)y-=Math.abs(wf(o,i[v]*l,v<w-1?i[v+1]*l:o.length,l));var M=0;for(v=0;v<f.length;v+=3){var I=f[v]*l,L=f[v+1]*l,z=f[v+2]*l;M+=Math.abs((o[I]-o[z])*(o[L+1]-o[I+1])-(o[I]-o[L])*(o[z+1]-o[I+1]))}return y===0&&M===0?0:Math.abs((M-y)/y)},Pc.flatten=function(o){for(var i=o[0][0].length,l={vertices:[],holes:[],dimensions:i},f=0,p=0;p<o.length;p++){for(var y=0;y<o[p].length;y++)for(var v=0;v<i;v++)l.vertices.push(o[p][y][v]);p>0&&l.holes.push(f+=o[p-1].length)}return l};var Np=vf.exports;function A0(o,i,l,f,p){Up(o,i,l||0,f||o.length-1,p||C0)}function Up(o,i,l,f,p){for(;f>l;){if(f-l>600){var y=f-l+1,v=i-l+1,w=Math.log(y),M=.5*Math.exp(2*w/3),I=.5*Math.sqrt(w*M*(y-M)/y)*(v-y/2<0?-1:1);Up(o,i,Math.max(l,Math.floor(i-v*M/y+I)),Math.min(f,Math.floor(i+(y-v)*M/y+I)),p)}var L=o[i],z=l,B=f;for(Wl(o,l,i),p(o[f],L)>0&&Wl(o,l,f);z<B;){for(Wl(o,z,B),z++,B--;p(o[z],L)<0;)z++;for(;p(o[B],L)>0;)B--}p(o[l],L)===0?Wl(o,l,B):Wl(o,++B,f),B<=i&&(l=B+1),i<=B&&(f=B-1)}}function Wl(o,i,l){var f=o[i];o[i]=o[l],o[l]=f}function C0(o,i){return o<i?-1:o>i?1:0}function Ef(o,i){const l=o.length;if(l<=1)return[o];const f=[];let p,y;for(let v=0;v<l;v++){const w=it(o[v]);w!==0&&(o[v].area=Math.abs(w),y===void 0&&(y=w<0),y===w<0?(p&&f.push(p),p=[o[v]]):p.push(o[v]))}if(p&&f.push(p),i>1)for(let v=0;v<f.length;v++)f[v].length<=i||(A0(f[v],i,1,f[v].length-1,I0),f[v]=f[v].slice(0,i));return f}function I0(o,i){return i.area-o.area}function Tf(o,i,l){const f=l.patternDependencies;let p=!1;for(const y of i){const v=y.paint.get(`${o}-pattern`);v.isConstant()||(p=!0);const w=v.constantOr(null);w&&(p=!0,f[w.to]=!0,f[w.from]=!0)}return p}function Mf(o,i,l,f,p){const y=p.patternDependencies;for(const v of i){const w=v.paint.get(`${o}-pattern`).value;if(w.kind!=="constant"){let M=w.evaluate({zoom:f-1},l,{},p.availableImages),I=w.evaluate({zoom:f},l,{},p.availableImages),L=w.evaluate({zoom:f+1},l,{},p.availableImages);M=M&&M.name?M.name:M,I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,y[M]=!0,y[I]=!0,y[L]=!0,l.patterns[v.id]={min:M,mid:I,max:L}}}return l}class Sf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vt,this.indexArray=new Ci,this.indexArray2=new qi,this.programConfigurations=new bs(i.layers,i.zoom),this.segments=new Vt,this.segments2=new Vt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Tf("fill",this.layers,l);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),v=[];for(const{feature:w,id:M,index:I,sourceLayerIndex:L}of i){const z=this.layers[0]._featureFilter.needGeometry,B=Es(w,z);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),B,f))continue;const G=y?p.evaluate(B,{},f,l.availableImages):void 0,V={id:M,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:z?B.geometry:ws(w),patterns:{},sortKey:G};v.push(V)}y&&v.sort((w,M)=>w.sortKey-M.sortKey);for(const w of v){const{geometry:M,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const z=Mf("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(z)}else this.addFeature(w,M,I,f,{});l.featureIndex.insert(i[I].feature,M,I,L,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_0),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,f,p,y){for(const v of Ef(l,500)){let w=0;for(const G of v)w+=G.length;const M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=M.vertexLength,L=[],z=[];for(const G of v){if(G.length===0)continue;G!==v[0]&&z.push(L.length/2);const V=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),J=V.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(J+G.length-1,J),L.push(G[0].x),L.push(G[0].y);for(let ee=1;ee<G.length;ee++)this.layoutVertexArray.emplaceBack(G[ee].x,G[ee].y),this.indexArray2.emplaceBack(J+ee-1,J+ee),L.push(G[ee].x),L.push(G[ee].y);V.vertexLength+=G.length,V.primitiveLength+=G.length}const B=Np(L,z);for(let G=0;G<B.length;G+=3)this.indexArray.emplaceBack(I+B[G],I+B[G+1],I+B[G+2]);M.vertexLength+=w,M.primitiveLength+=B.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,y,p)}}Xe("FillBucket",Sf,{omit:["layers","patternFeatures"]});const P0=new _i({"fill-sort-key":new st(xe.layout_fill["fill-sort-key"])});var R0={paint:new _i({"fill-antialias":new Je(xe.paint_fill["fill-antialias"]),"fill-opacity":new st(xe.paint_fill["fill-opacity"]),"fill-color":new st(xe.paint_fill["fill-color"]),"fill-outline-color":new st(xe.paint_fill["fill-outline-color"]),"fill-translate":new Je(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new Je(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new za(xe.paint_fill["fill-pattern"])}),layout:P0};const k0=ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:D0}=k0;var Ua={},L0=qe,Gp=Eo;function Eo(o,i,l,f,p){this.properties={},this.extent=l,this.type=0,this._pbf=o,this._geometry=-1,this._keys=f,this._values=p,o.readFields(O0,this,i)}function O0(o,i,l){o==1?i.id=l.readVarint():o==2?function(f,p){for(var y=f.readVarint()+f.pos;f.pos<y;){var v=p._keys[f.readVarint()],w=p._values[f.readVarint()];p.properties[v]=w}}(l,i):o==3?i.type=l.readVarint():o==4&&(i._geometry=l.pos)}function z0(o){for(var i,l,f=0,p=0,y=o.length,v=y-1;p<y;v=p++)f+=((l=o[v]).x-(i=o[p]).x)*(i.y+l.y);return f}Eo.types=["Unknown","Point","LineString","Polygon"],Eo.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,l=o.readVarint()+o.pos,f=1,p=0,y=0,v=0,w=[];o.pos<l;){if(p<=0){var M=o.readVarint();f=7&M,p=M>>3}if(p--,f===1||f===2)y+=o.readSVarint(),v+=o.readSVarint(),f===1&&(i&&w.push(i),i=[]),i.push(new L0(y,v));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&w.push(i),w},Eo.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,l=1,f=0,p=0,y=0,v=1/0,w=-1/0,M=1/0,I=-1/0;o.pos<i;){if(f<=0){var L=o.readVarint();l=7&L,f=L>>3}if(f--,l===1||l===2)(p+=o.readSVarint())<v&&(v=p),p>w&&(w=p),(y+=o.readSVarint())<M&&(M=y),y>I&&(I=y);else if(l!==7)throw new Error("unknown command "+l)}return[v,M,w,I]},Eo.prototype.toGeoJSON=function(o,i,l){var f,p,y=this.extent*Math.pow(2,l),v=this.extent*o,w=this.extent*i,M=this.loadGeometry(),I=Eo.types[this.type];function L(G){for(var V=0;V<G.length;V++){var J=G[V];G[V]=[360*(J.x+v)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(f=0;f<M.length;f++)z[f]=M[f][0];L(M=z);break;case 2:for(f=0;f<M.length;f++)L(M[f]);break;case 3:for(M=function(G){var V=G.length;if(V<=1)return[G];for(var J,ee,le=[],de=0;de<V;de++){var fe=z0(G[de]);fe!==0&&(ee===void 0&&(ee=fe<0),ee===fe<0?(J&&le.push(J),J=[G[de]]):J.push(G[de]))}return J&&le.push(J),le}(M),f=0;f<M.length;f++)for(p=0;p<M[f].length;p++)L(M[f][p])}M.length===1?M=M[0]:I="Multi"+I;var B={type:"Feature",geometry:{type:I,coordinates:M},properties:this.properties};return"id"in this&&(B.id=this.id),B};var F0=Gp,Vp=$p;function $p(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(B0,this,i),this.length=this._features.length}function B0(o,i,l){o===15?i.version=l.readVarint():o===1?i.name=l.readString():o===5?i.extent=l.readVarint():o===2?i._features.push(l.pos):o===3?i._keys.push(l.readString()):o===4&&i._values.push(function(f){for(var p=null,y=f.readVarint()+f.pos;f.pos<y;){var v=f.readVarint()>>3;p=v===1?f.readString():v===2?f.readFloat():v===3?f.readDouble():v===4?f.readVarint64():v===5?f.readVarint():v===6?f.readSVarint():v===7?f.readBoolean():null}return p}(l))}$p.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new F0(this._pbf,i,this.extent,this._keys,this._values)};var N0=Vp;function U0(o,i,l){if(o===3){var f=new N0(l,l.readVarint()+l.pos);f.length&&(i[f.name]=f)}}Ua.VectorTile=function(o,i){this.layers=o.readFields(U0,{},i)},Ua.VectorTileFeature=Gp,Ua.VectorTileLayer=Vp;const G0=Ua.VectorTileFeature.types,Af=Math.pow(2,13);function Yl(o,i,l,f,p,y,v,w){o.emplaceBack(i,l,2*Math.floor(f*Af)+v,p*Af*2,y*Af*2,Math.round(w))}class Cf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new xt,this.indexArray=new Ci,this.programConfigurations=new bs(i.layers,i.zoom),this.segments=new Vt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.features=[],this.hasPattern=Tf("fill-extrusion",this.layers,l);for(const{feature:p,id:y,index:v,sourceLayerIndex:w}of i){const M=this.layers[0]._featureFilter.needGeometry,I=Es(p,M);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),I,f))continue;const L={id:y,sourceLayerIndex:w,index:v,geometry:M?I.geometry:ws(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Mf("fill-extrusion",this.layers,L,this.zoom,l)):this.addFeature(L,L.geometry,v,f,{}),l.featureIndex.insert(p,L.geometry,v,w,this.index,!0)}}addFeatures(i,l,f){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,l,f)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,D0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,f,p,y){for(const v of Ef(l,500)){let w=0;for(const G of v)w+=G.length;let M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of v){if(G.length===0||$0(G))continue;let V=0;for(let J=0;J<G.length;J++){const ee=G[J];if(J>=1){const le=G[J-1];if(!V0(ee,le)){M.vertexLength+4>Vt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const de=ee.sub(le)._perp()._unit(),fe=le.dist(ee);V+fe>32768&&(V=0),Yl(this.layoutVertexArray,ee.x,ee.y,de.x,de.y,0,0,V),Yl(this.layoutVertexArray,ee.x,ee.y,de.x,de.y,0,1,V),V+=fe,Yl(this.layoutVertexArray,le.x,le.y,de.x,de.y,0,0,V),Yl(this.layoutVertexArray,le.x,le.y,de.x,de.y,0,1,V);const ye=M.vertexLength;this.indexArray.emplaceBack(ye,ye+2,ye+1),this.indexArray.emplaceBack(ye+1,ye+2,ye+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+w>Vt.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),G0[i.type]!=="Polygon")continue;const I=[],L=[],z=M.vertexLength;for(const G of v)if(G.length!==0){G!==v[0]&&L.push(I.length/2);for(let V=0;V<G.length;V++){const J=G[V];Yl(this.layoutVertexArray,J.x,J.y,0,0,1,1,0),I.push(J.x),I.push(J.y)}}const B=Np(I,L);for(let G=0;G<B.length;G+=3)this.indexArray.emplaceBack(z+B[G],z+B[G+2],z+B[G+1]);M.primitiveLength+=B.length/3,M.vertexLength+=w}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,y,p)}}function V0(o,i){return o.x===i.x&&(o.x<0||o.x>Lr)||o.y===i.y&&(o.y<0||o.y>Lr)}function $0(o){return o.every(i=>i.x<0)||o.every(i=>i.x>Lr)||o.every(i=>i.y<0)||o.every(i=>i.y>Lr)}Xe("FillExtrusionBucket",Cf,{omit:["layers","features"]});var j0={paint:new _i({"fill-extrusion-opacity":new Je(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Je(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Je(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Je(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Jl(o,i){return o.x*i.x+o.y*i.y}function jp(o,i){if(o.length===1){let l=0;const f=i[l++];let p;for(;!p||f.equals(p);)if(p=i[l++],!p)return 1/0;for(;l<i.length;l++){const y=i[l],v=o[0],w=p.sub(f),M=y.sub(f),I=v.sub(f),L=Jl(w,w),z=Jl(w,M),B=Jl(M,M),G=Jl(I,w),V=Jl(I,M),J=L*B-z*z,ee=(B*G-z*V)/J,le=(L*V-z*G)/J,de=f.z*(1-ee-le)+p.z*ee+y.z*le;if(isFinite(de))return de}return 1/0}{let l=1/0;for(const f of i)l=Math.min(l,f.z);return l}}const Z0=ur([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:q0}=Z0,X0=ur([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:K0}=X0,H0=Ua.VectorTileFeature.types,W0=Math.cos(Math.PI/180*37.5),Zp=Math.pow(2,14)/.5;class If{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new fr,this.layoutVertexArray2=new ut,this.indexArray=new Ci,this.programConfigurations=new bs(i.layers,i.zoom),this.segments=new Vt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Tf("line",this.layers,l);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),v=[];for(const{feature:w,id:M,index:I,sourceLayerIndex:L}of i){const z=this.layers[0]._featureFilter.needGeometry,B=Es(w,z);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),B,f))continue;const G=y?p.evaluate(B,{},f):void 0,V={id:M,properties:w.properties,type:w.type,sourceLayerIndex:L,index:I,geometry:z?B.geometry:ws(w),patterns:{},sortKey:G};v.push(V)}y&&v.sort((w,M)=>w.sortKey-M.sortKey);for(const w of v){const{geometry:M,index:I,sourceLayerIndex:L}=w;if(this.hasPattern){const z=Mf("line",this.layers,w,this.zoom,l);this.patternFeatures.push(z)}else this.addFeature(w,M,I,f,{});l.featureIndex.insert(i[I].feature,M,I,L,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,K0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,q0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,f,p,y){const v=this.layers[0].layout,w=v.get("line-join").evaluate(i,{}),M=v.get("line-cap"),I=v.get("line-miter-limit"),L=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const z of l)this.addLine(z,i,w,M,I,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,y,p)}addLine(i,l,f,p,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<i.length-1;le++)this.totalDistance+=i[le].dist(i[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=H0[l.type]==="Polygon";let M=i.length;for(;M>=2&&i[M-1].equals(i[M-2]);)M--;let I=0;for(;I<M-1&&i[I].equals(i[I+1]);)I++;if(M<(w?3:2))return;f==="bevel"&&(y=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,z=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let B,G,V,J,ee;this.e1=this.e2=-1,w&&(B=i[M-2],ee=i[I].sub(B)._unit()._perp());for(let le=I;le<M;le++){if(V=le===M-1?w?i[I+1]:void 0:i[le+1],V&&i[le].equals(V))continue;ee&&(J=ee),B&&(G=B),B=i[le],ee=V?V.sub(B)._unit()._perp():J,J=J||ee;let de=J.add(ee);de.x===0&&de.y===0||de._unit();const fe=J.x*ee.x+J.y*ee.y,ye=de.x*ee.x+de.y*ee.y,Ce=ye!==0?1/ye:1/0,Te=2*Math.sqrt(2-2*ye),je=ye<W0&&G&&V,et=J.x*ee.y-J.y*ee.x>0;if(je&&le>I){const Oe=B.dist(G);if(Oe>2*L){const Ze=B.sub(B.sub(G)._mult(L/Oe)._round());this.updateDistance(G,Ze),this.addCurrentVertex(Ze,J,0,0,z),G=Ze}}const Ue=G&&V;let Ge=Ue?f:w?"butt":p;if(Ue&&Ge==="round"&&(Ce<v?Ge="miter":Ce<=2&&(Ge="fakeround")),Ge==="miter"&&Ce>y&&(Ge="bevel"),Ge==="bevel"&&(Ce>2&&(Ge="flipbevel"),Ce<y&&(Ge="miter")),G&&this.updateDistance(G,B),Ge==="miter")de._mult(Ce),this.addCurrentVertex(B,de,0,0,z);else if(Ge==="flipbevel"){if(Ce>100)de=ee.mult(-1);else{const Oe=Ce*J.add(ee).mag()/J.sub(ee).mag();de._perp()._mult(Oe*(et?-1:1))}this.addCurrentVertex(B,de,0,0,z),this.addCurrentVertex(B,de.mult(-1),0,0,z)}else if(Ge==="bevel"||Ge==="fakeround"){const Oe=-Math.sqrt(Ce*Ce-1),Ze=et?Oe:0,Ve=et?0:Oe;if(G&&this.addCurrentVertex(B,J,Ze,Ve,z),Ge==="fakeround"){const Pe=Math.round(180*Te/Math.PI/20);for(let at=1;at<Pe;at++){let tt=at/Pe;if(tt!==.5){const Ft=tt-.5;tt+=tt*Ft*(tt-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*Ft*Ft+(.848013+fe*(.215638*fe-1.06021)))}const St=ee.sub(J)._mult(tt)._add(J)._unit()._mult(et?-1:1);this.addHalfVertex(B,St.x,St.y,!1,et,0,z)}}V&&this.addCurrentVertex(B,ee,-Ze,-Ve,z)}else if(Ge==="butt")this.addCurrentVertex(B,de,0,0,z);else if(Ge==="square"){const Oe=G?1:-1;this.addCurrentVertex(B,de,Oe,Oe,z)}else Ge==="round"&&(G&&(this.addCurrentVertex(B,J,0,0,z),this.addCurrentVertex(B,J,1,1,z,!0)),V&&(this.addCurrentVertex(B,ee,-1,-1,z,!0),this.addCurrentVertex(B,ee,0,0,z)));if(je&&le<M-1){const Oe=B.dist(V);if(Oe>2*L){const Ze=B.add(V.sub(B)._mult(L/Oe)._round());this.updateDistance(B,Ze),this.addCurrentVertex(Ze,ee,0,0,z),B=Ze}}}}addCurrentVertex(i,l,f,p,y,v=!1){const w=l.y*p-l.x,M=-l.y-l.x*p;this.addHalfVertex(i,l.x+l.y*f,l.y-l.x*f,v,!1,f,y),this.addHalfVertex(i,w,M,v,!0,-p,y),this.distance>Zp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(i,l,f,p,y,v))}addHalfVertex({x:i,y:l},f,p,y,v,w,M){const I=.5*(this.lineClips?this.scaledDistance*(Zp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(l<<1)+(v?1:0),Math.round(63*f)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const L=M.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),M.primitiveLength++),v?this.e2=L:this.e1=L}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}Xe("LineBucket",If,{omit:["layers","patternFeatures"]});const Y0=new _i({"line-cap":new Je(xe.layout_line["line-cap"]),"line-join":new st(xe.layout_line["line-join"]),"line-miter-limit":new Je(xe.layout_line["line-miter-limit"]),"line-round-limit":new Je(xe.layout_line["line-round-limit"]),"line-sort-key":new st(xe.layout_line["line-sort-key"])});var qp={paint:new _i({"line-opacity":new st(xe.paint_line["line-opacity"]),"line-color":new st(xe.paint_line["line-color"]),"line-translate":new Je(xe.paint_line["line-translate"]),"line-translate-anchor":new Je(xe.paint_line["line-translate-anchor"]),"line-width":new st(xe.paint_line["line-width"]),"line-gap-width":new st(xe.paint_line["line-gap-width"]),"line-offset":new st(xe.paint_line["line-offset"]),"line-blur":new st(xe.paint_line["line-blur"]),"line-dasharray":new mo(xe.paint_line["line-dasharray"]),"line-pattern":new za(xe.paint_line["line-pattern"]),"line-gradient":new _s(xe.paint_line["line-gradient"])}),layout:Y0};const Xp=new class extends st{possiblyEvaluate(o,i){return i=new Qt(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,l,f){return i=j({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,l,f)}}(qp.paint.properties["line-width"].specification);function Kp(o,i){return i>0?i+2*o:o}Xp.useIntegerZoom=!0;const J0=ur([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q0=ur([{name:"a_projected_pos",components:3,type:"Float32"}],4);ur([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ev=ur([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);ur([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hp=ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tv=ur([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function rv(o,i,l){return o.sections.forEach(f=>{f.text=function(p,y,v){const w=y.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),gi.applyArabicShaping&&(p=gi.applyArabicShaping(p)),p}(f.text,i,l)}),o}ur([{name:"triangle",components:3,type:"Uint16"}]),ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ur([{type:"Float32",name:"offsetX"}]),ur([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Ql={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var $r=24,Pf=$t,Wp=function(o,i,l,f,p){var y,v,w=8*p-f-1,M=(1<<w)-1,I=M>>1,L=-7,z=l?p-1:0,B=l?-1:1,G=o[i+z];for(z+=B,y=G&(1<<-L)-1,G>>=-L,L+=w;L>0;y=256*y+o[i+z],z+=B,L-=8);for(v=y&(1<<-L)-1,y>>=-L,L+=f;L>0;v=256*v+o[i+z],z+=B,L-=8);if(y===0)y=1-I;else{if(y===M)return v?NaN:1/0*(G?-1:1);v+=Math.pow(2,f),y-=I}return(G?-1:1)*v*Math.pow(2,y-f)},Yp=function(o,i,l,f,p,y){var v,w,M,I=8*y-p-1,L=(1<<I)-1,z=L>>1,B=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=f?0:y-1,V=f?1:-1,J=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,v=L):(v=Math.floor(Math.log(i)/Math.LN2),i*(M=Math.pow(2,-v))<1&&(v--,M*=2),(i+=v+z>=1?B/M:B*Math.pow(2,1-z))*M>=2&&(v++,M/=2),v+z>=L?(w=0,v=L):v+z>=1?(w=(i*M-1)*Math.pow(2,p),v+=z):(w=i*Math.pow(2,z-1)*Math.pow(2,p),v=0));p>=8;o[l+G]=255&w,G+=V,w/=256,p-=8);for(v=v<<p|w,I+=p;I>0;o[l+G]=255&v,G+=V,v/=256,I-=8);o[l+G-V]|=128*J};function $t(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var Ga,Rf=4294967296,Jp=1/Rf,Qp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function fa(o){return o.type===$t.Bytes?o.readVarint()+o.pos:o.pos+1}function To(o,i,l){return l?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function em(o,i,l){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(f);for(var p=l.pos-1;p>=o;p--)l.buf[p+f]=l.buf[p]}function iv(o,i){for(var l=0;l<o.length;l++)i.writeVarint(o[l])}function nv(o,i){for(var l=0;l<o.length;l++)i.writeSVarint(o[l])}function av(o,i){for(var l=0;l<o.length;l++)i.writeFloat(o[l])}function sv(o,i){for(var l=0;l<o.length;l++)i.writeDouble(o[l])}function ov(o,i){for(var l=0;l<o.length;l++)i.writeBoolean(o[l])}function lv(o,i){for(var l=0;l<o.length;l++)i.writeFixed32(o[l])}function hv(o,i){for(var l=0;l<o.length;l++)i.writeSFixed32(o[l])}function cv(o,i){for(var l=0;l<o.length;l++)i.writeFixed64(o[l])}function uv(o,i){for(var l=0;l<o.length;l++)i.writeSFixed64(o[l])}function Lc(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Mo(o,i,l){o[l]=i,o[l+1]=i>>>8,o[l+2]=i>>>16,o[l+3]=i>>>24}function tm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}function fv(o,i,l){o===1&&l.readMessage(dv,i)}function dv(o,i,l){if(o===3){const{id:f,bitmap:p,width:y,height:v,left:w,top:M,advance:I}=l.readMessage(pv,{});i.push({id:f,bitmap:new ql({width:y+6,height:v+6},p),metrics:{width:y,height:v,left:w,top:M,advance:I}})}}function pv(o,i,l){o===1?i.id=l.readVarint():o===2?i.bitmap=l.readBytes():o===3?i.width=l.readVarint():o===4?i.height=l.readVarint():o===5?i.left=l.readSVarint():o===6?i.top=l.readSVarint():o===7&&(i.advance=l.readVarint())}function rm(o){let i=0,l=0;for(const v of o)i+=v.w*v.h,l=Math.max(l,v.w);o.sort((v,w)=>w.h-v.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let p=0,y=0;for(const v of o)for(let w=f.length-1;w>=0;w--){const M=f[w];if(!(v.w>M.w||v.h>M.h)){if(v.x=M.x,v.y=M.y,y=Math.max(y,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===M.w&&v.h===M.h){const I=f.pop();w<f.length&&(f[w]=I)}else v.h===M.h?(M.x+=v.w,M.w-=v.w):v.w===M.w?(M.y+=v.h,M.h-=v.h):(f.push({x:M.x+v.w,y:M.y,w:M.w-v.w,h:v.h}),M.y+=v.h,M.h-=v.h);break}}return{w:p,h:y,fill:i/(p*y)||0}}$t.prototype={destroy:function(){this.buf=null},readFields:function(o,i,l){for(l=l||this.length;this.pos<l;){var f=this.readVarint(),p=f>>3,y=this.pos;this.type=7&f,o(p,i,this),this.pos===y&&this.skip(f)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=Lc(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=tm(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Lc(this.buf,this.pos)+Lc(this.buf,this.pos+4)*Rf;return this.pos+=8,o},readSFixed64:function(){var o=Lc(this.buf,this.pos)+tm(this.buf,this.pos+4)*Rf;return this.pos+=8,o},readFloat:function(){var o=Wp(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Wp(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,l,f=this.buf;return i=127&(l=f[this.pos++]),l<128?i:(i|=(127&(l=f[this.pos++]))<<7,l<128?i:(i|=(127&(l=f[this.pos++]))<<14,l<128?i:(i|=(127&(l=f[this.pos++]))<<21,l<128?i:function(p,y,v){var w,M,I=v.buf;if(w=(112&(M=I[v.pos++]))>>4,M<128||(w|=(127&(M=I[v.pos++]))<<3,M<128)||(w|=(127&(M=I[v.pos++]))<<10,M<128)||(w|=(127&(M=I[v.pos++]))<<17,M<128)||(w|=(127&(M=I[v.pos++]))<<24,M<128)||(w|=(1&(M=I[v.pos++]))<<31,M<128))return To(p,w,y);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=f[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&Qp?function(l,f,p){return Qp.decode(l.subarray(f,p))}(this.buf,i,o):function(l,f,p){for(var y="",v=f;v<p;){var w,M,I,L=l[v],z=null,B=L>239?4:L>223?3:L>191?2:1;if(v+B>p)break;B===1?L<128&&(z=L):B===2?(192&(w=l[v+1]))==128&&(z=(31&L)<<6|63&w)<=127&&(z=null):B===3?(M=l[v+2],(192&(w=l[v+1]))==128&&(192&M)==128&&((z=(15&L)<<12|(63&w)<<6|63&M)<=2047||z>=55296&&z<=57343)&&(z=null)):B===4&&(M=l[v+2],I=l[v+3],(192&(w=l[v+1]))==128&&(192&M)==128&&(192&I)==128&&((z=(15&L)<<18|(63&w)<<12|(63&M)<<6|63&I)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,B=1):z>65535&&(z-=65536,y+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),y+=String.fromCharCode(z),v+=B}return y}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==$t.Bytes)return o.push(this.readVarint(i));var l=fa(this);for(o=o||[];this.pos<l;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==$t.Bytes)return o.push(this.readSVarint());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==$t.Bytes)return o.push(this.readBoolean());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==$t.Bytes)return o.push(this.readFloat());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==$t.Bytes)return o.push(this.readDouble());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==$t.Bytes)return o.push(this.readFixed32());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==$t.Bytes)return o.push(this.readSFixed32());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==$t.Bytes)return o.push(this.readFixed64());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==$t.Bytes)return o.push(this.readSFixed64());var i=fa(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===$t.Varint)for(;this.buf[this.pos++]>127;);else if(i===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(i===$t.Fixed32)this.pos+=4;else{if(i!==$t.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Mo(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Mo(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Mo(this.buf,-1&o,this.pos),Mo(this.buf,Math.floor(o*Jp),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Mo(this.buf,-1&o,this.pos),Mo(this.buf,Math.floor(o*Jp),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,l){var f,p;if(i>=0?(f=i%4294967296|0,p=i/4294967296|0):(p=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,p=p+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(y,v,w){w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,y>>>=7,w.buf[w.pos++]=127&y|128,w.buf[w.pos]=127&(y>>>=7)}(f,0,l),function(y,v){var w=(7&y)<<4;v.buf[v.pos++]|=w|((y>>>=3)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y)))))}(p,l)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(f,p,y){for(var v,w,M=0;M<p.length;M++){if((v=p.charCodeAt(M))>55295&&v<57344){if(!w){v>56319||M+1===p.length?(f[y++]=239,f[y++]=191,f[y++]=189):w=v;continue}if(v<56320){f[y++]=239,f[y++]=191,f[y++]=189,w=v;continue}v=w-55296<<10|v-56320|65536,w=null}else w&&(f[y++]=239,f[y++]=191,f[y++]=189,w=null);v<128?f[y++]=v:(v<2048?f[y++]=v>>6|192:(v<65536?f[y++]=v>>12|224:(f[y++]=v>>18|240,f[y++]=v>>12&63|128),f[y++]=v>>6&63|128),f[y++]=63&v|128)}return y}(this.buf,o,this.pos);var l=this.pos-i;l>=128&&em(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(o){this.realloc(4),Yp(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Yp(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=o[l]},writeRawMessage:function(o,i){this.pos++;var l=this.pos;o(i,this);var f=this.pos-l;f>=128&&em(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeMessage:function(o,i,l){this.writeTag(o,$t.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,iv,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,nv,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,ov,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,av,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,sv,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,lv,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,hv,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,cv,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,uv,i)},writeBytesField:function(o,i){this.writeTag(o,$t.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,$t.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,$t.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,$t.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,$t.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,$t.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,$t.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,$t.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,$t.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,$t.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,Boolean(i))}};class kf{constructor(i,{pixelRatio:l,version:f,stretchX:p,stretchY:y,content:v}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=p,this.stretchY=y,this.content=v,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class im{constructor(i,l){const f={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(i,f,y),this.addImages(l,p,y);const{w:v,h:w}=rm(y),M=new Xi({width:v||1,height:w||1});for(const I in i){const L=i[I],z=f[I].paddedRect;Xi.copy(L.data,M,{x:0,y:0},{x:z.x+1,y:z.y+1},L.data)}for(const I in l){const L=l[I],z=p[I].paddedRect,B=z.x+1,G=z.y+1,V=L.data.width,J=L.data.height;Xi.copy(L.data,M,{x:0,y:0},{x:B,y:G},L.data),Xi.copy(L.data,M,{x:0,y:J-1},{x:B,y:G-1},{width:V,height:1}),Xi.copy(L.data,M,{x:0,y:0},{x:B,y:G+J},{width:V,height:1}),Xi.copy(L.data,M,{x:V-1,y:0},{x:B-1,y:G},{width:1,height:J}),Xi.copy(L.data,M,{x:0,y:0},{x:B+V,y:G},{width:1,height:J})}this.image=M,this.iconPositions=f,this.patternPositions=p}addImages(i,l,f){for(const p in i){const y=i[p],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};f.push(v),l[p]=new kf(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),l)}patchUpdatedImage(i,l,f){if(!i||!l||i.version===l.version)return;i.version=l.version;const[p,y]=i.tl;f.update(l.data,void 0,{x:p,y})}}Xe("ImagePosition",kf),Xe("ImageAtlas",im),h.WritingMode=void 0,(Ga=h.WritingMode||(h.WritingMode={}))[Ga.none=0]="none",Ga[Ga.horizontal=1]="horizontal",Ga[Ga.vertical=2]="vertical",Ga[Ga.horizontalOnly=3]="horizontalOnly";const Oc=-17;class eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const f=new eh;return f.scale=i||1,f.fontStack=l,f}static forImage(i){const l=new eh;return l.imageName=i,l}}class So{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const f=new So;for(let p=0;p<i.sections.length;p++){const y=i.sections[p];y.image?f.addImageSection(y):f.addTextSection(y,l)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let f=0;f<i.length;f++){const p=i.charCodeAt(f+1)||null,y=i.charCodeAt(f-1)||null;l+=p&&co(p)&&!Ql[i[f+1]]||y&&co(y)&&!Ql[i[f-1]]||!Ql[i[f]]?i[f]:Ql[i[f]]}return l}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Fc[this.text.charCodeAt(f)];f++)i++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Fc[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const f=new So;return f.text=this.text.substring(i,l),f.sectionIndex=this.sectionIndex.slice(i,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(eh.forText(i.scale,i.fontStack||l));const f=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(f)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void Ae("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(eh.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function zc(o,i,l,f,p,y,v,w,M,I,L,z,B,G,V,J){const ee=So.fromFeature(o,p);let le;z===h.WritingMode.vertical&&ee.verticalizePunctuation();const{processBidirectionalText:de,processStyledBidirectionalText:fe}=gi;if(de&&ee.sections.length===1){le=[];const Te=de(ee.toString(),Df(ee,I,y,i,f,G,V));for(const je of Te){const et=new So;et.text=je,et.sections=ee.sections;for(let Ue=0;Ue<je.length;Ue++)et.sectionIndex.push(0);le.push(et)}}else if(fe){le=[];const Te=fe(ee.text,ee.sectionIndex,Df(ee,I,y,i,f,G,V));for(const je of Te){const et=new So;et.text=je[0],et.sectionIndex=je[1],et.sections=ee.sections,le.push(et)}}else le=function(Te,je){const et=[],Ue=Te.text;let Ge=0;for(const Oe of je)et.push(Te.substring(Ge,Oe)),Ge=Oe;return Ge<Ue.length&&et.push(Te.substring(Ge,Ue.length)),et}(ee,Df(ee,I,y,i,f,G,V));const ye=[],Ce={positionedLines:ye,text:ee.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(Te,je,et,Ue,Ge,Oe,Ze,Ve,Pe,at,tt,St){let Ft=0,tr=Oc,rr=0,Hr=0;const Sr=Ve==="right"?1:Ve==="left"?0:.5;let Ar=0;for(const Cr of Ge){Cr.trim();const Yr=Cr.getMaxScale(),ai=(Yr-1)*$r,yi={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Ar]=yi;const Ri=yi.positionedGlyphs;let ki=0;if(!Cr.length()){tr+=Oe,++Ar;continue}for(let Br=0;Br<Cr.length();Br++){const bt=Cr.getSection(Br),Ni=Cr.getSectionIndex(Br),Jr=Cr.getCharCode(Br);let si=0,tn=null,pn=null,mn=null,da=$r;const rn=!(Pe===h.WritingMode.horizontal||!tt&&!Ol(Jr)||tt&&(Fc[Jr]||(Fr=Jr,Fe.Arabic(Fr)||Fe["Arabic Supplement"](Fr)||Fe["Arabic Extended-A"](Fr)||Fe["Arabic Presentation Forms-A"](Fr)||Fe["Arabic Presentation Forms-B"](Fr))));if(bt.imageName){const Ki=Ue[bt.imageName];if(!Ki)continue;mn=bt.imageName,Te.iconsInText=Te.iconsInText||!0,pn=Ki.paddedRect;const Di=Ki.displaySize;bt.scale=bt.scale*$r/St,tn={width:Di[0],height:Di[1],left:1,top:-3,advance:rn?Di[1]:Di[0]},si=ai+($r-Di[1]*bt.scale),da=tn.advance;const pa=rn?Di[0]*bt.scale-$r*Yr:Di[1]*bt.scale-$r*Yr;pa>0&&pa>ki&&(ki=pa)}else{const Ki=et[bt.fontStack],Di=Ki&&Ki[Jr];if(Di&&Di.rect)pn=Di.rect,tn=Di.metrics;else{const pa=je[bt.fontStack],ih=pa&&pa[Jr];if(!ih)continue;tn=ih.metrics}si=(Yr-bt.scale)*$r}rn?(Te.verticalizable=!0,Ri.push({glyph:Jr,imageName:mn,x:Ft,y:tr+si,vertical:rn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Ni,metrics:tn,rect:pn}),Ft+=da*bt.scale+at):(Ri.push({glyph:Jr,imageName:mn,x:Ft,y:tr+si,vertical:rn,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Ni,metrics:tn,rect:pn}),Ft+=tn.advance*bt.scale+at)}Ri.length!==0&&(rr=Math.max(Ft-at,rr),_v(Ri,0,Ri.length-1,Sr,ki)),Ft=0;const or=Oe*Yr+ki;yi.lineOffset=Math.max(ki,ai),tr+=or,Hr=Math.max(or,Hr),++Ar}var Fr;const Wr=tr-Oc,{horizontalAlign:ni,verticalAlign:Pi}=Lf(Ze);(function(Cr,Yr,ai,yi,Ri,ki,or,Br,bt){const Ni=(Yr-ai)*Ri;let Jr=0;Jr=ki!==or?-Br*yi-Oc:(-yi*bt+.5)*or;for(const si of Cr)for(const tn of si.positionedGlyphs)tn.x+=Ni,tn.y+=Jr})(Te.positionedLines,Sr,ni,Pi,rr,Hr,Oe,Wr,Ge.length),Te.top+=-Pi*Wr,Te.bottom=Te.top+Wr,Te.left+=-ni*rr,Te.right=Te.left+rr}(Ce,i,l,f,le,v,w,M,z,I,B,J),!function(Te){for(const je of Te)if(je.positionedGlyphs.length!==0)return!1;return!0}(ye)&&Ce}const Fc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function nm(o,i,l,f,p,y){if(i.imageName){const v=f[i.imageName];return v?v.displaySize[0]*i.scale*$r/y+p:0}{const v=l[i.fontStack],w=v&&v[o];return w?w.metrics.advance*i.scale+p:0}}function am(o,i,l,f){const p=Math.pow(o-i,2);return f?o<i?p/2:2*p:p+Math.abs(l)*l}function gv(o,i,l){let f=0;return o===10&&(f-=1e4),l&&(f+=150),o!==40&&o!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function sm(o,i,l,f,p,y){let v=null,w=am(i,l,p,y);for(const M of f){const I=am(i-M.x,l,p,y)+M.badness;I<=w&&(v=M,w=I)}return{index:o,x:i,priorBreak:v,badness:w}}function om(o){return o?om(o.priorBreak).concat(o.index):[]}function Df(o,i,l,f,p,y,v){if(y!=="point")return[];if(!o)return[];const w=[],M=function(B,G,V,J,ee,le){let de=0;for(let fe=0;fe<B.length();fe++){const ye=B.getSection(fe);de+=nm(B.getCharCode(fe),ye,J,ee,G,le)}return de/Math.max(1,Math.ceil(de/V))}(o,i,l,f,p,v),I=o.text.indexOf("\u200B")>=0;let L=0;for(let B=0;B<o.length();B++){const G=o.getSection(B),V=o.getCharCode(B);if(Fc[V]||(L+=nm(V,G,f,p,i,v)),B<o.length()-1){const J=!((z=V)<11904||!(Fe["Bopomofo Extended"](z)||Fe.Bopomofo(z)||Fe["CJK Compatibility Forms"](z)||Fe["CJK Compatibility Ideographs"](z)||Fe["CJK Compatibility"](z)||Fe["CJK Radicals Supplement"](z)||Fe["CJK Strokes"](z)||Fe["CJK Symbols and Punctuation"](z)||Fe["CJK Unified Ideographs Extension A"](z)||Fe["CJK Unified Ideographs"](z)||Fe["Enclosed CJK Letters and Months"](z)||Fe["Halfwidth and Fullwidth Forms"](z)||Fe.Hiragana(z)||Fe["Ideographic Description Characters"](z)||Fe["Kangxi Radicals"](z)||Fe["Katakana Phonetic Extensions"](z)||Fe.Katakana(z)||Fe["Vertical Forms"](z)||Fe["Yi Radicals"](z)||Fe["Yi Syllables"](z)));(mv[V]||J||G.imageName)&&w.push(sm(B+1,L,M,w,gv(V,o.getCharCode(B+1),J&&I),!1))}}var z;return om(sm(o.length(),L,M,w,0,!0))}function Lf(o){let i=.5,l=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function _v(o,i,l,f,p){if(!f&&!p)return;const y=o[l],v=(o[l].x+y.metrics.advance*y.scale)*f;for(let w=i;w<=l;w++)o[w].x-=v,o[w].y+=p}function yv(o,i,l){const{horizontalAlign:f,verticalAlign:p}=Lf(l),y=i[0]-o.displaySize[0]*f,v=i[1]-o.displaySize[1]*p;return{image:o,top:v,bottom:v+o.displaySize[1],left:y,right:y+o.displaySize[0]}}function lm(o,i,l,f,p,y){const v=o.image;let w;if(v.content){const ee=v.content,le=v.pixelRatio||1;w=[ee[0]/le,ee[1]/le,v.displaySize[0]-ee[2]/le,v.displaySize[1]-ee[3]/le]}const M=i.left*y,I=i.right*y;let L,z,B,G;l==="width"||l==="both"?(G=p[0]+M-f[3],z=p[0]+I+f[1]):(G=p[0]+(M+I-v.displaySize[0])/2,z=G+v.displaySize[0]);const V=i.top*y,J=i.bottom*y;return l==="height"||l==="both"?(L=p[1]+V-f[0],B=p[1]+J+f[2]):(L=p[1]+(V+J-v.displaySize[1])/2,B=L+v.displaySize[1]),{image:v,top:L,right:z,bottom:B,left:G,collisionPadding:w}}const Ln=128;function Of(o,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Qt(o+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:p}=l;let y=0;for(;y<f.length&&f[y]<=o;)y++;y=Math.max(0,y-1);let v=y;for(;v<f.length&&f[v]<o+1;)v++;v=Math.min(f.length-1,v);const w=f[y],M=f[v];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:M,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:M,minSize:l.evaluate(new Qt(w)),maxSize:l.evaluate(new Qt(M)),interpolationType:p}}}function hm(o,{uSize:i,uSizeT:l},{lowerSize:f,upperSize:p}){return o.kind==="source"?f/Ln:o.kind==="composite"?Tr(f/Ln,p/Ln,l):i}function cm(o,i){let l=0,f=0;if(o.kind==="constant")f=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:v}=o,w=p?R(Ti.interpolationFactor(p,i,y,v),0,1):0;o.kind==="camera"?f=Tr(o.minSize,o.maxSize,w):l=w}return{uSizeT:l,uSize:f}}var vv=Object.freeze({__proto__:null,getSizeData:Of,evaluateSizeForFeature:hm,evaluateSizeForZoom:cm,SIZE_PACK_FACTOR:Ln});class Va extends qe{constructor(i,l,f,p){super(i,l),this.angle=f,p!==void 0&&(this.segment=p)}clone(){return new Va(this.x,this.y,this.angle,this.segment)}}function um(o,i,l,f,p){if(i.segment===void 0)return!0;let y=i,v=i.segment+1,w=0;for(;w>-l/2;){if(v--,v<0)return!1;w-=o[v].dist(y),y=o[v]}w+=o[v].dist(o[v+1]),v++;const M=[];let I=0;for(;w<l/2;){const L=o[v],z=o[v+1];if(!z)return!1;let B=o[v-1].angleTo(L)-L.angleTo(z);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),M.push({distance:w,angleDelta:B}),I+=B;w-M[0].distance>f;)I-=M.shift().angleDelta;if(I>p)return!1;v++,w+=L.dist(z)}return!0}function fm(o){let i=0;for(let l=0;l<o.length-1;l++)i+=o[l].dist(o[l+1]);return i}function dm(o,i,l){return o?.6*i*l:0}function pm(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function xv(o,i,l,f,p,y){const v=dm(l,p,y),w=pm(l,f)*y;let M=0;const I=fm(o)/2;for(let L=0;L<o.length-1;L++){const z=o[L],B=o[L+1],G=z.dist(B);if(M+G>I){const V=(I-M)/G,J=Tr(z.x,B.x,V),ee=Tr(z.y,B.y,V),le=new Va(J,ee,B.angleTo(z),L);return le._round(),!v||um(o,le,w,v,i)?le:void 0}M+=G}}function bv(o,i,l,f,p,y,v,w,M){const I=dm(f,y,v),L=pm(f,p),z=L*v,B=o[0].x===0||o[0].x===M||o[0].y===0||o[0].y===M;return i-z<i/4&&(i=z+i/4),mm(o,B?i/2*w%i:(L/2+2*y)*v*w%i,i,I,l,z,B,!1,M)}function mm(o,i,l,f,p,y,v,w,M){const I=y/2,L=fm(o);let z=0,B=i-l,G=[];for(let V=0;V<o.length-1;V++){const J=o[V],ee=o[V+1],le=J.dist(ee),de=ee.angleTo(J);for(;B+l<z+le;){B+=l;const fe=(B-z)/le,ye=Tr(J.x,ee.x,fe),Ce=Tr(J.y,ee.y,fe);if(ye>=0&&ye<M&&Ce>=0&&Ce<M&&B-I>=0&&B+I<=L){const Te=new Va(ye,Ce,de,V);Te._round(),f&&!um(o,Te,y,f,p)||G.push(Te)}}z+=le}return w||G.length||v||(G=mm(o,z/2,l,f,p,y,v,!0,M)),G}function gm(o,i,l,f,p){const y=[];for(let v=0;v<o.length;v++){const w=o[v];let M;for(let I=0;I<w.length-1;I++){let L=w[I],z=w[I+1];L.x<i&&z.x<i||(L.x<i?L=new qe(i,L.y+(i-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x<i&&(z=new qe(i,L.y+(i-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y<l&&z.y<l||(L.y<l?L=new qe(L.x+(l-L.y)/(z.y-L.y)*(z.x-L.x),l)._round():z.y<l&&(z=new qe(L.x+(l-L.y)/(z.y-L.y)*(z.x-L.x),l)._round()),L.x>=f&&z.x>=f||(L.x>=f?L=new qe(f,L.y+(f-L.x)/(z.x-L.x)*(z.y-L.y))._round():z.x>=f&&(z=new qe(f,L.y+(f-L.x)/(z.x-L.x)*(z.y-L.y))._round()),L.y>=p&&z.y>=p||(L.y>=p?L=new qe(L.x+(p-L.y)/(z.y-L.y)*(z.x-L.x),p)._round():z.y>=p&&(z=new qe(L.x+(p-L.y)/(z.y-L.y)*(z.x-L.x),p)._round()),M&&L.equals(M[M.length-1])||(M=[L],y.push(M)),M.push(z)))))}}return y}function _m(o,i,l,f){const p=[],y=o.image,v=y.pixelRatio,w=y.paddedRect.w-2,M=y.paddedRect.h-2,I=o.right-o.left,L=o.bottom-o.top,z=y.stretchX||[[0,w]],B=y.stretchY||[[0,M]],G=(Oe,Ze)=>Oe+Ze[1]-Ze[0],V=z.reduce(G,0),J=B.reduce(G,0),ee=w-V,le=M-J;let de=0,fe=V,ye=0,Ce=J,Te=0,je=ee,et=0,Ue=le;if(y.content&&f){const Oe=y.content;de=Bc(z,0,Oe[0]),ye=Bc(B,0,Oe[1]),fe=Bc(z,Oe[0],Oe[2]),Ce=Bc(B,Oe[1],Oe[3]),Te=Oe[0]-de,et=Oe[1]-ye,je=Oe[2]-Oe[0]-fe,Ue=Oe[3]-Oe[1]-Ce}const Ge=(Oe,Ze,Ve,Pe)=>{const at=Nc(Oe.stretch-de,fe,I,o.left),tt=Uc(Oe.fixed-Te,je,Oe.stretch,V),St=Nc(Ze.stretch-ye,Ce,L,o.top),Ft=Uc(Ze.fixed-et,Ue,Ze.stretch,J),tr=Nc(Ve.stretch-de,fe,I,o.left),rr=Uc(Ve.fixed-Te,je,Ve.stretch,V),Hr=Nc(Pe.stretch-ye,Ce,L,o.top),Sr=Uc(Pe.fixed-et,Ue,Pe.stretch,J),Ar=new qe(at,St),Fr=new qe(tr,St),Wr=new qe(tr,Hr),ni=new qe(at,Hr),Pi=new qe(tt/v,Ft/v),Cr=new qe(rr/v,Sr/v),Yr=i*Math.PI/180;if(Yr){const Ri=Math.sin(Yr),ki=Math.cos(Yr),or=[ki,-Ri,Ri,ki];Ar._matMult(or),Fr._matMult(or),ni._matMult(or),Wr._matMult(or)}const ai=Oe.stretch+Oe.fixed,yi=Ze.stretch+Ze.fixed;return{tl:Ar,tr:Fr,bl:ni,br:Wr,tex:{x:y.paddedRect.x+1+ai,y:y.paddedRect.y+1+yi,w:Ve.stretch+Ve.fixed-ai,h:Pe.stretch+Pe.fixed-yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Pi,pixelOffsetBR:Cr,minFontScaleX:je/v/I,minFontScaleY:Ue/v/L,isSDF:l}};if(f&&(y.stretchX||y.stretchY)){const Oe=ym(z,ee,V),Ze=ym(B,le,J);for(let Ve=0;Ve<Oe.length-1;Ve++){const Pe=Oe[Ve],at=Oe[Ve+1];for(let tt=0;tt<Ze.length-1;tt++)p.push(Ge(Pe,Ze[tt],at,Ze[tt+1]))}}else p.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:M+1}));return p}function Bc(o,i,l){let f=0;for(const p of o)f+=Math.max(i,Math.min(l,p[1]))-Math.max(i,Math.min(l,p[0]));return f}function ym(o,i,l){const f=[{fixed:-1,stretch:0}];for(const[p,y]of o){const v=f[f.length-1];f.push({fixed:p-v.stretch,stretch:v.stretch}),f.push({fixed:p-v.stretch,stretch:v.stretch+(y-p)})}return f.push({fixed:i+1,stretch:l}),f}function Nc(o,i,l,f){return o/i*l+f}function Uc(o,i,l,f){return o-i*l/f}Xe("Anchor",Va);class Gc{constructor(i,l,f,p,y,v,w,M,I,L){if(this.boxStartIndex=i.length,I){let z=v.top,B=v.bottom;const G=v.collisionPadding;G&&(z-=G[1],B+=G[3]);let V=B-z;V>0&&(V=Math.max(10,V),this.circleDiameter=V)}else{let z=v.top*w-M,B=v.bottom*w+M,G=v.left*w-M,V=v.right*w+M;const J=v.collisionPadding;if(J&&(G-=J[0]*w,z-=J[1]*w,V+=J[2]*w,B+=J[3]*w),L){const ee=new qe(G,z),le=new qe(V,z),de=new qe(G,B),fe=new qe(V,B),ye=L*Math.PI/180;ee._rotate(ye),le._rotate(ye),de._rotate(ye),fe._rotate(ye),G=Math.min(ee.x,le.x,de.x,fe.x),V=Math.max(ee.x,le.x,de.x,fe.x),z=Math.min(ee.y,le.y,de.y,fe.y),B=Math.max(ee.y,le.y,de.y,fe.y)}i.emplaceBack(l.x,l.y,G,z,V,B,f,p,y)}this.boxEndIndex=i.length}}class wv{constructor(i=[],l=Ev){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:f}=this,p=l[i];for(;i>0;){const y=i-1>>1,v=l[y];if(f(p,v)>=0)break;l[i]=v,i=y}l[i]=p}_down(i){const{data:l,compare:f}=this,p=this.length>>1,y=l[i];for(;i<p;){let v=1+(i<<1),w=l[v];const M=v+1;if(M<this.length&&f(l[M],w)<0&&(v=M,w=l[M]),f(w,y)>=0)break;l[i]=w,i=v}l[i]=y}}function Ev(o,i){return o<i?-1:o>i?1:0}function Tv(o,i=1,l=!1){let f=1/0,p=1/0,y=-1/0,v=-1/0;const w=o[0];for(let G=0;G<w.length;G++){const V=w[G];(!G||V.x<f)&&(f=V.x),(!G||V.y<p)&&(p=V.y),(!G||V.x>y)&&(y=V.x),(!G||V.y>v)&&(v=V.y)}const M=Math.min(y-f,v-p);let I=M/2;const L=new wv([],Mv);if(M===0)return new qe(f,p);for(let G=f;G<y;G+=M)for(let V=p;V<v;V+=M)L.push(new Ao(G+I,V+I,I,o));let z=function(G){let V=0,J=0,ee=0;const le=G[0];for(let de=0,fe=le.length,ye=fe-1;de<fe;ye=de++){const Ce=le[de],Te=le[ye],je=Ce.x*Te.y-Te.x*Ce.y;J+=(Ce.x+Te.x)*je,ee+=(Ce.y+Te.y)*je,V+=3*je}return new Ao(J/V,ee/V,0,G)}(o),B=L.length;for(;L.length;){const G=L.pop();(G.d>z.d||!z.d)&&(z=G,l&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,B)),G.max-z.d<=i||(I=G.h/2,L.push(new Ao(G.p.x-I,G.p.y-I,I,o)),L.push(new Ao(G.p.x+I,G.p.y-I,I,o)),L.push(new Ao(G.p.x-I,G.p.y+I,I,o)),L.push(new Ao(G.p.x+I,G.p.y+I,I,o)),B+=4)}return l&&(console.log(`num probes: ${B}`),console.log(`best distance: ${z.d}`)),z.p}function Mv(o,i){return i.max-o.max}function Ao(o,i,l,f){this.p=new qe(o,i),this.h=l,this.d=function(p,y){let v=!1,w=1/0;for(let M=0;M<y.length;M++){const I=y[M];for(let L=0,z=I.length,B=z-1;L<z;B=L++){const G=I[L],V=I[B];G.y>p.y!=V.y>p.y&&p.x<(V.x-G.x)*(p.y-G.y)/(V.y-G.y)+G.x&&(v=!v),w=Math.min(w,Cp(p,G,V))}}return(v?1:-1)*Math.sqrt(w)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const zf=Number.POSITIVE_INFINITY;function vm(o,i){return i[1]!==zf?function(l,f,p){let y=0,v=0;switch(f=Math.abs(f),p=Math.abs(p),l){case"top-right":case"top-left":case"top":v=p-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-p}switch(l){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,v]}(o,i[0],i[1]):function(l,f){let p=0,y=0;f<0&&(f=0);const v=f/Math.sqrt(2);switch(l){case"top-right":case"top-left":y=v-7;break;case"bottom-right":case"bottom-left":y=7-v;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(l){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=f;break;case"right":p=-f}return[p,y]}(o,i[0])}function Ff(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sv(o,i,l,f,p,y,v,w,M,I,L){let z=y.textMaxSize.evaluate(i,{});z===void 0&&(z=v);const B=o.layers[0].layout,G=B.get("icon-offset").evaluate(i,{},L),V=bm(l.horizontal),J=v/24,ee=o.tilePixelRatio*J,le=o.tilePixelRatio*z/24,de=o.tilePixelRatio*w,fe=o.tilePixelRatio*B.get("symbol-spacing"),ye=B.get("text-padding")*o.tilePixelRatio,Ce=B.get("icon-padding")*o.tilePixelRatio,Te=B.get("text-max-angle")/180*Math.PI,je=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",et=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ue=B.get("symbol-placement"),Ge=fe/2,Oe=B.get("icon-text-fit");let Ze;f&&Oe!=="none"&&(o.allowVerticalPlacement&&l.vertical&&(Ze=lm(f,l.vertical,Oe,B.get("icon-text-fit-padding"),G,J)),V&&(f=lm(f,V,Oe,B.get("icon-text-fit-padding"),G,J)));const Ve=(Pe,at)=>{at.x<0||at.x>=Lr||at.y<0||at.y>=Lr||function(tt,St,Ft,tr,rr,Hr,Sr,Ar,Fr,Wr,ni,Pi,Cr,Yr,ai,yi,Ri,ki,or,Br,bt,Ni,Jr,si,tn){const pn=tt.addToLineVertexArray(St,Ft);let mn,da,rn,Ki,Di=0,pa=0,ih=0,Fm=0,Xf=-1,Kf=-1;const ma={};let Bm=Fa(""),Hf=0,Wf=0;if(Ar._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Hf,Wf]=Ar.layout.get("text-offset").evaluate(bt,{},si).map(Li=>Li*$r):(Hf=Ar.layout.get("text-radial-offset").evaluate(bt,{},si)*$r,Wf=zf),tt.allowVerticalPlacement&&tr.vertical){const Li=Ar.layout.get("text-rotate").evaluate(bt,{},si)+90;rn=new Gc(Fr,St,Wr,ni,Pi,tr.vertical,Cr,Yr,ai,Li),Sr&&(Ki=new Gc(Fr,St,Wr,ni,Pi,Sr,Ri,ki,ai,Li))}if(rr){const Li=Ar.layout.get("icon-rotate").evaluate(bt,{}),On=Ar.layout.get("icon-text-fit")!=="none",nh=_m(rr,Li,Jr,On),ah=Sr?_m(Sr,Li,Jr,On):void 0;da=new Gc(Fr,St,Wr,ni,Pi,rr,Ri,ki,!1,Li),Di=4*nh.length;const Gm=tt.iconSizeData;let Ss=null;Gm.kind==="source"?(Ss=[Ln*Ar.layout.get("icon-size").evaluate(bt,{})],Ss[0]>$a&&Ae(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Gm.kind==="composite"&&(Ss=[Ln*Ni.compositeIconSizes[0].evaluate(bt,{},si),Ln*Ni.compositeIconSizes[1].evaluate(bt,{},si)],(Ss[0]>$a||Ss[1]>$a)&&Ae(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,nh,Ss,Br,or,bt,h.WritingMode.none,St,pn.lineStartIndex,pn.lineLength,-1,si),Xf=tt.icon.placedSymbolArray.length-1,ah&&(pa=4*ah.length,tt.addSymbols(tt.icon,ah,Ss,Br,or,bt,h.WritingMode.vertical,St,pn.lineStartIndex,pn.lineLength,-1,si),Kf=tt.icon.placedSymbolArray.length-1)}const Nm=Object.keys(tr.horizontal);for(const Li of Nm){const On=tr.horizontal[Li];if(!mn){Bm=Fa(On.text);const ah=Ar.layout.get("text-rotate").evaluate(bt,{},si);mn=new Gc(Fr,St,Wr,ni,Pi,On,Cr,Yr,ai,ah)}const nh=On.positionedLines.length===1;if(ih+=xm(tt,St,On,Hr,Ar,ai,bt,yi,pn,tr.vertical?h.WritingMode.horizontal:h.WritingMode.horizontalOnly,nh?Nm:[Li],ma,Xf,Ni,si),nh)break}tr.vertical&&(Fm+=xm(tt,St,tr.vertical,Hr,Ar,ai,bt,yi,pn,h.WritingMode.vertical,["vertical"],ma,Kf,Ni,si));const Nv=mn?mn.boxStartIndex:tt.collisionBoxArray.length,Uv=mn?mn.boxEndIndex:tt.collisionBoxArray.length,Gv=rn?rn.boxStartIndex:tt.collisionBoxArray.length,Vv=rn?rn.boxEndIndex:tt.collisionBoxArray.length,$v=da?da.boxStartIndex:tt.collisionBoxArray.length,jv=da?da.boxEndIndex:tt.collisionBoxArray.length,Zv=Ki?Ki.boxStartIndex:tt.collisionBoxArray.length,qv=Ki?Ki.boxEndIndex:tt.collisionBoxArray.length;let gn=-1;const qc=(Li,On)=>Li&&Li.circleDiameter?Math.max(Li.circleDiameter,On):On;gn=qc(mn,gn),gn=qc(rn,gn),gn=qc(da,gn),gn=qc(Ki,gn);const Um=gn>-1?1:0;Um&&(gn*=tn/$r),tt.glyphOffsetArray.length>=Co.MAX_GLYPHS&&Ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,bt.sortKey),tt.symbolInstances.emplaceBack(St.x,St.y,ma.right>=0?ma.right:-1,ma.center>=0?ma.center:-1,ma.left>=0?ma.left:-1,ma.vertical||-1,Xf,Kf,Bm,Nv,Uv,Gv,Vv,$v,jv,Zv,qv,Wr,ih,Fm,Di,pa,Um,0,Cr,Hf,Wf,gn)}(o,at,Pe,l,f,p,Ze,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,ee,ye,je,M,de,Ce,et,G,i,y,I,L,v)};if(Ue==="line")for(const Pe of gm(i.geometry,0,0,Lr,Lr)){const at=bv(Pe,fe,Te,l.vertical||V,f,24,le,o.overscaling,Lr);for(const tt of at){const St=V;St&&Av(o,St.text,Ge,tt)||Ve(Pe,tt)}}else if(Ue==="line-center"){for(const Pe of i.geometry)if(Pe.length>1){const at=xv(Pe,Te,l.vertical||V,f,24,le);at&&Ve(Pe,at)}}else if(i.type==="Polygon")for(const Pe of Ef(i.geometry,0)){const at=Tv(Pe,16);Ve(Pe[0],new Va(at.x,at.y,0))}else if(i.type==="LineString")for(const Pe of i.geometry)Ve(Pe,new Va(Pe[0].x,Pe[0].y,0));else if(i.type==="Point")for(const Pe of i.geometry)for(const at of Pe)Ve([at],new Va(at.x,at.y,0))}const $a=32640;function xm(o,i,l,f,p,y,v,w,M,I,L,z,B,G,V){const J=function(de,fe,ye,Ce,Te,je,et,Ue){const Ge=Ce.layout.get("text-rotate").evaluate(je,{})*Math.PI/180,Oe=[];for(const Ze of fe.positionedLines)for(const Ve of Ze.positionedGlyphs){if(!Ve.rect)continue;const Pe=Ve.rect||{};let at=4,tt=!0,St=1,Ft=0;const tr=(Te||Ue)&&Ve.vertical,rr=Ve.metrics.advance*Ve.scale/2;if(Ue&&fe.verticalizable){const or=(Ve.scale-1)*$r,Br=($r-Ve.metrics.width*Ve.scale)/2;Ft=Ze.lineOffset/2-(Ve.imageName?-Br:or)}if(Ve.imageName){const or=et[Ve.imageName];tt=or.sdf,St=or.pixelRatio,at=1/St}const Hr=Te?[Ve.x+rr,Ve.y]:[0,0];let Sr=Te?[0,0]:[Ve.x+rr+ye[0],Ve.y+ye[1]-Ft],Ar=[0,0];tr&&(Ar=Sr,Sr=[0,0]);const Fr=(Ve.metrics.left-at)*Ve.scale-rr+Sr[0],Wr=(-Ve.metrics.top-at)*Ve.scale+Sr[1],ni=Fr+Pe.w*Ve.scale/St,Pi=Wr+Pe.h*Ve.scale/St,Cr=new qe(Fr,Wr),Yr=new qe(ni,Wr),ai=new qe(Fr,Pi),yi=new qe(ni,Pi);if(tr){const or=new qe(-rr,rr-Oc),Br=-Math.PI/2,bt=12-rr,Ni=new qe(22-bt,-(Ve.imageName?bt:0)),Jr=new qe(...Ar);Cr._rotateAround(Br,or)._add(Ni)._add(Jr),Yr._rotateAround(Br,or)._add(Ni)._add(Jr),ai._rotateAround(Br,or)._add(Ni)._add(Jr),yi._rotateAround(Br,or)._add(Ni)._add(Jr)}if(Ge){const or=Math.sin(Ge),Br=Math.cos(Ge),bt=[Br,-or,or,Br];Cr._matMult(bt),Yr._matMult(bt),ai._matMult(bt),yi._matMult(bt)}const Ri=new qe(0,0),ki=new qe(0,0);Oe.push({tl:Cr,tr:Yr,bl:ai,br:yi,tex:Pe,writingMode:fe.writingMode,glyphOffset:Hr,sectionIndex:Ve.sectionIndex,isSDF:tt,pixelOffsetTL:Ri,pixelOffsetBR:ki,minFontScaleX:0,minFontScaleY:0})}return Oe}(0,l,w,p,y,v,f,o.allowVerticalPlacement),ee=o.textSizeData;let le=null;ee.kind==="source"?(le=[Ln*p.layout.get("text-size").evaluate(v,{})],le[0]>$a&&Ae(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(le=[Ln*G.compositeTextSizes[0].evaluate(v,{},V),Ln*G.compositeTextSizes[1].evaluate(v,{},V)],(le[0]>$a||le[1]>$a)&&Ae(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,J,le,w,y,v,I,i,M.lineStartIndex,M.lineLength,B,V);for(const de of L)z[de]=o.text.placedSymbolArray.length-1;return 4*J.length}function bm(o){for(const i in o)return o[i];return null}function Av(o,i,l,f){const p=o.compareText;if(i in p){const y=p[i];for(let v=y.length-1;v>=0;v--)if(f.dist(y[v])<l)return!0}else p[i]=[];return p[i].push(f),!1}const Cv=Ua.VectorTileFeature.types,Iv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Vc(o,i,l,f,p,y,v,w,M,I,L,z,B){const G=w?Math.min($a,Math.round(w[0])):0,V=w?Math.min($a,Math.round(w[1])):0;o.emplaceBack(i,l,Math.round(32*f),Math.round(32*p),y,v,(G<<1)+(M?1:0),V,16*I,16*L,256*z,256*B)}function Bf(o,i,l){o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l),o.emplaceBack(i.x,i.y,l)}function Pv(o){for(const i of o.sections)if(lf(i.text))return!0;return!1}class Nf{constructor(i){this.layoutVertexArray=new sr,this.indexArray=new Ci,this.programConfigurations=i,this.segments=new Vt,this.dynamicLayoutVertexArray=new Vr,this.opacityVertexArray=new Si,this.placedSymbolArray=new ve}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,f,p){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,J0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Q0.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Iv,!0),this.opacityVertexBuffer.itemSize=1),(f||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",Nf);class Uf{constructor(i,l,f){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Vt,this.collisionVertexArray=new Zi}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,ev.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Xe("CollisionBuffers",Uf);class Co{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(v=>v.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mf([]),this.placementViewportMatrix=mf([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Of(this.zoom,l["text-size"]),this.iconSizeData=Of(this.zoom,l["icon-size"]);const f=this.layers[0].layout,p=f.get("symbol-sort-key"),y=f.get("symbol-z-order");this.canOverlap=Vf(f,"text-overlap","text-allow-overlap")!=="never"||Vf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(v=>h.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=i.sourceID}createArrays(){this.text=new Nf(new bs(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Nf(new bs(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Me,this.lineVertexArray=new We,this.symbolInstances=new Re}calculateGlyphDependencies(i,l,f,p,y){for(let v=0;v<i.length;v++)if(l[i.charCodeAt(v)]=!0,(f||p)&&y){const w=Ql[i.charAt(v)];w&&(l[w.charCodeAt(0)]=!0)}}populate(i,l,f){const p=this.layers[0],y=p.layout,v=y.get("text-font"),w=y.get("text-field"),M=y.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof W&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),L=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,z=y.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const B=l.iconDependencies,G=l.glyphDependencies,V=l.availableImages,J=new Qt(this.zoom);for(const{feature:ee,id:le,index:de,sourceLayerIndex:fe}of i){const ye=p._featureFilter.needGeometry,Ce=Es(ee,ye);if(!p._featureFilter.filter(J,Ce,f))continue;let Te,je;if(ye||(Ce.geometry=ws(ee)),I){const Ue=p.getValueAndResolveTokens("text-field",Ce,f,V),Ge=W.factory(Ue);Pv(Ge)&&(this.hasRTLText=!0),(!this.hasRTLText||Oa()==="unavailable"||this.hasRTLText&&gi.isParsed())&&(Te=rv(Ge,p,Ce))}if(L){const Ue=p.getValueAndResolveTokens("icon-image",Ce,f,V);je=Ue instanceof ae?Ue:ae.fromString(Ue)}if(!Te&&!je)continue;const et=this.sortFeaturesByKey?z.evaluate(Ce,{},f):void 0;if(this.features.push({id:le,text:Te,icon:je,index:de,sourceLayerIndex:fe,geometry:Ce.geometry,properties:ee.properties,type:Cv[ee.type],sortKey:et}),je&&(B[je.name]=!0),Te){const Ue=v.evaluate(Ce,{},f).join(","),Ge=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.WritingMode.vertical)>=0;for(const Oe of Te.sections)if(Oe.image)B[Oe.image.name]=!0;else{const Ze=ho(Te.toString()),Ve=Oe.fontStack||Ue,Pe=G[Ve]=G[Ve]||{};this.calculateGlyphDependencies(Oe.text,Pe,Ge,this.allowVerticalPlacement,Ze)}}}y.get("symbol-placement")==="line"&&(this.features=function(ee){const le={},de={},fe=[];let ye=0;function Ce(Ue){fe.push(ee[Ue]),ye++}function Te(Ue,Ge,Oe){const Ze=de[Ue];return delete de[Ue],de[Ge]=Ze,fe[Ze].geometry[0].pop(),fe[Ze].geometry[0]=fe[Ze].geometry[0].concat(Oe[0]),Ze}function je(Ue,Ge,Oe){const Ze=le[Ge];return delete le[Ge],le[Ue]=Ze,fe[Ze].geometry[0].shift(),fe[Ze].geometry[0]=Oe[0].concat(fe[Ze].geometry[0]),Ze}function et(Ue,Ge,Oe){const Ze=Oe?Ge[0][Ge[0].length-1]:Ge[0][0];return`${Ue}:${Ze.x}:${Ze.y}`}for(let Ue=0;Ue<ee.length;Ue++){const Ge=ee[Ue],Oe=Ge.geometry,Ze=Ge.text?Ge.text.toString():null;if(!Ze){Ce(Ue);continue}const Ve=et(Ze,Oe),Pe=et(Ze,Oe,!0);if(Ve in de&&Pe in le&&de[Ve]!==le[Pe]){const at=je(Ve,Pe,Oe),tt=Te(Ve,Pe,fe[at].geometry);delete le[Ve],delete de[Pe],de[et(Ze,fe[tt].geometry,!0)]=tt,fe[at].geometry=null}else Ve in de?Te(Ve,Pe,Oe):Pe in le?je(Ve,Pe,Oe):(Ce(Ue),le[Ve]=ye-1,de[Pe]=ye-1)}return fe.filter(Ue=>Ue.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,le)=>ee.sortKey-le.sortKey)}update(i,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const f=this.lineVertexArray.length;if(i.segment!==void 0){let p=i.dist(l[i.segment+1]),y=i.dist(l[i.segment]);const v={};for(let w=i.segment+1;w<l.length;w++)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:p},w<l.length-1&&(p+=l[w+1].dist(l[w]));for(let w=i.segment||0;w>=0;w--)v[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:y},w>0&&(y+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){const M=v[w];this.lineVertexArray.emplaceBack(M.x,M.y,M.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,l,f,p,y,v,w,M,I,L,z,B){const G=i.indexArray,V=i.layoutVertexArray,J=i.segments.prepareSegment(4*l.length,V,G,this.canOverlap?v.sortKey:void 0),ee=this.glyphOffsetArray.length,le=J.vertexLength,de=this.allowVerticalPlacement&&w===h.WritingMode.vertical?Math.PI/2:0,fe=v.text&&v.text.sections;for(let ye=0;ye<l.length;ye++){const{tl:Ce,tr:Te,bl:je,br:et,tex:Ue,pixelOffsetTL:Ge,pixelOffsetBR:Oe,minFontScaleX:Ze,minFontScaleY:Ve,glyphOffset:Pe,isSDF:at,sectionIndex:tt}=l[ye],St=J.vertexLength,Ft=Pe[1];Vc(V,M.x,M.y,Ce.x,Ft+Ce.y,Ue.x,Ue.y,f,at,Ge.x,Ge.y,Ze,Ve),Vc(V,M.x,M.y,Te.x,Ft+Te.y,Ue.x+Ue.w,Ue.y,f,at,Oe.x,Ge.y,Ze,Ve),Vc(V,M.x,M.y,je.x,Ft+je.y,Ue.x,Ue.y+Ue.h,f,at,Ge.x,Oe.y,Ze,Ve),Vc(V,M.x,M.y,et.x,Ft+et.y,Ue.x+Ue.w,Ue.y+Ue.h,f,at,Oe.x,Oe.y,Ze,Ve),Bf(i.dynamicLayoutVertexArray,M,de),G.emplaceBack(St,St+1,St+2),G.emplaceBack(St+1,St+2,St+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),ye!==l.length-1&&tt===l[ye+1].sectionIndex||i.programConfigurations.populatePaintArrays(V.length,v,v.index,{},B,fe&&fe[tt])}i.placedSymbolArray.emplaceBack(M.x,M.y,ee,this.glyphOffsetArray.length-ee,le,I,L,M.segment,f?f[0]:0,f?f[1]:0,p[0],p[1],w,0,!1,0,z)}_addCollisionDebugVertex(i,l,f,p,y,v){return l.emplaceBack(0,0),i.emplaceBack(f.x,f.y,p,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(i,l,f,p,y,v,w){const M=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=M.vertexLength,L=y.layoutVertexArray,z=y.collisionVertexArray,B=w.anchorX,G=w.anchorY;this._addCollisionDebugVertex(L,z,v,B,G,new qe(i,l)),this._addCollisionDebugVertex(L,z,v,B,G,new qe(f,l)),this._addCollisionDebugVertex(L,z,v,B,G,new qe(f,p)),this._addCollisionDebugVertex(L,z,v,B,G,new qe(i,p)),M.vertexLength+=4;const V=y.indexArray;V.emplaceBack(I,I+1),V.emplaceBack(I+1,I+2),V.emplaceBack(I+2,I+3),V.emplaceBack(I+3,I),M.primitiveLength+=4}addDebugCollisionBoxes(i,l,f,p){for(let y=i;y<l;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Uf(Ai,Hp.members,qi),this.iconCollisionBox=new Uf(Ai,Hp.members,qi);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,f,p,y,v,w,M,I){const L={};for(let z=l;z<f;z++){const B=i.get(z);L.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},L.textFeatureIndex=B.featureIndex;break}for(let z=p;z<y;z++){const B=i.get(z);L.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},L.verticalTextFeatureIndex=B.featureIndex;break}for(let z=v;z<w;z++){const B=i.get(z);L.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},L.iconFeatureIndex=B.featureIndex;break}for(let z=M;z<I;z++){const B=i.get(z);L.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},L.verticalIconFeatureIndex=B.featureIndex;break}return L}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const f=i.placedSymbolArray.get(l),p=f.vertexStartIndex+4*f.numGlyphs;for(let y=f.vertexStartIndex;y<p;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),f=Math.cos(i),p=[],y=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const M=this.symbolInstances.get(w);p.push(0|Math.round(l*M.anchorX+f*M.anchorY)),y.push(M.featureIndex)}return v.sort((w,M)=>p[w]-p[M]||y[M]-y[w]),v}addToSortKeyRanges(i,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((p,y,v)=>{p>=0&&v.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xe("SymbolBucket",Co,{omit:["layers","collisionBoxArray","features","compareText"]}),Co.MAX_GLYPHS=65535,Co.addDynamicAttributes=Bf;const Rv=new _i({"symbol-placement":new Je(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new Je(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Je(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Je(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Je(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Je(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Je(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Je(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Je(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(xe.layout_symbol["icon-size"]),"icon-text-fit":new Je(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Je(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(xe.layout_symbol["icon-image"]),"icon-rotate":new st(xe.layout_symbol["icon-rotate"]),"icon-padding":new Je(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new Je(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new st(xe.layout_symbol["icon-offset"]),"icon-anchor":new st(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Je(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Je(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Je(xe.layout_symbol["text-rotation-alignment"]),"text-field":new st(xe.layout_symbol["text-field"]),"text-font":new st(xe.layout_symbol["text-font"]),"text-size":new st(xe.layout_symbol["text-size"]),"text-max-width":new st(xe.layout_symbol["text-max-width"]),"text-line-height":new Je(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new st(xe.layout_symbol["text-letter-spacing"]),"text-justify":new st(xe.layout_symbol["text-justify"]),"text-radial-offset":new st(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Je(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new st(xe.layout_symbol["text-anchor"]),"text-max-angle":new Je(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new Je(xe.layout_symbol["text-writing-mode"]),"text-rotate":new st(xe.layout_symbol["text-rotate"]),"text-padding":new Je(xe.layout_symbol["text-padding"]),"text-keep-upright":new Je(xe.layout_symbol["text-keep-upright"]),"text-transform":new st(xe.layout_symbol["text-transform"]),"text-offset":new st(xe.layout_symbol["text-offset"]),"text-allow-overlap":new Je(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new Je(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new Je(xe.layout_symbol["text-ignore-placement"]),"text-optional":new Je(xe.layout_symbol["text-optional"])});var Gf={paint:new _i({"icon-opacity":new st(xe.paint_symbol["icon-opacity"]),"icon-color":new st(xe.paint_symbol["icon-color"]),"icon-halo-color":new st(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new Je(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Je(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(xe.paint_symbol["text-opacity"]),"text-color":new st(xe.paint_symbol["text-color"],{runtimeType:pi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new st(xe.paint_symbol["text-halo-color"]),"text-halo-width":new st(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new st(xe.paint_symbol["text-halo-blur"]),"text-translate":new Je(xe.paint_symbol["text-translate"]),"text-translate-anchor":new Je(xe.paint_symbol["text-translate-anchor"])}),layout:Rv};class wm{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Xr,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",wm,{omit:["defaultValue"]});class $c extends Mi{constructor(i){super(i,Gf)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const p=[];for(const y of f)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,f,p){const y=this.layout.get(i).evaluate(l,{},f,p),v=this._unevaluatedLayout._values[i];return v.isDataDriven()||Js(v.value)||!y?y:function(w,M){return M.replace(/{([^{}]+)}/g,(I,L)=>L in w?String(w[L]):"")}(l.properties,y)}createBucket(i){return new Co(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Gf.paint.overridableProperties){if(!$c.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),f=new wm(l),p=new Cl(f,l.property.specification);let y=null;y=l.value.kind==="constant"||l.value.kind==="source"?new Il("source",p):new eo("composite",p,l.value.zoomStops,l.value._interpolationType),this.paint._values[i]=new Qi(l.property,y,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&$c.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const f=i.get("text-field"),p=Gf.paint.properties[l];let y=!1;const v=w=>{for(const M of w)if(p.overrides&&p.overrides.hasOverride(M))return void(y=!0)};if(f.value.kind==="constant"&&f.value.value instanceof W)v(f.value.value.sections);else if(f.value.kind==="source"){const w=I=>{y||(I instanceof Se&&oe(I.value)===un?v(I.value.sections):I instanceof Ye?v(I.sections):I.eachChild(w))},M=f.value;M._styleExpression&&w(M._styleExpression.expression)}return y}}function Vf(o,i,l){let f="never";const p=o.get(i);return p?f=p:o.get(l)&&(f="always"),f}var kv={paint:new _i({"background-color":new Je(xe.paint_background["background-color"]),"background-pattern":new mo(xe.paint_background["background-pattern"]),"background-opacity":new Je(xe.paint_background["background-opacity"])})},Dv={paint:new _i({"raster-opacity":new Je(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Je(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Je(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Je(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new Je(xe.paint_raster["raster-saturation"]),"raster-contrast":new Je(xe.paint_raster["raster-contrast"]),"raster-resampling":new Je(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new Je(xe.paint_raster["raster-fade-duration"])})};class Lv extends Mi{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Ov={circle:class extends Mi{constructor(o){super(o,f0)}createBucket(o){return new ff(o)}queryRadius(o){const i=o;return Zl("circle-radius",this,i)+Zl("circle-stroke-width",this,i)+Sc(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,l,f,p,y,v,w){const M=Ac(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),I=this.paint.get("circle-radius").evaluate(i,l)+this.paint.get("circle-stroke-width").evaluate(i,l),L=this.paint.get("circle-pitch-alignment")==="map",z=L?M:function(G,V){return G.map(J=>Rp(J,V))}(M,w),B=L?I*v:I;for(const G of f)for(const V of G){const J=L?V:Rp(V,w);let ee=B;const le=Ic(gf(),Cc(V.x,V.y,0,1),w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=le[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=y.cameraToCenterDistance/le[3]),o0(z,J,ee))return!0}return!1}},heatmap:class extends Mi{constructor(o){super(o,p0),this._updateColorRamp()}createBucket(o){return new kp(o)}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Mi{constructor(o){super(o,m0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Mi{constructor(o){super(o,R0)}recalculate(o,i){super.recalculate(o,i);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Sf(o)}queryRadius(){return Sc(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,l,f,p,y,v){return Ap(Ac(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),f)}isTileClipped(){return!0}},"fill-extrusion":class extends Mi{constructor(o){super(o,j0)}createBucket(o){return new Cf(o)}queryRadius(){return Sc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(o,i,l,f,p,y,v,w){const M=Ac(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),I=this.paint.get("fill-extrusion-height").evaluate(i,l),L=this.paint.get("fill-extrusion-base").evaluate(i,l),z=function(G,V,J,ee){const le=[];for(const de of G){const fe=Cc(de.x,de.y,0,1);Ic(fe,fe,V),le.push(new qe(fe[0]/fe[3],fe[1]/fe[3]))}return le}(M,w),B=function(G,V,J,ee){const le=[],de=[],fe=ee[8]*V,ye=ee[9]*V,Ce=ee[10]*V,Te=ee[11]*V,je=ee[8]*J,et=ee[9]*J,Ue=ee[10]*J,Ge=ee[11]*J;for(const Oe of G){const Ze=[],Ve=[];for(const Pe of Oe){const at=Pe.x,tt=Pe.y,St=ee[0]*at+ee[4]*tt+ee[12],Ft=ee[1]*at+ee[5]*tt+ee[13],tr=ee[2]*at+ee[6]*tt+ee[14],rr=ee[3]*at+ee[7]*tt+ee[15],Hr=tr+Ce,Sr=rr+Te,Ar=St+je,Fr=Ft+et,Wr=tr+Ue,ni=rr+Ge,Pi=new qe((St+fe)/Sr,(Ft+ye)/Sr);Pi.z=Hr/Sr,Ze.push(Pi);const Cr=new qe(Ar/ni,Fr/ni);Cr.z=Wr/ni,Ve.push(Cr)}le.push(Ze),de.push(Ve)}return[le,de]}(f,L,I,w);return function(G,V,J){let ee=1/0;Ap(J,V)&&(ee=jp(J,V[0]));for(let le=0;le<V.length;le++){const de=V[le],fe=G[le];for(let ye=0;ye<de.length-1;ye++){const Ce=de[ye],Te=[Ce,de[ye+1],fe[ye+1],fe[ye],Ce];Sp(J,Te)&&(ee=Math.min(ee,jp(J,Te)))}}return ee!==1/0&&ee}(B[0],B[1],z)}},line:class extends Mi{constructor(o){super(o,qp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){o==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ns,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=Xp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new If(o)}queryRadius(o){const i=o,l=Kp(Zl("line-width",this,i),Zl("line-gap-width",this,i)),f=Zl("line-offset",this,i);return l/2+Math.abs(f)+Sc(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,l,f,p,y,v){const w=Ac(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),M=v/2*Kp(this.paint.get("line-width").evaluate(i,l),this.paint.get("line-gap-width").evaluate(i,l)),I=this.paint.get("line-offset").evaluate(i,l);return I&&(f=function(L,z){const B=[],G=new qe(0,0);for(let V=0;V<L.length;V++){const J=L[V],ee=[];for(let le=0;le<J.length;le++){const de=J[le-1],fe=J[le],ye=J[le+1],Ce=le===0?G:fe.sub(de)._unit()._perp(),Te=le===J.length-1?G:ye.sub(fe)._unit()._perp(),je=Ce._add(Te)._unit();je._mult(1/(je.x*Te.x+je.y*Te.y)),ee.push(je._mult(z)._add(fe))}B.push(ee)}return B}(f,I*v)),function(L,z,B){for(let G=0;G<z.length;G++){const V=z[G];if(L.length>=3){for(let J=0;J<V.length;J++)if(bo(L,V[J]))return!0}if(l0(L,V,B))return!0}return!1}(w,f,M)}isTileClipped(){return!0}},symbol:$c,background:class extends Mi{constructor(o){super(o,kv)}},raster:class extends Mi{constructor(o){super(o,Dv)}}};class zv{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Em=63710088e-1;class vr{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vr(U(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,f=this.lat*l,p=i.lat*l,y=Math.sin(f)*Math.sin(p)+Math.cos(f)*Math.cos(p)*Math.cos((i.lng-this.lng)*l);return Em*Math.acos(Math.min(y,1))}toBounds(i=0){const l=360*i/40075017,f=l/Math.cos(Math.PI/180*this.lat);return new Ms(new vr(this.lng-f,this.lat-l),new vr(this.lng+f,this.lat+l))}static convert(i){if(i instanceof vr)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new vr(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new vr(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ms{constructor(i,l){i&&(l?this.setSouthWest(i).setNorthEast(l):i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof vr?new vr(i.lng,i.lat):vr.convert(i),this}setSouthWest(i){return this._sw=i instanceof vr?new vr(i.lng,i.lat):vr.convert(i),this}extend(i){const l=this._sw,f=this._ne;let p,y;if(i instanceof vr)p=i,y=i;else{if(!(i instanceof Ms))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(Ms.convert(i)):this.extend(vr.convert(i)):this;if(p=i._sw,y=i._ne,!p||!y)return this}return l||f?(l.lng=Math.min(p.lng,l.lng),l.lat=Math.min(p.lat,l.lat),f.lng=Math.max(y.lng,f.lng),f.lat=Math.max(y.lat,f.lat)):(this._sw=new vr(p.lng,p.lat),this._ne=new vr(y.lng,y.lat)),this}getCenter(){return new vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vr(this.getWest(),this.getNorth())}getSouthEast(){return new vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:l,lat:f}=vr.convert(i);let p=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(i){return i instanceof Ms?i:i&&new Ms(i)}}const Tm=2*Math.PI*Em;function Mm(o){return Tm*Math.cos(o*Math.PI/180)}function Sm(o){return(180+o)/360}function Am(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Cm(o,i){return o/Mm(i)}function $f(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class jc{constructor(i,l,f=0){this.x=+i,this.y=+l,this.z=+f}static fromLngLat(i,l=0){const f=vr.convert(i);return new jc(Sm(f.lng),Am(f.lat),Cm(l,f.lat))}toLngLat(){return new vr(360*this.x-180,$f(this.y))}toAltitude(){return this.z*Mm($f(this.y))}meterInMercatorCoordinateUnits(){return 1/Tm*(i=$f(this.y),1/Math.cos(i*Math.PI/180));var i}}function Im(o,i,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[o*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class jf{constructor(i,l,f){this.z=i,this.x=l,this.y=f,this.key=th(0,i,i,l,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,f){const p=(v=this.y,w=this.z,M=Im(256*(y=this.x),256*(v=Math.pow(2,w)-v-1),w),I=Im(256*(y+1),256*(v+1),w),M[0]+","+M[1]+","+I[0]+","+I[1]);var y,v,w,M,I;const L=function(z,B,G){let V,J="";for(let ee=z;ee>0;ee--)V=1<<ee-1,J+=(B&V?1:0)+(G&V?2:0);return J}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,L).replace(/{bbox-epsg-3857}/g,p)}getTilePoint(i){const l=Math.pow(2,this.z);return new qe((i.x*l-this.x)*Lr,(i.y*l-this.y)*Lr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Pm{constructor(i,l){this.wrap=i,this.canonical=l,this.key=th(i,l.z,l.z,l.x,l.y)}}class en{constructor(i,l,f,p,y){this.overscaledZ=i,this.wrap=l,this.canonical=new jf(f,+p,+y),this.key=th(l,i,f,p,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const l=this.canonical.z-i;return i>this.canonical.z?new en(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new en(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){const f=this.canonical.z-i;return i>this.canonical.z?th(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):th(this.wrap*+l,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new en(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,p=2*this.canonical.y;return[new en(l,this.wrap,l,f,p),new en(l,this.wrap,l,f+1,p),new en(l,this.wrap,l,f,p+1),new en(l,this.wrap,l,f+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new en(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new en(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Pm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new jc(i.x-this.wrap,i.y))}}function th(o,i,l,f,p){(o*=2)<0&&(o=-1*o-1);const y=1<<l;return(y*y*o+y*p+f).toString(36)+l.toString(36)+i.toString(36)}Xe("CanonicalTileID",jf),Xe("OverscaledTileID",en,{omit:["posMatrix"]});class Rm{constructor(i,l,f){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void Ae(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const p=this.dim=l.height-2;this.data=new Uint32Array(l.data.buffer),this.encoding=f||"mapbox";for(let y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]}get(i,l){const f=new Uint8Array(this.data.buffer),p=4*this._idx(i,l);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[p],f[p+1],f[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}_unpackMapbox(i,l,f){return(256*i*256+256*l+f)/10-1e4}_unpackTerrarium(i,l,f){return 256*i+l+f/256-32768}getPixels(){return new Xi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=l*this.dim,y=l*this.dim+this.dim,v=f*this.dim,w=f*this.dim+this.dim;switch(l){case-1:p=y-1;break;case 1:y=p+1}switch(f){case-1:v=w-1;break;case 1:w=v+1}const M=-l*this.dim,I=-f*this.dim;for(let L=v;L<w;L++)for(let z=p;z<y;z++)this.data[this._idx(z,L)]=i.data[this._idx(z+M,L+I)]}}Xe("DEMData",Rm);class km{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const f=i[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class Dm{constructor(i,l,f,p,y){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=f,i._y=p,this.properties=i.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i=function(l,f){var p={};for(var y in l)Object.prototype.hasOwnProperty.call(l,y)&&f.indexOf(y)<0&&(p[y]=l[y]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function"){var v=0;for(y=Object.getOwnPropertySymbols(l);v<y.length;v++)f.indexOf(y[v])<0&&Object.prototype.propertyIsEnumerable.call(l,y[v])&&(p[y[v]]=l[y[v]])}return p}(this,["_geometry","_vectorTileFeature"]);return i.geometry=this.geometry,i}}class Lm{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new ms(Lr,16,0),this.grid3D=new ms(Lr,16,0),this.featureIndexArray=new ht,this.promoteId=l}insert(i,l,f,p,y,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,p,y);const M=v?this.grid3D:this.grid;for(let I=0;I<l.length;I++){const L=l[I],z=[1/0,1/0,-1/0,-1/0];for(let B=0;B<L.length;B++){const G=L[B];z[0]=Math.min(z[0],G.x),z[1]=Math.min(z[1],G.y),z[2]=Math.max(z[2],G.x),z[3]=Math.max(z[3],G.y)}z[0]<Lr&&z[1]<Lr&&z[2]>=0&&z[3]>=0&&M.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ua.VectorTile(new Pf(this.rawTileData)).layers,this.sourceLayerCoder=new km(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,f,p){this.loadVTLayers();const y=i.params||{},v=Lr/i.tileSize/i.scale,w=ro(y.filter),M=i.queryGeometry,I=i.queryPadding*v,L=zm(M),z=this.grid.query(L.minX-I,L.minY-I,L.maxX+I,L.maxY+I),B=zm(i.cameraQueryGeometry),G=this.grid3D.query(B.minX-I,B.minY-I,B.maxX+I,B.maxY+I,(ee,le,de,fe)=>function(ye,Ce,Te,je,et){for(const Ge of ye)if(Ce<=Ge.x&&Te<=Ge.y&&je>=Ge.x&&et>=Ge.y)return!0;const Ue=[new qe(Ce,Te),new qe(Ce,et),new qe(je,et),new qe(je,Te)];if(ye.length>2){for(const Ge of Ue)if(bo(ye,Ge))return!0}for(let Ge=0;Ge<ye.length-1;Ge++)if(c0(ye[Ge],ye[Ge+1],Ue))return!0;return!1}(i.cameraQueryGeometry,ee-I,le-I,de+I,fe+I));for(const ee of G)z.push(ee);z.sort(Fv);const V={};let J;for(let ee=0;ee<z.length;ee++){const le=z[ee];if(le===J)continue;J=le;const de=this.featureIndexArray.get(le);let fe=null;this.loadMatchingFeature(V,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,w,y.layers,y.availableImages,l,f,p,(ye,Ce,Te)=>(fe||(fe=ws(ye)),Ce.queryIntersectsFeature(M,ye,Te,fe,this.z,i.transform,v,i.pixelPosMatrix)))}return V}loadMatchingFeature(i,l,f,p,y,v,w,M,I,L,z){const B=this.bucketLayerIDs[l];if(v&&!function(ee,le){for(let de=0;de<ee.length;de++)if(le.indexOf(ee[de])>=0)return!0;return!1}(v,B))return;const G=this.sourceLayerCoder.decode(f),V=this.vtLayers[G].feature(p);if(y.needGeometry){const ee=Es(V,!0);if(!y.filter(new Qt(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!y.filter(new Qt(this.tileID.overscaledZ),V))return;const J=this.getId(V,G);for(let ee=0;ee<B.length;ee++){const le=B[ee];if(v&&v.indexOf(le)<0)continue;const de=M[le];if(!de)continue;let fe={};J&&L&&(fe=L.getState(de.sourceLayer||"_geojsonTileLayer",J));const ye=j({},I[le]);ye.paint=Om(ye.paint,de.paint,V,fe,w),ye.layout=Om(ye.layout,de.layout,V,fe,w);const Ce=!z||z(V,de,fe);if(!Ce)continue;const Te=new Dm(V,this.z,this.x,this.y,J);Te.layer=ye;let je=i[le];je===void 0&&(je=i[le]=[]),je.push({featureIndex:p,feature:Te,intersectionZ:Ce})}}lookupSymbolFeatures(i,l,f,p,y,v,w,M){const I={};this.loadVTLayers();const L=ro(y);for(const z of i)this.loadMatchingFeature(I,f,p,z,L,v,w,M,l);return I}hasLayer(i){for(const l of this.bucketLayerIDs)for(const f of l)if(i===f)return!0;return!1}getId(i,l){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof f=="boolean"&&(f=Number(f))),f}}function Om(o,i,l,f,p){return ge(o,(y,v)=>{const w=i instanceof po?i.get(v):null;return w&&w.evaluate?w.evaluate(l,f,p):w})}function zm(o){let i=1/0,l=1/0,f=-1/0,p=-1/0;for(const y of o)i=Math.min(i,y.x),l=Math.min(l,y.y),f=Math.max(f,y.x),p=Math.max(p,y.y);return{minX:i,minY:l,maxX:f,maxY:p}}function Fv(o,i){return i-o}var Zf;Xe("FeatureIndex",Lm,{omit:["rawTileData","sourceLayerCoder"]}),h.PerformanceMarkers=void 0,(Zf=h.PerformanceMarkers||(h.PerformanceMarkers={})).create="create",Zf.load="load",Zf.fullLoad="fullLoad";let Zc=null,rh=[];const qf=1e3/30,Bv={mark(o){performance.mark(o)},frame(o){const i=o;Zc!=null&&rh.push(i-Zc),Zc=i},clearMetrics(){Zc=null,rh=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const o in h.PerformanceMarkers)performance.clearMarks(h.PerformanceMarkers[o])},getPerformanceMetrics(){performance.measure("loadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.load),performance.measure("fullLoadTime",h.PerformanceMarkers.create,h.PerformanceMarkers.fullLoad);const o=performance.getEntriesByName("loadTime")[0].duration,i=performance.getEntriesByName("fullLoadTime")[0].duration,l=rh.length,f=1/(rh.reduce((y,v)=>y+v,0)/l/1e3),p=rh.filter(y=>y>qf).reduce((y,v)=>y+(v-qf)/qf,0);return{loadTime:o,fullLoadTime:i,fps:f,percentDroppedFrames:p/(l+p)*100}}};h.AJAXError=wi,h.ARRAY_TYPE=Ts,h.Actor=class{constructor(o,i,l){this.target=o,this.parent=i,this.mapId=l,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},re(["receive","process"],this),this.invoker=new zv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ze()?o:window}send(o,i,l,f,p=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(this.callbacks[y]=l);const v=Kt(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!l,targetMapId:f,mustQueue:p,sourceMapId:this.mapId,data:La(i,v)},v),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(o){const i=o.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){delete this.tasks[l];const f=this.cancelCallbacks[l];delete this.cancelCallbacks[l],f&&f()}else ze()||i.mustQueue?(this.tasks[l]=i,this.taskQueue.push(l),this.invoker.trigger()):this.processTask(l,i)}process(){if(!this.taskQueue.length)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){if(i.type==="<response>"){const l=this.callbacks[o];delete this.callbacks[o],l&&(i.error?l(gs(i.error)):l(null,gs(i.data)))}else{let l=!1;const f=Kt(this.globalScope)?void 0:[],p=i.hasCallback?(w,M)=>{l=!0,delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:w?La(w):null,data:La(M,f)},f)}:w=>{l=!0};let y=null;const v=gs(i.data);if(this.parent[i.type])y=this.parent[i.type](i.sourceMapId,v,p);else if(this.parent.getWorkerSource){const w=i.type.split(".");y=this.parent.getWorkerSource(i.sourceMapId,w[0],v.source)[w[1]](v,p)}else p(new Error(`Could not find function ${i.type}`));!l&&y&&y.cancel&&(this.cancelCallbacks[o]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},h.AlphaImage=ql,h.CanonicalTileID=jf,h.CollisionBoxArray=Ee,h.CollisionCircleLayoutArray=class extends A{},h.Color=O,h.DEMData=Rm,h.DataConstantProperty=Je,h.DictionaryCoder=km,h.EXTENT=Lr,h.ErrorEvent=Mn,h.EvaluationParameters=Qt,h.Event=Tn,h.Evented=Qa,h.FeatureIndex=Lm,h.FillBucket=Sf,h.FillExtrusionBucket=Cf,h.GeoJSONFeature=Dm,h.ImageAtlas=im,h.ImagePosition=kf,h.LineBucket=If,h.LineStripIndexArray=class extends se{},h.LngLat=vr,h.LngLatBounds=Ms,h.MercatorCoordinate=jc,h.ONE_EM=$r,h.OverscaledTileID=en,h.PerformanceUtils=Bv,h.PosArray=class extends vs{},h.Properties=_i,h.QuadTriangleArray=class extends F{},h.RGBAImage=Xi,h.RasterBoundsArray=class extends _o{},h.RequestPerformance=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},h.ResourceType=Kn,h.SegmentVector=Vt,h.SymbolBucket=Co,h.Transitionable=Vl,h.TriangleIndexArray=Ci,h.Uniform1f=ca,h.Uniform1i=class extends ha{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},h.Uniform2f=class extends ha{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},h.Uniform3f=class extends ha{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},h.Uniform4f=vo,h.UniformColor=wp,h.UniformMatrix4f=class extends ha{constructor(o,i){super(o,i),this.current=a0}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},h.UnwrappedTileID=Pm,h.ValidationError=Be,h.ZoomHistory=lo,h.addDynamicAttributes=Bf,h.asyncAll=function(o,i,l){if(!o.length)return l(null,[]);let f=o.length;const p=new Array(o.length);let y=null;o.forEach((v,w)=>{i(v,(M,I)=>{M&&(y=M),p[w]=I,--f==0&&l(y,p)})})},h.bezier=C,h.bindAll=re,h.cacheEntryPossiblyAdded=function(o){Ur++,Ur>ci&&(o.getActor().send("enforceCacheSizeLimit",Fi),Ur=0)},h.clamp=R,h.clearTileCache=function(o){const i=caches.delete(Er);o&&i.catch(o).then(()=>o())},h.clipLine=gm,h.clone=function(o){var i=new Ts(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},h.clone$1=be,h.collisionCircleLayout=tv,h.config=Zt,h.create=function(){var o=new Ts(16);return Ts!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},h.createExpression=Qs,h.createFilter=ro,h.createLayout=ur,h.createStyleLayer=function(o){return o.type==="custom"?new Lv(o):new Ov[o.type](o)},h.dot=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},h.ease=P,h.emitValidationErrors=gc,h.enforceCacheSizeLimit=function(o){Nr(),nr&&nr.then(i=>{i.keys().then(l=>{for(let f=0;f<l.length-o;f++)i.delete(l[f])})})},h.evaluateSizeForFeature=hm,h.evaluateSizeForZoom=cm,h.evaluateVariableOffset=vm,h.evented=Ul,h.exported=At,h.exported$1=Rr,h.extend=j,h.filterObject=ce,h.fromValues=Cc,h.getAnchorAlignment=Lf,h.getAnchorJustification=Ff,h.getArrayBuffer=En,h.getImage=Vs,h.getJSON=function(o,i){return Wn(j(o,{type:"json"}),i)},h.getOverlapMode=Vf,h.getRTLTextPluginStatus=Oa,h.getReferrer=kr,h.getVideo=function(o,i){const l=window.document.createElement("video");l.muted=!0,l.onloadstart=function(){i(null,l)};for(let f=0;f<o.length;f++){const p=window.document.createElement("source");hn(o[f])||(l.crossOrigin="Anonymous"),p.src=o[f],l.appendChild(p)}return{cancel:()=>{}}},h.identity=mf,h.invert=function(o,i){var l=i[0],f=i[1],p=i[2],y=i[3],v=i[4],w=i[5],M=i[6],I=i[7],L=i[8],z=i[9],B=i[10],G=i[11],V=i[12],J=i[13],ee=i[14],le=i[15],de=l*w-f*v,fe=l*M-p*v,ye=l*I-y*v,Ce=f*M-p*w,Te=f*I-y*w,je=p*I-y*M,et=L*J-z*V,Ue=L*ee-B*V,Ge=L*le-G*V,Oe=z*ee-B*J,Ze=z*le-G*J,Ve=B*le-G*ee,Pe=de*Ve-fe*Ze+ye*Oe+Ce*Ge-Te*Ue+je*et;return Pe?(o[0]=(w*Ve-M*Ze+I*Oe)*(Pe=1/Pe),o[1]=(p*Ze-f*Ve-y*Oe)*Pe,o[2]=(J*je-ee*Te+le*Ce)*Pe,o[3]=(B*Te-z*je-G*Ce)*Pe,o[4]=(M*Ge-v*Ve-I*Ue)*Pe,o[5]=(l*Ve-p*Ge+y*Ue)*Pe,o[6]=(ee*ye-V*je-le*fe)*Pe,o[7]=(L*je-B*ye+G*fe)*Pe,o[8]=(v*Ze-w*Ge+I*et)*Pe,o[9]=(f*Ge-l*Ze-y*et)*Pe,o[10]=(V*Te-J*ye+le*de)*Pe,o[11]=(z*ye-L*Te-G*de)*Pe,o[12]=(w*Ue-v*Oe-M*et)*Pe,o[13]=(l*Oe-f*Ue+p*et)*Pe,o[14]=(J*fe-V*Ce-ee*de)*Pe,o[15]=(L*Ce-z*fe+B*de)*Pe,o):null},h.isImageBitmap=Ht,h.isSafari=Kt,h.keysDifference=function(o,i){const l=[];for(const f in o)f in i||l.push(f);return l},h.lazyLoadRTLTextPlugin=function(){gi.isLoading()||gi.isLoaded()||Oa()!=="deferred"||xc()},h.makeRequest=Wn,h.mapObject=ge,h.mercatorXfromLng=Sm,h.mercatorYfromLat=Am,h.mercatorZfromAltitude=Cm,h.mul=d0,h.multiply=Pp,h.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},h.number=Tr,h.ortho=function(o,i,l,f,p,y,v){var w=1/(i-l),M=1/(f-p),I=1/(y-v);return o[0]=-2*w,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*M,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*I,o[11]=0,o[12]=(i+l)*w,o[13]=(p+f)*M,o[14]=(v+y)*I,o[15]=1,o},h.parseCacheControl=lt,h.parseGlyphPBF=function(o){return new Pf(o).readFields(fv,[])},h.pbf=Pf,h.performSymbolLayout=function(o,i,l,f,p,y,v){o.createArrays(),o.tilePixelRatio=Lr/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const w=o.layers[0].layout,M=o.layers[0]._unevaluatedLayout._values,I={layoutIconSize:M["icon-size"].possiblyEvaluate(new Qt(o.zoom+1),v),layoutTextSize:M["text-size"].possiblyEvaluate(new Qt(o.zoom+1),v),textMaxSize:M["text-size"].possiblyEvaluate(new Qt(18))};if(o.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:J}=o.textSizeData;I.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Qt(V),v),M["text-size"].possiblyEvaluate(new Qt(J),v)]}if(o.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:J}=o.iconSizeData;I.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Qt(V),v),M["icon-size"].possiblyEvaluate(new Qt(J),v)]}const L=w.get("text-line-height")*$r,z=w.get("text-rotation-alignment")==="map"&&w.get("symbol-placement")!=="point",B=w.get("text-keep-upright"),G=w.get("text-size");for(const V of o.features){const J=w.get("text-font").evaluate(V,{},v).join(","),ee=G.evaluate(V,{},v),le=I.layoutTextSize.evaluate(V,{},v),de=I.layoutIconSize.evaluate(V,{},v),fe={horizontal:{},vertical:void 0},ye=V.text;let Ce,Te=[0,0];if(ye){const Ue=ye.toString(),Ge=w.get("text-letter-spacing").evaluate(V,{},v)*$r,Oe=sf(Ue)?Ge:0,Ze=w.get("text-anchor").evaluate(V,{},v),Ve=w.get("text-variable-anchor");if(!Ve){const Ft=w.get("text-radial-offset").evaluate(V,{},v);Te=Ft?vm(Ze,[Ft*$r,zf]):w.get("text-offset").evaluate(V,{},v).map(tr=>tr*$r)}let Pe=z?"center":w.get("text-justify").evaluate(V,{},v);const at=w.get("symbol-placement"),tt=at==="point"?w.get("text-max-width").evaluate(V,{},v)*$r:0,St=()=>{o.allowVerticalPlacement&&ho(Ue)&&(fe.vertical=zc(ye,i,l,p,J,tt,L,Ze,"left",Oe,Te,h.WritingMode.vertical,!0,at,le,ee))};if(!z&&Ve){const Ft=Pe==="auto"?Ve.map(rr=>Ff(rr)):[Pe];let tr=!1;for(let rr=0;rr<Ft.length;rr++){const Hr=Ft[rr];if(!fe.horizontal[Hr])if(tr)fe.horizontal[Hr]=fe.horizontal[0];else{const Sr=zc(ye,i,l,p,J,tt,L,"center",Hr,Oe,Te,h.WritingMode.horizontal,!1,at,le,ee);Sr&&(fe.horizontal[Hr]=Sr,tr=Sr.positionedLines.length===1)}}St()}else{Pe==="auto"&&(Pe=Ff(Ze));const Ft=zc(ye,i,l,p,J,tt,L,Ze,Pe,Oe,Te,h.WritingMode.horizontal,!1,at,le,ee);Ft&&(fe.horizontal[Pe]=Ft),St(),ho(Ue)&&z&&B&&(fe.vertical=zc(ye,i,l,p,J,tt,L,Ze,Pe,Oe,Te,h.WritingMode.vertical,!1,at,le,ee))}}let je=!1;if(V.icon&&V.icon.name){const Ue=f[V.icon.name];Ue&&(Ce=yv(p[V.icon.name],w.get("icon-offset").evaluate(V,{},v),w.get("icon-anchor").evaluate(V,{},v)),je=!!Ue.sdf,o.sdfIcons===void 0?o.sdfIcons=je:o.sdfIcons!==je&&Ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ue.pixelRatio!==o.pixelRatio||w.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}const et=bm(fe.horizontal)||fe.vertical;o.iconsInText=!!et&&et.iconsInText,(et||Ce)&&Sv(o,V,fe,Ce,f,I,le,de,Te,je,v)}y&&o.generateCollisionDebugBuffers()},h.perspective=function(o,i,l,f,p){var y,v=1/Math.tan(i/2);return o[0]=v/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=v,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,p!=null&&p!==1/0?(o[10]=(p+f)*(y=1/(f-p)),o[14]=2*p*f*y):(o[10]=-1,o[14]=-2*f),o},h.pick=function(o,i){const l={};for(let f=0;f<i.length;f++){const p=i[f];p in o&&(l[p]=o[p])}return l},h.plugin=gi,h.pointGeometry=qe,h.polygonIntersectsPolygon=Sp,h.potpack=rm,h.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],h.register=Xe,h.registerForPluginStateChange=function(o){return o({pluginStatus:mi,pluginURL:Rn}),Ul.on("pluginStateChange",o),o},h.renderColorRamp=Lp,h.rotateX=function(o,i,l){var f=Math.sin(l),p=Math.cos(l),y=i[4],v=i[5],w=i[6],M=i[7],I=i[8],L=i[9],z=i[10],B=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=y*p+I*f,o[5]=v*p+L*f,o[6]=w*p+z*f,o[7]=M*p+B*f,o[8]=I*p-y*f,o[9]=L*p-v*f,o[10]=z*p-w*f,o[11]=B*p-M*f,o},h.rotateZ=function(o,i,l){var f=Math.sin(l),p=Math.cos(l),y=i[0],v=i[1],w=i[2],M=i[3],I=i[4],L=i[5],z=i[6],B=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=y*p+I*f,o[1]=v*p+L*f,o[2]=w*p+z*f,o[3]=M*p+B*f,o[4]=I*p-y*f,o[5]=L*p-v*f,o[6]=z*p-w*f,o[7]=B*p-M*f,o},h.scale=function(o,i,l){var f=l[0],p=l[1],y=l[2];return o[0]=i[0]*f,o[1]=i[1]*f,o[2]=i[2]*f,o[3]=i[3]*f,o[4]=i[4]*p,o[5]=i[5]*p,o[6]=i[6]*p,o[7]=i[7]*p,o[8]=i[8]*y,o[9]=i[9]*y,o[10]=i[10]*y,o[11]=i[11]*y,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},h.scale$1=function(o,i,l){return o[0]=i[0]*l,o[1]=i[1]*l,o[2]=i[2]*l,o[3]=i[3]*l,o},h.setCacheLimits=function(o,i){Fi=o,ci=i},h.setRTLTextPlugin=function(o,i,l=!1){if(mi===zl||mi===uo||mi===Fl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Rn=At.resolveURL(o),mi=zl,Bl=i,Nl(),l||xc()},h.spec=xe,h.sphericalToCartesian=function([o,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(l),y:o*Math.sin(i)*Math.sin(l),z:o*Math.cos(l)}},h.symbolSize=vv,h.toEvaluationFeature=Es,h.transformMat4=Ic,h.translate=function(o,i,l){var f,p,y,v,w,M,I,L,z,B,G,V,J=l[0],ee=l[1],le=l[2];return i===o?(o[12]=i[0]*J+i[4]*ee+i[8]*le+i[12],o[13]=i[1]*J+i[5]*ee+i[9]*le+i[13],o[14]=i[2]*J+i[6]*ee+i[10]*le+i[14],o[15]=i[3]*J+i[7]*ee+i[11]*le+i[15]):(p=i[1],y=i[2],v=i[3],w=i[4],M=i[5],I=i[6],L=i[7],z=i[8],B=i[9],G=i[10],V=i[11],o[0]=f=i[0],o[1]=p,o[2]=y,o[3]=v,o[4]=w,o[5]=M,o[6]=I,o[7]=L,o[8]=z,o[9]=B,o[10]=G,o[11]=V,o[12]=f*J+w*ee+z*le+i[12],o[13]=p*J+M*ee+B*le+i[13],o[14]=y*J+I*ee+G*le+i[14],o[15]=v*J+L*ee+V*le+i[15]),o},h.triggerPluginCompletionEvent=vc,h.unicodeBlockLookup=Fe,h.uniqueId=function(){return H++},h.validateCustomStyleLayer=function(o){const i=[],l=o.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},h.validateLight=kl,h.validateStyle=ps,h.vectorTile=Ua,h.warnOnce=Ae,h.wrap=U}),u(["./shared"],function(h){function b(X){const k=typeof X;if(k==="number"||k==="boolean"||k==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){let K="[";for(const W of X)K+=`${b(W)},`;return`${K}]`}const O=Object.keys(X).sort();let $="{";for(let K=0;K<O.length;K++)$+=`${JSON.stringify(O[K])}:${b(X[O[K]])},`;return`${$}}`}function T(X){let k="";for(const O of h.refProperties)k+=`/${b(X[O])}`;return k}class C{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,O){for(const K of k){this._layerConfigs[K.id]=K;const W=this._layers[K.id]=h.createStyleLayer(K);W._featureFilter=h.createFilter(W.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of O)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const $=function(K,W){const ae={};for(let ie=0;ie<K.length;ie++){const oe=W&&W[K[ie].id]||T(K[ie]);W&&(W[K[ie].id]=oe);let _e=ae[oe];_e||(_e=ae[oe]=[]),_e.push(K[ie])}const te=[];for(const ie in ae)te.push(ae[ie]);return te}(Object.values(this._layerConfigs),this.keyCache);for(const K of $){const W=K.map(Se=>this._layers[Se.id]),ae=W[0];if(ae.visibility==="none")continue;const te=ae.source||"";let ie=this.familiesBySource[te];ie||(ie=this.familiesBySource[te]={});const oe=ae.sourceLayer||"_geojsonTileLayer";let _e=ie[oe];_e||(_e=ie[oe]=[]),_e.push(W)}}}class P{constructor(k){const O={},$=[];for(const te in k){const ie=k[te],oe=O[te]={};for(const _e in ie){const Se=ie[+_e];if(!Se||Se.bitmap.width===0||Se.bitmap.height===0)continue;const me={x:0,y:0,w:Se.bitmap.width+2,h:Se.bitmap.height+2};$.push(me),oe[_e]={rect:me,metrics:Se.metrics}}}const{w:K,h:W}=h.potpack($),ae=new h.AlphaImage({width:K||1,height:W||1});for(const te in k){const ie=k[te];for(const oe in ie){const _e=ie[+oe];if(!_e||_e.bitmap.width===0||_e.bitmap.height===0)continue;const Se=O[te][oe].rect;h.AlphaImage.copy(_e.bitmap,ae,{x:0,y:0},{x:Se.x+1,y:Se.y+1},_e.bitmap)}}this.image=ae,this.positions=O}}h.register("GlyphAtlas",P);class R{constructor(k){this.tileID=new h.OverscaledTileID(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId}parse(k,O,$,K,W){this.status="parsing",this.data=k,this.collisionBoxArray=new h.CollisionBoxArray;const ae=new h.DictionaryCoder(Object.keys(k.layers).sort()),te=new h.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];const ie={},oe={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},_e=O.familiesBySource[this.source];for(const yt in _e){const mt=k.layers[yt];if(!mt)continue;mt.version===1&&h.warnOnce(`Vector tile source "${this.source}" layer "${yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const gt=ae.encode(yt),ar=[];for(let mr=0;mr<mt.length;mr++){const zr=mt.feature(mr),In=te.getId(zr,yt);ar.push({feature:zr,id:In,index:mr,sourceLayerIndex:gt})}for(const mr of _e[yt]){const zr=mr[0];zr.minzoom&&this.zoom<Math.floor(zr.minzoom)||zr.maxzoom&&this.zoom>=zr.maxzoom||zr.visibility!=="none"&&(U(mr,this.zoom,$),(ie[zr.id]=zr.createBucket({index:te.bucketLayerIDs.length,layers:mr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gt,sourceID:this.source})).populate(ar,oe,this.tileID.canonical),te.bucketLayerIDs.push(mr.map(In=>In.id)))}}let Se,me,He,Ne;const Ye=h.mapObject(oe.glyphDependencies,yt=>Object.keys(yt).map(Number));Object.keys(Ye).length?K.send("getGlyphs",{uid:this.uid,stacks:Ye},(yt,mt)=>{Se||(Se=yt,me=mt,Et.call(this))}):me={};const nt=Object.keys(oe.iconDependencies);nt.length?K.send("getImages",{icons:nt,source:this.source,tileID:this.tileID,type:"icons"},(yt,mt)=>{Se||(Se=yt,He=mt,Et.call(this))}):He={};const It=Object.keys(oe.patternDependencies);function Et(){if(Se)return W(Se);if(me&&He&&Ne){const yt=new P(me),mt=new h.ImageAtlas(He,Ne);for(const gt in ie){const ar=ie[gt];ar instanceof h.SymbolBucket?(U(ar.layers,this.zoom,$),h.performSymbolLayout(ar,me,yt.positions,He,mt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ar.hasPattern&&(ar instanceof h.LineBucket||ar instanceof h.FillBucket||ar instanceof h.FillExtrusionBucket)&&(U(ar.layers,this.zoom,$),ar.addFeatures(oe,this.tileID.canonical,mt.patternPositions))}this.status="done",W(null,{buckets:Object.values(ie).filter(gt=>!gt.isEmpty()),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:yt.image,imageAtlas:mt,glyphMap:this.returnDependencies?me:null,iconMap:this.returnDependencies?He:null,glyphPositions:this.returnDependencies?yt.positions:null})}}It.length?K.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},(yt,mt)=>{Se||(Se=yt,Ne=mt,Et.call(this))}):Ne={},Et.call(this)}}function U(X,k,O){const $=new h.EvaluationParameters(k);for(const K of X)K.recalculate($,O)}function j(X,k){const O=h.getArrayBuffer(X.request,($,K,W,ae)=>{$?k($):K&&k(null,{vectorTile:new h.vectorTile.VectorTile(new h.pbf(K)),rawData:K,cacheControl:W,expires:ae})});return()=>{O.cancel(),k()}}class H{constructor(k,O,$,K){this.actor=k,this.layerIndex=O,this.availableImages=$,this.loadVectorData=K||j,this.loading={},this.loaded={}}loadTile(k,O){const $=k.uid;this.loading||(this.loading={});const K=!!(k&&k.request&&k.request.collectResourceTiming)&&new h.RequestPerformance(k.request),W=this.loading[$]=new R(k);W.abort=this.loadVectorData(k,(ae,te)=>{if(delete this.loading[$],ae||!te)return W.status="done",this.loaded[$]=W,O(ae);const ie=te.rawData,oe={};te.expires&&(oe.expires=te.expires),te.cacheControl&&(oe.cacheControl=te.cacheControl);const _e={};if(K){const Se=K.finish();Se&&(_e.resourceTiming=JSON.parse(JSON.stringify(Se)))}W.vectorTile=te.vectorTile,W.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,(Se,me)=>{if(Se||!me)return O(Se);O(null,h.extend({rawTileData:ie.slice(0)},me,oe,_e))}),this.loaded=this.loaded||{},this.loaded[$]=W})}reloadTile(k,O){const $=this.loaded,K=k.uid,W=this;if($&&$[K]){const ae=$[K];ae.showCollisionBoxes=k.showCollisionBoxes;const te=(ie,oe)=>{const _e=ae.reloadCallback;_e&&(delete ae.reloadCallback,ae.parse(ae.vectorTile,W.layerIndex,this.availableImages,W.actor,_e)),O(ie,oe)};ae.status==="parsing"?ae.reloadCallback=te:ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}}abortTile(k,O){const $=this.loading,K=k.uid;$&&$[K]&&$[K].abort&&($[K].abort(),delete $[K]),O()}removeTile(k,O){const $=this.loaded,K=k.uid;$&&$[K]&&delete $[K],O()}}class re{constructor(){this.loaded={}}loadTile(k,O){const{uid:$,encoding:K,rawImageData:W}=k,ae=h.isImageBitmap(W)?this.getImageData(W):W,te=new h.DEMData($,ae,K);this.loaded=this.loaded||{},this.loaded[$]=te,O(null,te)}getImageData(k){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const O=this.offscreenCanvasContext.getImageData(-1,-1,k.width+2,k.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new h.RGBAImage({width:O.width,height:O.height},O.data)}removeTile(k){const O=this.loaded,$=k.uid;O&&O[$]&&delete O[$]}}var ge=function X(k,O){var $,K=k&&k.type;if(K==="FeatureCollection")for($=0;$<k.features.length;$++)X(k.features[$],O);else if(K==="GeometryCollection")for($=0;$<k.geometries.length;$++)X(k.geometries[$],O);else if(K==="Feature")X(k.geometry,O);else if(K==="Polygon")ce(k.coordinates,O);else if(K==="MultiPolygon")for($=0;$<k.coordinates.length;$++)ce(k.coordinates[$],O);return k};function ce(X,k){if(X.length!==0){be(X[0],k);for(var O=1;O<X.length;O++)be(X[O],!k)}}function be(X,k){for(var O=0,$=0,K=0,W=X.length,ae=W-1;K<W;ae=K++){var te=(X[K][0]-X[ae][0])*(X[ae][1]+X[K][1]),ie=O+te;$+=Math.abs(O)>=Math.abs(te)?O-ie+te:te-ie+O,O=ie}O+$>=0!=!!k&&X.reverse()}const we=h.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ae{constructor(k){this._feature=k,this.extent=h.EXTENT,this.type=k.type,this.properties=k.tags,"id"in k&&!isNaN(k.id)&&(this.id=parseInt(k.id,10))}loadGeometry(){if(this._feature.type===1){const k=[];for(const O of this._feature.geometry)k.push([new h.pointGeometry(O[0],O[1])]);return k}{const k=[];for(const O of this._feature.geometry){const $=[];for(const K of O)$.push(new h.pointGeometry(K[0],K[1]));k.push($)}return k}}toGeoJSON(k,O,$){return we.call(this,k,O,$)}}class De{constructor(k){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.EXTENT,this.length=k.length,this._features=k}feature(k){return new Ae(this._features[k])}}var it={exports:{}},ze=h.pointGeometry,lt=h.vectorTile.VectorTileFeature,ct=Rt;function Rt(X,k){this.options=k||{},this.features=X,this.length=X.length}function Bt(X,k){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=k||4096}Rt.prototype.feature=function(X){return new Bt(this.features[X],this.options.extent)},Bt.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var k=0;k<X.length;k++){for(var O=X[k],$=[],K=0;K<O.length;K++)$.push(new ze(O[K][0],O[K][1]));this.geometry.push($)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,k=1/0,O=-1/0,$=1/0,K=-1/0,W=0;W<X.length;W++)for(var ae=X[W],te=0;te<ae.length;te++){var ie=ae[te];k=Math.min(k,ie.x),O=Math.max(O,ie.x),$=Math.min($,ie.y),K=Math.max(K,ie.y)}return[k,$,O,K]},Bt.prototype.toGeoJSON=lt.prototype.toGeoJSON;var Kt=h.pbf,Ht=ct;function At(X){var k=new Kt;return function(O,$){for(var K in O.layers)$.writeMessage(3,qe,O.layers[K])}(X,k),k.finish()}function qe(X,k){var O;k.writeVarintField(15,X.version||1),k.writeStringField(1,X.name||""),k.writeVarintField(5,X.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<X.length;O++)$.feature=X.feature(O),k.writeMessage(2,Ut,$);var K=$.keys;for(O=0;O<K.length;O++)k.writeStringField(3,K[O]);var W=$.values;for(O=0;O<W.length;O++)k.writeMessage(4,Fi,W[O])}function Ut(X,k){var O=X.feature;O.id!==void 0&&k.writeVarintField(1,O.id),k.writeMessage(2,Zt,X),k.writeVarintField(3,O.type),k.writeMessage(4,qr,O)}function Zt(X,k){var O=X.feature,$=X.keys,K=X.values,W=X.keycache,ae=X.valuecache;for(var te in O.properties){var ie=O.properties[te],oe=W[te];if(ie!==null){oe===void 0&&($.push(te),W[te]=oe=$.length-1),k.writeVarint(oe);var _e=typeof ie;_e!=="string"&&_e!=="boolean"&&_e!=="number"&&(ie=JSON.stringify(ie));var Se=_e+":"+ie,me=ae[Se];me===void 0&&(K.push(ie),ae[Se]=me=K.length-1),k.writeVarint(me)}}}function Er(X,k){return(k<<3)+(7&X)}function nr(X){return X<<1^X>>31}function qr(X,k){for(var O=X.loadGeometry(),$=X.type,K=0,W=0,ae=O.length,te=0;te<ae;te++){var ie=O[te],oe=1;$===1&&(oe=ie.length),k.writeVarint(Er(1,oe));for(var _e=$===3?ie.length-1:ie.length,Se=0;Se<_e;Se++){Se===1&&$!==1&&k.writeVarint(Er(2,_e-1));var me=ie[Se].x-K,He=ie[Se].y-W;k.writeVarint(nr(me)),k.writeVarint(nr(He)),K+=me,W+=He}$===3&&k.writeVarint(Er(7,1))}}function Fi(X,k){var O=typeof X;O==="string"?k.writeStringField(1,X):O==="boolean"?k.writeBooleanField(7,X):O==="number"&&(X%1!=0?k.writeDoubleField(3,X):X<0?k.writeSVarintField(6,X):k.writeVarintField(5,X))}it.exports=At,it.exports.fromVectorTileJs=At,it.exports.fromGeojsonVt=function(X,k){k=k||{};var O={};for(var $ in X)O[$]=new Ht(X[$].features,k),O[$].name=$,O[$].version=k.version,O[$].extent=k.extent;return At({layers:O})},it.exports.GeoJSONWrapper=Ht;var ci=it.exports;function Nr(X,k,O,$,K,W){if(K-$<=O)return;const ae=$+K>>1;Ur(X,k,ae,$,K,W%2),Nr(X,k,O,$,ae-1,W+1),Nr(X,k,O,ae+1,K,W+1)}function Ur(X,k,O,$,K,W){for(;K>$;){if(K-$>600){const oe=K-$+1,_e=O-$+1,Se=Math.log(oe),me=.5*Math.exp(2*Se/3),He=.5*Math.sqrt(Se*me*(oe-me)/oe)*(_e-oe/2<0?-1:1);Ur(X,k,O,Math.max($,Math.floor(O-_e*me/oe+He)),Math.min(K,Math.floor(O+(oe-_e)*me/oe+He)),W)}const ae=k[2*O+W];let te=$,ie=K;for(Rr(X,k,$,O),k[2*K+W]>ae&&Rr(X,k,$,K);te<ie;){for(Rr(X,k,te,ie),te++,ie--;k[2*te+W]<ae;)te++;for(;k[2*ie+W]>ae;)ie--}k[2*$+W]===ae?Rr(X,k,$,ie):(ie++,Rr(X,k,ie,K)),ie<=O&&($=ie+1),O<=ie&&(K=ie-1)}}function Rr(X,k,O,$){ri(X,O,$),ri(k,2*O,2*$),ri(k,2*O+1,2*$+1)}function ri(X,k,O){const $=X[k];X[k]=X[O],X[O]=$}function ui(X,k,O,$){const K=X-O,W=k-$;return K*K+W*W}const Gr=X=>X[0],qn=X=>X[1];class Xn{constructor(k,O=Gr,$=qn,K=64,W=Float64Array){this.nodeSize=K,this.points=k;const ae=k.length<65536?Uint16Array:Uint32Array,te=this.ids=new ae(k.length),ie=this.coords=new W(2*k.length);for(let oe=0;oe<k.length;oe++)te[oe]=oe,ie[2*oe]=O(k[oe]),ie[2*oe+1]=$(k[oe]);Nr(te,ie,K,0,te.length-1,0)}range(k,O,$,K){return function(W,ae,te,ie,oe,_e,Se){const me=[0,W.length-1,0],He=[];let Ne,Ye;for(;me.length;){const nt=me.pop(),It=me.pop(),Et=me.pop();if(It-Et<=Se){for(let gt=Et;gt<=It;gt++)Ne=ae[2*gt],Ye=ae[2*gt+1],Ne>=te&&Ne<=oe&&Ye>=ie&&Ye<=_e&&He.push(W[gt]);continue}const yt=Math.floor((Et+It)/2);Ne=ae[2*yt],Ye=ae[2*yt+1],Ne>=te&&Ne<=oe&&Ye>=ie&&Ye<=_e&&He.push(W[yt]);const mt=(nt+1)%2;(nt===0?te<=Ne:ie<=Ye)&&(me.push(Et),me.push(yt-1),me.push(mt)),(nt===0?oe>=Ne:_e>=Ye)&&(me.push(yt+1),me.push(It),me.push(mt))}return He}(this.ids,this.coords,k,O,$,K,this.nodeSize)}within(k,O,$){return function(K,W,ae,te,ie,oe){const _e=[0,K.length-1,0],Se=[],me=ie*ie;for(;_e.length;){const He=_e.pop(),Ne=_e.pop(),Ye=_e.pop();if(Ne-Ye<=oe){for(let mt=Ye;mt<=Ne;mt++)ui(W[2*mt],W[2*mt+1],ae,te)<=me&&Se.push(K[mt]);continue}const nt=Math.floor((Ye+Ne)/2),It=W[2*nt],Et=W[2*nt+1];ui(It,Et,ae,te)<=me&&Se.push(K[nt]);const yt=(He+1)%2;(He===0?ae-ie<=It:te-ie<=Et)&&(_e.push(Ye),_e.push(nt-1),_e.push(yt)),(He===0?ae+ie>=It:te+ie>=Et)&&(_e.push(nt+1),_e.push(Ne),_e.push(yt))}return Se}(this.ids,this.coords,k,O,$,this.nodeSize)}}const Kn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},wi=Math.fround||(kr=new Float32Array(1),X=>(kr[0]=+X,kr[0]));var kr;class Hn{constructor(k){this.options=cn(Object.create(Kn),k),this.trees=new Array(this.options.maxZoom+1)}load(k){const{log:O,minZoom:$,maxZoom:K,nodeSize:W}=this.options;O&&console.time("total time");const ae=`prepare ${k.length} points`;O&&console.time(ae),this.points=k;let te=[];for(let ie=0;ie<k.length;ie++)k[ie].geometry&&te.push(En(k[ie],ie));this.trees[K+1]=new Xn(te,Ct,Tn,W,Float32Array),O&&console.timeEnd(ae);for(let ie=K;ie>=$;ie--){const oe=+Date.now();te=this._cluster(te,ie),this.trees[ie]=new Xn(te,Ct,Tn,W,Float32Array),O&&console.log("z%d: %d clusters in %dms",ie,te.length,+Date.now()-oe)}return O&&console.timeEnd("total time"),this}getClusters(k,O){let $=((k[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,k[1]));let W=k[2]===180?180:((k[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)$=-180,W=180;else if($>W){const _e=this.getClusters([$,K,180,ae],O),Se=this.getClusters([-180,K,W,ae],O);return _e.concat(Se)}const te=this.trees[this._limitZoom(O)],ie=te.range(Ei($),Vi(ae),Ei(W),Vi(K)),oe=[];for(const _e of ie){const Se=te.points[_e];oe.push(Se.numPoints?hn(Se):this.points[Se.index])}return oe}getChildren(k){const O=this._getOriginId(k),$=this._getOriginZoom(k),K="No cluster with the specified id.",W=this.trees[$];if(!W)throw new Error(K);const ae=W.points[O];if(!ae)throw new Error(K);const te=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ie=W.within(ae.x,ae.y,te),oe=[];for(const _e of ie){const Se=W.points[_e];Se.parentId===k&&oe.push(Se.numPoints?hn(Se):this.points[Se.index])}if(oe.length===0)throw new Error(K);return oe}getLeaves(k,O,$){const K=[];return this._appendLeaves(K,k,O=O||10,$=$||0,0),K}getTile(k,O,$){const K=this.trees[this._limitZoom(k)],W=Math.pow(2,k),{extent:ae,radius:te}=this.options,ie=te/ae,oe=($-ie)/W,_e=($+1+ie)/W,Se={features:[]};return this._addTileFeatures(K.range((O-ie)/W,oe,(O+1+ie)/W,_e),K.points,O,$,W,Se),O===0&&this._addTileFeatures(K.range(1-ie/W,oe,1,_e),K.points,W,$,W,Se),O===W-1&&this._addTileFeatures(K.range(0,oe,ie/W,_e),K.points,-1,$,W,Se),Se.features.length?Se:null}getClusterExpansionZoom(k){let O=this._getOriginZoom(k)-1;for(;O<=this.options.maxZoom;){const $=this.getChildren(k);if(O++,$.length!==1)break;k=$[0].properties.cluster_id}return O}_appendLeaves(k,O,$,K,W){const ae=this.getChildren(O);for(const te of ae){const ie=te.properties;if(ie&&ie.cluster?W+ie.point_count<=K?W+=ie.point_count:W=this._appendLeaves(k,ie.cluster_id,$,K,W):W<K?W++:k.push(te),k.length===$)break}return W}_addTileFeatures(k,O,$,K,W,ae){for(const te of k){const ie=O[te],oe=ie.numPoints;let _e,Se,me;if(oe)_e=Ja(ie),Se=ie.x,me=ie.y;else{const Ye=this.points[ie.index];_e=Ye.properties,Se=Ei(Ye.geometry.coordinates[0]),me=Vi(Ye.geometry.coordinates[1])}const He={type:1,geometry:[[Math.round(this.options.extent*(Se*W-$)),Math.round(this.options.extent*(me*W-K))]],tags:_e};let Ne;oe?Ne=ie.id:this.options.generateId?Ne=ie.index:this.points[ie.index].id&&(Ne=this.points[ie.index].id),Ne!==void 0&&(He.id=Ne),ae.features.push(He)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(+k,this.options.maxZoom+1))}_cluster(k,O){const $=[],{radius:K,extent:W,reduce:ae,minPoints:te}=this.options,ie=K/(W*Math.pow(2,O));for(let oe=0;oe<k.length;oe++){const _e=k[oe];if(_e.zoom<=O)continue;_e.zoom=O;const Se=this.trees[O+1],me=Se.within(_e.x,_e.y,ie),He=_e.numPoints||1;let Ne=He;for(const Ye of me){const nt=Se.points[Ye];nt.zoom>O&&(Ne+=nt.numPoints||1)}if(Ne>He&&Ne>=te){let Ye=_e.x*He,nt=_e.y*He,It=ae&&He>1?this._map(_e,!0):null;const Et=(oe<<5)+(O+1)+this.points.length;for(const yt of me){const mt=Se.points[yt];if(mt.zoom<=O)continue;mt.zoom=O;const gt=mt.numPoints||1;Ye+=mt.x*gt,nt+=mt.y*gt,mt.parentId=Et,ae&&(It||(It=this._map(_e,!0)),ae(It,this._map(mt)))}_e.parentId=Et,$.push(Wn(Ye/Ne,nt/Ne,Et,Ne,It))}else if($.push(_e),Ne>1)for(const Ye of me){const nt=Se.points[Ye];nt.zoom<=O||(nt.zoom=O,$.push(nt))}}return $}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,O){if(k.numPoints)return O?cn({},k.properties):k.properties;const $=this.points[k.index].properties,K=this.options.map($);return O&&K===$?cn({},K):K}}function Wn(X,k,O,$,K){return{x:wi(X),y:wi(k),zoom:1/0,id:O,parentId:-1,numPoints:$,properties:K}}function En(X,k){const[O,$]=X.geometry.coordinates;return{x:wi(Ei(O)),y:wi(Vi($)),zoom:1/0,index:k,parentId:-1}}function hn(X){return{type:"Feature",id:X.id,properties:Ja(X),geometry:{type:"Point",coordinates:[(k=X.x,360*(k-.5)),Vs(X.y)]}};var k}function Ja(X){const k=X.numPoints,O=k>=1e4?`${Math.round(k/1e3)}k`:k>=1e3?Math.round(k/100)/10+"k":k;return cn(cn({},X.properties),{cluster:!0,cluster_id:X.id,point_count:k,point_count_abbreviated:O})}function Ei(X){return X/360+.5}function Vi(X){const k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function Vs(X){const k=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function cn(X,k){for(const O in k)X[O]=k[O];return X}function Ct(X){return X.x}function Tn(X){return X.y}function Mn(X,k,O,$){for(var K,W=$,ae=O-k>>1,te=O-k,ie=X[k],oe=X[k+1],_e=X[O],Se=X[O+1],me=k+3;me<O;me+=3){var He=Qa(X[me],X[me+1],ie,oe,_e,Se);if(He>W)K=me,W=He;else if(He===W){var Ne=Math.abs(me-ae);Ne<te&&(K=me,te=Ne)}}W>$&&(K-k>3&&Mn(X,k,K,$),X[K+2]=W,O-K>3&&Mn(X,K,O,$))}function Qa(X,k,O,$,K,W){var ae=K-O,te=W-$;if(ae!==0||te!==0){var ie=((X-O)*ae+(k-$)*te)/(ae*ae+te*te);ie>1?(O=K,$=W):ie>0&&(O+=ae*ie,$+=te*ie)}return(ae=X-O)*ae+(te=k-$)*te}function xe(X,k,O,$){var K={id:X===void 0?null:X,type:k,geometry:O,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(W){var ae=W.geometry,te=W.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")Be(W,ae);else if(te==="Polygon"||te==="MultiLineString")for(var ie=0;ie<ae.length;ie++)Be(W,ae[ie]);else if(te==="MultiPolygon")for(ie=0;ie<ae.length;ie++)for(var oe=0;oe<ae[ie].length;oe++)Be(W,ae[ie][oe])}(K),K}function Be(X,k){for(var O=0;O<k.length;O+=3)X.minX=Math.min(X.minX,k[O]),X.minY=Math.min(X.minY,k[O+1]),X.maxX=Math.max(X.maxX,k[O]),X.maxY=Math.max(X.maxY,k[O+1])}function Yn(X,k,O,$){if(k.geometry){var K=k.geometry.coordinates,W=k.geometry.type,ae=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),te=[],ie=k.id;if(O.promoteId?ie=k.properties[O.promoteId]:O.generateId&&(ie=$||0),W==="Point")Yi(K,te);else if(W==="MultiPoint")for(var oe=0;oe<K.length;oe++)Yi(K[oe],te);else if(W==="LineString")Jt(K,te,ae,!1);else if(W==="MultiLineString"){if(O.lineMetrics){for(oe=0;oe<K.length;oe++)Jt(K[oe],te=[],ae,!1),X.push(xe(ie,"LineString",te,k.properties));return}fi(K,te,ae,!1)}else if(W==="Polygon")fi(K,te,ae,!0);else{if(W!=="MultiPolygon"){if(W==="GeometryCollection"){for(oe=0;oe<k.geometry.geometries.length;oe++)Yn(X,{id:ie,geometry:k.geometry.geometries[oe],properties:k.properties},O,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(oe=0;oe<K.length;oe++){var _e=[];fi(K[oe],_e,ae,!0),te.push(_e)}}X.push(xe(ie,W,te,k.properties))}}function Yi(X,k){k.push(di(X[0])),k.push(Sn(X[1])),k.push(0)}function Jt(X,k,O,$){for(var K,W,ae=0,te=0;te<X.length;te++){var ie=di(X[te][0]),oe=Sn(X[te][1]);k.push(ie),k.push(oe),k.push(0),te>0&&(ae+=$?(K*oe-ie*W)/2:Math.sqrt(Math.pow(ie-K,2)+Math.pow(oe-W,2))),K=ie,W=oe}var _e=k.length-3;k[2]=1,Mn(k,0,_e,O),k[_e+2]=1,k.size=Math.abs(ae),k.start=0,k.end=k.size}function fi(X,k,O,$){for(var K=0;K<X.length;K++){var W=[];Jt(X[K],W,O,$),k.push(W)}}function di(X){return X/360+.5}function Sn(X){var k=Math.sin(X*Math.PI/180),O=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return O<0?0:O>1?1:O}function Xr(X,k,O,$,K,W,ae,te){if($/=k,W>=(O/=k)&&ae<$)return X;if(ae<O||W>=$)return null;for(var ie=[],oe=0;oe<X.length;oe++){var _e=X[oe],Se=_e.geometry,me=_e.type,He=K===0?_e.minX:_e.minY,Ne=K===0?_e.maxX:_e.maxY;if(He>=O&&Ne<$)ie.push(_e);else if(!(Ne<O||He>=$)){var Ye=[];if(me==="Point"||me==="MultiPoint")ke(Se,Ye,O,$,K);else if(me==="LineString")pt(Se,Ye,O,$,K,!1,te.lineMetrics);else if(me==="MultiLineString")pi(Se,Ye,O,$,K,!1);else if(me==="Polygon")pi(Se,Ye,O,$,K,!0);else if(me==="MultiPolygon")for(var nt=0;nt<Se.length;nt++){var It=[];pi(Se[nt],It,O,$,K,!0),It.length&&Ye.push(It)}if(Ye.length){if(te.lineMetrics&&me==="LineString"){for(nt=0;nt<Ye.length;nt++)ie.push(xe(_e.id,me,Ye[nt],_e.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(Ye.length===1?(me="LineString",Ye=Ye[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=Ye.length===3?"Point":"MultiPoint"),ie.push(xe(_e.id,me,Ye,_e.tags))}}}return ie.length?ie:null}function ke(X,k,O,$,K){for(var W=0;W<X.length;W+=3){var ae=X[W+K];ae>=O&&ae<=$&&(k.push(X[W]),k.push(X[W+1]),k.push(X[W+2]))}}function pt(X,k,O,$,K,W,ae){for(var te,ie,oe=ft(X),_e=K===0?dt:Jn,Se=X.start,me=0;me<X.length-3;me+=3){var He=X[me],Ne=X[me+1],Ye=X[me+2],nt=X[me+3],It=X[me+4],Et=K===0?He:Ne,yt=K===0?nt:It,mt=!1;ae&&(te=Math.sqrt(Math.pow(He-nt,2)+Math.pow(Ne-It,2))),Et<O?yt>O&&(ie=_e(oe,He,Ne,nt,It,O),ae&&(oe.start=Se+te*ie)):Et>$?yt<$&&(ie=_e(oe,He,Ne,nt,It,$),ae&&(oe.start=Se+te*ie)):$i(oe,He,Ne,Ye),yt<O&&Et>=O&&(ie=_e(oe,He,Ne,nt,It,O),mt=!0),yt>$&&Et<=$&&(ie=_e(oe,He,Ne,nt,It,$),mt=!0),!W&&mt&&(ae&&(oe.end=Se+te*ie),k.push(oe),oe=ft(X)),ae&&(Se+=te)}var gt=X.length-3;He=X[gt],Ne=X[gt+1],Ye=X[gt+2],(Et=K===0?He:Ne)>=O&&Et<=$&&$i(oe,He,Ne,Ye),gt=oe.length-3,W&&gt>=3&&(oe[gt]!==oe[0]||oe[gt+1]!==oe[1])&&$i(oe,oe[0],oe[1],oe[2]),oe.length&&k.push(oe)}function ft(X){var k=[];return k.size=X.size,k.start=X.start,k.end=X.end,k}function pi(X,k,O,$,K,W){for(var ae=0;ae<X.length;ae++)pt(X[ae],k,O,$,K,W,!1)}function $i(X,k,O,$){X.push(k),X.push(O),X.push($)}function dt(X,k,O,$,K,W){var ae=(W-k)/($-k);return X.push(W),X.push(O+(K-O)*ae),X.push(1),ae}function Jn(X,k,O,$,K,W){var ae=(W-O)/(K-O);return X.push(k+($-k)*ae),X.push(W),X.push(1),ae}function un(X,k){for(var O=[],$=0;$<X.length;$++){var K,W=X[$],ae=W.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")K=Bi(W.geometry,k);else if(ae==="MultiLineString"||ae==="Polygon"){K=[];for(var te=0;te<W.geometry.length;te++)K.push(Bi(W.geometry[te],k))}else if(ae==="MultiPolygon")for(K=[],te=0;te<W.geometry.length;te++){for(var ie=[],oe=0;oe<W.geometry[te].length;oe++)ie.push(Bi(W.geometry[te][oe],k));K.push(ie)}O.push(xe(W.id,ae,K,W.tags))}return O}function Bi(X,k){var O=[];O.size=X.size,X.start!==void 0&&(O.start=X.start,O.end=X.end);for(var $=0;$<X.length;$+=3)O.push(X[$]+k,X[$+1],X[$+2]);return O}function ii(X,k){if(X.transformed)return X;var O,$,K,W=1<<X.z,ae=X.x,te=X.y;for(O=0;O<X.features.length;O++){var ie=X.features[O],oe=ie.geometry,_e=ie.type;if(ie.geometry=[],_e===1)for($=0;$<oe.length;$+=2)ie.geometry.push(Lt(oe[$],oe[$+1],k,W,ae,te));else for($=0;$<oe.length;$++){var Se=[];for(K=0;K<oe[$].length;K+=2)Se.push(Lt(oe[$][K],oe[$][K+1],k,W,ae,te));ie.geometry.push(Se)}}return X.transformed=!0,X}function Lt(X,k,O,$,K,W){return[Math.round(O*(X*$-K)),Math.round(O*(k*$-W))]}function $s(X,k,O,$,K){for(var W=k===K.maxZoom?0:K.tolerance/((1<<k)*K.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:$,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<X.length;te++){ae.numFeatures++,Kr(ae,X[te],W,K);var ie=X[te].minX,oe=X[te].minY,_e=X[te].maxX,Se=X[te].maxY;ie<ae.minX&&(ae.minX=ie),oe<ae.minY&&(ae.minY=oe),_e>ae.maxX&&(ae.maxX=_e),Se>ae.maxY&&(ae.maxY=Se)}return ae}function Kr(X,k,O,$){var K=k.geometry,W=k.type,ae=[];if(W==="Point"||W==="MultiPoint")for(var te=0;te<K.length;te+=3)ae.push(K[te]),ae.push(K[te+1]),X.numPoints++,X.numSimplified++;else if(W==="LineString")Qn(ae,K,X,O,!1,!1);else if(W==="MultiLineString"||W==="Polygon")for(te=0;te<K.length;te++)Qn(ae,K[te],X,O,W==="Polygon",te===0);else if(W==="MultiPolygon")for(var ie=0;ie<K.length;ie++){var oe=K[ie];for(te=0;te<oe.length;te++)Qn(ae,oe[te],X,O,!0,te===0)}if(ae.length){var _e=k.tags||null;if(W==="LineString"&&$.lineMetrics){for(var Se in _e={},k.tags)_e[Se]=k.tags[Se];_e.mapbox_clip_start=K.start/K.size,_e.mapbox_clip_end=K.end/K.size}var me={geometry:ae,type:W==="Polygon"||W==="MultiPolygon"?3:W==="LineString"||W==="MultiLineString"?2:1,tags:_e};k.id!==null&&(me.id=k.id),X.features.push(me)}}function Qn(X,k,O,$,K,W){var ae=$*$;if($>0&&k.size<(K?ae:$))O.numPoints+=k.length/3;else{for(var te=[],ie=0;ie<k.length;ie+=3)($===0||k[ie+2]>ae)&&(O.numSimplified++,te.push(k[ie]),te.push(k[ie+1])),O.numPoints++;K&&function(oe,_e){for(var Se=0,me=0,He=oe.length,Ne=He-2;me<He;Ne=me,me+=2)Se+=(oe[me]-oe[Ne])*(oe[me+1]+oe[Ne+1]);if(Se>0===_e)for(me=0,He=oe.length;me<He/2;me+=2){var Ye=oe[me],nt=oe[me+1];oe[me]=oe[He-2-me],oe[me+1]=oe[He-1-me],oe[He-2-me]=Ye,oe[He-1-me]=nt}}(te,W),X.push(te)}}function pr(X,k){var O=(k=this.options=function(K,W){for(var ae in W)K[ae]=W[ae];return K}(Object.create(this.options),k)).debug;if(O&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(K,W){var ae=[];if(K.type==="FeatureCollection")for(var te=0;te<K.features.length;te++)Yn(ae,K.features[te],W,te);else Yn(ae,K.type==="Feature"?K:{geometry:K},W);return ae}(X,k);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(K,W){var ae=W.buffer/W.extent,te=K,ie=Xr(K,1,-1-ae,ae,0,-1,2,W),oe=Xr(K,1,1-ae,2+ae,0,-1,2,W);return(ie||oe)&&(te=Xr(K,1,-ae,1+ae,0,-1,2,W)||[],ie&&(te=un(ie,1).concat(te)),oe&&(te=te.concat(un(oe,-1)))),te}($,k),$.length&&this.splitTile($,0,0,0),O&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function An(X,k,O){return 32*((1<<X)*O+k)+X}function Cn(X,k){const O=X.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const $=this._geoJSONIndex.getTile(O.z,O.x,O.y);if(!$)return k(null,null);const K=new De($.features);let W=ci(K);W.byteOffset===0&&W.byteLength===W.buffer.byteLength||(W=new Uint8Array(W)),k(null,{vectorTile:K,rawData:W.buffer})}pr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},pr.prototype.splitTile=function(X,k,O,$,K,W,ae){for(var te=[X,k,O,$],ie=this.options,oe=ie.debug;te.length;){$=te.pop(),O=te.pop(),k=te.pop(),X=te.pop();var _e=1<<k,Se=An(k,O,$),me=this.tiles[Se];if(!me&&(oe>1&&console.time("creation"),me=this.tiles[Se]=$s(X,k,O,$,ie),this.tileCoords.push({z:k,x:O,y:$}),oe)){oe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,O,$,me.numFeatures,me.numPoints,me.numSimplified),console.timeEnd("creation"));var He="z"+k;this.stats[He]=(this.stats[He]||0)+1,this.total++}if(me.source=X,K){if(k===ie.maxZoom||k===K)continue;var Ne=1<<K-k;if(O!==Math.floor(W/Ne)||$!==Math.floor(ae/Ne))continue}else if(k===ie.indexMaxZoom||me.numPoints<=ie.indexMaxPoints)continue;if(me.source=null,X.length!==0){oe>1&&console.time("clipping");var Ye,nt,It,Et,yt,mt,gt=.5*ie.buffer/ie.extent,ar=.5-gt,mr=.5+gt,zr=1+gt;Ye=nt=It=Et=null,yt=Xr(X,_e,O-gt,O+mr,0,me.minX,me.maxX,ie),mt=Xr(X,_e,O+ar,O+zr,0,me.minX,me.maxX,ie),X=null,yt&&(Ye=Xr(yt,_e,$-gt,$+mr,1,me.minY,me.maxY,ie),nt=Xr(yt,_e,$+ar,$+zr,1,me.minY,me.maxY,ie),yt=null),mt&&(It=Xr(mt,_e,$-gt,$+mr,1,me.minY,me.maxY,ie),Et=Xr(mt,_e,$+ar,$+zr,1,me.minY,me.maxY,ie),mt=null),oe>1&&console.timeEnd("clipping"),te.push(Ye||[],k+1,2*O,2*$),te.push(nt||[],k+1,2*O,2*$+1),te.push(It||[],k+1,2*O+1,2*$),te.push(Et||[],k+1,2*O+1,2*$+1)}}},pr.prototype.getTile=function(X,k,O){var $=this.options,K=$.extent,W=$.debug;if(X<0||X>24)return null;var ae=1<<X,te=An(X,k=(k%ae+ae)%ae,O);if(this.tiles[te])return ii(this.tiles[te],K);W>1&&console.log("drilling down to z%d-%d-%d",X,k,O);for(var ie,oe=X,_e=k,Se=O;!ie&&oe>0;)oe--,_e=Math.floor(_e/2),Se=Math.floor(Se/2),ie=this.tiles[An(oe,_e,Se)];return ie&&ie.source?(W>1&&console.log("found parent tile z%d-%d-%d",oe,_e,Se),W>1&&console.time("drilling down"),this.splitTile(ie.source,oe,_e,Se,X,k,O),W>1&&console.timeEnd("drilling down"),this.tiles[te]?ii(this.tiles[te],K):null):null};class ea extends H{constructor(k,O,$,K){super(k,O,$,Cn),K&&(this.loadGeoJSON=K)}loadData(k,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=O,this._pendingLoadDataParams=k,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const k=this._pendingCallback,O=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const $=!!(O&&O.request&&O.request.collectResourceTiming)&&new h.RequestPerformance(O.request);this.loadGeoJSON(O,(K,W)=>{if(K||!W)return k(K);if(typeof W!="object")return k(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{ge(W,!0);try{if(O.filter){const te=h.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(oe=>`${oe.key}: ${oe.message}`).join(", "));const ie=W.features.filter(oe=>te.value.evaluate({zoom:0},oe));W={type:"FeatureCollection",features:ie}}this._geoJSONIndex=O.cluster?new Hn(function({superclusterOptions:te,clusterProperties:ie}){if(!ie||!te)return te;const oe={},_e={},Se={accumulated:null,zoom:0},me={properties:null},He=Object.keys(ie);for(const Ne of He){const[Ye,nt]=ie[Ne],It=h.createExpression(nt),Et=h.createExpression(typeof Ye=="string"?[Ye,["accumulated"],["get",Ne]]:Ye);oe[Ne]=It.value,_e[Ne]=Et.value}return te.map=Ne=>{me.properties=Ne;const Ye={};for(const nt of He)Ye[nt]=oe[nt].evaluate(Se,me);return Ye},te.reduce=(Ne,Ye)=>{me.properties=Ye;for(const nt of He)Se.accumulated=Ne[nt],Ne[nt]=_e[nt].evaluate(Se,me)},te}(O)).load(W.features):function(te,ie){return new pr(te,ie)}(W,O.geojsonVtOptions)}catch(te){return k(te)}this.loaded={};const ae={};if($){const te=$.finish();te&&(ae.resourceTiming={},ae.resourceTiming[O.source]=JSON.parse(JSON.stringify(te)))}k(null,ae)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(k,O){const $=this.loaded;return $&&$[k.uid]?super.reloadTile(k,O):this.loadTile(k,O)}loadGeoJSON(k,O){if(k.request)h.getJSON(k.request,O);else{if(typeof k.data!="string")return O(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));try{return O(null,JSON.parse(k.data))}catch($){return O(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`))}}}removeSource(k,O){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),O()}getClusterExpansionZoom(k,O){try{O(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch($){O($)}}getClusterChildren(k,O){try{O(null,this._geoJSONIndex.getChildren(k.clusterId))}catch($){O($)}}getClusterLeaves(k,O){try{O(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch($){O($)}}}class Ta{constructor(k){this.self=k,this.actor=new h.Actor(k,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:H,geojson:ea},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(O,$)=>{if(this.workerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.workerSourceTypes[O]=$},this.self.registerRTLTextPlugin=O=>{if(h.plugin.isParsed())throw new Error("RTL text plugin already registered.");h.plugin.applyArabicShaping=O.applyArabicShaping,h.plugin.processBidirectionalText=O.processBidirectionalText,h.plugin.processStyledBidirectionalText=O.processStyledBidirectionalText}}setReferrer(k,O){this.referrer=O}setImages(k,O,$){this.availableImages[k]=O;for(const K in this.workerSources[k]){const W=this.workerSources[k][K];for(const ae in W)W[ae].availableImages=O}$()}setLayers(k,O,$){this.getLayerIndex(k).replace(O),$()}updateLayers(k,O,$){this.getLayerIndex(k).update(O.layers,O.removedIds),$()}loadTile(k,O,$){this.getWorkerSource(k,O.type,O.source).loadTile(O,$)}loadDEMTile(k,O,$){this.getDEMWorkerSource(k,O.source).loadTile(O,$)}reloadTile(k,O,$){this.getWorkerSource(k,O.type,O.source).reloadTile(O,$)}abortTile(k,O,$){this.getWorkerSource(k,O.type,O.source).abortTile(O,$)}removeTile(k,O,$){this.getWorkerSource(k,O.type,O.source).removeTile(O,$)}removeDEMTile(k,O){this.getDEMWorkerSource(k,O.source).removeTile(O)}removeSource(k,O,$){if(!this.workerSources[k]||!this.workerSources[k][O.type]||!this.workerSources[k][O.type][O.source])return;const K=this.workerSources[k][O.type][O.source];delete this.workerSources[k][O.type][O.source],K.removeSource!==void 0?K.removeSource(O,$):$()}loadWorkerSource(k,O,$){try{this.self.importScripts(O.url),$()}catch(K){$(K.toString())}}syncRTLPluginState(k,O,$){try{h.plugin.setState(O);const K=h.plugin.getPluginURL();if(h.plugin.isLoaded()&&!h.plugin.isParsed()&&K!=null){this.self.importScripts(K);const W=h.plugin.isParsed();$(W?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),W)}}catch(K){$(K.toString())}}getAvailableImages(k){let O=this.availableImages[k];return O||(O=[]),O}getLayerIndex(k){let O=this.layerIndexes[k];return O||(O=this.layerIndexes[k]=new C),O}getWorkerSource(k,O,$){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][O]||(this.workerSources[k][O]={}),!this.workerSources[k][O][$]){const K={send:(W,ae,te)=>{this.actor.send(W,ae,te,k)}};this.workerSources[k][O][$]=new this.workerSourceTypes[O](K,this.getLayerIndex(k),this.getAvailableImages(k))}return this.workerSources[k][O][$]}getDEMWorkerSource(k,O){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][O]||(this.demWorkerSources[k][O]=new re),this.demWorkerSources[k][O]}enforceCacheSizeLimit(k,O){h.enforceCacheSizeLimit(O)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ta(self)),Ta}),u(["./shared"],function(h){var b=T;function T(m){return!function(a){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var d,_,x=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(x);try{_=new Worker(E),d=!0}catch(S){d=!1}return _&&_.terminate(),URL.revokeObjectURL(E),d}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var d=document.createElement("canvas");d.width=d.height=1;var _=d.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===d.width}()?(C[c=a&&a.failIfMajorPerformanceCaveat]===void 0&&(C[c]=function(d){var _,x=function(E){var S=document.createElement("canvas"),A=Object.create(T.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=E,S.getContext("webgl",A)||S.getContext("experimental-webgl",A)}(d);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch(E){return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(c)),C[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(m)}var C={};function P(m,a){if(Array.isArray(m)){if(!Array.isArray(a)||m.length!==a.length)return!1;for(let c=0;c<m.length;c++)if(!P(m[c],a[c]))return!1;return!0}if(typeof m=="object"&&m!==null&&a!==null){if(typeof a!="object"||Object.keys(m).length!==Object.keys(a).length)return!1;for(const c in m)if(!P(m[c],a[c]))return!1;return!0}return m===a}T.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class R{static testProp(a){if(!R.docStyle)return a[0];for(let c=0;c<a.length;c++)if(a[c]in R.docStyle)return a[c];return a[0]}static create(a,c,d){const _=window.document.createElement(a);return c!==void 0&&(_.className=c),d&&d.appendChild(_),_}static createNS(a,c){return window.document.createElementNS(a,c)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(a,c){a.style[R.transformProp]=c}static addEventListener(a,c,d,_={}){a.addEventListener(c,d,"passive"in _?_:_.capture)}static removeEventListener(a,c,d,_={}){a.removeEventListener(c,d,"passive"in _?_:_.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static mousePos(a,c){const d=a.getBoundingClientRect();return new h.pointGeometry(c.clientX-d.left-a.clientLeft,c.clientY-d.top-a.clientTop)}static touchPos(a,c){const d=a.getBoundingClientRect(),_=[];for(let x=0;x<c.length;x++)_.push(new h.pointGeometry(c[x].clientX-d.left-a.clientLeft,c[x].clientY-d.top-a.clientTop));return _}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}R.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);class U{constructor(a){this._transformRequestFn=a}transformRequest(a,c){return this._transformRequestFn&&this._transformRequestFn(a,c)||{url:a}}normalizeSpriteURL(a,c,d){const _=function(x){const E=x.match(j);if(!E)throw new Error(`Unable to parse URL "${x}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(a);return _.path+=`${c}${d}`,function(x){const E=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${E}`}(_)}setTransformRequest(a){this._transformRequestFn=a}}const j=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function H(m){var a=new h.ARRAY_TYPE(3);return a[0]=m[0],a[1]=m[1],a[2]=m[2],a}function re(m,a,c){var d=new h.ARRAY_TYPE(3);return d[0]=m,d[1]=a,d[2]=c,d}var ge,ce=function(m,a,c){return m[0]=a[0]-c[0],m[1]=a[1]-c[1],m[2]=a[2]-c[2],m};ge=new h.ARRAY_TYPE(3),h.ARRAY_TYPE!=Float32Array&&(ge[0]=0,ge[1]=0,ge[2]=0);var be=function(m){var a=m[0],c=m[1];return a*a+c*c};(function(){var m=new h.ARRAY_TYPE(2);h.ARRAY_TYPE!=Float32Array&&(m[0]=0,m[1]=0)})();class we{constructor(a,c,d,_){this.context=a,this.format=d,this.texture=a.gl.createTexture(),this.update(c,_)}update(a,c,d){const{width:_,height:x}=a,E=!(this.size&&this.size[0]===_&&this.size[1]===x||d),{context:S}=this,{gl:A}=S;if(this.useMipmap=Boolean(c&&c.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!c||c.premultiply!==!1)),E)this.size=[_,x],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||h.isImageBitmap(a)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,a):A.texImage2D(A.TEXTURE_2D,0,this.format,_,x,0,this.format,A.UNSIGNED_BYTE,a.data);else{const{x:D,y:F}=d||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||h.isImageBitmap(a)?A.texSubImage2D(A.TEXTURE_2D,0,D,F,A.RGBA,A.UNSIGNED_BYTE,a):A.texSubImage2D(A.TEXTURE_2D,0,D,F,_,x,A.RGBA,A.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(a,c,d){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),d!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,d||a),this.filter=a),c!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Ae(m){const{userImage:a}=m;return!!(a&&a.render&&a.render())&&(m.data.replace(new Uint8Array(a.data.buffer)),!0)}class De extends h.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:c,callback:d}of this.requestors)this._notify(c,d);this.requestors=[]}}getImage(a){return this.images[a]}addImage(a,c){this._validate(a,c)&&(this.images[a]=c)}_validate(a,c){let d=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new h.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),d=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new h.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),d=!1),this._validateContent(c.content,c)||(this.fire(new h.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),d=!1),d}_validateStretch(a,c){if(!a)return!0;let d=0;for(const _ of a){if(_[0]<d||_[1]<_[0]||c<_[1])return!1;d=_[1]}return!0}_validateContent(a,c){return!(a&&(a.length!==4||a[0]<0||c.data.width<a[0]||a[1]<0||c.data.height<a[1]||a[2]<0||c.data.width<a[2]||a[3]<0||c.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,c){c.version=this.images[a].version+1,this.images[a]=c,this.updatedImages[a]=!0}removeImage(a){const c=this.images[a];delete this.images[a],delete this.patterns[a],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,c){let d=!0;if(!this.isLoaded())for(const _ of a)this.images[_]||(d=!1);this.isLoaded()||d?this._notify(a,c):this.requestors.push({ids:a,callback:c})}_notify(a,c){const d={};for(const _ of a){this.images[_]||this.fire(new h.Event("styleimagemissing",{id:_}));const x=this.images[_];x?d[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:h.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,d)}getPixelSize(){const{width:a,height:c}=this.atlasImage;return{width:a,height:c}}getPattern(a){const c=this.patterns[a],d=this.getImage(a);if(!d)return null;if(c&&c.position.version===d.version)return c.position;if(c)c.position.version=d.version;else{const _={w:d.data.width+2,h:d.data.height+2,x:0,y:0},x=new h.ImagePosition(_,d);this.patterns[a]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const c=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(a,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const x in this.patterns)a.push(this.patterns[x].bin);const{w:c,h:d}=h.potpack(a),_=this.atlasImage;_.resize({width:c||1,height:d||1});for(const x in this.patterns){const{bin:E}=this.patterns[x],S=E.x+1,A=E.y+1,D=this.images[x].data,F=D.width,N=D.height;h.RGBAImage.copy(D,_,{x:0,y:0},{x:S,y:A},{width:F,height:N}),h.RGBAImage.copy(D,_,{x:0,y:N-1},{x:S,y:A-1},{width:F,height:1}),h.RGBAImage.copy(D,_,{x:0,y:0},{x:S,y:A+N},{width:F,height:1}),h.RGBAImage.copy(D,_,{x:F-1,y:0},{x:S-1,y:A},{width:1,height:N}),h.RGBAImage.copy(D,_,{x:0,y:0},{x:S+F,y:A},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const c of a){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const d=this.images[c];Ae(d)&&this.updateImage(c,d)}}}const it=1e20;function ze(m,a,c,d,_,x,E,S,A){for(let D=a;D<a+d;D++)lt(m,c*x+D,x,_,E,S,A);for(let D=c;D<c+_;D++)lt(m,D*x+a,1,d,E,S,A)}function lt(m,a,c,d,_,x,E){x[0]=0,E[0]=-it,E[1]=it,_[0]=m[a];for(let S=1,A=0,D=0;S<d;S++){_[S]=m[a+S*c];const F=S*S;do{const N=x[A];D=(_[S]-_[N]+F-N*N)/(S-N)/2}while(D<=E[A]&&--A>-1);A++,x[A]=S,E[A]=D,E[A+1]=it}for(let S=0,A=0;S<d;S++){for(;E[A+1]<S;)A++;const D=x[A],F=S-D;m[a+S*c]=_[D]+F*F}}class ct{constructor(a,c){this.requestManager=a,this.localIdeographFontFamily=c,this.entries={}}setURL(a){this.url=a}getGlyphs(a,c){const d=[];for(const _ in a)for(const x of a[_])d.push({stack:_,id:x});h.asyncAll(d,({stack:_,id:x},E)=>{let S=this.entries[_];S||(S=this.entries[_]={glyphs:{},requests:{},ranges:{}});let A=S.glyphs[x];if(A!==void 0)return void E(null,{stack:_,id:x,glyph:A});if(A=this._tinySDF(S,_,x),A)return S.glyphs[x]=A,void E(null,{stack:_,id:x,glyph:A});const D=Math.floor(x/256);if(256*D>65535)return void E(new Error("glyphs > 65535 not supported"));if(S.ranges[D])return void E(null,{stack:_,id:x,glyph:A});let F=S.requests[D];F||(F=S.requests[D]=[],ct.loadGlyphRange(_,D,this.url,this.requestManager,(N,Z)=>{if(Z){for(const Y in Z)this._doesCharSupportLocalGlyph(+Y)||(S.glyphs[+Y]=Z[+Y]);S.ranges[D]=!0}for(const Y of F)Y(N,Z);delete S.requests[D]})),F.push((N,Z)=>{N?E(N):Z&&E(null,{stack:_,id:x,glyph:Z[x]||null})})},(_,x)=>{if(_)c(_);else if(x){const E={};for(const{stack:S,id:A,glyph:D}of x)(E[S]||(E[S]={}))[A]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};c(null,E)}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(h.unicodeBlockLookup["CJK Unified Ideographs"](a)||h.unicodeBlockLookup["Hangul Syllables"](a)||h.unicodeBlockLookup.Hiragana(a)||h.unicodeBlockLookup.Katakana(a))}_tinySDF(a,c,d){const _=this.localIdeographFontFamily;if(!_||!this._doesCharSupportLocalGlyph(d))return;let x=a.tinySDF;if(!x){let S="400";/bold/i.test(c)?S="900":/medium/i.test(c)?S="500":/light/i.test(c)&&(S="200"),x=a.tinySDF=new ct.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:_,fontWeight:S})}const E=x.draw(String.fromCharCode(d));return{id:d,bitmap:new h.AlphaImage({width:E.width||30,height:E.height||30},E.data),metrics:{width:E.glyphWidth||24,height:E.glyphHeight||24,left:E.glyphLeft||0,top:E.glyphTop-27||-8,advance:E.glyphAdvance||24}}}}ct.loadGlyphRange=function(m,a,c,d,_){const x=256*a,E=x+255,S=d.transformRequest(c.replace("{fontstack}",m).replace("{range}",`${x}-${E}`),h.ResourceType.Glyphs);h.getArrayBuffer(S,(A,D)=>{if(A)_(A);else if(D){const F={};for(const N of h.parseGlyphPBF(D))F[N.id]=N;_(null,F)}})},ct.TinySDF=class{constructor({fontSize:m=24,buffer:a=3,radius:c=8,cutoff:d=.25,fontFamily:_="sans-serif",fontWeight:x="normal",fontStyle:E="normal"}){this.buffer=a,this.cutoff=d,this.radius=c;const S=this.size=m+4*a,A=this._createCanvas(S),D=this.ctx=A.getContext("2d",{willReadFrequently:!0});D.font=`${E} ${x} ${m}px ${_}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const a=document.createElement("canvas");return a.width=a.height=m,a}draw(m){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:d,actualBoundingBoxLeft:_,actualBoundingBoxRight:x}=this.ctx.measureText(m),E=Math.floor(c),S=Math.min(this.size-this.buffer,Math.ceil(x-_)),A=Math.min(this.size-this.buffer,Math.ceil(c)+Math.ceil(d)),D=S+2*this.buffer,F=A+2*this.buffer,N=D*F,Z=new Uint8ClampedArray(N),Y={data:Z,width:D,height:F,glyphWidth:S,glyphHeight:A,glyphTop:E,glyphLeft:0,glyphAdvance:a};if(S===0||A===0)return Y;const{ctx:q,buffer:Q,gridInner:ne,gridOuter:se}=this;q.clearRect(Q,Q,S,A),q.fillText(m,Q,Q+E+1);const ue=q.getImageData(Q,Q,S,A);se.fill(it,0,N),ne.fill(0,0,N);for(let he=0;he<A;he++)for(let Ee=0;Ee<S;Ee++){const pe=ue.data[4*(he*S+Ee)+3]/255;if(pe===0)continue;const ve=(he+Q)*D+Ee+Q;if(pe===1)se[ve]=0,ne[ve]=it;else{const Ie=.5-pe;se[ve]=Ie>0?Ie*Ie:0,ne[ve]=Ie<0?Ie*Ie:0}}ze(se,0,0,D,F,D,this.f,this.v,this.z),ze(ne,Q,Q,S,A,D,this.f,this.v,this.z);for(let he=0;he<N;he++){const Ee=Math.sqrt(se[he])-Math.sqrt(ne[he]);Z[he]=Math.round(255-255*(Ee/this.radius+this.cutoff))}return Y}};const Rt=new h.Properties({anchor:new h.DataConstantProperty(h.spec.light.anchor),position:new class{constructor(){this.specification=h.spec.light.position}possiblyEvaluate(m,a){return h.sphericalToCartesian(m.expression.evaluate(a))}interpolate(m,a,c){return{x:h.number(m.x,a.x,c),y:h.number(m.y,a.y,c),z:h.number(m.z,a.z,c)}}},color:new h.DataConstantProperty(h.spec.light.color),intensity:new h.DataConstantProperty(h.spec.light.intensity)}),Bt="-transition";class Kt extends h.Evented{constructor(a){super(),this._transitionable=new h.Transitionable(Rt),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,c={}){if(!this._validate(h.validateLight,a,c))for(const d in a){const _=a[d];d.endsWith(Bt)?this._transitionable.setTransition(d.slice(0,-Bt.length),_):this._transitionable.setValue(d,_)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,c,d){return(!d||d.validate!==!1)&&h.emitValidationErrors(this,a.call(h.validateStyle,h.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:h.spec})))}}class Ht{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,c){const d=a.join(",")+String(c);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(a,c)),this.dashEntry[d]}getDashRanges(a,c,d){const _=[];let x=a.length%2==1?-a[a.length-1]*d:0,E=a[0]*d,S=!0;_.push({left:x,right:E,isDash:S,zeroLength:a[0]===0});let A=a[0];for(let D=1;D<a.length;D++){S=!S;const F=a[D];x=A*d,A+=F,E=A*d,_.push({left:x,right:E,isDash:S,zeroLength:F===0})}return _}addRoundDash(a,c,d){const _=c/2;for(let x=-d;x<=d;x++){const E=this.width*(this.nextRow+d+x);let S=0,A=a[S];for(let D=0;D<this.width;D++){D/A.right>1&&(A=a[++S]);const F=Math.abs(D-A.left),N=Math.abs(D-A.right),Z=Math.min(F,N);let Y;const q=x/d*(_+1);if(A.isDash){const Q=_-Math.abs(q);Y=Math.sqrt(Z*Z+Q*Q)}else Y=_-Math.sqrt(Z*Z+q*q);this.data[E+D]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(a){for(let S=a.length-1;S>=0;--S){const A=a[S],D=a[S+1];A.zeroLength?a.splice(S,1):D&&D.isDash===A.isDash&&(D.left=A.left,a.splice(S,1))}const c=a[0],d=a[a.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const _=this.width*this.nextRow;let x=0,E=a[x];for(let S=0;S<this.width;S++){S/E.right>1&&(E=a[++x]);const A=Math.abs(S-E.left),D=Math.abs(S-E.right),F=Math.min(A,D);this.data[_+S]=Math.max(0,Math.min(255,(E.isDash?F:-F)+128))}}addDash(a,c){const d=c?7:0,_=2*d+1;if(this.nextRow+_>this.height)return h.warnOnce("LineAtlas out of space"),null;let x=0;for(let S=0;S<a.length;S++)x+=a[S];if(x!==0){const S=this.width/x,A=this.getDashRanges(a,this.width,S);c?this.addRoundDash(A,S,d):this.addRegularDash(A)}const E={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:x};return this.nextRow+=_,this.dirty=!0,E}bind(a){const c=a.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}class At{constructor(a,c){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=h.uniqueId();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const x=new At.Actor(d[_],c,this.id);x.name=`Worker ${_}`,this.actors.push(x)}}broadcast(a,c,d){h.asyncAll(this.actors,(_,x)=>{_.send(a,c,x)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qe(m,a,c){const d=function(_,x){if(_)return c(_);if(x){const E=h.pick(h.extend(x,m),["tiles","minzoom","maxzoom","attribution","maplibreLogo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(S=>S.id)),c(null,E)}};return m.url?h.getJSON(a.transformRequest(m.url,h.ResourceType.Source),d):h.exported.frame(()=>d(null,m))}At.Actor=h.Actor;class Ut{constructor(a,c,d){this.bounds=h.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=c||0,this.maxzoom=d||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const c=Math.pow(2,a.z),d=Math.floor(h.mercatorXfromLng(this.bounds.getWest())*c),_=Math.floor(h.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(h.mercatorXfromLng(this.bounds.getEast())*c),E=Math.ceil(h.mercatorYfromLat(this.bounds.getSouth())*c);return a.x>=d&&a.x<x&&a.y>=_&&a.y<E}}class Zt extends h.Evented{constructor(a,c,d,_){if(super(),this.id=a,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.extend(this,h.pick(c,["url","scheme","tileSize","promoteId"])),this._options=h.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_)}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qe(this._options,this.map._requestManager,(a,c)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a?this.fire(new h.ErrorEvent(a)):c&&(h.extend(this,c),c.bounds&&(this.tileBounds=new Ut(c.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.cancel(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}loadTile(a,c){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),_={request:this.map._requestManager.transformRequest(d,h.ResourceType.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(E,S){return delete a.request,a.aborted?c(null):E&&E.status!==404?c(E):(S&&S.resourceTiming&&(a.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&a.setExpiryData(S),a.loadVectorData(S,this.map.painter),h.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}_.request.collectResourceTiming=this._collectResourceTiming,a.actor&&a.state!=="expired"?a.state==="loading"?a.reloadCallback=c:a.request=a.actor.send("reloadTile",_,x.bind(this)):(a.actor=this.dispatcher.getActor(),a.request=a.actor.send("loadTile",_,x.bind(this)))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0)}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Er extends h.Evented{constructor(a,c,d,_){super(),this.id=a,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.extend({type:"raster"},c),h.extend(this,h.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qe(this._options,this.map._requestManager,(a,c)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new h.ErrorEvent(a)):c&&(h.extend(this,c),c.bounds&&(this.tileBounds=new Ut(c.bounds,this.minzoom,this.maxzoom)),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return h.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,c){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.request=h.getImage(this.map._requestManager.transformRequest(d,h.ResourceType.Tile),(_,x)=>{if(delete a.request,a.aborted)a.state="unloaded",c(null);else if(_)a.state="errored",c(_);else if(x){this.map._refreshExpiredTiles&&a.setExpiryData(x),delete x.cacheControl,delete x.expires;const E=this.map.painter.context,S=E.gl;a.texture=this.map.painter.getTileTexture(x.width),a.texture?a.texture.update(x,{useMipmap:!0}):(a.texture=new we(E,x,S.RGBA,{useMipmap:!0}),a.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),E.extTextureFilterAnisotropic&&S.texParameterf(S.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax)),a.state="loaded",h.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(a,c){a.request&&(a.request.cancel(),delete a.request),c()}unloadTile(a,c){a.texture&&this.map.painter.saveTileTexture(a.texture),c()}hasTransition(){return!1}}let nr;class qr extends Er{constructor(a,c,d,_){super(a,c,d,_),this.type="raster-dem",this.maxzoom=22,this._options=h.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(a,c){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function _(x,E){x&&(a.state="errored",c(x)),E&&(a.dem=E,a.needsHillshadePrepare=!0,a.state="loaded",c(null))}a.request=h.getImage(this.map._requestManager.transformRequest(d,h.ResourceType.Tile),function(x,E){if(delete a.request,a.aborted)a.state="unloaded",c(null);else if(x)a.state="errored",c(x);else if(E){this.map._refreshExpiredTiles&&a.setExpiryData(E),delete E.cacheControl,delete E.expires;const S=h.isImageBitmap(E)&&(nr==null&&(nr=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),nr)?E:h.exported.getImageData(E,1),A={uid:a.uid,coord:a.tileID,source:this.id,rawImageData:S,encoding:this.encoding};a.actor&&a.state!=="expired"||(a.actor=this.dispatcher.getActor(),a.actor.send("loadDEMTile",A,_.bind(this)))}}.bind(this)),a.neighboringTiles=this._getNeighboringTiles(a.tileID)}_getNeighboringTiles(a){const c=a.canonical,d=Math.pow(2,c.z),_=(c.x-1+d)%d,x=c.x===0?a.wrap-1:a.wrap,E=(c.x+1+d)%d,S=c.x+1===d?a.wrap+1:a.wrap,A={};return A[new h.OverscaledTileID(a.overscaledZ,x,c.z,_,c.y).key]={backfilled:!1},A[new h.OverscaledTileID(a.overscaledZ,S,c.z,E,c.y).key]={backfilled:!1},c.y>0&&(A[new h.OverscaledTileID(a.overscaledZ,x,c.z,_,c.y-1).key]={backfilled:!1},A[new h.OverscaledTileID(a.overscaledZ,a.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},A[new h.OverscaledTileID(a.overscaledZ,S,c.z,E,c.y-1).key]={backfilled:!1}),c.y+1<d&&(A[new h.OverscaledTileID(a.overscaledZ,x,c.z,_,c.y+1).key]={backfilled:!1},A[new h.OverscaledTileID(a.overscaledZ,a.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},A[new h.OverscaledTileID(a.overscaledZ,S,c.z,E,c.y+1).key]={backfilled:!1}),A}unloadTile(a){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&a.actor.send("removeDEMTile",{uid:a.uid,source:this.id})}}class Fi extends h.Evented{constructor(a,c,d,_){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(_),this._data=c.data,this._options=h.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=h.EXTENT/this.tileSize;this.workerOptions=h.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*x,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*x,extent:h.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:h.EXTENT,radius:(c.clusterRadius||50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData("content"),this}getClusterExpansionZoom(a,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:a,source:this.id},c),this}getClusterChildren(a,c){return this.actor.send("geojson.getClusterChildren",{clusterId:a,source:this.id},c),this}getClusterLeaves(a,c,d,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:a,limit:c,offset:d},_),this}_updateWorkerData(a){const c=h.extend({},this.workerOptions),d=this._data;typeof d=="string"?(c.request=this.map._requestManager.transformRequest(h.exported.resolveURL(d),h.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(d),this._pendingLoads++,this.fire(new h.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,c,(_,x)=>{if(this._pendingLoads--,this._removed||x&&x.abandoned)return;let E=null;if(x&&x.resourceTiming&&x.resourceTiming[this.id]&&(E=x.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:c.source},null),_)return void this.fire(new h.ErrorEvent(_));const S={dataType:"source",sourceDataType:a};this._collectResourceTiming&&E&&E.length>0&&h.extend(S,{resourceTiming:E}),this.fire(new h.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(a,c){const d=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const _={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.request=this.actor.send(d,_,(x,E)=>(delete a.request,a.unloadVectorData(),a.aborted?c(null):x?c(x):(a.loadVectorData(E,this.map.painter,d==="reloadTile"),c(null))))}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.aborted=!0}unloadTile(a){a.unloadVectorData(),this.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return h.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ci=h.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Nr extends h.Evented{constructor(a,c,d,_){super(),this.id=a,this.dispatcher=d,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=c}load(a,c){this._loaded=!1,this.fire(new h.Event("dataloading",{dataType:"source"})),this.url=this.options.url,h.getImage(this.map._requestManager.transformRequest(this.url,h.ResourceType.Image),(d,_)=>{this._loaded=!0,d?this.fire(new h.ErrorEvent(d)):_&&(this.image=_,a&&(this.coordinates=a),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this.options.url=a.url,this.load(a.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}setCoordinates(a){this.coordinates=a;const c=a.map(h.MercatorCoordinate.fromLngLat);this.tileID=function(_){let x=1/0,E=1/0,S=-1/0,A=-1/0;for(const Z of _)x=Math.min(x,Z.x),E=Math.min(E,Z.y),S=Math.max(S,Z.x),A=Math.max(A,Z.y);const D=Math.max(S-x,A-E),F=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),N=Math.pow(2,F);return new h.CanonicalTileID(F,Math.floor((x+S)/2*N),Math.floor((E+A)/2*N))}(c),this.minzoom=this.maxzoom=this.tileID.z;const d=c.map(_=>this.tileID.getTilePoint(_)._round());return this._boundsArray=new h.RasterBoundsArray,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,h.EXTENT,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,h.EXTENT),this._boundsArray.emplaceBack(d[2].x,d[2].y,h.EXTENT,h.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new h.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,c=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(a,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Ur extends Nr{constructor(a,c,d,_){super(a,c,d,_),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const a=this.options;this.urls=[];for(const c of a.urls)this.urls.push(this.map._requestManager.transformRequest(c,h.ResourceType.Source).url);h.getVideo(this.urls,(c,d)=>{this._loaded=!0,c?this.fire(new h.ErrorEvent(c)):d&&(this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const c=this.video.seekable;a<c.start(0)||a>c.end(0)?this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,c=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new we(a,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const d in this.tiles){const _=this.tiles[d];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Rr extends Nr{constructor(a,c,d,_){super(a,c,d,_),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(E=>typeof E!="number"))||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${a}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.ErrorEvent(new h.ValidationError(`sources.${a}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,d=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,ci.members)),this.boundsSegments||(this.boundsSegments=h.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(c,this.canvas,d.RGBA,{premultiply:!0});for(const _ in this.tiles){const x=this.tiles[_];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const ri={vector:Zt,raster:Er,"raster-dem":qr,geojson:Fi,video:Ur,image:Nr,canvas:Rr};function ui(m,a){const c=h.create();return h.translate(c,c,[1,1,0]),h.scale(c,c,[.5*m.width,.5*m.height,1]),h.multiply(c,c,m.calculatePosMatrix(a.toUnwrapped()))}function Gr(m,a,c,d,_,x){const E=function(N,Z,Y){if(N)for(const q of N){const Q=Z[q];if(Q&&Q.source===Y&&Q.type==="fill-extrusion")return!0}else for(const q in Z){const Q=Z[q];if(Q.source===Y&&Q.type==="fill-extrusion")return!0}return!1}(_&&_.layers,a,m.id),S=x.maxPitchScaleFactor(),A=m.tilesIn(d,S,E);A.sort(qn);const D=[];for(const N of A)D.push({wrappedTileID:N.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(a,c,m._state,N.queryGeometry,N.cameraQueryGeometry,N.scale,_,x,S,ui(m.transform,N.tileID))});const F=function(N){const Z={},Y={};for(const q of N){const Q=q.queryResults,ne=q.wrappedTileID,se=Y[ne]=Y[ne]||{};for(const ue in Q){const he=Q[ue],Ee=se[ue]=se[ue]||{},pe=Z[ue]=Z[ue]||[];for(const ve of he)Ee[ve.featureIndex]||(Ee[ve.featureIndex]=!0,pe.push(ve))}}return Z}(D);for(const N in F)F[N].forEach(Z=>{const Y=Z.feature,q=m.getFeatureState(Y.layer["source-layer"],Y.id);Y.source=Y.layer.source,Y.layer["source-layer"]&&(Y.sourceLayer=Y.layer["source-layer"]),Y.state=q});return F}function qn(m,a){const c=m.tileID,d=a.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}class Xn{constructor(a,c){this.tileID=a,this.uid=h.uniqueId(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const c=a+this.timeAdded;c<h.exported.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(a,c,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(_,x){const E={};if(!x)return E;for(const S of _){const A=S.layerIds.map(D=>x.getLayer(D)).filter(Boolean);if(A.length!==0){S.layers=A,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(D=>A.filter(F=>F.id===D)[0]));for(const D of A)E[D.id]=S}}return E}(a.buckets,c.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof h.SymbolBucket){if(this.hasSymbolBuckets=!0,!d)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof h.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,h.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(_).queryRadius(x))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new h.CollisionBoxArray}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const d in this.buckets){const _=this.buckets[d];_.uploadPending()&&_.upload(a)}const c=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(a,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(a,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,c,d,_,x,E,S,A,D,F){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:_,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:F,transform:A,params:S,queryPadding:this.queryPadding*D},a,c,d):{}}querySourceFeatures(a,c){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),x=c?c.sourceLayer:"",E=_._geojsonTileLayer||_[x];if(!E)return;const S=h.createFilter(c&&c.filter),{z:A,x:D,y:F}=this.tileID.canonical,N={z:A,x:D,y:F};for(let Z=0;Z<E.length;Z++){const Y=E.feature(Z);if(S.needGeometry){const ne=h.toEvaluationFeature(Y,!0);if(!S.filter(new h.EvaluationParameters(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!S.filter(new h.EvaluationParameters(this.tileID.overscaledZ),Y))continue;const q=d.getId(Y,x),Q=new h.GeoJSONFeature(Y,A,D,F,q);Q.tile=N,a.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const c=this.expirationTime;if(a.cacheControl){const d=h.parseCacheControl(a.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(c)if(this.expirationTime<c)_=!0;else{const x=this.expirationTime-c;x?this.expirationTime=d+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const _ in this.buckets){if(!c.style.hasLayer(_))continue;const x=this.buckets[_],E=x.layers[0].sourceLayer||"_geojsonTileLayer",S=d[E],A=a[E];if(!S||!A||Object.keys(A).length===0)continue;x.update(A,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const D=c&&c.style&&c.style.getLayer(_);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<h.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=h.exported.now()+a}setDependencies(a,c){const d={};for(const _ of c)d[_]=!0;this.dependencies[a]=d}hasDependency(a,c){for(const d of a){const _=this.dependencies[d];if(_){for(const x of c)if(_[x])return!0}}return!1}}class Kn{constructor(a,c){this.max=a,this.onRemove=c,this.reset()}reset(){for(const a in this.data)for(const c of this.data[a])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(a,c,d){const _=a.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:c,timeout:void 0};if(d!==void 0&&(x.timeout=setTimeout(()=>{this.remove(a,x)},d)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const c=this.data[a].shift();return c.timeout&&clearTimeout(c.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),c.value}getByKey(a){const c=this.data[a];return c?c[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,c){if(!this.has(a))return this;const d=a.wrapped().key,_=c===void 0?0:this.data[d].indexOf(c),x=this.data[d][_];return this.data[d].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(x.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(a){const c=[];for(const d in this.data)for(const _ of this.data[d])a(_.value)||c.push(_);for(const d of c)this.remove(d.value.tileID,d)}}class wi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,c,d){const _=String(c);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][_]=this.stateChanges[a][_]||{},h.extend(this.stateChanges[a][_],d),this.deletedStates[a]===null){this.deletedStates[a]={};for(const x in this.state[a])x!==_&&(this.deletedStates[a][x]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][_]===null){this.deletedStates[a][_]={};for(const x in this.state[a][_])d[x]||(this.deletedStates[a][_][x]=null)}else for(const x in d)this.deletedStates[a]&&this.deletedStates[a][_]&&this.deletedStates[a][_][x]===null&&delete this.deletedStates[a][_][x]}removeFeatureState(a,c,d){if(this.deletedStates[a]===null)return;const _=String(c);if(this.deletedStates[a]=this.deletedStates[a]||{},d&&c!==void 0)this.deletedStates[a][_]!==null&&(this.deletedStates[a][_]=this.deletedStates[a][_]||{},this.deletedStates[a][_][d]=null);else if(c!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][_])for(d in this.deletedStates[a][_]={},this.stateChanges[a][_])this.deletedStates[a][_][d]=null;else this.deletedStates[a][_]=null;else this.deletedStates[a]=null}getState(a,c){const d=String(c),_=h.extend({},(this.state[a]||{})[d],(this.stateChanges[a]||{})[d]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const x=this.deletedStates[a][c];if(x===null)return{};for(const E in x)delete _[E]}return _}initializeTileState(a,c){a.setFeatureState(this.state,c)}coalesceChanges(a,c){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const E in this.stateChanges[_])this.state[_][E]||(this.state[_][E]={}),h.extend(this.state[_][E],this.stateChanges[_][E]),x[E]=this.state[_][E];d[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const E in this.state[_])x[E]={},this.state[_][E]={};else for(const E in this.deletedStates[_]){if(this.deletedStates[_][E]===null)this.state[_][E]={};else for(const S of Object.keys(this.deletedStates[_][E]))delete this.state[_][E][S];x[E]=this.state[_][E]}d[_]=d[_]||{},h.extend(d[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in a)a[_].setFeatureState(d,c)}}class kr extends h.Evented{constructor(a,c,d){super(),this.id=a,this.dispatcher=d,this.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=!0}),this._source=function(_,x,E,S){const A=new ri[x.type](_,x,E,S);if(A.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${A.id}`);return h.bindAll(["load","abort","unload","serialize","prepare"],A),A}(a,c,d,this),this._tiles={},this._cache=new Kn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new wi}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const a in this._tiles){const c=this._tiles[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(a,c){return this._source.loadTile(a,c)}_unloadTile(a){if(this._source.unloadTile)return this._source.unloadTile(a,()=>{})}_abortTile(a){this._source.abortTile&&this._source.abortTile(a,()=>{}),this._source.fire(new h.Event("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const d=this._tiles[c];d.upload(a),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Hn).map(a=>a.key)}getRenderableIds(a){const c=[];for(const d in this._tiles)this._isIdRenderable(d,a)&&c.push(this._tiles[d]);return a?c.sort((d,_)=>{const x=d.tileID,E=_.tileID,S=new h.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),A=new h.pointGeometry(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||A.y-S.y||A.x-S.x}).map(d=>d.tileID.key):c.map(d=>d.tileID).sort(Hn).map(d=>d.key)}hasRenderableParent(a){const c=this.findLoadedParent(a,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(a,c){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(c||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,c){const d=this._tiles[a];d&&(d.state!=="loading"&&(d.state=c),this._loadTile(d,this._tileLoaded.bind(this,d,a,c)))}_tileLoaded(a,c,d,_){if(_)return a.state="errored",void(_.status!==404?this._source.fire(new h.ErrorEvent(_,{tile:a})):this.update(this.transform));a.timeAdded=h.exported.now(),d==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(c,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),this._source.fire(new h.Event("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const c=this.getRenderableIds();for(let _=0;_<c.length;_++){const x=c[_];if(a.neighboringTiles&&a.neighboringTiles[x]){const E=this.getTileByID(x);d(a,E),d(E,a)}}function d(_,x){_.needsHillshadePrepare=!0;let E=x.tileID.canonical.x-_.tileID.canonical.x;const S=x.tileID.canonical.y-_.tileID.canonical.y,A=Math.pow(2,_.tileID.canonical.z),D=x.tileID.key;E===0&&S===0||Math.abs(S)>1||(Math.abs(E)>1&&(Math.abs(E+A)===1?E+=A:Math.abs(E-A)===1&&(E-=A)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,E,S),_.neighboringTiles&&_.neighboringTiles[D]&&(_.neighboringTiles[D].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,c,d,_){for(const x in this._tiles){let E=this._tiles[x];if(_[x]||!E.hasData()||E.tileID.overscaledZ<=c||E.tileID.overscaledZ>d)continue;let S=E.tileID;for(;E&&E.tileID.overscaledZ>c+1;){const D=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[D.key],E&&E.hasData()&&(S=D)}let A=S;for(;A.overscaledZ>c;)if(A=A.scaledTo(A.overscaledZ-1),a[A.key]){_[S.key]=S;break}}}findLoadedParent(a,c){if(a.key in this._loadedParentTiles){const d=this._loadedParentTiles[a.key];return d&&d.tileID.overscaledZ>=c?d:null}for(let d=a.overscaledZ-1;d>=c;d--){const _=a.scaledTo(d),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(a){const c=this._tiles[a.key];return c&&c.hasData()?c:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const c=Math.ceil(a.width/this._source.tileSize)+1,d=Math.ceil(a.height/this._source.tileSize)+1,_=Math.floor(c*d*5),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(a){const c=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,c){const d={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),d[x.tileID.key]=x}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(_,this._tiles[_])}}update(a){if(this.transform=a,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?c=a.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new h.OverscaledTileID(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(c=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(c=c.filter(A=>this._source.hasTile(A)))):c=[];const d=a.coveringZoomLevel(this._source),_=Math.max(d-kr.maxOverzooming,this._source.minzoom),x=Math.max(d+kr.maxUnderzooming,this._source.minzoom),E=this._updateRetainedTiles(c,d);if(Wn(this._source.type)){const A={},D={},F=Object.keys(E);for(const N of F){const Z=E[N],Y=this._tiles[N];if(!Y||Y.fadeEndTime&&Y.fadeEndTime<=h.exported.now())continue;const q=this.findLoadedParent(Z,_);q&&(this._addTile(q.tileID),A[q.tileID.key]=q.tileID),D[N]=Z}this._retainLoadedChildren(D,d,x,E);for(const N in A)E[N]||(this._coveredTiles[N]=!0,E[N]=A[N])}for(const A in E)this._tiles[A].clearFadeHold();const S=h.keysDifference(this._tiles,E);for(const A of S){const D=this._tiles[A];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,c){const d={},_={},x=Math.max(c-kr.maxOverzooming,this._source.minzoom),E=Math.max(c+kr.maxUnderzooming,this._source.minzoom),S={};for(const A of a){const D=this._addTile(A);d[A.key]=A,D.hasData()||c<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,c,E,d);for(const A of a){let D=this._tiles[A.key];if(D.hasData())continue;if(c+1>this._source.maxzoom){const N=A.children(this._source.maxzoom)[0],Z=this.getTile(N);if(Z&&Z.hasData()){d[N.key]=N;continue}}else{const N=A.children(this._source.maxzoom);if(d[N[0].key]&&d[N[1].key]&&d[N[2].key]&&d[N[3].key])continue}let F=D.wasRequested();for(let N=A.overscaledZ-1;N>=x;--N){const Z=A.scaledTo(N);if(_[Z.key]||(_[Z.key]=!0,D=this.getTile(Z),!D&&F&&(D=this._addTile(Z)),D&&(d[Z.key]=Z,F=D.wasRequested(),D.hasData())))break}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const c=[];let d,_=this._tiles[a].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}c.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(x),d)break;_=x}for(const x of c)this._loadedParentTiles[x]=d}}_addTile(a){let c=this._tiles[a.key];if(c)return c;c=this._cache.getAndRemove(a),c&&(this._setTileReloadTimer(a.key,c),c.tileID=a,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,c)));const d=c;return c||(c=new Xn(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(c,this._tileLoaded.bind(this,c,a.key,c.state))),c.uses++,this._tiles[a.key]=c,d||this._source.fire(new h.Event("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(a,c){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const d=c.getExpiryTimeout();d&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},d))}_removeTile(a){const c=this._tiles[a];c&&(c.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,c,d){const _=[],x=this.transform;if(!x)return _;const E=d?x.getCameraQueryGeometry(a):a,S=a.map(q=>x.pointCoordinate(q)),A=E.map(q=>x.pointCoordinate(q)),D=this.getIds();let F=1/0,N=1/0,Z=-1/0,Y=-1/0;for(const q of A)F=Math.min(F,q.x),N=Math.min(N,q.y),Z=Math.max(Z,q.x),Y=Math.max(Y,q.y);for(let q=0;q<D.length;q++){const Q=this._tiles[D[q]];if(Q.holdingForFade())continue;const ne=Q.tileID,se=Math.pow(2,x.zoom-Q.tileID.overscaledZ),ue=c*Q.queryPadding*h.EXTENT/Q.tileSize/se,he=[ne.getTilePoint(new h.MercatorCoordinate(F,N)),ne.getTilePoint(new h.MercatorCoordinate(Z,Y))];if(he[0].x-ue<h.EXTENT&&he[0].y-ue<h.EXTENT&&he[1].x+ue>=0&&he[1].y+ue>=0){const Ee=S.map(ve=>ne.getTilePoint(ve)),pe=A.map(ve=>ne.getTilePoint(ve));_.push({tile:Q,tileID:ne,queryGeometry:Ee,cameraQueryGeometry:pe,scale:se})}}return _}getVisibleCoordinates(a){const c=this.getRenderableIds(a).map(d=>this._tiles[d].tileID);for(const d of c)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(Wn(this._source.type))for(const a in this._tiles){const c=this._tiles[a];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=h.exported.now())return!0}return!1}setFeatureState(a,c,d){this._state.updateState(a=a||"_geojsonTileLayer",c,d)}removeFeatureState(a,c,d){this._state.removeFeatureState(a=a||"_geojsonTileLayer",c,d)}getFeatureState(a,c){return this._state.getState(a=a||"_geojsonTileLayer",c)}setDependencies(a,c,d){const _=this._tiles[a];_&&_.setDependencies(c,d)}reloadTilesForDependencies(a,c){for(const d in this._tiles)this._tiles[d].hasDependency(a,c)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(a,c))}}function Hn(m,a){const c=Math.abs(2*m.wrap)-+(m.wrap<0),d=Math.abs(2*a.wrap)-+(a.wrap<0);return m.overscaledZ-a.overscaledZ||d-c||a.canonical.y-m.canonical.y||a.canonical.x-m.canonical.x}function Wn(m){return m==="raster"||m==="image"||m==="video"}kr.maxOverzooming=10,kr.maxUnderzooming=3;const En="mapboxgl_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new Worker(xs.workerUrl));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[En]}numActive(){return Object.keys(this.active).length}}const Ja=Math.floor(h.exported.hardwareConcurrency/2);let Ei;function Vi(){return Ei||(Ei=new hn),Ei}function Vs(m,a){const c={};for(const d in m)d!=="ref"&&(c[d]=m[d]);return h.refProperties.forEach(d=>{d in a&&(c[d]=a[d])}),c}function cn(m){m=m.slice();const a=Object.create(null);for(let c=0;c<m.length;c++)a[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=Vs(m[c],a[m[c].ref]));return m}hn.workerCount=Math.max(Math.min(Ja,6),1);const Ct={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Tn(m,a,c){c.push({command:Ct.addSource,args:[m,a[m]]})}function Mn(m,a,c){a.push({command:Ct.removeSource,args:[m]}),c[m]=!0}function Qa(m,a,c,d){Mn(m,c,d),Tn(m,a,c)}function xe(m,a,c){let d;for(d in m[c])if(Object.prototype.hasOwnProperty.call(m[c],d)&&d!=="data"&&!P(m[c][d],a[c][d]))return!1;for(d in a[c])if(Object.prototype.hasOwnProperty.call(a[c],d)&&d!=="data"&&!P(m[c][d],a[c][d]))return!1;return!0}function Be(m,a,c,d,_,x){let E;for(E in a=a||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(P(m[E],a[E])||c.push({command:x,args:[d,E,a[E],_]}));for(E in a)Object.prototype.hasOwnProperty.call(a,E)&&!Object.prototype.hasOwnProperty.call(m,E)&&(P(m[E],a[E])||c.push({command:x,args:[d,E,a[E],_]}))}function Yn(m){return m.id}function Yi(m,a){return m[a.id]=a,m}class Jt{constructor(a,c){this.reset(a,c)}reset(a,c){this.points=a||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=h.clamp(a,0,1);let c=1,d=this._distances[c];const _=a*this.paddedLength+this.padding;for(;d<_&&c<this._distances.length;)d=this._distances[++c];const x=c-1,E=this._distances[x],S=d-E,A=S>0?(_-E)/S:0;return this.points[x].mult(1-A).add(this.points[c].mult(A))}}function fi(m,a){let c=!0;return m==="always"||m!=="never"&&a!=="never"||(c=!1),c}class di{constructor(a,c,d){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(a/d),this.yCellCount=Math.ceil(c/d);for(let E=0;E<this.xCellCount*this.yCellCount;E++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=c,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,c,d,_,x){this._forEachCell(c,d,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(a,c,d,_){this._forEachCell(c-_,d-_,c+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(c),this.circles.push(d),this.circles.push(_)}_insertBoxCell(a,c,d,_,x,E){this.boxCells[x].push(E)}_insertCircleCell(a,c,d,_,x,E){this.circleCells[x].push(E)}_query(a,c,d,_,x,E,S){if(d<0||a>this.width||_<0||c>this.height)return[];const A=[];if(a<=0&&c<=0&&this.width<=d&&this.height<=_){if(x)return[{key:null,x1:a,y1:c,x2:d,y2:_}];for(let D=0;D<this.boxKeys.length;D++)A.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],N=this.circles[3*D+1],Z=this.circles[3*D+2];A.push({key:this.circleKeys[D],x1:F-Z,y1:N-Z,x2:F+Z,y2:N+Z})}}else this._forEachCell(a,c,d,_,this._queryCell,A,{hitTest:x,overlapMode:E,seenUids:{box:{},circle:{}}},S);return A}query(a,c,d,_){return this._query(a,c,d,_,!1,null)}hitTest(a,c,d,_,x,E){return this._query(a,c,d,_,!0,x,E).length>0}hitTestCircle(a,c,d,_,x){const E=a-d,S=a+d,A=c-d,D=c+d;if(S<0||E>this.width||D<0||A>this.height)return!1;const F=[];return this._forEachCell(E,A,S,D,this._queryCellCircle,F,{hitTest:!0,overlapMode:_,circle:{x:a,y:c,radius:d},seenUids:{box:{},circle:{}}},x),F.length>0}_queryCell(a,c,d,_,x,E,S,A){const{seenUids:D,hitTest:F,overlapMode:N}=S,Z=this.boxCells[x];if(Z!==null){const q=this.bboxes;for(const Q of Z)if(!D.box[Q]){D.box[Q]=!0;const ne=4*Q,se=this.boxKeys[Q];if(a<=q[ne+2]&&c<=q[ne+3]&&d>=q[ne+0]&&_>=q[ne+1]&&(!A||A(se))&&(!F||!fi(N,se.overlapMode))&&(E.push({key:se,x1:q[ne],y1:q[ne+1],x2:q[ne+2],y2:q[ne+3]}),F))return!0}}const Y=this.circleCells[x];if(Y!==null){const q=this.circles;for(const Q of Y)if(!D.circle[Q]){D.circle[Q]=!0;const ne=3*Q,se=this.circleKeys[Q];if(this._circleAndRectCollide(q[ne],q[ne+1],q[ne+2],a,c,d,_)&&(!A||A(se))&&(!F||!fi(N,se.overlapMode))){const ue=q[ne],he=q[ne+1],Ee=q[ne+2];if(E.push({key:se,x1:ue-Ee,y1:he-Ee,x2:ue+Ee,y2:he+Ee}),F)return!0}}}return!1}_queryCellCircle(a,c,d,_,x,E,S,A){const{circle:D,seenUids:F,overlapMode:N}=S,Z=this.boxCells[x];if(Z!==null){const q=this.bboxes;for(const Q of Z)if(!F.box[Q]){F.box[Q]=!0;const ne=4*Q,se=this.boxKeys[Q];if(this._circleAndRectCollide(D.x,D.y,D.radius,q[ne+0],q[ne+1],q[ne+2],q[ne+3])&&(!A||A(se))&&!fi(N,se.overlapMode))return E.push(!0),!0}}const Y=this.circleCells[x];if(Y!==null){const q=this.circles;for(const Q of Y)if(!F.circle[Q]){F.circle[Q]=!0;const ne=3*Q,se=this.circleKeys[Q];if(this._circlesCollide(q[ne],q[ne+1],q[ne+2],D.x,D.y,D.radius)&&(!A||A(se))&&!fi(N,se.overlapMode))return E.push(!0),!0}}}_forEachCell(a,c,d,_,x,E,S,A){const D=this._convertToXCellCoord(a),F=this._convertToYCellCoord(c),N=this._convertToXCellCoord(d),Z=this._convertToYCellCoord(_);for(let Y=D;Y<=N;Y++)for(let q=F;q<=Z;q++)if(x.call(this,a,c,d,_,this.xCellCount*q+Y,E,S,A))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,c,d,_,x,E){const S=_-a,A=x-c,D=d+E;return D*D>S*S+A*A}_circleAndRectCollide(a,c,d,_,x,E,S){const A=(E-_)/2,D=Math.abs(a-(_+A));if(D>A+d)return!1;const F=(S-x)/2,N=Math.abs(c-(x+F));if(N>F+d)return!1;if(D<=A||N<=F)return!0;const Z=D-A,Y=N-F;return Z*Z+Y*Y<=d*d}}function Sn(m,a,c,d,_){const x=h.create();return a?(h.scale(x,x,[1/_,1/_,1]),c||h.rotateZ(x,x,d.angle)):h.multiply(x,d.labelPlaneMatrix,m),x}function Xr(m,a,c,d,_){if(a){const x=h.clone(m);return h.scale(x,x,[_,_,1]),c||h.rotateZ(x,x,-d.angle),x}return d.glCoordMatrix}function ke(m,a){const c=h.fromValues(m.x,m.y,0,1);$s(c,c,a);const d=c[3];return{point:new h.pointGeometry(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function pt(m,a){return .5+m/a*.5}function ft(m,a){const c=m[0]/m[3],d=m[1]/m[3];return c>=-a[0]&&c<=a[0]&&d>=-a[1]&&d<=a[1]}function pi(m,a,c,d,_,x,E,S){const A=d?m.textSizeData:m.iconSizeData,D=h.evaluateSizeForZoom(A,c.transform.zoom),F=[256/c.width*2+1,256/c.height*2+1],N=d?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;N.clear();const Z=m.lineVertexArray,Y=d?m.text.placedSymbolArray:m.icon.placedSymbolArray,q=c.transform.width/c.transform.height;let Q=!1;for(let ne=0;ne<Y.length;ne++){const se=Y.get(ne);if(se.hidden||se.writingMode===h.WritingMode.vertical&&!Q){Lt(se.numGlyphs,N);continue}Q=!1;const ue=h.fromValues(se.anchorX,se.anchorY,0,1);if(h.transformMat4(ue,ue,a),!ft(ue,F)){Lt(se.numGlyphs,N);continue}const he=pt(c.transform.cameraToCenterDistance,ue[3]),Ee=h.evaluateSizeForFeature(A,D,se),pe=E?Ee/he:Ee*he,ve=new h.pointGeometry(se.anchorX,se.anchorY),Ie=ke(ve,_).point,Re={},Me=Jn(se,pe,!1,S,a,_,x,m.glyphOffsetArray,Z,N,Ie,ve,Re,q);Q=Me.useVertical,(Me.notEnoughRoom||Q||Me.needsFlipping&&Jn(se,pe,!0,S,a,_,x,m.glyphOffsetArray,Z,N,Ie,ve,Re,q).notEnoughRoom)&&Lt(se.numGlyphs,N)}d?m.text.dynamicLayoutVertexBuffer.updateData(N):m.icon.dynamicLayoutVertexBuffer.updateData(N)}function $i(m,a,c,d,_,x,E,S,A,D,F){const N=S.glyphStartIndex+S.numGlyphs,Z=S.lineStartIndex,Y=S.lineStartIndex+S.lineLength,q=a.getoffsetX(S.glyphStartIndex),Q=a.getoffsetX(N-1),ne=Bi(m*q,c,d,_,x,E,S.segment,Z,Y,A,D,F);if(!ne)return null;const se=Bi(m*Q,c,d,_,x,E,S.segment,Z,Y,A,D,F);return se?{first:ne,last:se}:null}function dt(m,a,c,d){return m===h.WritingMode.horizontal&&Math.abs(c.y-a.y)>Math.abs(c.x-a.x)*d?{useVertical:!0}:(m===h.WritingMode.vertical?a.y<c.y:a.x>c.x)?{needsFlipping:!0}:null}function Jn(m,a,c,d,_,x,E,S,A,D,F,N,Z,Y){const q=a/24,Q=m.lineOffsetX*q,ne=m.lineOffsetY*q;let se;if(m.numGlyphs>1){const ue=m.glyphStartIndex+m.numGlyphs,he=m.lineStartIndex,Ee=m.lineStartIndex+m.lineLength,pe=$i(q,S,Q,ne,c,F,N,m,A,x,Z);if(!pe)return{notEnoughRoom:!0};const ve=ke(pe.first.point,E).point,Ie=ke(pe.last.point,E).point;if(d&&!c){const Re=dt(m.writingMode,ve,Ie,Y);if(Re)return Re}se=[pe.first];for(let Re=m.glyphStartIndex+1;Re<ue-1;Re++)se.push(Bi(q*S.getoffsetX(Re),Q,ne,c,F,N,m.segment,he,Ee,A,x,Z));se.push(pe.last)}else{if(d&&!c){const he=ke(N,_).point,Ee=m.lineStartIndex+m.segment+1,pe=new h.pointGeometry(A.getx(Ee),A.gety(Ee)),ve=ke(pe,_),Ie=ve.signedDistanceFromCamera>0?ve.point:un(N,pe,he,1,_),Re=dt(m.writingMode,he,Ie,Y);if(Re)return Re}const ue=Bi(q*S.getoffsetX(m.glyphStartIndex),Q,ne,c,F,N,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,A,x,Z);if(!ue)return{notEnoughRoom:!0};se=[ue]}for(const ue of se)h.addDynamicAttributes(D,ue.point,ue.angle);return{}}function un(m,a,c,d,_){const x=ke(m.add(m.sub(a)._unit()),_).point,E=c.sub(x);return c.add(E._mult(d/E.mag()))}function Bi(m,a,c,d,_,x,E,S,A,D,F,N){const Z=d?m-a:m+a;let Y=Z>0?1:-1,q=0;d&&(Y*=-1,q=Math.PI),Y<0&&(q+=Math.PI);let Q=Y>0?S+E:S+E+1,ne=_,se=_,ue=0,he=0;const Ee=Math.abs(Z),pe=[];for(;ue+he<=Ee;){if(Q+=Y,Q<S||Q>=A)return null;if(se=ne,pe.push(ne),ne=N[Q],ne===void 0){const We=new h.pointGeometry(D.getx(Q),D.gety(Q)),$e=ke(We,F);if($e.signedDistanceFromCamera>0)ne=N[Q]=$e.point;else{const ht=Q-Y;ne=un(ue===0?x:new h.pointGeometry(D.getx(ht),D.gety(ht)),We,se,Ee-ue+1,F)}}ue+=he,he=se.dist(ne)}const ve=(Ee-ue)/he,Ie=ne.sub(se),Re=Ie.mult(ve)._add(se);Re._add(Ie._unit()._perp()._mult(c*Y));const Me=q+Math.atan2(ne.y-se.y,ne.x-se.x);return pe.push(Re),{point:Re,angle:Me,path:pe}}const ii=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Lt(m,a){for(let c=0;c<m;c++){const d=a.length;a.resize(d+4),a.float32.set(ii,3*d)}}function $s(m,a,c){const d=a[0],_=a[1];return m[0]=c[0]*d+c[4]*_+c[12],m[1]=c[1]*d+c[5]*_+c[13],m[3]=c[3]*d+c[7]*_+c[15],m}const Kr=100;class Qn{constructor(a,c=new di(a.width+200,a.height+200,25),d=new di(a.width+200,a.height+200,25)){this.transform=a,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Kr,this.screenBottomBoundary=a.height+Kr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200}placeCollisionBox(a,c,d,_,x){const E=this.projectAndGetPerspectiveRatio(_,a.anchorPointX,a.anchorPointY),S=d*E.perspectiveRatio,A=a.x1*S+E.point.x,D=a.y1*S+E.point.y,F=a.x2*S+E.point.x,N=a.y2*S+E.point.y;return!this.isInsideGrid(A,D,F,N)||c!=="always"&&this.grid.hitTest(A,D,F,N,c,x)?{box:[],offscreen:!1}:{box:[A,D,F,N],offscreen:this.isOffscreen(A,D,F,N)}}placeCollisionCircles(a,c,d,_,x,E,S,A,D,F,N,Z,Y){const q=[],Q=new h.pointGeometry(c.anchorX,c.anchorY),ne=ke(Q,E),se=pt(this.transform.cameraToCenterDistance,ne.signedDistanceFromCamera),ue=(F?x/se:x*se)/h.ONE_EM,he=ke(Q,S).point,Ee=$i(ue,_,c.lineOffsetX*ue,c.lineOffsetY*ue,!1,he,Q,c,d,S,{});let pe=!1,ve=!1,Ie=!0;if(Ee){const Re=.5*Z*se+Y,Me=new h.pointGeometry(-100,-100),We=new h.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),$e=new Jt,ht=Ee.first,Dt=Ee.last;let vt=[];for(let ut=ht.path.length-1;ut>=1;ut--)vt.push(ht.path[ut]);for(let ut=1;ut<Dt.path.length;ut++)vt.push(Dt.path[ut]);const xt=2.5*Re;if(A){const ut=vt.map(Tt=>ke(Tt,A));vt=ut.some(Tt=>Tt.signedDistanceFromCamera<=0)?[]:ut.map(Tt=>Tt.point)}let fr=[];if(vt.length>0){const ut=vt[0].clone(),Tt=vt[0].clone();for(let sr=1;sr<vt.length;sr++)ut.x=Math.min(ut.x,vt[sr].x),ut.y=Math.min(ut.y,vt[sr].y),Tt.x=Math.max(Tt.x,vt[sr].x),Tt.y=Math.max(Tt.y,vt[sr].y);fr=ut.x>=Me.x&&Tt.x<=We.x&&ut.y>=Me.y&&Tt.y<=We.y?[vt]:Tt.x<Me.x||ut.x>We.x||Tt.y<Me.y||ut.y>We.y?[]:h.clipLine([vt],Me.x,Me.y,We.x,We.y)}for(const ut of fr){$e.reset(ut,.25*Re);let Tt=0;Tt=$e.length<=.5*Re?1:Math.ceil($e.paddedLength/xt)+1;for(let sr=0;sr<Tt;sr++){const Vr=sr/Math.max(Tt-1,1),Si=$e.lerp(Vr),Ai=Si.x+Kr,Zi=Si.y+Kr;q.push(Ai,Zi,Re,0);const Ci=Ai-Re,qi=Zi-Re,kn=Ai+Re,sa=Zi+Re;if(Ie=Ie&&this.isOffscreen(Ci,qi,kn,sa),ve=ve||this.isInsideGrid(Ci,qi,kn,sa),a!=="always"&&this.grid.hitTestCircle(Ai,Zi,Re,a,N)&&(pe=!0,!D))return{circles:[],offscreen:!1,collisionDetected:pe}}}}return{circles:!D&&pe||!ve?[]:q,offscreen:Ie,collisionDetected:pe}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let d=1/0,_=1/0,x=-1/0,E=-1/0;for(const F of a){const N=new h.pointGeometry(F.x+Kr,F.y+Kr);d=Math.min(d,N.x),_=Math.min(_,N.y),x=Math.max(x,N.x),E=Math.max(E,N.y),c.push(N)}const S=this.grid.query(d,_,x,E).concat(this.ignoredGrid.query(d,_,x,E)),A={},D={};for(const F of S){const N=F.key;if(A[N.bucketInstanceId]===void 0&&(A[N.bucketInstanceId]={}),A[N.bucketInstanceId][N.featureIndex])continue;const Z=[new h.pointGeometry(F.x1,F.y1),new h.pointGeometry(F.x2,F.y1),new h.pointGeometry(F.x2,F.y2),new h.pointGeometry(F.x1,F.y2)];h.polygonIntersectsPolygon(c,Z)&&(A[N.bucketInstanceId][N.featureIndex]=!0,D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(a,c,d,_,x,E){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:c},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,c,d,_,x,E){const S=d?this.ignoredGrid:this.grid,A={bucketInstanceId:_,featureIndex:x,collisionGroupID:E,overlapMode:c};for(let D=0;D<a.length;D+=4)S.insertCircle(A,a[D],a[D+1],a[D+2])}projectAndGetPerspectiveRatio(a,c,d){const _=h.fromValues(c,d,0,1);return $s(_,_,a),{point:new h.pointGeometry((_[0]/_[3]+1)/2*this.transform.width+Kr,(-_[1]/_[3]+1)/2*this.transform.height+Kr),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(a,c,d,_){return d<Kr||a>=this.screenRightBoundary||_<Kr||c>this.screenBottomBoundary}isInsideGrid(a,c,d,_){return d>=0&&a<this.gridRightBoundary&&_>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const a=h.identity([]);return h.translate(a,a,[-100,-100,0]),a}}function pr(m,a,c){return a*(h.EXTENT/(m.tileSize*Math.pow(2,c-m.tileID.overscaledZ)))}class An{constructor(a,c,d,_){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?c:-c))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Cn{constructor(a,c,d,_,x){this.text=new An(a?a.text:null,c,d,x),this.icon=new An(a?a.icon:null,c,_,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ea{constructor(a,c,d){this.text=a,this.icon=c,this.skipFade=d}}class Ta{constructor(){this.invProjMatrix=h.create(),this.viewportMatrix=h.create(),this.circles=[]}}class X{constructor(a,c,d,_,x){this.bucketInstanceId=a,this.featureIndex=c,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=x}}class k{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const c=++this.maxGroupID;this.collisionGroups[a]={ID:c,predicate:d=>d.collisionGroupID===c}}return this.collisionGroups[a]}}function O(m,a,c,d,_){const{horizontalAlign:x,verticalAlign:E}=h.getAnchorAlignment(m),S=-(x-.5)*a,A=-(E-.5)*c,D=h.evaluateVariableOffset(m,d);return new h.pointGeometry(S+D[0]*_,A+D[1]*_)}function $(m,a,c,d,_,x){const{x1:E,x2:S,y1:A,y2:D,anchorPointX:F,anchorPointY:N}=m,Z=new h.pointGeometry(a,c);return d&&Z._rotate(_?x:-x),{x1:E+Z.x,y1:A+Z.y,x2:S+Z.x,y2:D+Z.y,anchorPointX:F,anchorPointY:N}}class K{constructor(a,c,d,_){this.transform=a.clone(),this.collisionIndex=new Qn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new k(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,c,d,_){const x=d.getBucket(c),E=d.latestFeatureIndex;if(!x||!E||c.id!==x.layerIds[0])return;const S=d.collisionBoxArray,A=x.layers[0].layout,D=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),F=d.tileSize/h.EXTENT,N=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),Z=A.get("text-pitch-alignment")==="map",Y=A.get("text-rotation-alignment")==="map",q=pr(d,1,this.transform.zoom),Q=Sn(N,Z,Y,this.transform,q);let ne=null;if(Z){const ue=Xr(N,Z,Y,this.transform,q);ne=h.multiply([],this.transform.labelPlaneMatrix,ue)}this.retainedQueryData[x.bucketInstanceId]=new X(x.bucketInstanceId,E,x.sourceLayerIndex,x.index,d.tileID);const se={bucket:x,layout:A,posMatrix:N,textLabelPlaneMatrix:Q,labelToScreenMatrix:ne,scale:D,textPixelRatio:F,holdingForFade:d.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:h.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const ue of x.sortKeyRanges){const{sortKey:he,symbolInstanceStart:Ee,symbolInstanceEnd:pe}=ue;a.push({sortKey:he,symbolInstanceStart:Ee,symbolInstanceEnd:pe,parameters:se})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:se})}attemptAnchorPlacement(a,c,d,_,x,E,S,A,D,F,N,Z,Y,q,Q){const ne=[Z.textOffset0,Z.textOffset1],se=O(a,d,_,ne,x),ue=this.collisionIndex.placeCollisionBox($(c,se.x,se.y,E,S,this.transform.angle),N,A,D,F.predicate);if((!Q||this.collisionIndex.placeCollisionBox($(Q,se.x,se.y,E,S,this.transform.angle),N,A,D,F.predicate).box.length!==0)&&ue.box.length>0){let he;return this.prevPlacement&&this.prevPlacement.variableOffsets[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID]&&this.prevPlacement.placements[Z.crossTileID].text&&(he=this.prevPlacement.variableOffsets[Z.crossTileID].anchor),this.variableOffsets[Z.crossTileID]={textOffset:ne,width:d,height:_,anchor:a,textBoxScale:x,prevAnchor:he},this.markUsedJustification(Y,a,Z,q),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,q,Z),this.placedOrientations[Z.crossTileID]=q),{shift:se,placedGlyphBoxes:ue}}}placeLayerBucketPart(a,c,d){const{bucket:_,layout:x,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:A,textPixelRatio:D,holdingForFade:F,collisionBoxArray:N,partiallyEvaluatedTextSize:Z,collisionGroup:Y}=a.parameters,q=x.get("text-optional"),Q=x.get("icon-optional"),ne=h.getOverlapMode(x,"text-overlap","text-allow-overlap"),se=ne==="always",ue=h.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),he=ue==="always",Ee=x.get("text-rotation-alignment")==="map",pe=x.get("text-pitch-alignment")==="map",ve=x.get("icon-text-fit")!=="none",Ie=x.get("symbol-z-order")==="viewport-y",Re=se&&(he||!_.hasIconData()||Q),Me=he&&(se||!_.hasTextData()||q);!_.collisionArrays&&N&&_.deserializeCollisionBoxes(N);const We=($e,ht)=>{if(c[$e.crossTileID])return;if(F)return void(this.placements[$e.crossTileID]=new ea(!1,!1,!1));let Dt=!1,vt=!1,xt=!0,fr=null,ut={box:null,offscreen:null},Tt={box:null,offscreen:null},sr=null,Vr=null,Si=null,Ai=0,Zi=0,Ci=0;ht.textFeatureIndex?Ai=ht.textFeatureIndex:$e.useRuntimeCollisionCircles&&(Ai=$e.featureIndex),ht.verticalTextFeatureIndex&&(Zi=ht.verticalTextFeatureIndex);const qi=ht.textBox;if(qi){const Vt=kt=>{let Mr=h.WritingMode.horizontal;if(_.allowVerticalPlacement&&!kt&&this.prevPlacement){const Ii=this.prevPlacement.placedOrientations[$e.crossTileID];Ii&&(this.placedOrientations[$e.crossTileID]=Ii,Mr=Ii,this.markUsedOrientation(_,Mr,$e))}return Mr},Dr=(kt,Mr)=>{if(_.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const Ii of _.writingModes)if(Ii===h.WritingMode.vertical?(ut=Mr(),Tt=ut):ut=kt(),ut&&ut.box&&ut.box.length)break}else ut=kt()};if(x.get("text-variable-anchor")){let kt=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$e.crossTileID]){const er=this.prevPlacement.variableOffsets[$e.crossTileID];kt.indexOf(er.anchor)>0&&(kt=kt.filter(oa=>oa!==er.anchor),kt.unshift(er.anchor))}const Mr=(er,oa,la)=>{const Fa=er.x2-er.x1,yo=er.y2-er.y1,Tc=$e.textBoxScale,$l=ve&&ue==="never"?oa:null;let Dn={box:[],offscreen:!1};const ha=ne!=="never"?2*kt.length:kt.length;for(let ca=0;ca<ha;++ca){const vo=this.attemptAnchorPlacement(kt[ca%kt.length],er,Fa,yo,Tc,Ee,pe,D,E,Y,ca>=kt.length?ne:"never",$e,_,la,$l);if(vo&&(Dn=vo.placedGlyphBoxes,Dn&&Dn.box&&Dn.box.length)){Dt=!0,fr=vo.shift;break}}return Dn};Dr(()=>Mr(qi,ht.iconBox,h.WritingMode.horizontal),()=>{const er=ht.verticalTextBox;return _.allowVerticalPlacement&&!(ut&&ut.box&&ut.box.length)&&$e.numVerticalGlyphVertices>0&&er?Mr(er,ht.verticalIconBox,h.WritingMode.vertical):{box:null,offscreen:null}}),ut&&(Dt=ut.box,xt=ut.offscreen);const Ii=Vt(ut&&ut.box);if(!Dt&&this.prevPlacement){const er=this.prevPlacement.variableOffsets[$e.crossTileID];er&&(this.variableOffsets[$e.crossTileID]=er,this.markUsedJustification(_,er.anchor,$e,Ii))}}else{const kt=(Mr,Ii)=>{const er=this.collisionIndex.placeCollisionBox(Mr,ne,D,E,Y.predicate);return er&&er.box&&er.box.length&&(this.markUsedOrientation(_,Ii,$e),this.placedOrientations[$e.crossTileID]=Ii),er};Dr(()=>kt(qi,h.WritingMode.horizontal),()=>{const Mr=ht.verticalTextBox;return _.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&Mr?kt(Mr,h.WritingMode.vertical):{box:null,offscreen:null}}),Vt(ut&&ut.box&&ut.box.length)}}if(sr=ut,Dt=sr&&sr.box&&sr.box.length>0,xt=sr&&sr.offscreen,$e.useRuntimeCollisionCircles){const Vt=_.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex),Dr=h.evaluateSizeForFeature(_.textSizeData,Z,Vt),kt=x.get("text-padding");Vr=this.collisionIndex.placeCollisionCircles(ne,Vt,_.lineVertexArray,_.glyphOffsetArray,Dr,E,S,A,d,pe,Y.predicate,$e.collisionCircleDiameter,kt),Dt=se||Vr.circles.length>0&&!Vr.collisionDetected,xt=xt&&Vr.offscreen}if(ht.iconFeatureIndex&&(Ci=ht.iconFeatureIndex),ht.iconBox){const Vt=Dr=>{const kt=ve&&fr?$(Dr,fr.x,fr.y,Ee,pe,this.transform.angle):Dr;return this.collisionIndex.placeCollisionBox(kt,ue,D,E,Y.predicate)};Tt&&Tt.box&&Tt.box.length&&ht.verticalIconBox?(Si=Vt(ht.verticalIconBox),vt=Si.box.length>0):(Si=Vt(ht.iconBox),vt=Si.box.length>0),xt=xt&&Si.offscreen}const kn=q||$e.numHorizontalGlyphVertices===0&&$e.numVerticalGlyphVertices===0,sa=Q||$e.numIconVertices===0;if(kn||sa?sa?kn||(vt=vt&&Dt):Dt=vt&&Dt:vt=Dt=vt&&Dt,Dt&&sr&&sr.box&&this.collisionIndex.insertCollisionBox(sr.box,ne,x.get("text-ignore-placement"),_.bucketInstanceId,Tt&&Tt.box&&Zi?Zi:Ai,Y.ID),vt&&Si&&this.collisionIndex.insertCollisionBox(Si.box,ue,x.get("icon-ignore-placement"),_.bucketInstanceId,Ci,Y.ID),Vr&&(Dt&&this.collisionIndex.insertCollisionCircles(Vr.circles,ne,x.get("text-ignore-placement"),_.bucketInstanceId,Ai,Y.ID),d)){const Vt=_.bucketInstanceId;let Dr=this.collisionCircleArrays[Vt];Dr===void 0&&(Dr=this.collisionCircleArrays[Vt]=new Ta);for(let kt=0;kt<Vr.circles.length;kt+=4)Dr.circles.push(Vr.circles[kt+0]),Dr.circles.push(Vr.circles[kt+1]),Dr.circles.push(Vr.circles[kt+2]),Dr.circles.push(Vr.collisionDetected?1:0)}this.placements[$e.crossTileID]=new ea(Dt||Re,vt||Me,xt||_.justReloaded),c[$e.crossTileID]=!0};if(Ie){const $e=_.getSortedSymbolIndexes(this.transform.angle);for(let ht=$e.length-1;ht>=0;--ht){const Dt=$e[ht];We(_.symbolInstances.get(Dt),_.collisionArrays[Dt])}}else for(let $e=a.symbolInstanceStart;$e<a.symbolInstanceEnd;$e++)We(_.symbolInstances.get($e),_.collisionArrays[$e]);if(d&&_.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[_.bucketInstanceId];h.invert($e.invProjMatrix,E),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(a,c,d,_){let x;x=_===h.WritingMode.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[h.getAnchorJustification(c)];const E=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const S of E)S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=x>=0&&S!==x?0:d.crossTileID)}markUsedOrientation(a,c,d){const _=c===h.WritingMode.horizontal||c===h.WritingMode.horizontalOnly?c:0,x=c===h.WritingMode.vertical?c:0,E=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const S of E)a.text.placedSymbolArray.get(S).placedOrientation=_;d.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let d=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const _=c?c.symbolFadeChange(a):1,x=c?c.opacities:{},E=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],F=x[A];F?(this.opacities[A]=new Cn(F,_,D.text,D.icon),d=d||D.text!==F.text.placed||D.icon!==F.icon.placed):(this.opacities[A]=new Cn(null,_,D.text,D.icon,D.skipFade),d=d||D.text||D.icon)}for(const A in x){const D=x[A];if(!this.opacities[A]){const F=new Cn(D,_,!1,!1);F.isHidden()||(this.opacities[A]=F,d=d||D.text.placed||D.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);d?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:a)}updateLayerOpacities(a,c){const d={};for(const _ of c){const x=_.getBucket(a);x&&_.latestFeatureIndex&&a.id===x.layerIds[0]&&this.updateBucketOpacities(x,d,_.collisionBoxArray)}}updateBucketOpacities(a,c,d){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const _=a.layers[0].layout,x=new Cn(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),S=_.get("icon-allow-overlap"),A=_.get("text-variable-anchor"),D=_.get("text-rotation-alignment")==="map",F=_.get("text-pitch-alignment")==="map",N=_.get("icon-text-fit")!=="none",Z=new Cn(null,0,E&&(S||!a.hasIconData()||_.get("icon-optional")),S&&(E||!a.hasTextData()||_.get("text-optional")),!0);!a.collisionArrays&&d&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(d);const Y=(q,Q,ne)=>{for(let se=0;se<Q/4;se++)q.opacityVertexArray.emplaceBack(ne)};for(let q=0;q<a.symbolInstances.length;q++){const Q=a.symbolInstances.get(q),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:se,crossTileID:ue}=Q;let he=this.opacities[ue];c[ue]?he=x:he||(he=Z,this.opacities[ue]=he),c[ue]=!0;const Ee=Q.numIconVertices>0,pe=this.placedOrientations[Q.crossTileID],ve=pe===h.WritingMode.vertical,Ie=pe===h.WritingMode.horizontal||pe===h.WritingMode.horizontalOnly;if(ne>0||se>0){const Re=He(he.text);Y(a.text,ne,ve?Ne:Re),Y(a.text,se,Ie?Ne:Re);const Me=he.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(ht=>{ht>=0&&(a.text.placedSymbolArray.get(ht).hidden=Me||ve?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Me||Ie?1:0);const We=this.variableOffsets[Q.crossTileID];We&&this.markUsedJustification(a,We.anchor,Q,pe);const $e=this.placedOrientations[Q.crossTileID];$e&&(this.markUsedJustification(a,"left",Q,$e),this.markUsedOrientation(a,$e,Q))}if(Ee){const Re=He(he.icon),Me=!(N&&Q.verticalPlacedIconSymbolIndex&&ve);Q.placedIconSymbolIndex>=0&&(Y(a.icon,Q.numIconVertices,Me?Re:Ne),a.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=he.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(Y(a.icon,Q.numVerticalIconVertices,Me?Ne:Re),a.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=he.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Re=a.collisionArrays[q];if(Re){let Me=new h.pointGeometry(0,0);if(Re.textBox||Re.verticalTextBox){let $e=!0;if(A){const ht=this.variableOffsets[ue];ht?(Me=O(ht.anchor,ht.width,ht.height,ht.textOffset,ht.textBoxScale),D&&Me._rotate(F?this.transform.angle:-this.transform.angle)):$e=!1}Re.textBox&&W(a.textCollisionBox.collisionVertexArray,he.text.placed,!$e||ve,Me.x,Me.y),Re.verticalTextBox&&W(a.textCollisionBox.collisionVertexArray,he.text.placed,!$e||Ie,Me.x,Me.y)}const We=Boolean(!Ie&&Re.verticalIconBox);Re.iconBox&&W(a.iconCollisionBox.collisionVertexArray,he.icon.placed,We,N?Me.x:0,N?Me.y:0),Re.verticalIconBox&&W(a.iconCollisionBox.collisionVertexArray,he.icon.placed,!We,N?Me.x:0,N?Me.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const q=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=q.invProjMatrix,a.placementViewportMatrix=q.viewportMatrix,a.collisionCircleArray=q.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,c){const d=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*d>a}setStale(){this.stale=!0}}function W(m,a,c,d,_){m.emplaceBack(a?1:0,c?1:0,d||0,_||0),m.emplaceBack(a?1:0,c?1:0,d||0,_||0),m.emplaceBack(a?1:0,c?1:0,d||0,_||0),m.emplaceBack(a?1:0,c?1:0,d||0,_||0)}const ae=Math.pow(2,25),te=Math.pow(2,24),ie=Math.pow(2,17),oe=Math.pow(2,16),_e=Math.pow(2,9),Se=Math.pow(2,8),me=Math.pow(2,1);function He(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const a=m.placed?1:0,c=Math.floor(127*m.opacity);return c*ae+a*te+c*ie+a*oe+c*_e+a*Se+c*me+a}const Ne=0;class Ye{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,c,d,_,x){const E=this._bucketParts;for(;this._currentTileIndex<a.length;)if(c.getBucketParts(E,_,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<E.length;)if(c.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,x())return!0;return!1}}class nt{constructor(a,c,d,_,x,E,S){this.placement=new K(a,x,E,S),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(a,c,d){const _=h.exported.now(),x=()=>{const E=h.exported.now()-_;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){const E=c[a[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=S)&&(!E.maxzoom||E.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ye(E)),this._inProgressLayer.continuePlacement(d[E.source],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const It=512/h.EXTENT/2;class Et{constructor(a,c,d){this.tileID=a,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(let _=0;_<c.length;_++){const x=c.get(_),E=x.key;this.indexedSymbolInstances[E]||(this.indexedSymbolInstances[E]=[]),this.indexedSymbolInstances[E].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,a)})}}getScaledCoordinates(a,c){const d=It/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*h.EXTENT+a.anchorX)*d),y:Math.floor((c.canonical.y*h.EXTENT+a.anchorY)*d)}}findMatches(a,c,d){const _=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<a.length;x++){const E=a.get(x);if(E.crossTileID)continue;const S=this.indexedSymbolInstances[E.key];if(!S)continue;const A=this.getScaledCoordinates(E,c);for(const D of S)if(Math.abs(D.coord.x-A.x)<=_&&Math.abs(D.coord.y-A.y)<=_&&!d[D.crossTileID]){d[D.crossTileID]=!0,E.crossTileID=D.crossTileID;break}}}}class yt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const c=Math.round((a-this.lng)/360);if(c!==0)for(const d in this.indexes){const _=this.indexes[d],x={};for(const E in _){const S=_[E];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),x[S.tileID.key]=S}this.indexes[d]=x}this.lng=a}addBucket(a,c,d){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const _=this.usedCrossTileIDs[a.overscaledZ];for(const x in this.indexes){const E=this.indexes[x];if(Number(x)>a.overscaledZ)for(const S in E){const A=E[S];A.tileID.isChildOf(a)&&A.findMatches(c.symbolInstances,a,_)}else{const S=E[a.scaledTo(Number(x)).key];S&&S.findMatches(c.symbolInstances,a,_)}}for(let x=0;x<c.symbolInstances.length;x++){const E=c.symbolInstances.get(x);E.crossTileID||(E.crossTileID=d.generate(),_[E.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Et(a,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(a,c){for(const d in c.indexedSymbolInstances)for(const _ of c.indexedSymbolInstances[d])delete this.usedCrossTileIDs[a][_.crossTileID]}removeStaleBuckets(a){let c=!1;for(const d in this.indexes){const _=this.indexes[d];for(const x in _)a[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[x]),delete _[x],c=!0)}return c}}class gt{constructor(){this.layerIndexes={},this.crossTileIDs=new yt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,c,d){let _=this.layerIndexes[a.id];_===void 0&&(_=this.layerIndexes[a.id]=new mt);let x=!1;const E={};_.handleWrapJump(d);for(const S of c){const A=S.getBucket(a);A&&a.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,A,this.crossTileIDs)&&(x=!0),E[A.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(a){const c={};a.forEach(d=>{c[d]=!0});for(const d in this.layerIndexes)c[d]||delete this.layerIndexes[d]}}const ar=(m,a)=>h.emitValidationErrors(m,a&&a.filter(c=>c.identifier!=="source.canvas")),mr=h.pick(Ct,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),zr=h.pick(Ct,["setCenter","setZoom","setBearing","setPitch"]),In=function(){const m={},a=h.spec.$version;for(const c in h.spec.$root){const d=h.spec.$root[c];if(d.required){let _=null;_=c==="version"?a:d.type==="array"?[]:{},_!=null&&(m[c]=_)}}return m}();class Ji extends h.Evented{constructor(a,c={}){super(),this.map=a,this.dispatcher=new At(Vi(),this),this.imageManager=new De,this.imageManager.setEventedParent(this),this.glyphManager=new ct(a._requestManager,c.localIdeographFontFamily),this.lineAtlas=new Ht(256,512),this.crossTileSymbolIndex=new gt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",h.getReferrer());const d=this;this._rtlTextPluginCallback=Ji.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,E)=>{if(h.triggerPluginCompletionEvent(x),E&&E.every(S=>S))for(const S in d.sourceCaches)d.sourceCaches[S].reload()})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.sourceCaches[_.sourceId];if(!x)return;const E=x.getSource();if(E&&E.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===E.id&&this._validateLayer(A)}})}loadURL(a,c={}){this.fire(new h.Event("dataloading",{dataType:"style"}));const d=typeof c.validate!="boolean"||c.validate,_=this.map._requestManager.transformRequest(a,h.ResourceType.Style);this._request=h.getJSON(_,(x,E)=>{this._request=null,x?this.fire(new h.ErrorEvent(x)):E&&this._load(E,d)})}loadJSON(a,c={}){this.fire(new h.Event("dataloading",{dataType:"style"})),this._request=h.exported.frame(()=>{this._request=null,this._load(a,c.validate!==!1)})}loadEmpty(){this.fire(new h.Event("dataloading",{dataType:"style"})),this._load(In,!1)}_load(a,c){if(c&&ar(this,h.validateStyle(a)))return;this._loaded=!0,this.stylesheet=a;for(const _ in a.sources)this.addSource(_,a.sources[_],{validate:!1});a.sprite?this._loadSprite(a.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(a.glyphs);const d=cn(this.stylesheet.layers);this._order=d.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of d)_=h.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Kt(this.stylesheet.light),this.fire(new h.Event("data",{dataType:"style"})),this.fire(new h.Event("style.load"))}_loadSprite(a){this._spriteRequest=function(c,d,_,x){let E,S,A;const D=_>1?"@2x":"";let F=h.getJSON(d.transformRequest(d.normalizeSpriteURL(c,D,".json"),h.ResourceType.SpriteJSON),(Y,q)=>{F=null,A||(A=Y,E=q,Z())}),N=h.getImage(d.transformRequest(d.normalizeSpriteURL(c,D,".png"),h.ResourceType.SpriteImage),(Y,q)=>{N=null,A||(A=Y,S=q,Z())});function Z(){if(A)x(A);else if(E&&S){const Y=h.exported.getImageData(S),q={};for(const Q in E){const{width:ne,height:se,x:ue,y:he,sdf:Ee,pixelRatio:pe,stretchX:ve,stretchY:Ie,content:Re}=E[Q],Me=new h.RGBAImage({width:ne,height:se});h.RGBAImage.copy(Y,Me,{x:ue,y:he},{x:0,y:0},{width:ne,height:se}),q[Q]={data:Me,pixelRatio:pe,sdf:Ee,stretchX:ve,stretchY:Ie,content:Re}}x(null,q)}}return{cancel(){F&&(F.cancel(),F=null),N&&(N.cancel(),N=null)}}}(a,this.map._requestManager,this.map.getPixelRatio(),(c,d)=>{if(this._spriteRequest=null,c)this.fire(new h.ErrorEvent(c));else if(d)for(const _ in d)this.imageManager.addImage(_,d[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))})}_validateLayer(a){const c=this.sourceCaches[a.source];if(!c)return;const d=a.sourceLayer;if(!d)return;const _=c.getSource();(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(d)===-1)&&this.fire(new h.ErrorEvent(new Error(`Source layer "${d}" does not exist on source "${_.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const c=[];for(const d of a){const _=this._layers[d];_.type!=="custom"&&c.push(_.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const c=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const E in this._updatedSources){const S=this._updatedSources[E];S==="reload"?this._reloadSource(E):S==="clear"&&this._clearSource(E)}this._updateTilesForChangedImages();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const d={};for(const _ in this.sourceCaches){const x=this.sourceCaches[_];d[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];x.recalculate(a,this._availableImages),!x.isHidden(a.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const _ in d){const x=this.sourceCaches[_];d[_]!==x.used&&x.fire(new h.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_}))}this.light.recalculate(a),this.z=a.zoom,c&&this.fire(new h.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),ar(this,h.validateStyle(a)))return!1;(a=h.clone$1(a)).layers=cn(a.layers);const c=function(_,x){if(!_)return[{command:Ct.setStyle,args:[x]}];let E=[];try{if(!P(_.version,x.version))return[{command:Ct.setStyle,args:[x]}];P(_.center,x.center)||E.push({command:Ct.setCenter,args:[x.center]}),P(_.zoom,x.zoom)||E.push({command:Ct.setZoom,args:[x.zoom]}),P(_.bearing,x.bearing)||E.push({command:Ct.setBearing,args:[x.bearing]}),P(_.pitch,x.pitch)||E.push({command:Ct.setPitch,args:[x.pitch]}),P(_.sprite,x.sprite)||E.push({command:Ct.setSprite,args:[x.sprite]}),P(_.glyphs,x.glyphs)||E.push({command:Ct.setGlyphs,args:[x.glyphs]}),P(_.transition,x.transition)||E.push({command:Ct.setTransition,args:[x.transition]}),P(_.light,x.light)||E.push({command:Ct.setLight,args:[x.light]});const S={},A=[];(function(F,N,Z,Y){let q;for(q in N=N||{},F=F||{})Object.prototype.hasOwnProperty.call(F,q)&&(Object.prototype.hasOwnProperty.call(N,q)||Mn(q,Z,Y));for(q in N)Object.prototype.hasOwnProperty.call(N,q)&&(Object.prototype.hasOwnProperty.call(F,q)?P(F[q],N[q])||(F[q].type==="geojson"&&N[q].type==="geojson"&&xe(F,N,q)?Z.push({command:Ct.setGeoJSONSourceData,args:[q,N[q].data]}):Qa(q,N,Z,Y)):Tn(q,N,Z))})(_.sources,x.sources,A,S);const D=[];_.layers&&_.layers.forEach(F=>{S[F.source]?E.push({command:Ct.removeLayer,args:[F.id]}):D.push(F)}),E=E.concat(A),function(F,N,Z){N=N||[];const Y=(F=F||[]).map(Yn),q=N.map(Yn),Q=F.reduce(Yi,{}),ne=N.reduce(Yi,{}),se=Y.slice(),ue=Object.create(null);let he,Ee,pe,ve,Ie,Re,Me;for(he=0,Ee=0;he<Y.length;he++)pe=Y[he],Object.prototype.hasOwnProperty.call(ne,pe)?Ee++:(Z.push({command:Ct.removeLayer,args:[pe]}),se.splice(se.indexOf(pe,Ee),1));for(he=0,Ee=0;he<q.length;he++)pe=q[q.length-1-he],se[se.length-1-he]!==pe&&(Object.prototype.hasOwnProperty.call(Q,pe)?(Z.push({command:Ct.removeLayer,args:[pe]}),se.splice(se.lastIndexOf(pe,se.length-Ee),1)):Ee++,Re=se[se.length-he],Z.push({command:Ct.addLayer,args:[ne[pe],Re]}),se.splice(se.length-he,0,pe),ue[pe]=!0);for(he=0;he<q.length;he++)if(pe=q[he],ve=Q[pe],Ie=ne[pe],!ue[pe]&&!P(ve,Ie))if(P(ve.source,Ie.source)&&P(ve["source-layer"],Ie["source-layer"])&&P(ve.type,Ie.type)){for(Me in Be(ve.layout,Ie.layout,Z,pe,null,Ct.setLayoutProperty),Be(ve.paint,Ie.paint,Z,pe,null,Ct.setPaintProperty),P(ve.filter,Ie.filter)||Z.push({command:Ct.setFilter,args:[pe,Ie.filter]}),P(ve.minzoom,Ie.minzoom)&&P(ve.maxzoom,Ie.maxzoom)||Z.push({command:Ct.setLayerZoomRange,args:[pe,Ie.minzoom,Ie.maxzoom]}),ve)Object.prototype.hasOwnProperty.call(ve,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Be(ve[Me],Ie[Me],Z,pe,Me.slice(6),Ct.setPaintProperty):P(ve[Me],Ie[Me])||Z.push({command:Ct.setLayerProperty,args:[pe,Me,Ie[Me]]}));for(Me in Ie)Object.prototype.hasOwnProperty.call(Ie,Me)&&!Object.prototype.hasOwnProperty.call(ve,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?Be(ve[Me],Ie[Me],Z,pe,Me.slice(6),Ct.setPaintProperty):P(ve[Me],Ie[Me])||Z.push({command:Ct.setLayerProperty,args:[pe,Me,Ie[Me]]}))}else Z.push({command:Ct.removeLayer,args:[pe]}),Re=se[se.lastIndexOf(pe)+1],Z.push({command:Ct.addLayer,args:[Ie,Re]})}(D,x.layers,E)}catch(S){console.warn("Unable to compute style diff:",S),E=[{command:Ct.setStyle,args:[x]}]}return E}(this.serialize(),a).filter(_=>!(_.command in zr));if(c.length===0)return!1;const d=c.filter(_=>!(_.command in mr));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);return c.forEach(_=>{_.command!=="setTransition"&&this[_.command].apply(this,_.args)}),this.stylesheet=a,!0}addImage(a,c){if(this.getImage(a))return this.fire(new h.ErrorEvent(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,c),this._afterImageUpdated(a)}updateImage(a,c){this.imageManager.updateImage(a,c)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new h.ErrorEvent(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new h.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,c,d={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(h.validateStyle.source,`sources.${a}`,c,null,d))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const _=this.sourceCaches[a]=new kr(a,c,this.dispatcher);_.style=this,_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:a})),_.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===a)return this.fire(new h.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${d}" is using it.`)));const c=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],c.fire(new h.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),c.setEventedParent(null),c.clearTiles(),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,c){this._checkLoaded(),this.sourceCaches[a].getSource().setData(c),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,c,d={}){this._checkLoaded();const _=a.id;if(this.getLayer(_))return void this.fire(new h.ErrorEvent(new Error(`Layer "${_}" already exists on this map.`)));let x;if(a.type==="custom"){if(ar(this,h.validateCustomStyleLayer(a)))return;x=h.createStyleLayer(a)}else{if(typeof a.source=="object"&&(this.addSource(_,a.source),a=h.clone$1(a),a=h.extend(a,{source:_})),this._validate(h.validateStyle.layer,`layers.${_}`,a,{arrayIndex:-1},d))return;x=h.createStyleLayer(a),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize()}const E=c?this._order.indexOf(c):this._order.length;if(c&&E===-1)this.fire(new h.ErrorEvent(new Error(`Cannot add layer "${_}" before non-existing layer "${c}".`)));else{if(this._order.splice(E,0,_),this._layerOrderChanged=!0,this._layers[_]=x,this._removedLayers[_]&&x.source&&x.type!=="custom"){const S=this._removedLayers[_];delete this._removedLayers[_],S.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(a,c){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new h.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===c)return;const d=this._order.indexOf(a);this._order.splice(d,1);const _=c?this._order.indexOf(c):this._order.length;c&&_===-1?this.fire(new h.ErrorEvent(new Error(`Cannot move layer "${a}" before non-existing layer "${c}".`))):(this._order.splice(_,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const c=this._layers[a];if(!c)return void this.fire(new h.ErrorEvent(new Error(`Cannot remove non-existing layer "${a}".`)));c.setEventedParent(null);const d=this._order.indexOf(a);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=c,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],c.onRemove&&c.onRemove(this.map)}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,c,d){this._checkLoaded();const _=this.getLayer(a);_?_.minzoom===c&&_.maxzoom===d||(c!=null&&(_.minzoom=c),d!=null&&(_.maxzoom=d),this._updateLayer(_)):this.fire(new h.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,c,d={}){this._checkLoaded();const _=this.getLayer(a);if(_){if(!P(_.filter,c))return c==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(h.validateStyle.filter,`layers.${_.id}.filter`,c,null,d)||(_.filter=h.clone$1(c),this._updateLayer(_)))}else this.fire(new h.ErrorEvent(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return h.clone$1(this.getLayer(a).filter)}setLayoutProperty(a,c,d,_={}){this._checkLoaded();const x=this.getLayer(a);x?P(x.getLayoutProperty(c),d)||(x.setLayoutProperty(c,d,_),this._updateLayer(x)):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,c){const d=this.getLayer(a);if(d)return d.getLayoutProperty(c);this.fire(new h.ErrorEvent(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,c,d,_={}){this._checkLoaded();const x=this.getLayer(a);x?P(x.getPaintProperty(c),d)||(x.setPaintProperty(c,d,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new h.ErrorEvent(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,c){return this.getLayer(a).getPaintProperty(c)}setFeatureState(a,c){this._checkLoaded();const d=a.source,_=a.sourceLayer,x=this.sourceCaches[d];if(x===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const E=x.getSource().type;E==="geojson"&&_?this.fire(new h.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||_?(a.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(_,a.id,c)):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,c){this._checkLoaded();const d=a.source,_=this.sourceCaches[d];if(_===void 0)return void this.fire(new h.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)));const x=_.getSource().type,E=x==="vector"?a.sourceLayer:void 0;x!=="vector"||E?c&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new h.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):_.removeFeatureState(E,a.id,c):this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const c=a.source,d=a.sourceLayer,_=this.sourceCaches[c];if(_!==void 0)return _.getSource().type!=="vector"||d?(a.id===void 0&&this.fire(new h.ErrorEvent(new Error("The feature id parameter must be provided."))),_.getFeatureState(d,a.id)):void this.fire(new h.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return h.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return h.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:h.mapObject(this.sourceCaches,a=>a.serialize()),layers:this._serializeLayers(this._order)},a=>a!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(a){const c=E=>this._layers[E].type==="fill-extrusion",d={},_=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(c(S)){d[S]=E;for(const A of a){const D=A[S];if(D)for(const F of D)_.push(F)}}}_.sort((E,S)=>S.intersectionZ-E.intersectionZ);const x=[];for(let E=this._order.length-1;E>=0;E--){const S=this._order[E];if(c(S))for(let A=_.length-1;A>=0;A--){const D=_[A].feature;if(d[D.layer.id]<E)break;x.push(D),_.pop()}else for(const A of a){const D=A[S];if(D)for(const F of D)x.push(F.feature)}}return x}queryRenderedFeatures(a,c,d){c&&c.filter&&this._validate(h.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const _={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new h.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of c.layers){const S=this._layers[E];if(!S)return this.fire(new h.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];_[S.source]=!0}}const x=[];c.availableImages=this._availableImages;for(const E in this.sourceCaches)c.layers&&!_[E]||x.push(Gr(this.sourceCaches[E],this._layers,this._serializedLayers,a,c,d));return this.placement&&x.push(function(E,S,A,D,F,N,Z){const Y={},q=N.queryRenderedSymbols(D),Q=[];for(const ne of Object.keys(q).map(Number))Q.push(Z[ne]);Q.sort(qn);for(const ne of Q){const se=ne.featureIndex.lookupSymbolFeatures(q[ne.bucketInstanceId],S,ne.bucketIndex,ne.sourceLayerIndex,F.filter,F.layers,F.availableImages,E);for(const ue in se){const he=Y[ue]=Y[ue]||[],Ee=se[ue];Ee.sort((pe,ve)=>{const Ie=ne.featureSortOrder;if(Ie){const Re=Ie.indexOf(pe.featureIndex);return Ie.indexOf(ve.featureIndex)-Re}return ve.featureIndex-pe.featureIndex});for(const pe of Ee)he.push(pe)}}for(const ne in Y)Y[ne].forEach(se=>{const ue=se.feature,he=A[E[ne].source].getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=he});return Y}(this._layers,this._serializedLayers,this.sourceCaches,a,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(a,c){c&&c.filter&&this._validate(h.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const d=this.sourceCaches[a];return d?function(_,x){const E=_.getRenderableIds().map(D=>_.getTileByID(D)),S=[],A={};for(let D=0;D<E.length;D++){const F=E[D],N=F.tileID.canonical.key;A[N]||(A[N]=!0,F.querySourceFeatures(S,x))}return S}(d,c):[]}addSourceType(a,c,d){return Ji.getSourceType(a)?d(new Error(`A source type called "${a}" already exists.`)):(Ji.setSourceType(a,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:c.workerSourceURL},d):d(null,null))}getLight(){return this.light.getLight()}setLight(a,c={}){this._checkLoaded();const d=this.light.getLight();let _=!1;for(const E in a)if(!P(a[E],d[E])){_=!0;break}if(!_)return;const x={now:h.exported.now(),transition:h.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,c),this.light.updateTransitions(x)}_validate(a,c,d,_,x={}){return(!x||x.validate!==!1)&&ar(this,a.call(h.validateStyle,h.extend({key:c,style:this.serialize(),value:d,styleSpec:h.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),h.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches)this.sourceCaches[a].clearTiles(),this.sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const c in this.sourceCaches)this.sourceCaches[c].update(a)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,c,d,_,x=!1){let E=!1,S=!1;const A={};for(const D of this._order){const F=this._layers[D];if(F.type!=="symbol")continue;if(!A[F.source]){const Z=this.sourceCaches[F.source];A[F.source]=Z.getRenderableIds(!0).map(Y=>Z.getTileByID(Y)).sort((Y,q)=>q.tileID.overscaledZ-Y.tileID.overscaledZ||(Y.tileID.isLessThan(q.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(F,A[F.source],a.center.lng);E=E||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(h.exported.now(),a.zoom))&&(this.pauseablePlacement=new nt(a,this._order,x,c,d,_,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(h.exported.now()),S=!0),E&&this.pauseablePlacement.placement.setStale()),S||E)for(const D of this._order){const F=this._layers[D];F.type==="symbol"&&this.placement.updateLayerOpacities(F,A[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(h.exported.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,c,d){this.imageManager.getImages(c.icons,d),this._updateTilesForChangedImages();const _=this.sourceCaches[c.source];_&&_.setDependencies(c.tileID.key,c.type,c.icons)}getGlyphs(a,c,d){this.glyphManager.getGlyphs(c.stacks,d)}getResource(a,c,d){return h.makeRequest(c,d)}}Ji.getSourceType=function(m){return ri[m]},Ji.setSourceType=function(m,a){ri[m]=a},Ji.registerForPluginStateChange=h.registerForPluginStateChange;var ol=h.createLayout([{name:"a_pos",type:"Int16",components:2}]),es={prelude:Wt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:Wt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Wt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Wt(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Wt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Wt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Wt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Wt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Wt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Wt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:Wt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Wt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Wt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Wt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Wt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Wt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Wt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Wt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Wt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:Wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:Wt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Wt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Wt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Wt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:Wt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Wt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function Wt(m,a){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=a.match(/attribute ([\w]+) ([\w]+)/g),_=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=x?x.concat(_):_,S={};return{fragmentSource:m=m.replace(c,(A,D,F,N,Z)=>(S[Z]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
varying ${F} ${N} ${Z};
#else
uniform ${F} ${N} u_${Z};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Z}
    ${F} ${N} ${Z} = u_${Z};
#endif
`)),vertexSource:a=a.replace(c,(A,D,F,N,Z)=>{const Y=N==="float"?"vec2":"vec4",q=Z.match(/color/)?"color":Y;return S[Z]?D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${F} ${Y} a_${Z};
varying ${F} ${N} ${Z};
#else
uniform ${F} ${N} u_${Z};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = a_${Z};
#else
    ${F} ${N} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${Z} = unpack_mix_${q}(a_${Z}, u_${Z}_t);
#else
    ${F} ${N} ${Z} = u_${Z};
#endif
`:D==="define"?`
#ifndef HAS_UNIFORM_u_${Z}
uniform lowp float u_${Z}_t;
attribute ${F} ${Y} a_${Z};
#else
uniform ${F} ${N} u_${Z};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${Z}
    ${F} ${N} ${Z} = a_${Z};
#else
    ${F} ${N} ${Z} = u_${Z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Z}
    ${F} ${N} ${Z} = unpack_mix_${q}(a_${Z}, u_${Z}_t);
#else
    ${F} ${N} ${Z} = u_${Z};
#endif
`}),staticAttributes:d,staticUniforms:E}}class Gh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,c,d,_,x,E,S,A){this.context=a;let D=this.boundPaintVertexBuffers.length!==_.length;for(let F=0;!D&&F<_.length;F++)this.boundPaintVertexBuffers[F]!==_[F]&&(D=!0);a.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===d&&!D&&this.boundIndexBuffer===x&&this.boundVertexOffset===E&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===A?(a.bindVertexArrayOES.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),A&&A.bind()):this.freshBind(c,d,_,x,E,S,A)}freshBind(a,c,d,_,x,E,S){let A;const D=a.numAttributes,F=this.context,N=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=a,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=S;else{A=F.currentNumAttributes||0;for(let Z=D;Z<A;Z++)N.disableVertexAttribArray(Z)}c.enableAttributes(N,a);for(const Z of d)Z.enableAttributes(N,a);E&&E.enableAttributes(N,a),S&&S.enableAttributes(N,a),c.bind(),c.setVertexAttribPointers(N,a,x);for(const Z of d)Z.bind(),Z.setVertexAttribPointers(N,a,x);E&&(E.bind(),E.setVertexAttribPointers(N,a,x)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers(N,a,x)),F.currentNumAttributes=D}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Vh(m){const a=[];for(let c=0;c<m.length;c++){if(m[c]===null)continue;const d=m[c].split(" ");a.push(d.pop())}return a}class $h{constructor(a,c,d,_,x,E){const S=a.gl;this.program=S.createProgram();const A=Vh(d.staticAttributes),D=_?_.getBinderAttributes():[],F=A.concat(D),N=d.staticUniforms?Vh(d.staticUniforms):[],Z=_?_.getBinderUniforms():[],Y=N.concat(Z),q=[];for(const pe of Y)q.indexOf(pe)<0&&q.push(pe);const Q=_?_.defines():[];E&&Q.push("#define OVERDRAW_INSPECTOR;");const ne=Q.concat(es.prelude.fragmentSource,d.fragmentSource).join(`
`),se=Q.concat(es.prelude.vertexSource,d.vertexSource).join(`
`),ue=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ue,ne),S.compileShader(ue),S.attachShader(this.program,ue);const he=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(he,se),S.compileShader(he),S.attachShader(this.program,he),this.attributes={};const Ee={};this.numAttributes=F.length;for(let pe=0;pe<this.numAttributes;pe++)F[pe]&&(S.bindAttribLocation(this.program,pe,F[pe]),this.attributes[F[pe]]=pe);S.linkProgram(this.program),S.deleteShader(he),S.deleteShader(ue);for(let pe=0;pe<q.length;pe++){const ve=q[pe];if(ve&&!Ee[ve]){const Ie=S.getUniformLocation(this.program,ve);Ie&&(Ee[ve]=Ie)}}this.fixedUniforms=x(a,Ee),this.binderUniforms=_?_.getUniforms(a,Ee):[]}draw(a,c,d,_,x,E,S,A,D,F,N,Z,Y,q,Q,ne){const se=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(d),a.setStencilMode(_),a.setColorMode(x),a.setCullFace(E);for(const he in this.fixedUniforms)this.fixedUniforms[he].set(S[he]);q&&q.setUniforms(a,this.binderUniforms,Z,{zoom:Y});const ue={[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[c];for(const he of N.get()){const Ee=he.vaos||(he.vaos={});(Ee[A]||(Ee[A]=new Gh)).bind(a,this,D,q?q.getPaintVertexBuffers():[],F,he.vertexOffset,Q,ne),se.drawElements(c,he.primitiveLength*ue,se.UNSIGNED_SHORT,he.primitiveOffset*ue*2)}}}function jh(m,a,c){const d=1/pr(c,1,a.transform.tileZoom),_=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,a.transform.tileZoom)/_,E=x*(c.tileID.canonical.x+c.tileID.wrap*_),S=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[E>>16,S>>16],u_pixel_coord_lower:[65535&E,65535&S]}}const js=(m,a,c,d)=>{const _=a.style.light,x=_.properties.get("position"),E=re(x.x,x.y,x.z),S=function(){var D=new h.ARRAY_TYPE(9);return h.ARRAY_TYPE!=Float32Array&&(D[1]=0,D[2]=0,D[3]=0,D[5]=0,D[6]=0,D[7]=0),D[0]=1,D[4]=1,D[8]=1,D}();_.properties.get("anchor")==="viewport"&&function(D,F){var N=Math.sin(F),Z=Math.cos(F);D[0]=Z,D[1]=N,D[2]=0,D[3]=-N,D[4]=Z,D[5]=0,D[6]=0,D[7]=0,D[8]=1}(S,-a.transform.angle),function(D,F,N){var Z=F[0],Y=F[1],q=F[2];D[0]=Z*N[0]+Y*N[3]+q*N[6],D[1]=Z*N[1]+Y*N[4]+q*N[7],D[2]=Z*N[2]+Y*N[5]+q*N[8]}(E,E,S);const A=_.properties.get("color");return{u_matrix:m,u_lightpos:E,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+c,u_opacity:d}},Zh=(m,a,c,d,_,x,E)=>h.extend(js(m,a,c,d),jh(x,a,E),{u_height_factor:-Math.pow(2,_.overscaledZ)/E.tileSize/8}),ll=m=>({u_matrix:m}),hl=(m,a,c,d)=>h.extend(ll(m),jh(c,a,d)),qh=(m,a)=>({u_matrix:m,u_world:a}),ta=(m,a,c,d,_)=>h.extend(hl(m,a,c,d),{u_world:_}),Zs=(m,a,c,d)=>{const _=m.transform;let x,E;if(d.paint.get("circle-pitch-alignment")==="map"){const S=pr(c,1,_.zoom);x=!0,E=[S,S]}else x=!1,E=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:m.translatePosMatrix(a.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:E}},ts=(m,a,c)=>{const d=pr(c,1,a.zoom),_=Math.pow(2,a.zoom-c.tileID.overscaledZ),x=c.tileID.overscaleFactor();return{u_matrix:m,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[a.pixelsToGLUnits[0]/(d*_),a.pixelsToGLUnits[1]/(d*_)],u_overscale_factor:x}},rs=(m,a,c=1)=>({u_matrix:m,u_color:a,u_overlay:0,u_overlay_scale:c}),is=m=>({u_matrix:m}),qs=(m,a,c,d)=>({u_matrix:m,u_extrude_scale:pr(a,1,c),u_intensity:d});function cl(m,a){const c=Math.pow(2,a.canonical.z),d=a.canonical.y;return[new h.MercatorCoordinate(0,d/c).toLngLat().lat,new h.MercatorCoordinate(0,(d+1)/c).toLngLat().lat]}const Ma=(m,a,c)=>{const d=m.transform;return{u_matrix:fl(m,a,c),u_ratio:1/pr(a,1,d.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},ns=(m,a,c,d)=>h.extend(Ma(m,a,c),{u_image:0,u_image_height:d}),Tr=(m,a,c,d)=>{const _=m.transform,x=ul(a,_);return{u_matrix:fl(m,a,c),u_texsize:a.imageAtlasTexture.size,u_ratio:1/pr(a,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[x,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Xs=(m,a,c,d,_)=>{const x=m.lineAtlas,E=ul(a,m.transform),S=c.layout.get("line-cap")==="round",A=x.getDash(d.from,S),D=x.getDash(d.to,S),F=A.width*_.fromScale,N=D.width*_.toScale;return h.extend(Ma(m,a,c),{u_patternscale_a:[E/F,-A.height/2],u_patternscale_b:[E/N,-D.height/2],u_sdfgamma:x.width/(256*Math.min(F,N)*m.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:D.y,u_mix:_.t})};function ul(m,a){return 1/pr(m,1,a.tileZoom)}function fl(m,a,c){return m.translatePosMatrix(a.tileID.posMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Xh=(m,a,c,d,_)=>{return{u_matrix:m,u_tl_parent:a,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(E=_.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(x=_.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:dl(_.paint.get("raster-hue-rotate"))};var x,E};function dl(m){m*=Math.PI/180;const a=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*a-c+1)/3,(Math.sqrt(3)*a-c+1)/3]}const pl=(m,a,c,d,_,x,E,S,A,D)=>{const F=_.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:F.width/F.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:E,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+d,u_texsize:D,u_texture:0}},Kh=(m,a,c,d,_,x,E,S,A,D,F)=>{const N=_.transform;return h.extend(pl(m,a,c,d,_,x,E,S,A,D),{u_gamma_scale:d?Math.cos(N._pitch)*N.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:+F})},Hu=(m,a,c,d,_,x,E,S,A,D)=>h.extend(Kh(m,a,c,d,_,x,E,S,!0,A,!0),{u_texsize_icon:D,u_texture_icon:1}),ml=(m,a,c)=>({u_matrix:m,u_opacity:a,u_color:c}),gl=(m,a,c,d,_,x)=>h.extend(function(E,S,A,D){const F=A.imageManager.getPattern(E.from.toString()),N=A.imageManager.getPattern(E.to.toString()),{width:Z,height:Y}=A.imageManager.getPixelSize(),q=Math.pow(2,D.tileID.overscaledZ),Q=D.tileSize*Math.pow(2,A.transform.tileZoom)/q,ne=Q*(D.tileID.canonical.x+D.tileID.wrap*q),se=Q*D.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[Z,Y],u_mix:S.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/pr(D,1,A.transform.tileZoom),u_pixel_coord_upper:[ne>>16,se>>16],u_pixel_coord_lower:[65535&ne,65535&se]}}(d,x,c,_),{u_matrix:m,u_opacity:a}),_l={fillExtrusion:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_lightpos:new h.Uniform3f(m,a.u_lightpos),u_lightintensity:new h.Uniform1f(m,a.u_lightintensity),u_lightcolor:new h.Uniform3f(m,a.u_lightcolor),u_vertical_gradient:new h.Uniform1f(m,a.u_vertical_gradient),u_opacity:new h.Uniform1f(m,a.u_opacity)}),fillExtrusionPattern:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_lightpos:new h.Uniform3f(m,a.u_lightpos),u_lightintensity:new h.Uniform1f(m,a.u_lightintensity),u_lightcolor:new h.Uniform3f(m,a.u_lightcolor),u_vertical_gradient:new h.Uniform1f(m,a.u_vertical_gradient),u_height_factor:new h.Uniform1f(m,a.u_height_factor),u_image:new h.Uniform1i(m,a.u_image),u_texsize:new h.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,a.u_scale),u_fade:new h.Uniform1f(m,a.u_fade),u_opacity:new h.Uniform1f(m,a.u_opacity)}),fill:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix)}),fillPattern:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_image:new h.Uniform1i(m,a.u_image),u_texsize:new h.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,a.u_scale),u_fade:new h.Uniform1f(m,a.u_fade)}),fillOutline:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_world:new h.Uniform2f(m,a.u_world)}),fillOutlinePattern:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_world:new h.Uniform2f(m,a.u_world),u_image:new h.Uniform1i(m,a.u_image),u_texsize:new h.Uniform2f(m,a.u_texsize),u_pixel_coord_upper:new h.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,a.u_pixel_coord_lower),u_scale:new h.Uniform3f(m,a.u_scale),u_fade:new h.Uniform1f(m,a.u_fade)}),circle:(m,a)=>({u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_scale_with_map:new h.Uniform1i(m,a.u_scale_with_map),u_pitch_with_map:new h.Uniform1i(m,a.u_pitch_with_map),u_extrude_scale:new h.Uniform2f(m,a.u_extrude_scale),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_matrix:new h.UniformMatrix4f(m,a.u_matrix)}),collisionBox:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_pixels_to_tile_units:new h.Uniform1f(m,a.u_pixels_to_tile_units),u_extrude_scale:new h.Uniform2f(m,a.u_extrude_scale),u_overscale_factor:new h.Uniform1f(m,a.u_overscale_factor)}),collisionCircle:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_inv_matrix:new h.UniformMatrix4f(m,a.u_inv_matrix),u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_viewport_size:new h.Uniform2f(m,a.u_viewport_size)}),debug:(m,a)=>({u_color:new h.UniformColor(m,a.u_color),u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_overlay:new h.Uniform1i(m,a.u_overlay),u_overlay_scale:new h.Uniform1f(m,a.u_overlay_scale)}),clippingMask:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix)}),heatmap:(m,a)=>({u_extrude_scale:new h.Uniform1f(m,a.u_extrude_scale),u_intensity:new h.Uniform1f(m,a.u_intensity),u_matrix:new h.UniformMatrix4f(m,a.u_matrix)}),heatmapTexture:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_world:new h.Uniform2f(m,a.u_world),u_image:new h.Uniform1i(m,a.u_image),u_color_ramp:new h.Uniform1i(m,a.u_color_ramp),u_opacity:new h.Uniform1f(m,a.u_opacity)}),hillshade:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_image:new h.Uniform1i(m,a.u_image),u_latrange:new h.Uniform2f(m,a.u_latrange),u_light:new h.Uniform2f(m,a.u_light),u_shadow:new h.UniformColor(m,a.u_shadow),u_highlight:new h.UniformColor(m,a.u_highlight),u_accent:new h.UniformColor(m,a.u_accent)}),hillshadePrepare:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_image:new h.Uniform1i(m,a.u_image),u_dimension:new h.Uniform2f(m,a.u_dimension),u_zoom:new h.Uniform1f(m,a.u_zoom),u_unpack:new h.Uniform4f(m,a.u_unpack)}),line:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_ratio:new h.Uniform1f(m,a.u_ratio),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(m,a.u_units_to_pixels)}),lineGradient:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_ratio:new h.Uniform1f(m,a.u_ratio),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(m,a.u_units_to_pixels),u_image:new h.Uniform1i(m,a.u_image),u_image_height:new h.Uniform1f(m,a.u_image_height)}),linePattern:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_texsize:new h.Uniform2f(m,a.u_texsize),u_ratio:new h.Uniform1f(m,a.u_ratio),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_image:new h.Uniform1i(m,a.u_image),u_units_to_pixels:new h.Uniform2f(m,a.u_units_to_pixels),u_scale:new h.Uniform3f(m,a.u_scale),u_fade:new h.Uniform1f(m,a.u_fade)}),lineSDF:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_ratio:new h.Uniform1f(m,a.u_ratio),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_units_to_pixels:new h.Uniform2f(m,a.u_units_to_pixels),u_patternscale_a:new h.Uniform2f(m,a.u_patternscale_a),u_patternscale_b:new h.Uniform2f(m,a.u_patternscale_b),u_sdfgamma:new h.Uniform1f(m,a.u_sdfgamma),u_image:new h.Uniform1i(m,a.u_image),u_tex_y_a:new h.Uniform1f(m,a.u_tex_y_a),u_tex_y_b:new h.Uniform1f(m,a.u_tex_y_b),u_mix:new h.Uniform1f(m,a.u_mix)}),raster:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_tl_parent:new h.Uniform2f(m,a.u_tl_parent),u_scale_parent:new h.Uniform1f(m,a.u_scale_parent),u_buffer_scale:new h.Uniform1f(m,a.u_buffer_scale),u_fade_t:new h.Uniform1f(m,a.u_fade_t),u_opacity:new h.Uniform1f(m,a.u_opacity),u_image0:new h.Uniform1i(m,a.u_image0),u_image1:new h.Uniform1i(m,a.u_image1),u_brightness_low:new h.Uniform1f(m,a.u_brightness_low),u_brightness_high:new h.Uniform1f(m,a.u_brightness_high),u_saturation_factor:new h.Uniform1f(m,a.u_saturation_factor),u_contrast_factor:new h.Uniform1f(m,a.u_contrast_factor),u_spin_weights:new h.Uniform3f(m,a.u_spin_weights)}),symbolIcon:(m,a)=>({u_is_size_zoom_constant:new h.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,a.u_size_t),u_size:new h.Uniform1f(m,a.u_size),u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_pitch:new h.Uniform1f(m,a.u_pitch),u_rotate_symbol:new h.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,a.u_fade_change),u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new h.Uniform1i(m,a.u_is_text),u_pitch_with_map:new h.Uniform1i(m,a.u_pitch_with_map),u_texsize:new h.Uniform2f(m,a.u_texsize),u_texture:new h.Uniform1i(m,a.u_texture)}),symbolSDF:(m,a)=>({u_is_size_zoom_constant:new h.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,a.u_size_t),u_size:new h.Uniform1f(m,a.u_size),u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_pitch:new h.Uniform1f(m,a.u_pitch),u_rotate_symbol:new h.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,a.u_fade_change),u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new h.Uniform1i(m,a.u_is_text),u_pitch_with_map:new h.Uniform1i(m,a.u_pitch_with_map),u_texsize:new h.Uniform2f(m,a.u_texsize),u_texture:new h.Uniform1i(m,a.u_texture),u_gamma_scale:new h.Uniform1f(m,a.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(m,a.u_is_halo)}),symbolTextAndIcon:(m,a)=>({u_is_size_zoom_constant:new h.Uniform1i(m,a.u_is_size_zoom_constant),u_is_size_feature_constant:new h.Uniform1i(m,a.u_is_size_feature_constant),u_size_t:new h.Uniform1f(m,a.u_size_t),u_size:new h.Uniform1f(m,a.u_size),u_camera_to_center_distance:new h.Uniform1f(m,a.u_camera_to_center_distance),u_pitch:new h.Uniform1f(m,a.u_pitch),u_rotate_symbol:new h.Uniform1i(m,a.u_rotate_symbol),u_aspect_ratio:new h.Uniform1f(m,a.u_aspect_ratio),u_fade_change:new h.Uniform1f(m,a.u_fade_change),u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_label_plane_matrix:new h.UniformMatrix4f(m,a.u_label_plane_matrix),u_coord_matrix:new h.UniformMatrix4f(m,a.u_coord_matrix),u_is_text:new h.Uniform1i(m,a.u_is_text),u_pitch_with_map:new h.Uniform1i(m,a.u_pitch_with_map),u_texsize:new h.Uniform2f(m,a.u_texsize),u_texsize_icon:new h.Uniform2f(m,a.u_texsize_icon),u_texture:new h.Uniform1i(m,a.u_texture),u_texture_icon:new h.Uniform1i(m,a.u_texture_icon),u_gamma_scale:new h.Uniform1f(m,a.u_gamma_scale),u_device_pixel_ratio:new h.Uniform1f(m,a.u_device_pixel_ratio),u_is_halo:new h.Uniform1i(m,a.u_is_halo)}),background:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_opacity:new h.Uniform1f(m,a.u_opacity),u_color:new h.UniformColor(m,a.u_color)}),backgroundPattern:(m,a)=>({u_matrix:new h.UniformMatrix4f(m,a.u_matrix),u_opacity:new h.Uniform1f(m,a.u_opacity),u_image:new h.Uniform1i(m,a.u_image),u_pattern_tl_a:new h.Uniform2f(m,a.u_pattern_tl_a),u_pattern_br_a:new h.Uniform2f(m,a.u_pattern_br_a),u_pattern_tl_b:new h.Uniform2f(m,a.u_pattern_tl_b),u_pattern_br_b:new h.Uniform2f(m,a.u_pattern_br_b),u_texsize:new h.Uniform2f(m,a.u_texsize),u_mix:new h.Uniform1f(m,a.u_mix),u_pattern_size_a:new h.Uniform2f(m,a.u_pattern_size_a),u_pattern_size_b:new h.Uniform2f(m,a.u_pattern_size_b),u_scale_a:new h.Uniform1f(m,a.u_scale_a),u_scale_b:new h.Uniform1f(m,a.u_scale_b),u_pixel_coord_upper:new h.Uniform2f(m,a.u_pixel_coord_upper),u_pixel_coord_lower:new h.Uniform2f(m,a.u_pixel_coord_lower),u_tile_units_to_pixels:new h.Uniform1f(m,a.u_tile_units_to_pixels)})};class yl{constructor(a,c,d){this.context=a;const _=a.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Hh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wh{constructor(a,c,d,_){this.length=c.length,this.attributes=d,this.itemSize=c.bytesPerElement,this.dynamicDraw=_,this.context=a;const x=a.gl;this.buffer=x.createBuffer(),a.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,c){for(let d=0;d<this.attributes.length;d++){const _=c.attributes[this.attributes[d].name];_!==void 0&&a.enableVertexAttribArray(_)}}setVertexAttribPointers(a,c,d){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],E=c.attributes[x.name];E!==void 0&&a.vertexAttribPointer(E,x.components,a[Hh[x.type]],!1,this.itemSize,x.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ot{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class as extends Ot{getDefault(){return h.Color.transparent}set(a){const c=this.current;(a.r!==c.r||a.g!==c.g||a.b!==c.b||a.a!==c.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class ss extends Ot{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class Yh extends Ot{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class Ti extends Ot{getDefault(){return[!0,!0,!0,!0]}set(a){const c=this.current;(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||a[3]!==c[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class vl extends Ot{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class Ks extends Ot{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class Hs extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const c=this.current;(a.func!==c.func||a.ref!==c.ref||a.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class xl extends Ot{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const c=this.current;(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class bl extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;a?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=a,this.dirty=!1}}class Ws extends Ot{getDefault(){return[0,1]}set(a){const c=this.current;(a[0]!==c[0]||a[1]!==c[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class wl extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;a?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=a,this.dirty=!1}}class El extends Ot{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Ys extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;a?c.enable(c.BLEND):c.disable(c.BLEND),this.current=a,this.dirty=!1}}class Jh extends Ot{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const c=this.current;(a[0]!==c[0]||a[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Qh extends Ot{getDefault(){return h.Color.transparent}set(a){const c=this.current;(a.r!==c.r||a.g!==c.g||a.b!==c.b||a.a!==c.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Sa extends Ot{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class Wu extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;a?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=a,this.dirty=!1}}class Yu extends Ot{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class Ju extends Ot{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class Qu extends Ot{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class ef extends Ot{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class tf extends Ot{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const c=this.current;(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||a[3]!==c[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Tl extends Ot{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class Ml extends Ot{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Aa extends Ot{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class ec extends Ot{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class tc extends Ot{getDefault(){return null}set(a){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Sl extends Ot{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class ra extends Ot{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class rc extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class Ca extends Ot{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ia extends Ot{constructor(a,c){super(a),this.context=a,this.parent=c}getDefault(){return null}}class ic extends ia{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class Al extends ia{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Gt{constructor(a,c,d,_){this.context=a,this.width=c,this.height=d;const x=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new ic(a,x),_&&(this.depthAttachment=new Al(a,x))}destroy(){const a=this.context.gl,c=this.colorAttachment.get();if(c&&a.deleteTexture(c),this.depthAttachment){const d=this.depthAttachment.get();d&&a.deleteRenderbuffer(d)}a.deleteFramebuffer(this.framebuffer)}}class gr{constructor(a,c,d){this.blendFunction=a,this.blendColor=c,this.mask=d}}gr.Replace=[1,0],gr.disabled=new gr(gr.Replace,h.Color.transparent,[!1,!1,!1,!1]),gr.unblended=new gr(gr.Replace,h.Color.transparent,[!0,!0,!0,!0]),gr.alphaBlended=new gr([1,771],h.Color.transparent,[!0,!0,!0,!0]);class rf{constructor(a){this.gl=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new as(this),this.clearDepth=new ss(this),this.clearStencil=new Yh(this),this.colorMask=new Ti(this),this.depthMask=new vl(this),this.stencilMask=new Ks(this),this.stencilFunc=new Hs(this),this.stencilOp=new xl(this),this.stencilTest=new bl(this),this.depthRange=new Ws(this),this.depthTest=new wl(this),this.depthFunc=new El(this),this.blend=new Ys(this),this.blendFunc=new Jh(this),this.blendColor=new Qh(this),this.blendEquation=new Sa(this),this.cullFace=new Wu(this),this.cullFaceSide=new Yu(this),this.frontFace=new Ju(this),this.program=new Qu(this),this.activeTexture=new ef(this),this.viewport=new tf(this),this.bindFramebuffer=new Tl(this),this.bindRenderbuffer=new Ml(this),this.bindTexture=new Aa(this),this.bindVertexBuffer=new ec(this),this.bindElementBuffer=new tc(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Sl(this),this.pixelStoreUnpack=new ra(this),this.pixelStoreUnpackPremultiplyAlpha=new rc(this),this.pixelStoreUnpackFlipY=new Ca(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=a.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(a.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,c){return new yl(this,a,c)}createVertexBuffer(a,c,d){return new Wh(this,a,c,d)}createRenderbuffer(a,c,d){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,a,c,d),this.bindRenderbuffer.set(null),x}createFramebuffer(a,c,d){return new Gt(this,a,c,d)}clear({color:a,depth:c}){const d=this.gl;let _=0;a&&(_|=d.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(_|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(_)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){P(a.blendFunction,gr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class zt{constructor(a,c,d){this.func=a,this.mask=c,this.range=d}}zt.ReadOnly=!1,zt.ReadWrite=!0,zt.disabled=new zt(519,zt.ReadOnly,[0,1]);const na=7680;class xr{constructor(a,c,d,_,x,E){this.test=a,this.ref=c,this.mask=d,this.fail=_,this.depthFail=x,this.pass=E}}xr.disabled=new xr({func:519,mask:0},0,0,na,na,na);class _r{constructor(a,c,d){this.enable=a,this.mode=c,this.frontFace=d}}let os;function nc(m,a,c,d,_,x,E){const S=m.context,A=S.gl,D=m.useProgram("collisionBox"),F=[];let N=0,Z=0;for(let he=0;he<d.length;he++){const Ee=d[he],pe=a.getTile(Ee),ve=pe.getBucket(c);if(!ve)continue;let Ie=Ee.posMatrix;_[0]===0&&_[1]===0||(Ie=m.translatePosMatrix(Ee.posMatrix,pe,_,x));const Re=E?ve.textCollisionBox:ve.iconCollisionBox,Me=ve.collisionCircleArray;if(Me.length>0){const We=h.create(),$e=Ie;h.mul(We,ve.placementInvProjMatrix,m.transform.glCoordMatrix),h.mul(We,We,ve.placementViewportMatrix),F.push({circleArray:Me,circleOffset:Z,transform:$e,invTransform:We}),N+=Me.length/4,Z=N}Re&&D.draw(S,A.LINES,zt.disabled,xr.disabled,m.colorModeForRenderPass(),_r.disabled,ts(Ie,m.transform,pe),c.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,null,m.transform.zoom,null,null,Re.collisionVertexBuffer)}if(!E||!F.length)return;const Y=m.useProgram("collisionCircle"),q=new h.CollisionCircleLayoutArray;q.resize(4*N),q._trim();let Q=0;for(const he of F)for(let Ee=0;Ee<he.circleArray.length/4;Ee++){const pe=4*Ee,ve=he.circleArray[pe+0],Ie=he.circleArray[pe+1],Re=he.circleArray[pe+2],Me=he.circleArray[pe+3];q.emplace(Q++,ve,Ie,Re,Me,0),q.emplace(Q++,ve,Ie,Re,Me,1),q.emplace(Q++,ve,Ie,Re,Me,2),q.emplace(Q++,ve,Ie,Re,Me,3)}(!os||os.length<2*N)&&(os=function(he){const Ee=2*he,pe=new h.QuadTriangleArray;pe.resize(Ee),pe._trim();for(let ve=0;ve<Ee;ve++){const Ie=6*ve;pe.uint16[Ie+0]=4*ve+0,pe.uint16[Ie+1]=4*ve+1,pe.uint16[Ie+2]=4*ve+2,pe.uint16[Ie+3]=4*ve+2,pe.uint16[Ie+4]=4*ve+3,pe.uint16[Ie+5]=4*ve+0}return pe}(N));const ne=S.createIndexBuffer(os,!0),se=S.createVertexBuffer(q,h.collisionCircleLayout.members,!0);for(const he of F){const Ee={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ue=m.transform).cameraToCenterDistance,u_viewport_size:[ue.width,ue.height]};Y.draw(S,A.TRIANGLES,zt.disabled,xr.disabled,m.colorModeForRenderPass(),_r.disabled,Ee,c.id,se,ne,h.SegmentVector.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,m.transform.zoom,null,null,null)}var ue;se.destroy(),ne.destroy()}_r.disabled=new _r(!1,1029,2305),_r.backCCW=new _r(!0,1029,2305);const Cl=h.identity(new Float32Array(16));function Js(m,a,c,d,_,x){const{horizontalAlign:E,verticalAlign:S}=h.getAnchorAlignment(m),A=-(E-.5)*a,D=-(S-.5)*c,F=h.evaluateVariableOffset(m,d);return new h.pointGeometry((A/_+F[0])*x,(D/_+F[1])*x)}function Qs(m,a,c,d,_,x,E,S,A,D,F){const N=m.text.placedSymbolArray,Z=m.text.dynamicLayoutVertexArray,Y=m.icon.dynamicLayoutVertexArray,q={};Z.clear();for(let Q=0;Q<N.length;Q++){const ne=N.get(Q),se=m.allowVerticalPlacement&&!ne.placedOrientation,ue=ne.hidden||!ne.crossTileID||se?null:d[ne.crossTileID];if(ue){const he=new h.pointGeometry(ne.anchorX,ne.anchorY),Ee=ke(he,c?S:E),pe=pt(x.cameraToCenterDistance,Ee.signedDistanceFromCamera);let ve=_.evaluateSizeForFeature(m.textSizeData,D,ne)*pe/h.ONE_EM;c&&(ve*=m.tilePixelRatio/A);const{width:Ie,height:Re,anchor:Me,textOffset:We,textBoxScale:$e}=ue,ht=Js(Me,Ie,Re,We,$e,ve),Dt=c?ke(he.add(ht),E).point:Ee.point.add(a?ht.rotate(-x.angle):ht),vt=m.allowVerticalPlacement&&ne.placedOrientation===h.WritingMode.vertical?Math.PI/2:0;for(let xt=0;xt<ne.numGlyphs;xt++)h.addDynamicAttributes(Z,Dt,vt);F&&ne.associatedIconIndex>=0&&(q[ne.associatedIconIndex]={shiftedAnchor:Dt,angle:vt})}else Lt(ne.numGlyphs,Z)}if(F){Y.clear();const Q=m.icon.placedSymbolArray;for(let ne=0;ne<Q.length;ne++){const se=Q.get(ne);if(se.hidden)Lt(se.numGlyphs,Y);else{const ue=q[ne];if(ue)for(let he=0;he<se.numGlyphs;he++)h.addDynamicAttributes(Y,ue.shiftedAnchor,ue.angle);else Lt(se.numGlyphs,Y)}}m.icon.dynamicLayoutVertexBuffer.updateData(Y)}m.text.dynamicLayoutVertexBuffer.updateData(Z)}function Il(m,a,c){return c.iconsInText&&a?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function eo(m,a,c,d,_,x,E,S,A,D,F,N){const Z=m.context,Y=Z.gl,q=m.transform,Q=S==="map",ne=A==="map",se=Q&&c.layout.get("symbol-placement")!=="point",ue=Q&&!ne&&!se,he=!c.layout.get("symbol-sort-key").isConstant();let Ee=!1;const pe=m.depthModeForSublayer(0,zt.ReadOnly),ve=c.layout.get("text-variable-anchor"),Ie=[];for(const Re of d){const Me=a.getTile(Re),We=Me.getBucket(c);if(!We)continue;const $e=_?We.text:We.icon;if(!$e||!$e.segments.get().length)continue;const ht=$e.programConfigurations.get(c.id),Dt=_||We.sdfIcons,vt=_?We.textSizeData:We.iconSizeData,xt=ne||q.pitch!==0,fr=m.useProgram(Il(Dt,_,We),ht),ut=h.evaluateSizeForZoom(vt,q.zoom);let Tt,sr,Vr,Si,Ai=[0,0],Zi=null;if(_){if(sr=Me.glyphAtlasTexture,Vr=Y.LINEAR,Tt=Me.glyphAtlasTexture.size,We.iconsInText){Ai=Me.imageAtlasTexture.size,Zi=Me.imageAtlasTexture;const la=vt.kind==="composite"||vt.kind==="camera";Si=xt||m.options.rotating||m.options.zooming||la?Y.LINEAR:Y.NEAREST}}else{const la=c.layout.get("icon-size").constantOr(0)!==1||We.iconsNeedLinear;sr=Me.imageAtlasTexture,Vr=Dt||m.options.rotating||m.options.zooming||la||xt?Y.LINEAR:Y.NEAREST,Tt=Me.imageAtlasTexture.size}const Ci=pr(Me,1,m.transform.zoom),qi=Sn(Re.posMatrix,ne,Q,m.transform,Ci),kn=Xr(Re.posMatrix,ne,Q,m.transform,Ci),sa=ve&&We.hasTextData(),Vt=c.layout.get("icon-text-fit")!=="none"&&sa&&We.hasIconData();se&&pi(We,Re.posMatrix,m,_,qi,kn,ne,D);const Dr=m.translatePosMatrix(Re.posMatrix,Me,x,E),kt=se||_&&ve||Vt?Cl:qi,Mr=m.translatePosMatrix(kn,Me,x,E,!0),Ii=Dt&&c.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let er;er=Dt?We.iconsInText?Hu(vt.kind,ut,ue,ne,m,Dr,kt,Mr,Tt,Ai):Kh(vt.kind,ut,ue,ne,m,Dr,kt,Mr,_,Tt,!0):pl(vt.kind,ut,ue,ne,m,Dr,kt,Mr,_,Tt);const oa={program:fr,buffers:$e,uniformValues:er,atlasTexture:sr,atlasTextureIcon:Zi,atlasInterpolation:Vr,atlasInterpolationIcon:Si,isSDF:Dt,hasHalo:Ii};if(he&&We.canOverlap){Ee=!0;const la=$e.segments.get();for(const Fa of la)Ie.push({segments:new h.SegmentVector([Fa]),sortKey:Fa.sortKey,state:oa})}else Ie.push({segments:$e.segments,sortKey:0,state:oa})}Ee&&Ie.sort((Re,Me)=>Re.sortKey-Me.sortKey);for(const Re of Ie){const Me=Re.state;if(Z.activeTexture.set(Y.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,Y.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(Z.activeTexture.set(Y.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,Y.CLAMP_TO_EDGE)),Me.isSDF){const We=Me.uniformValues;Me.hasHalo&&(We.u_is_halo=1,Pl(Me.buffers,Re.segments,c,m,Me.program,pe,F,N,We)),We.u_is_halo=0}Pl(Me.buffers,Re.segments,c,m,Me.program,pe,F,N,Me.uniformValues)}}function Pl(m,a,c,d,_,x,E,S,A){const D=d.context;_.draw(D,D.gl.TRIANGLES,x,E,S,_r.disabled,A,c.id,m.layoutVertexBuffer,m.indexBuffer,a,c.paint,d.transform.zoom,m.programConfigurations.get(c.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function ls(m,a,c,d,_,x,E){const S=m.context.gl,A=c.paint.get("fill-pattern"),D=A&&A.constantOr(1),F=c.getCrossfadeParameters();let N,Z,Y,q,Q;E?(Z=D&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=S.LINES):(Z=D?"fillPattern":"fill",N=S.TRIANGLES);for(const ne of d){const se=a.getTile(ne);if(D&&!se.patternsLoaded())continue;const ue=se.getBucket(c);if(!ue)continue;const he=ue.programConfigurations.get(c.id),Ee=m.useProgram(Z,he);D&&(m.context.activeTexture.set(S.TEXTURE0),se.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),he.updatePaintBuffers(F));const pe=A.constantOr(null);if(pe&&se.imageAtlas){const Ie=se.imageAtlas,Re=Ie.patternPositions[pe.to.toString()],Me=Ie.patternPositions[pe.from.toString()];Re&&Me&&he.setConstantPatternPositions(Re,Me)}const ve=m.translatePosMatrix(ne.posMatrix,se,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(E){q=ue.indexBuffer2,Q=ue.segments2;const Ie=[S.drawingBufferWidth,S.drawingBufferHeight];Y=Z==="fillOutlinePattern"&&D?ta(ve,m,F,se,Ie):qh(ve,Ie)}else q=ue.indexBuffer,Q=ue.segments,Y=D?hl(ve,m,F,se):ll(ve);Ee.draw(m.context,N,_,m.stencilModeForClipping(ne),x,_r.disabled,Y,c.id,ue.layoutVertexBuffer,q,Q,c.paint,m.transform.zoom,he)}}function Ia(m,a,c,d,_,x,E){const S=m.context,A=S.gl,D=c.paint.get("fill-extrusion-pattern"),F=D.constantOr(1),N=c.getCrossfadeParameters(),Z=c.paint.get("fill-extrusion-opacity");for(const Y of d){const q=a.getTile(Y),Q=q.getBucket(c);if(!Q)continue;const ne=Q.programConfigurations.get(c.id),se=m.useProgram(F?"fillExtrusionPattern":"fillExtrusion",ne);F&&(m.context.activeTexture.set(A.TEXTURE0),q.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ne.updatePaintBuffers(N));const ue=D.constantOr(null);if(ue&&q.imageAtlas){const ve=q.imageAtlas,Ie=ve.patternPositions[ue.to.toString()],Re=ve.patternPositions[ue.from.toString()];Ie&&Re&&ne.setConstantPatternPositions(Ie,Re)}const he=m.translatePosMatrix(Y.posMatrix,q,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ee=c.paint.get("fill-extrusion-vertical-gradient"),pe=F?Zh(he,m,Ee,Z,Y,N,q):js(he,m,Ee,Z);se.draw(S,S.gl.TRIANGLES,_,x,E,_r.backCCW,pe,c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,m.transform.zoom,ne)}}function ji(m,a,c,d,_,x){const E=m.context,S=E.gl,A=a.fbo;if(!A)return;const D=m.useProgram("hillshade");E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get());const F=((N,Z,Y)=>{const q=Y.paint.get("hillshade-shadow-color"),Q=Y.paint.get("hillshade-highlight-color"),ne=Y.paint.get("hillshade-accent-color");let se=Y.paint.get("hillshade-illumination-direction")*(Math.PI/180);Y.paint.get("hillshade-illumination-anchor")==="viewport"&&(se-=N.transform.angle);const ue=!N.options.moving;return{u_matrix:N.transform.calculatePosMatrix(Z.tileID.toUnwrapped(),ue),u_image:0,u_latrange:cl(0,Z.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),se],u_shadow:q,u_highlight:Q,u_accent:ne}})(m,a,c);D.draw(E,S.TRIANGLES,d,_,x,_r.disabled,F,c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}function ac(m,a,c,d,_,x){const E=m.context,S=E.gl,A=a.dem;if(A&&A.data){const D=A.dim,F=A.stride,N=A.getPixels();if(E.activeTexture.set(S.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||m.getTileTexture(F),a.demTexture){const Y=a.demTexture;Y.update(N,{premultiply:!1}),Y.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else a.demTexture=new we(E,N,S.RGBA,{premultiply:!1}),a.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);E.activeTexture.set(S.TEXTURE0);let Z=a.fbo;if(!Z){const Y=new we(E,{width:D,height:D,data:null},S.RGBA);Y.bind(S.LINEAR,S.CLAMP_TO_EDGE),Z=a.fbo=E.createFramebuffer(D,D,!0),Z.colorAttachment.set(Y.texture)}E.bindFramebuffer.set(Z.framebuffer),E.viewport.set([0,0,D,D]),m.useProgram("hillshadePrepare").draw(E,S.TRIANGLES,d,_,x,_r.disabled,((Y,q)=>{const Q=q.stride,ne=h.create();return h.ortho(ne,0,h.EXTENT,-h.EXTENT,0,0,1),h.translate(ne,ne,[0,-h.EXTENT,0]),{u_matrix:ne,u_image:1,u_dimension:[Q,Q],u_zoom:Y.overscaledZ,u_unpack:q.getUnpackVector()}})(a.tileID,A),c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function sc(m,a,c,d,_){const x=d.paint.get("raster-fade-duration");if(x>0){const E=h.exported.now(),S=(E-m.timeAdded)/x,A=a?(E-a.timeAdded)/x:-1,D=c.getSource(),F=_.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),N=!a||Math.abs(a.tileID.overscaledZ-F)>Math.abs(m.tileID.overscaledZ-F),Z=N&&m.refreshedUponExpiration?1:h.clamp(N?S:1-A,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),a?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}const oc=new h.Color(1,0,0,1),Pa=new h.Color(0,1,0,1),to=new h.Color(0,0,1,1),Rl=new h.Color(1,0,1,1),nf=new h.Color(0,1,1,1);function ro(m,a,c,d){hs(m,0,a+c/2,m.transform.width,c,d)}function lc(m,a,c,d){hs(m,a-c/2,0,c,m.transform.height,d)}function hs(m,a,c,d,_,x){const E=m.context,S=E.gl;S.enable(S.SCISSOR_TEST),S.scissor(a*m.pixelRatio,c*m.pixelRatio,d*m.pixelRatio,_*m.pixelRatio),E.clear({color:x}),S.disable(S.SCISSOR_TEST)}function io(m,a,c){const d=m.context,_=d.gl,x=c.posMatrix,E=m.useProgram("debug"),S=zt.disabled,A=xr.disabled,D=m.colorModeForRenderPass(),F="$debug";d.activeTexture.set(_.TEXTURE0),m.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),E.draw(d,_.LINE_STRIP,S,A,D,_r.disabled,rs(x,h.Color.red),F,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);const N=a.getTileByID(c.key).latestRawTileData,Z=Math.floor((N&&N.byteLength||0)/1024),Y=a.getTile(c).tileSize,q=512/Math.min(Y,512)*(c.overscaledZ/m.transform.zoom)*.5;let Q=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Q+=` => ${c.overscaledZ}`),function(ne,se){ne.initDebugOverlayCanvas();const ue=ne.debugOverlayCanvas,he=ne.context.gl,Ee=ne.debugOverlayCanvas.getContext("2d");Ee.clearRect(0,0,ue.width,ue.height),Ee.shadowColor="white",Ee.shadowBlur=2,Ee.lineWidth=1.5,Ee.strokeStyle="white",Ee.textBaseline="top",Ee.font="bold 36px Open Sans, sans-serif",Ee.fillText(se,5,5),Ee.strokeText(se,5,5),ne.debugOverlayTexture.update(ue),ne.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(m,`${Q} ${Z}kb`),E.draw(d,_.TRIANGLES,S,A,gr.alphaBlended,_r.disabled,rs(x,h.Color.transparent,q),F,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}const no={symbol:function(m,a,c,d,_){if(m.renderPass!=="translucent")return;const x=xr.disabled,E=m.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,A,D,F,N,Z,Y){const q=A.transform,Q=N==="map",ne=Z==="map";for(const se of S){const ue=F.getTile(se),he=ue.getBucket(D);if(!he||!he.text||!he.text.segments.get().length)continue;const Ee=h.evaluateSizeForZoom(he.textSizeData,q.zoom),pe=pr(ue,1,A.transform.zoom),ve=Sn(se.posMatrix,ne,Q,A.transform,pe),Ie=D.layout.get("icon-text-fit")!=="none"&&he.hasIconData();if(Ee){const Re=Math.pow(2,q.zoom-ue.tileID.overscaledZ);Qs(he,Q,ne,Y,h.symbolSize,q,ve,se.posMatrix,Re,Ee,Ie)}}}(d,m,c,a,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),_),c.paint.get("icon-opacity").constantOr(1)!==0&&eo(m,a,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,E),c.paint.get("text-opacity").constantOr(1)!==0&&eo(m,a,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,E),a.map.showCollisionBoxes&&(nc(m,a,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),nc(m,a,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,a,c,d){if(m.renderPass!=="translucent")return;const _=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),S=!c.layout.get("circle-sort-key").isConstant();if(_.constantOr(1)===0&&(x.constantOr(1)===0||E.constantOr(1)===0))return;const A=m.context,D=A.gl,F=m.depthModeForSublayer(0,zt.ReadOnly),N=xr.disabled,Z=m.colorModeForRenderPass(),Y=[];for(let q=0;q<d.length;q++){const Q=d[q],ne=a.getTile(Q),se=ne.getBucket(c);if(!se)continue;const ue=se.programConfigurations.get(c.id),he={programConfiguration:ue,program:m.useProgram("circle",ue),layoutVertexBuffer:se.layoutVertexBuffer,indexBuffer:se.indexBuffer,uniformValues:Zs(m,Q,ne,c)};if(S){const Ee=se.segments.get();for(const pe of Ee)Y.push({segments:new h.SegmentVector([pe]),sortKey:pe.sortKey,state:he})}else Y.push({segments:se.segments,sortKey:0,state:he})}S&&Y.sort((q,Q)=>q.sortKey-Q.sortKey);for(const q of Y){const{programConfiguration:Q,program:ne,layoutVertexBuffer:se,indexBuffer:ue,uniformValues:he}=q.state;ne.draw(A,D.TRIANGLES,F,N,Z,_r.disabled,he,c.id,se,ue,q.segments,c.paint,m.transform.zoom,Q)}},heatmap:function(m,a,c,d){if(c.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const _=m.context,x=_.gl,E=xr.disabled,S=new gr([x.ONE,x.ONE],h.Color.transparent,[!0,!0,!0,!0]);(function(A,D,F){const N=A.gl;A.activeTexture.set(N.TEXTURE1),A.viewport.set([0,0,D.width/4,D.height/4]);let Z=F.heatmapFbo;if(Z)N.bindTexture(N.TEXTURE_2D,Z.colorAttachment.get()),A.bindFramebuffer.set(Z.framebuffer);else{const Y=N.createTexture();N.bindTexture(N.TEXTURE_2D,Y),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),Z=F.heatmapFbo=A.createFramebuffer(D.width/4,D.height/4,!1),function(q,Q,ne,se){const ue=q.gl;ue.texImage2D(ue.TEXTURE_2D,0,ue.RGBA,Q.width/4,Q.height/4,0,ue.RGBA,q.extRenderToTextureHalfFloat?q.extTextureHalfFloat.HALF_FLOAT_OES:ue.UNSIGNED_BYTE,null),se.colorAttachment.set(ne)}(A,D,Y,Z)}})(_,m,c),_.clear({color:h.Color.transparent});for(let A=0;A<d.length;A++){const D=d[A];if(a.hasRenderableParent(D))continue;const F=a.getTile(D),N=F.getBucket(c);if(!N)continue;const Z=N.programConfigurations.get(c.id),Y=m.useProgram("heatmap",Z),{zoom:q}=m.transform;Y.draw(_,x.TRIANGLES,zt.disabled,E,S,_r.disabled,qs(D.posMatrix,F,q,c.paint.get("heatmap-intensity")),c.id,N.layoutVertexBuffer,N.indexBuffer,N.segments,c.paint,m.transform.zoom,Z)}_.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(_,x){const E=_.context,S=E.gl,A=x.heatmapFbo;if(!A)return;E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),E.activeTexture.set(S.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new we(E,x.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(E,S.TRIANGLES,zt.disabled,xr.disabled,_.colorModeForRenderPass(),_r.disabled,((F,N,Z,Y)=>{const q=h.create();h.ortho(q,0,F.width,F.height,0,0,1);const Q=F.context.gl;return{u_matrix:q,u_world:[Q.drawingBufferWidth,Q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}})(_,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(m,c))},line:function(m,a,c,d){if(m.renderPass!=="translucent")return;const _=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const E=m.depthModeForSublayer(0,zt.ReadOnly),S=m.colorModeForRenderPass(),A=c.paint.get("line-dasharray"),D=c.paint.get("line-pattern"),F=D.constantOr(1),N=c.paint.get("line-gradient"),Z=c.getCrossfadeParameters(),Y=F?"linePattern":A?"lineSDF":N?"lineGradient":"line",q=m.context,Q=q.gl;let ne=!0;for(const se of d){const ue=a.getTile(se);if(F&&!ue.patternsLoaded())continue;const he=ue.getBucket(c);if(!he)continue;const Ee=he.programConfigurations.get(c.id),pe=m.context.program.get(),ve=m.useProgram(Y,Ee),Ie=ne||ve.program!==pe,Re=D.constantOr(null);if(Re&&ue.imageAtlas){const We=ue.imageAtlas,$e=We.patternPositions[Re.to.toString()],ht=We.patternPositions[Re.from.toString()];$e&&ht&&Ee.setConstantPatternPositions($e,ht)}const Me=F?Tr(m,ue,c,Z):A?Xs(m,ue,c,A,Z):N?ns(m,ue,c,he.lineClipsArray.length):Ma(m,ue,c);if(F)q.activeTexture.set(Q.TEXTURE0),ue.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Ee.updatePaintBuffers(Z);else if(A&&(Ie||m.lineAtlas.dirty))q.activeTexture.set(Q.TEXTURE0),m.lineAtlas.bind(q);else if(N){const We=he.gradients[c.id];let $e=We.texture;if(c.gradientVersion!==We.version){let ht=256;if(c.stepInterpolant){const Dt=a.getSource().maxzoom,vt=se.canonical.z===Dt?Math.ceil(1<<m.transform.maxZoom-se.canonical.z):1;ht=h.clamp(h.nextPowerOfTwo(he.maxLineLength/h.EXTENT*1024*vt),256,q.maxTextureSize)}We.gradient=h.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:ht,image:We.gradient||void 0,clips:he.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new we(q,We.gradient,Q.RGBA),We.version=c.gradientVersion,$e=We.texture}q.activeTexture.set(Q.TEXTURE0),$e.bind(c.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}ve.draw(q,Q.TRIANGLES,E,m.stencilModeForClipping(se),S,_r.disabled,Me,c.id,he.layoutVertexBuffer,he.indexBuffer,he.segments,c.paint,m.transform.zoom,Ee,he.layoutVertexBuffer2),ne=!1}},fill:function(m,a,c,d){const _=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const E=m.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),A=m.opaquePassEnabledForLayer()&&!S.constantOr(1)&&_.constantOr(h.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===A){const D=m.depthModeForSublayer(1,m.renderPass==="opaque"?zt.ReadWrite:zt.ReadOnly);ls(m,a,c,d,D,E,!1)}if(m.renderPass==="translucent"&&c.paint.get("fill-antialias")){const D=m.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,zt.ReadOnly);ls(m,a,c,d,D,E,!0)}},"fill-extrusion":function(m,a,c,d){const _=c.paint.get("fill-extrusion-opacity");if(_!==0&&m.renderPass==="translucent"){const x=new zt(m.context.gl.LEQUAL,zt.ReadWrite,m.depthRangeFor3D);if(_!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Ia(m,a,c,d,x,xr.disabled,gr.disabled),Ia(m,a,c,d,x,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const E=m.colorModeForRenderPass();Ia(m,a,c,d,x,xr.disabled,E)}}},hillshade:function(m,a,c,d){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const _=m.context,x=m.depthModeForSublayer(0,zt.ReadOnly),E=m.colorModeForRenderPass(),[S,A]=m.renderPass==="translucent"?m.stencilConfigForOverlap(d):[{},d];for(const D of A){const F=a.getTile(D);F.needsHillshadePrepare&&m.renderPass==="offscreen"?ac(m,F,c,x,xr.disabled,E):m.renderPass==="translucent"&&ji(m,F,c,x,S[D.overscaledZ],E)}_.viewport.set([0,0,m.width,m.height])},raster:function(m,a,c,d){if(m.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!d.length)return;const _=m.context,x=_.gl,E=a.getSource(),S=m.useProgram("raster"),A=m.colorModeForRenderPass(),[D,F]=E instanceof Nr?[{},d]:m.stencilConfigForOverlap(d),N=F[F.length-1].overscaledZ,Z=!m.options.moving;for(const Y of F){const q=m.depthModeForSublayer(Y.overscaledZ-N,c.paint.get("raster-opacity")===1?zt.ReadWrite:zt.ReadOnly,x.LESS),Q=a.getTile(Y),ne=m.transform.calculatePosMatrix(Y.toUnwrapped(),Z);Q.registerFadeDuration(c.paint.get("raster-fade-duration"));const se=a.findLoadedParent(Y,0),ue=sc(Q,se,a,c,m.transform);let he,Ee;const pe=c.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;_.activeTexture.set(x.TEXTURE0),Q.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),_.activeTexture.set(x.TEXTURE1),se?(se.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),he=Math.pow(2,se.tileID.overscaledZ-Q.tileID.overscaledZ),Ee=[Q.tileID.canonical.x*he%1,Q.tileID.canonical.y*he%1]):Q.texture.bind(pe,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const ve=Xh(ne,Ee||[0,0],he||1,ue,c);E instanceof Nr?S.draw(_,x.TRIANGLES,q,xr.disabled,A,_r.disabled,ve,c.id,E.boundsBuffer,m.quadTriangleIndexBuffer,E.boundsSegments):S.draw(_,x.TRIANGLES,q,D[Y.overscaledZ],A,_r.disabled,ve,c.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}},background:function(m,a,c){const d=c.paint.get("background-color"),_=c.paint.get("background-opacity");if(_===0)return;const x=m.context,E=x.gl,S=m.transform,A=S.tileSize,D=c.paint.get("background-pattern");if(m.isPatternMissing(D))return;const F=!D&&d.a===1&&_===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==F)return;const N=xr.disabled,Z=m.depthModeForSublayer(0,F==="opaque"?zt.ReadWrite:zt.ReadOnly),Y=m.colorModeForRenderPass(),q=m.useProgram(D?"backgroundPattern":"background"),Q=S.coveringTiles({tileSize:A});D&&(x.activeTexture.set(E.TEXTURE0),m.imageManager.bind(m.context));const ne=c.getCrossfadeParameters();for(const se of Q){const ue=m.transform.calculatePosMatrix(se.toUnwrapped()),he=D?gl(ue,_,m,D,{tileID:se,tileSize:A},ne):ml(ue,_,d);q.draw(x,E.TRIANGLES,Z,N,Y,_r.disabled,he,c.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}},debug:function(m,a,c){for(let d=0;d<c.length;d++)io(m,a,c[d])},custom:function(m,a,c){const d=m.context,_=c.implementation;if(m.renderPass==="offscreen"){const x=_.prerender;x&&(m.setCustomLayerDefaults(),d.setColorMode(m.colorModeForRenderPass()),x.call(_,d.gl,m.transform.customLayerMatrix()),d.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),d.setColorMode(m.colorModeForRenderPass()),d.setStencilMode(xr.disabled);const x=_.renderingMode==="3d"?new zt(m.context.gl.LEQUAL,zt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,zt.ReadOnly);d.setDepthMode(x),_.render(d.gl,m.transform.customLayerMatrix()),d.setDirty(),m.setBaseState(),d.bindFramebuffer.set(null)}}};class hc{constructor(a,c){this.context=new rf(a),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=kr.maxUnderzooming+kr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gt,this.gpuTimers={}}resize(a,c,d){if(this.width=a*d,this.height=c*d,this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style._order)this.style._layers[_].resize()}setup(){const a=this.context,c=new h.PosArray;c.emplaceBack(0,0),c.emplaceBack(h.EXTENT,0),c.emplaceBack(0,h.EXTENT),c.emplaceBack(h.EXTENT,h.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(c,ol.members),this.tileExtentSegments=h.SegmentVector.simpleSegment(0,0,4,2);const d=new h.PosArray;d.emplaceBack(0,0),d.emplaceBack(h.EXTENT,0),d.emplaceBack(0,h.EXTENT),d.emplaceBack(h.EXTENT,h.EXTENT),this.debugBuffer=a.createVertexBuffer(d,ol.members),this.debugSegments=h.SegmentVector.simpleSegment(0,0,4,5);const _=new h.RasterBoundsArray;_.emplaceBack(0,0,0,0),_.emplaceBack(h.EXTENT,0,h.EXTENT,0),_.emplaceBack(0,h.EXTENT,0,h.EXTENT),_.emplaceBack(h.EXTENT,h.EXTENT,h.EXTENT,h.EXTENT),this.rasterBoundsBuffer=a.createVertexBuffer(_,ci.members),this.rasterBoundsSegments=h.SegmentVector.simpleSegment(0,0,4,2);const x=new h.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(x,ol.members),this.viewportSegments=h.SegmentVector.simpleSegment(0,0,4,2);const E=new h.LineStripIndexArray;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(E);const S=new h.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(S),this.emptyTexture=new we(a,{width:1,height:1,data:new Uint8Array([0,0,0,0])},a.gl.RGBA);const A=this.context.gl;this.stencilClearMode=new xr({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const a=this.context,c=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=h.create();h.ortho(d,0,this.width,this.height,0,0,1),h.scale(d,d,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,c.TRIANGLES,zt.disabled,this.stencilClearMode,gr.disabled,_r.disabled,is(d),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,c){if(this.currentStencilSource===a.source||!a.isTileClipped()||!c||!c.length)return;this.currentStencilSource=a.source;const d=this.context,_=d.gl;this.nextStencilID+c.length>256&&this.clearStencil(),d.setColorMode(gr.disabled),d.setDepthMode(zt.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of c){const S=this._tileClippingMaskIDs[E.key]=this.nextStencilID++;x.draw(d,_.TRIANGLES,zt.disabled,new xr({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),gr.disabled,_r.disabled,is(E.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,c=this.context.gl;return new xr({func:c.NOTEQUAL,mask:255},a,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(a){const c=this.context.gl;return new xr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(a){const c=this.context.gl,d=a.sort((E,S)=>S.overscaledZ-E.overscaledZ),_=d[d.length-1].overscaledZ,x=d[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const E={};for(let S=0;S<x;S++)E[S+_]=new xr({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[E,d]}return[{[_]:xr.disabled},d]}colorModeForRenderPass(){const a=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new gr([a.CONSTANT_COLOR,a.ONE],new h.Color(c,c,c,0),[!0,!0,!0,!0])}return this.renderPass==="opaque"?gr.unblended:gr.alphaBlended}depthModeForSublayer(a,c,d){if(!this.opaquePassEnabledForLayer())return zt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new zt(d||this.context.gl.LEQUAL,c,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,c){this.style=a,this.options=c,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(h.exported.now()),this.imageManager.beginFrame();const d=this.style._order,_=this.style.sourceCaches;for(const A in _){const D=_[A];D.used&&D.prepare(this.context)}const x={},E={},S={};for(const A in _){const D=_[A];x[A]=D.getVisibleCoordinates(),E[A]=x[A].slice().reverse(),S[A]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<d.length;A++)if(this.style._layers[d[A]].is3D()){this.opaquePassCutoff=A;break}this.renderPass="offscreen";for(const A of d){const D=this.style._layers[A];if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const F=E[D.source];(D.type==="custom"||F.length)&&this.renderLayer(this,_[D.source],D,F)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?h.Color.black:h.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[d[this.currentLayer]],D=_[A.source],F=x[A.source];this._renderTileClippingMasks(A,F),this.renderLayer(this,D,A,F)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const A=this.style._layers[d[this.currentLayer]],D=_[A.source],F=(A.type==="symbol"?S:E)[A.source];this._renderTileClippingMasks(A,x[A.source]),this.renderLayer(this,D,A,F)}if(this.options.showTileBoundaries){let A,D;Object.values(this.style._layers).forEach(F=>{F.source&&!F.isHidden(this.transform.zoom)&&(F.source!==(D&&D.id)&&(D=this.style.sourceCaches[F.source]),(!A||A.getSource().maxzoom<D.getSource().maxzoom)&&(A=D))}),A&&no.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const D=A.transform.padding;ro(A,A.transform.height-(D.top||0),3,oc),ro(A,D.bottom||0,3,Pa),lc(A,D.left||0,3,to),lc(A,A.transform.width-(D.right||0),3,Rl);const F=A.transform.centerPoint;(function(N,Z,Y,q){hs(N,Z-1,Y-10,2,20,q),hs(N,Z-10,Y-1,20,2,q)})(A,F.x,A.transform.height-F.y,nf)}(this),this.context.setDefault()}renderLayer(a,c,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="custom"||_.length)&&(this.id=d.id,this.gpuTimingStart(d),no[d.type](a,c,d,_,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let d=this.gpuTimers[a.id];d||(d=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),d.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,d.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}queryGpuTimers(a){const c={};for(const d in a){const _=a[d],x=this.context.extTimerQuery,E=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),c[d]=E}return c}translatePosMatrix(a,c,d,_,x){if(!d[0]&&!d[1])return a;const E=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(E){const D=Math.sin(E),F=Math.cos(E);d=[d[0]*F-d[1]*D,d[0]*D+d[1]*F]}const S=re(x?d[0]:pr(c,d[0],this.transform.zoom),x?d[1]:pr(c,d[1],this.transform.zoom),0),A=new Float32Array(16);return h.translate(A,a,S),A}saveTileTexture(a){const c=this._tileTextures[a.size[0]];c?c.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const c=this._tileTextures[a];return c&&c.length>0?c.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const c=this.imageManager.getPattern(a.from.toString()),d=this.imageManager.getPattern(a.to.toString());return!c||!d}useProgram(a,c){this.cache=this.cache||{};const d=`${a}${c?c.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[d]||(this.cache[d]=new $h(this.context,a,es[a],c,_l[a],this._showOverdrawInspector)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class ao{constructor(a,c){this.points=a,this.planes=c}static fromInvProjectionMatrix(a,c,d){const _=Math.pow(2,d),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>h.transformMat4([],S,a)).map(S=>h.scale$1([],S,1/S[3]/c*_)),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=function(Z,Y){var q=Y[0],Q=Y[1],ne=Y[2],se=q*q+Q*Q+ne*ne;return se>0&&(se=1/Math.sqrt(se)),Z[0]=Y[0]*se,Z[1]=Y[1]*se,Z[2]=Y[2]*se,Z}([],function(Z,Y,q){var Q=Y[0],ne=Y[1],se=Y[2],ue=q[0],he=q[1],Ee=q[2];return Z[0]=ne*Ee-se*he,Z[1]=se*ue-Q*Ee,Z[2]=Q*he-ne*ue,Z}([],ce([],x[S[0]],x[S[1]]),ce([],x[S[2]],x[S[1]]))),D=-((F=A)[0]*(N=x[S[1]])[0]+F[1]*N[1]+F[2]*N[2]);var F,N;return A.concat(D)});return new ao(x,E)}}class Ra{constructor(a,c){this.min=a,this.max=c,this.center=function(d,_,x){return d[0]=.5*_[0],d[1]=.5*_[1],d[2]=.5*_[2],d}([],function(d,_,x){return d[0]=_[0]+x[0],d[1]=_[1]+x[1],d[2]=_[2]+x[2],d}([],this.min,this.max))}quadrant(a){const c=[a%2==0,a<2],d=H(this.min),_=H(this.max);for(let x=0;x<c.length;x++)d[x]=c[x]?this.min[x]:this.center[x],_[x]=c[x]?this.center[x]:this.max[x];return _[2]=this.max[2],new Ra(d,_)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let d=!0;for(let _=0;_<a.planes.length;_++){const x=a.planes[_];let E=0;for(let S=0;S<c.length;S++)h.dot(x,c[S])>=0&&E++;if(E===0)return 0;E!==c.length&&(d=!1)}if(d)return 2;for(let _=0;_<3;_++){let x=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let S=0;S<a.points.length;S++){const A=a.points[S][_]-this.min[_];x=Math.min(x,A),E=Math.max(E,A)}if(E<0||x>this.max[_]-this.min[_])return 0}return 1}}class cs{constructor(a=0,c=0,d=0,_=0){if(isNaN(a)||a<0||isNaN(c)||c<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=c,this.left=d,this.right=_}interpolate(a,c,d){return c.top!=null&&a.top!=null&&(this.top=h.number(a.top,c.top,d)),c.bottom!=null&&a.bottom!=null&&(this.bottom=h.number(a.bottom,c.bottom,d)),c.left!=null&&a.left!=null&&(this.left=h.number(a.left,c.left,d)),c.right!=null&&a.right!=null&&(this.right=h.number(a.right,c.right,d)),this}getCenter(a,c){const d=h.clamp((this.left+a-this.right)/2,0,a),_=h.clamp((this.top+c-this.bottom)/2,0,c);return new h.pointGeometry(d,_)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new cs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class so{constructor(a,c,d,_,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||!!x,this._minZoom=a||0,this._maxZoom=c||22,this._minPitch=d==null?0:d,this._maxPitch=_==null?60:_,this.setMaxBounds(),this.width=0,this.height=0,this._center=new h.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cs,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const a=new so(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.tileSize=this.tileSize,a.latRange=this.latRange,a.width=this.width,a.height=this.height,a._center=this._center,a.zoom=this.zoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const c=-h.wrap(a,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=function(){var d=new h.ARRAY_TYPE(4);return h.ARRAY_TYPE!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,_,x){var E=_[0],S=_[1],A=_[2],D=_[3],F=Math.sin(x),N=Math.cos(x);d[0]=E*N+A*F,d[1]=S*N+D*F,d[2]=E*-F+A*N,d[3]=S*-F+D*N}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const c=h.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const c=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,c,d){this._unmodified=!1,this._edgeInsets.interpolate(a,c,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const c=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(a){const c=[new h.UnwrappedTileID(0,a)];if(this._renderWorldCopies){const d=this.pointCoordinate(new h.pointGeometry(0,0)),_=this.pointCoordinate(new h.pointGeometry(this.width,0)),x=this.pointCoordinate(new h.pointGeometry(this.width,this.height)),E=this.pointCoordinate(new h.pointGeometry(0,this.height)),S=Math.floor(Math.min(d.x,_.x,x.x,E.x)),A=Math.floor(Math.max(d.x,_.x,x.x,E.x)),D=1;for(let F=S-D;F<=A+D;F++)F!==0&&c.push(new h.UnwrappedTileID(F,a))}return c}coveringTiles(a){let c=this.coveringZoomLevel(a);const d=c;if(a.minzoom!==void 0&&c<a.minzoom)return[];a.maxzoom!==void 0&&c>a.maxzoom&&(c=a.maxzoom);const _=h.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,c),E=[x*_.x,x*_.y,0],S=ao.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c);let A=a.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(A=c);const D=q=>({aabb:new Ra([q*x,0,0],[(q+1)*x,x,0]),zoom:0,x:0,y:0,wrap:q,fullyVisible:!1}),F=[],N=[],Z=c,Y=a.reparseOverscaled?d:c;if(this._renderWorldCopies)for(let q=1;q<=3;q++)F.push(D(-q)),F.push(D(q));for(F.push(D(0));F.length>0;){const q=F.pop(),Q=q.x,ne=q.y;let se=q.fullyVisible;if(!se){const ve=q.aabb.intersects(S);if(ve===0)continue;se=ve===2}const ue=q.aabb.distanceX(E),he=q.aabb.distanceY(E),Ee=Math.max(Math.abs(ue),Math.abs(he)),pe=3+(1<<Z-q.zoom)-2;if(q.zoom===Z||Ee>pe&&q.zoom>=A)N.push({tileID:new h.OverscaledTileID(q.zoom===Z?Y:q.zoom,q.wrap,q.zoom,Q,ne),distanceSq:be([E[0]-.5-Q,E[1]-.5-ne])});else for(let ve=0;ve<4;ve++){const Ie=(Q<<1)+ve%2,Re=(ne<<1)+(ve>>1);F.push({aabb:q.aabb.quadrant(ve),zoom:q.zoom+1,x:Ie,y:Re,wrap:q.wrap,fullyVisible:se})}}return N.sort((q,Q)=>q.distanceSq-Q.distanceSq).map(q=>q.tileID)}resize(a,c){this.width=a,this.height=c,this.pixelsToGLUnits=[2/a,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const c=h.clamp(a.lat,-this.maxValidLatitude,this.maxValidLatitude);return new h.pointGeometry(h.mercatorXfromLng(a.lng)*this.worldSize,h.mercatorYfromLat(c)*this.worldSize)}unproject(a){return new h.MercatorCoordinate(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(a,c){const d=this.pointCoordinate(c),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(a),E=new h.MercatorCoordinate(x.x-(d.x-_.x),x.y-(d.y-_.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a){return this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}locationCoordinate(a){return h.MercatorCoordinate.fromLngLat(a)}coordinateLocation(a){return a.toLngLat()}pointCoordinate(a){const c=[a.x,a.y,0,1],d=[a.x,a.y,1,1];h.transformMat4(c,c,this.pixelMatrixInverse),h.transformMat4(d,d,this.pixelMatrixInverse);const _=c[3],x=d[3],E=c[1]/_,S=d[1]/x,A=c[2]/_,D=d[2]/x,F=A===D?0:(0-A)/(D-A);return new h.MercatorCoordinate(h.number(c[0]/_,d[0]/x,F)/this.worldSize,h.number(E,S,F)/this.worldSize)}coordinatePoint(a){const c=[a.x*this.worldSize,a.y*this.worldSize,0,1];return h.transformMat4(c,c,this.pixelMatrix),new h.pointGeometry(c[0]/c[3],c[1]/c[3])}getBounds(){return new h.LngLatBounds().extend(this.pointLocation(new h.pointGeometry(0,0))).extend(this.pointLocation(new h.pointGeometry(this.width,0))).extend(this.pointLocation(new h.pointGeometry(this.width,this.height))).extend(this.pointLocation(new h.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new h.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(a,c=!1){const d=a.key,_=c?this._alignedPosMatrixCache:this._posMatrixCache;if(_[d])return _[d];const x=a.canonical,E=this.worldSize/this.zoomScale(x.z),S=x.x+Math.pow(2,x.z)*a.wrap,A=h.identity(new Float64Array(16));return h.translate(A,A,[S*E,x.y*E,0]),h.scale(A,A,[E/h.EXTENT,E/h.EXTENT,1]),h.multiply(A,c?this.alignedProjMatrix:this.projMatrix,A),_[d]=new Float32Array(A),_[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let a,c,d,_,x=-90,E=90,S=-180,A=180;const D=this.size,F=this._unmodified;if(this.latRange){const Y=this.latRange;x=h.mercatorYfromLat(Y[1])*this.worldSize,E=h.mercatorYfromLat(Y[0])*this.worldSize,a=E-x<D.y?D.y/(E-x):0}if(this.lngRange){const Y=this.lngRange;S=h.mercatorXfromLng(Y[0])*this.worldSize,A=h.mercatorXfromLng(Y[1])*this.worldSize,c=A-S<D.x?D.x/(A-S):0}const N=this.point,Z=Math.max(c||0,a||0);if(Z)return this.center=this.unproject(new h.pointGeometry(c?(A+S)/2:N.x,a?(E+x)/2:N.y)),this.zoom+=this.scaleZoom(Z),this._unmodified=F,void(this._constraining=!1);if(this.latRange){const Y=N.y,q=D.y/2;Y-q<x&&(_=x+q),Y+q>E&&(_=E-q)}if(this.lngRange){const Y=N.x,q=D.x/2;Y-q<S&&(d=S+q),Y+q>A&&(d=A-q)}d===void 0&&_===void 0||(this.center=this.unproject(new h.pointGeometry(d!==void 0?d:N.x,_!==void 0?_:N.y))),this._unmodified=F,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=Math.PI/2+this._pitch,d=this._fov*(.5+a.y/this.height),_=Math.sin(d)*this.cameraToCenterDistance/Math.sin(h.clamp(Math.PI-c-d,.01,Math.PI-.01)),x=this.point,E=x.x,S=x.y,A=1.01*(Math.cos(Math.PI/2-this._pitch)*_+this.cameraToCenterDistance),D=this.height/50;let F=new Float64Array(16);h.perspective(F,this._fov,this.width/this.height,D,A),F[8]=2*-a.x/this.width,F[9]=2*a.y/this.height,h.scale(F,F,[1,-1,1]),h.translate(F,F,[0,0,-this.cameraToCenterDistance]),h.rotateX(F,F,this._pitch),h.rotateZ(F,F,this.angle),h.translate(F,F,[-E,-S,0]),this.mercatorMatrix=h.scale([],F,re(this.worldSize,this.worldSize,this.worldSize)),h.scale(F,F,re(1,1,h.mercatorZfromAltitude(1,this.center.lat)*this.worldSize)),this.projMatrix=F,this.invProjMatrix=h.invert([],this.projMatrix);const N=this.width%2/2,Z=this.height%2/2,Y=Math.cos(this.angle),q=Math.sin(this.angle),Q=E-Math.round(E)+Y*N+q*Z,ne=S-Math.round(S)+Y*Z+q*N,se=new Float64Array(F);if(h.translate(se,se,[Q>.5?Q-1:Q,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=se,F=h.create(),h.scale(F,F,[this.width/2,-this.height/2,1]),h.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=h.create(),h.scale(F,F,[1,-1,1]),h.translate(F,F,[-1,-1,0]),h.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=h.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),F=h.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");this.pixelMatrixInverse=F,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new h.pointGeometry(0,0)),c=h.fromValues(a.x*this.worldSize,a.y*this.worldSize,0,1);return h.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.pointGeometry(0,a))}getCameraQueryGeometry(a){const c=this.getCameraPoint();if(a.length===1)return[a[0],c];{let d=c.x,_=c.y,x=c.x,E=c.y;for(const S of a)d=Math.min(d,S.x),_=Math.min(_,S.y),x=Math.max(x,S.x),E=Math.max(E,S.y);return[new h.pointGeometry(d,_),new h.pointGeometry(x,_),new h.pointGeometry(x,E),new h.pointGeometry(d,E),new h.pointGeometry(d,_)]}}}class cc{constructor(a){this._hashName=a&&encodeURIComponent(a),h.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(c,d){let _=!1,x=null;const E=()=>{x=null,_&&(c(),x=setTimeout(E,300),_=!1)};return()=>(_=!0,x||E(),x)}(this._updateHashUnthrottled.bind(this))}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const c=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),E=Math.round(c.lng*x)/x,S=Math.round(c.lat*x)/x,A=this._map.getBearing(),D=this._map.getPitch();let F="";if(F+=a?`/${E}/${S}/${d}`:`${d}/${S}/${E}`,(A||D)&&(F+="/"+Math.round(10*A)/10),D&&(F+=`/${Math.round(D)}`),this._hashName){const N=this._hashName;let Z=!1;const Y=window.location.hash.slice(1).split("&").map(q=>{const Q=q.split("=")[0];return Q===N?(Z=!0,`${Q}=${F}`):q}).filter(q=>q);return Z||Y.push(`${N}=${F}`),`#${Y.join("&")}`}return`#${F}`}_getCurrentHash(){const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._getCurrentHash();if(a.length>=3&&!a.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,a)}catch(c){}}}const us={linearity:.3,easing:h.bezier(0,0,.3,1)},uc=h.extend({deceleration:2500,maxSpeed:1400},us),fc=h.extend({deceleration:20,maxSpeed:1400},us),ka=h.extend({deceleration:1e3,maxSpeed:360},us),dc=h.extend({deceleration:1e3,maxSpeed:90},us);class pc{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:h.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,c=h.exported.now();for(;a.length>0&&c-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new h.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(c.pan.mag()){const x=ds(c.pan.mag(),d,h.extend({},uc,a||{}));_.offset=c.pan.mult(x.amount/c.pan.mag()),_.center=this._map.transform.center,fs(_,x)}if(c.zoom){const x=ds(c.zoom,d,fc);_.zoom=this._map.transform.zoom+x.amount,fs(_,x)}if(c.bearing){const x=ds(c.bearing,d,ka);_.bearing=this._map.transform.bearing+h.clamp(x.amount,-179,179),fs(_,x)}if(c.pitch){const x=ds(c.pitch,d,dc);_.pitch=this._map.transform.pitch+x.amount,fs(_,x)}if(_.zoom||_.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),h.extend(_,{noMoveStart:!0})}}function fs(m,a){(!m.duration||m.duration<a.duration)&&(m.duration=a.duration,m.easing=a.easing)}function ds(m,a,c){const{maxSpeed:d,linearity:_,deceleration:x}=c,E=h.clamp(m*_/(a/1e3),-d,d),S=Math.abs(E)/(x*_);return{easing:c.easing,duration:1e3*S,amount:E*(S/2)}}class yr extends h.Event{constructor(a,c,d,_={}){const x=R.mousePos(c.getCanvasContainer(),d),E=c.unproject(x);super(a,h.extend({point:x,lngLat:E,originalEvent:d},_)),this._defaultPrevented=!1,this.target=c}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class oo extends h.Event{constructor(a,c,d){const _=a==="touchend"?d.changedTouches:d.touches,x=R.touchPos(c.getCanvasContainer(),_),E=x.map(A=>c.unproject(A)),S=x.reduce((A,D,F,N)=>A.add(D.div(N.length)),new h.pointGeometry(0,0));super(a,{points:x,point:S,lngLats:E,lngLat:c.unproject(S),originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class aa extends h.Event{constructor(a,c,d){super(a,{originalEvent:d}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class mc{constructor(a,c){this._map=a,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new aa(a.type,this._map,a))}mousedown(a,c){return this._mousedownPos=c,this._firePreventable(new yr(a.type,this._map,a))}mouseup(a){this._map.fire(new yr(a.type,this._map,a))}click(a,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new yr(a.type,this._map,a))}dblclick(a){return this._firePreventable(new yr(a.type,this._map,a))}mouseover(a){this._map.fire(new yr(a.type,this._map,a))}mouseout(a){this._map.fire(new yr(a.type,this._map,a))}touchstart(a){return this._firePreventable(new oo(a.type,this._map,a))}touchmove(a){this._map.fire(new oo(a.type,this._map,a))}touchend(a){this._map.fire(new oo(a.type,this._map,a))}touchcancel(a){this._map.fire(new oo(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Da{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(a){this._map.fire(new yr(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new yr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new yr(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ps{constructor(a,c){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,c){this.isEnabled()&&a.shiftKey&&a.button===0&&(R.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(a,c){if(!this._active)return;const d=c;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=d,this._box||(this._box=R.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const x=Math.min(_.x,d.x),E=Math.max(_.x,d.x),S=Math.min(_.y,d.y),A=Math.max(_.y,d.y);R.setTransform(this._box,`translate(${x}px,${S}px)`),this._box.style.width=E-x+"px",this._box.style.height=A-S+"px"}mouseupWindow(a,c){if(!this._active||a.button!==0)return;const d=this._startPos,_=c;if(this.reset(),R.suppressClick(),d.x!==_.x||d.y!==_.y)return this._map.fire(new h.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:x=>x.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,c){return this._map.fire(new h.Event(a,{originalEvent:c}))}}function kl(m,a){const c={};for(let d=0;d<m.length;d++)c[m[d].identifier]=a[d];return c}class af{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,c,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const x=new h.pointGeometry(0,0);for(const E of _)x._add(E);return x.div(_.length)}(c),this.touches=kl(d,c)))}touchmove(a,c,d){if(this.aborted||!this.centroid)return;const _=kl(d,c);for(const x in this.touches){const E=this.touches[x],S=_[x];(!S||S.dist(E)>30)&&(this.aborted=!0)}}touchend(a,c,d){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Dl{constructor(a){this.singleTap=new af(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,c,d){this.singleTap.touchstart(a,c,d)}touchmove(a,c,d){this.singleTap.touchmove(a,c,d)}touchend(a,c,d){const _=this.singleTap.touchend(a,c,d);if(_){const x=a.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(_)<30;if(x&&E||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class gc{constructor(){this._zoomIn=new Dl({numTouches:1,numTaps:2}),this._zoomOut=new Dl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,c,d){this._zoomIn.touchstart(a,c,d),this._zoomOut.touchstart(a,c,d)}touchmove(a,c,d){this._zoomIn.touchmove(a,c,d),this._zoomOut.touchmove(a,c,d)}touchend(a,c,d){const _=this._zoomIn.touchend(a,c,d),x=this._zoomOut.touchend(a,c,d);return _?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(_)},{originalEvent:a})}):x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(x)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ms={0:1,2:2};class Pn{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(a,c){return!1}_move(a,c){return{}}mousedown(a,c){if(this._lastPoint)return;const d=R.mouseButton(a);this._correctButton(a,d)&&(this._lastPoint=c,this._eventButton=d)}mousemoveWindow(a,c){const d=this._lastPoint;if(d){if(a.preventDefault(),function(_,x){const E=ms[x];return _.buttons===void 0||(_.buttons&E)!==E}(a,this._eventButton))this.reset();else if(this._moved||!(c.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(d,c)}}mouseupWindow(a){this._lastPoint&&R.mouseButton(a)===this._eventButton&&(this._moved&&R.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xe extends Pn{mousedown(a,c){super.mousedown(a,c),this._lastPoint&&(this._active=!0)}_correctButton(a,c){return c===0&&!a.ctrlKey}_move(a,c){return{around:c,panDelta:c.sub(a)}}}class Ll extends Pn{_correctButton(a,c){return c===0&&a.ctrlKey||c===2}_move(a,c){const d=.8*(c.x-a.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(a){a.preventDefault()}}class La extends Pn{_correctButton(a,c){return c===0&&a.ctrlKey||c===2}_move(a,c){const d=-.5*(c.y-a.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(a){a.preventDefault()}}class gs{constructor(a){this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.pointGeometry(0,0)}touchstart(a,c,d){return this._calculateTransform(a,c,d)}touchmove(a,c,d){if(this._active&&!(d.length<this._minTouches))return a.preventDefault(),this._calculateTransform(a,c,d)}touchend(a,c,d){this._calculateTransform(a,c,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,c,d){d.length>0&&(this._active=!0);const _=kl(d,c),x=new h.pointGeometry(0,0),E=new h.pointGeometry(0,0);let S=0;for(const D in _){const F=_[D],N=this._touches[D];N&&(x._add(F),E._add(F.sub(N)),S++,_[D]=F)}if(this._touches=_,S<this._minTouches||!E.mag())return;const A=E.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(a){}_move(a,c,d){return{}}touchstart(a,c,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([c[0],c[1]]))}touchmove(a,c,d){if(!this._firstTwoTouches)return;a.preventDefault();const[_,x]=this._firstTwoTouches,E=Fe(d,c,_),S=Fe(d,c,x);if(!E||!S)return;const A=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],A,a)}touchend(a,c,d){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,E=Fe(d,c,_),S=Fe(d,c,x);E&&S||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fe(m,a,c){for(let d=0;d<m.length;d++)if(m[d].identifier===c)return a[d]}function ho(m,a){return Math.log(m/a)/Math.LN2}class sf extends lo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,c){const d=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(ho(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ho(this._distance,d),pinchAround:c}}}function _c(m,a){return 180*m.angleWith(a)/Math.PI}class Ol extends lo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,c){const d=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_c(this._vector,d),pinchAround:c}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const c=25/(Math.PI*this._minDiameter)*360,d=_c(a,this._startVector);return Math.abs(d)<c}}function co(m){return Math.abs(m.y)>Math.abs(m.x)}class yc extends lo{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(a){this._lastPoints=a,co(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,c,d){const _=a[0].sub(this._lastPoints[0]),x=a[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(_,x,d.timeStamp),this._valid)return this._lastPoints=a,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}}gestureBeginsVertically(a,c,d){if(this._valid!==void 0)return this._valid;const _=a.mag()>=2,x=c.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const E=a.y>0==c.y>0;return co(a)&&co(c)&&E}}const of={panStep:100,bearingStep:15,pitchStep:10};class lf{constructor(){const a=of;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let c=0,d=0,_=0,x=0,E=0;switch(a.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:a.shiftKey?d=-1:(a.preventDefault(),x=-1);break;case 39:a.shiftKey?d=1:(a.preventDefault(),x=1);break;case 38:a.shiftKey?_=1:(a.preventDefault(),E=-1);break;case 40:a.shiftKey?_=-1:(a.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:zl,zoom:c?Math.round(A)+c*(a.shiftKey?2:1):A,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-E*this._panStep],center:S.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function zl(m){return m*(2-m)}const uo=4.000244140625;class Fl{constructor(a,c){this._map=a,this._el=a.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,h.bindAll(["_onTimeout"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled())return;let c=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const d=h.exported.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,c!==0&&c%uo==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(_*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),a.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=a,this._delta-=c,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=R.mousePos(this._el,a);this._around=h.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>uo?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&A!==0&&(A=1/A);const D=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(D*A))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,d=this._startZoom,_=this._easing;let x,E=!1;if(this._type==="wheel"&&d&&_){const S=Math.min((h.exported.now()-this._lastWheelEventTime)/200,1),A=_(S);x=h.number(d,c,A),S<1?this._frameId||(this._frameId=!0):E=!0}else x=c,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:x-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let c=h.ease;if(this._prevEase){const d=this._prevEase,_=(h.exported.now()-d.start)/d.duration,x=d.easing(_+.01)-d.easing(_),E=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-E*E);c=h.bezier(E,S,.25,1)}return this._prevEase={start:h.exported.now(),duration:a,easing:c},c}reset(){this._active=!1}}class Bl{constructor(a,c){this._clickZoom=a,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mi{constructor(){this.reset()}reset(){this._active=!1}dblclick(a,c){return a.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(a.shiftKey?-1:1),around:d.unproject(c)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rn{constructor(){this._tap=new Dl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(a,c,d){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=c[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(a,c,d))}touchmove(a,c,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=c[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,a.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(a,c,d)}touchend(a,c,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(a,c,d)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vc{constructor(a,c,d){this._el=a,this._mousePan=c,this._touchPan=d}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Nl{constructor(a,c,d){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=c,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ul{constructor(a,c,d,_){this._el=a,this._touchZoom=c,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oa=m=>m.zoom||m.drag||m.pitch||m.rotate;class xc extends h.Event{}function gi(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class Qt{constructor(a,c){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pc(a),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),h.bindAll(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,E]of this._listeners)R.addEventListener(_,x,_===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[a,c,d]of this._listeners)R.removeEventListener(a,c,a===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(a){const c=this._map,d=c.getCanvasContainer();this._add("mapEvent",new mc(c,a));const _=c.boxZoom=new ps(c,a);this._add("boxZoom",_);const x=new gc,E=new mi;c.doubleClickZoom=new Bl(E,x),this._add("tapZoom",x),this._add("clickZoom",E);const S=new Rn;this._add("tapDragZoom",S);const A=c.touchPitch=new yc;this._add("touchPitch",A);const D=new Ll(a),F=new La(a);c.dragRotate=new Nl(a,D,F),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const N=new Xe(a),Z=new gs(a);c.dragPan=new vc(d,N,Z),this._add("mousePan",N),this._add("touchPan",Z,["touchZoom","touchRotate"]);const Y=new Ol,q=new sf;c.touchZoomRotate=new Ul(d,q,Y,S),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]);const Q=c.scrollZoom=new Fl(c,this);this._add("scrollZoom",Q,["mousePan"]);const ne=c.keyboard=new lf;this._add("keyboard",ne),this._add("blockableMapEvent",new Da(c));for(const se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[se]&&c[se].enable(a[se])}_add(a,c,d){this._handlers.push({handlerName:a,handler:c,allowed:d}),this._handlersById[a]=c}stop(a){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Oa(this._eventsInProgress))||this.isZooming()}_blockedByActive(a,c,d){for(const _ in a)if(_!==d&&(!c||c.indexOf(_)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const c=[];for(const d of a)this._el.contains(d.target)&&c.push(d);return c}handleEvent(a,c){if(a.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const d=a.type==="renderFrame"?void 0:a,_={needsRenderFrame:!1},x={},E={},S=a.touches,A=S?this._getMapTouches(S):void 0,D=A?R.touchPos(this._el,A):R.mousePos(this._el,a);for(const{handlerName:Z,handler:Y,allowed:q}of this._handlers){if(!Y.isEnabled())continue;let Q;this._blockedByActive(E,q,Z)?Y.reset():Y[c||a.type]&&(Q=Y[c||a.type](a,D,A),this.mergeHandlerResult(_,x,Q,Z,d),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||Y.isActive())&&(E[Z]=Y)}const F={};for(const Z in this._previousActiveHandlers)E[Z]||(F[Z]=d);this._previousActiveHandlers=E,(Object.keys(F).length||gi(_))&&(this._changes.push([_,x,F]),this._triggerRenderFrame()),(Object.keys(E).length||gi(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=_;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(a,c,d,_,x){if(!d)return;h.extend(a,d);const E={handlerName:_,originalEvent:d.originalEvent||x};d.zoomDelta!==void 0&&(c.zoom=E),d.panDelta!==void 0&&(c.drag=E),d.pitchDelta!==void 0&&(c.pitch=E),d.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){const a={},c={},d={};for(const[_,x,E]of this._changes)_.panDelta&&(a.panDelta=(a.panDelta||new h.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(a.around=_.around),_.pinchAround!==void 0&&(a.pinchAround=_.pinchAround),_.noInertia&&(a.noInertia=_.noInertia),h.extend(c,x),h.extend(d,E);this._updateMapTransform(a,c,d),this._changes=[]}_updateMapTransform(a,c,d){const _=this._map,x=_.transform;if(!gi(a))return this._fireEvents(c,d,!0);let{panDelta:E,zoomDelta:S,bearingDelta:A,pitchDelta:D,around:F,pinchAround:N}=a;N!==void 0&&(F=N),_._stop(!0),F=F||_.transform.centerPoint;const Z=x.pointLocation(E?F.sub(E):F);A&&(x.bearing+=A),D&&(x.pitch+=D),S&&(x.zoom+=S),x.setLocationAtPoint(Z,F),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(c,d,!0)}_fireEvents(a,c,d){const _=Oa(this._eventsInProgress),x=Oa(a),E={};for(const F in a){const{originalEvent:N}=a[F];this._eventsInProgress[F]||(E[`${F}start`]=N),this._eventsInProgress[F]=a[F]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const F in E)this._fireEvent(F,E[F]);x&&this._fireEvent("move",x.originalEvent);for(const F in a){const{originalEvent:N}=a[F];this._fireEvent(F,N)}const S={};let A;for(const F in this._eventsInProgress){const{handlerName:N,originalEvent:Z}=this._eventsInProgress[F];this._handlersById[N].isActive()||(delete this._eventsInProgress[F],A=c[N]||Z,S[`${F}end`]=A)}for(const F in S)this._fireEvent(F,S[F]);const D=Oa(this._eventsInProgress);if(d&&(_||x)&&!D){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=Z=>Z!==0&&-this._bearingSnap<Z&&Z<this._bearingSnap;F?(N(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:A})):(this._map.fire(new h.Event("moveend",{originalEvent:A})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,c){this._map.fire(new h.Event(a,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new xc("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fo={extend:(m,...a)=>h.extend(m,...a),run(m){m()},logToElement(m,a=!1,c="log"){const d=window.document.getElementById(c);d&&(a&&(d.innerHTML=""),d.innerHTML+=`<br>${m}`)}};class Gl extends h.Evented{constructor(a,c){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=c.bearingSnap,h.bindAll(["_renderFrameCallback"],this)}getCenter(){return new h.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,c){return this.jumpTo({center:a},c)}panBy(a,c,d){return a=h.pointGeometry.convert(a).mult(-1),this.panTo(this.transform.center,h.extend({offset:a},c),d)}panTo(a,c,d){return this.easeTo(h.extend({center:a},c),d)}getZoom(){return this.transform.zoom}setZoom(a,c){return this.jumpTo({zoom:a},c),this}zoomTo(a,c,d){return this.easeTo(h.extend({zoom:a},c),d)}zoomIn(a,c){return this.zoomTo(this.getZoom()+1,a,c),this}zoomOut(a,c){return this.zoomTo(this.getZoom()-1,a,c),this}getBearing(){return this.transform.bearing}setBearing(a,c){return this.jumpTo({bearing:a},c),this}getPadding(){return this.transform.padding}setPadding(a,c){return this.jumpTo({padding:a},c),this}rotateTo(a,c,d){return this.easeTo(h.extend({bearing:a},c),d)}resetNorth(a,c){return this.rotateTo(0,h.extend({duration:1e3},a),c),this}resetNorthPitch(a,c){return this.easeTo(h.extend({bearing:0,pitch:0,duration:1e3},a),c),this}snapToNorth(a,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,c):this}getPitch(){return this.transform.pitch}setPitch(a,c){return this.jumpTo({pitch:a},c),this}cameraForBounds(a,c){a=h.LngLatBounds.convert(a);const d=c&&c.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),d,c)}_cameraForBoxAndBearing(a,c,d,_){const x={top:0,bottom:0,right:0,left:0};if(typeof(_=h.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},_)).padding=="number"){const pe=_.padding;_.padding={top:pe,bottom:pe,right:pe,left:pe}}_.padding=h.extend(x,_.padding);const E=this.transform,S=E.padding,A=E.project(h.LngLat.convert(a)),D=E.project(h.LngLat.convert(c)),F=A.rotate(-d*Math.PI/180),N=D.rotate(-d*Math.PI/180),Z=new h.pointGeometry(Math.max(F.x,N.x),Math.max(F.y,N.y)),Y=new h.pointGeometry(Math.min(F.x,N.x),Math.min(F.y,N.y)),q=Z.sub(Y),Q=(E.width-(S.left+S.right+_.padding.left+_.padding.right))/q.x,ne=(E.height-(S.top+S.bottom+_.padding.top+_.padding.bottom))/q.y;if(ne<0||Q<0)return void h.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(E.scaleZoom(E.scale*Math.min(Q,ne)),_.maxZoom),ue=h.pointGeometry.convert(_.offset),he=new h.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(d*Math.PI/180),Ee=ue.add(he).mult(E.scale/E.zoomScale(se));return{center:E.unproject(A.add(D).div(2).sub(Ee)),zoom:se,bearing:d}}fitBounds(a,c,d){return this._fitInternal(this.cameraForBounds(a,c),c,d)}fitScreenCoordinates(a,c,d,_,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(h.pointGeometry.convert(a)),this.transform.pointLocation(h.pointGeometry.convert(c)),d,_),_,x)}_fitInternal(a,c,d){return a?(delete(c=h.extend(a,c)).padding,c.linear?this.easeTo(c,d):this.flyTo(c,d)):this}jumpTo(a,c){this.stop();const d=this.transform;let _=!1,x=!1,E=!1;return"zoom"in a&&d.zoom!==+a.zoom&&(_=!0,d.zoom=+a.zoom),a.center!==void 0&&(d.center=h.LngLat.convert(a.center)),"bearing"in a&&d.bearing!==+a.bearing&&(x=!0,d.bearing=+a.bearing),"pitch"in a&&d.pitch!==+a.pitch&&(E=!0,d.pitch=+a.pitch),a.padding==null||d.isPaddingEqual(a.padding)||(d.padding=a.padding),this.fire(new h.Event("movestart",c)).fire(new h.Event("move",c)),_&&this.fire(new h.Event("zoomstart",c)).fire(new h.Event("zoom",c)).fire(new h.Event("zoomend",c)),x&&this.fire(new h.Event("rotatestart",c)).fire(new h.Event("rotate",c)).fire(new h.Event("rotateend",c)),E&&this.fire(new h.Event("pitchstart",c)).fire(new h.Event("pitch",c)).fire(new h.Event("pitchend",c)),this.fire(new h.Event("moveend",c))}easeTo(a,c){this._stop(!1,a.easeId),((a=h.extend({offset:[0,0],duration:500,easing:h.ease},a)).animate===!1||!a.essential&&h.exported.prefersReducedMotion)&&(a.duration=0);const d=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),A="zoom"in a?+a.zoom:_,D="bearing"in a?this._normalizeBearing(a.bearing,x):x,F="pitch"in a?+a.pitch:E,N="padding"in a?a.padding:d.padding,Z=h.pointGeometry.convert(a.offset);let Y=d.centerPoint.add(Z);const q=d.pointLocation(Y),Q=h.LngLat.convert(a.center||q);this._normalizeCenter(Q);const ne=d.project(q),se=d.project(Q).sub(ne),ue=d.zoomScale(A-_);let he,Ee;a.around&&(he=h.LngLat.convert(a.around),Ee=d.locationPoint(he));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==_,this._rotating=this._rotating||x!==D,this._pitching=this._pitching||F!==E,this._padding=!d.isPaddingEqual(N),this._easeId=a.easeId,this._prepareEase(c,a.noMoveStart,pe),this._ease(ve=>{if(this._zooming&&(d.zoom=h.number(_,A,ve)),this._rotating&&(d.bearing=h.number(x,D,ve)),this._pitching&&(d.pitch=h.number(E,F,ve)),this._padding&&(d.interpolatePadding(S,N,ve),Y=d.centerPoint.add(Z)),he)d.setLocationAtPoint(he,Ee);else{const Ie=d.zoomScale(d.zoom-_),Re=A>_?Math.min(2,ue):Math.max(.5,ue),Me=Math.pow(Re,1-ve),We=d.unproject(ne.add(se.mult(ve*Me)).mult(Ie));d.setLocationAtPoint(d.renderWorldCopies?We.wrap():We,Y)}this._fireMoveEvents(c)},ve=>{this._afterEase(c,ve)},a),this}_prepareEase(a,c,d={}){this._moving=!0,c||d.moving||this.fire(new h.Event("movestart",a)),this._zooming&&!d.zooming&&this.fire(new h.Event("zoomstart",a)),this._rotating&&!d.rotating&&this.fire(new h.Event("rotatestart",a)),this._pitching&&!d.pitching&&this.fire(new h.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new h.Event("move",a)),this._zooming&&this.fire(new h.Event("zoom",a)),this._rotating&&this.fire(new h.Event("rotate",a)),this._pitching&&this.fire(new h.Event("pitch",a))}_afterEase(a,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const d=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new h.Event("zoomend",a)),_&&this.fire(new h.Event("rotateend",a)),x&&this.fire(new h.Event("pitchend",a)),this.fire(new h.Event("moveend",a))}flyTo(a,c){if(!a.essential&&h.exported.prefersReducedMotion){const xt=h.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xt,c)}this.stop(),a=h.extend({offset:[0,0],speed:1.2,curve:1.42,easing:h.ease},a);const d=this.transform,_=this.getZoom(),x=this.getBearing(),E=this.getPitch(),S=this.getPadding(),A="zoom"in a?h.clamp(+a.zoom,d.minZoom,d.maxZoom):_,D="bearing"in a?this._normalizeBearing(a.bearing,x):x,F="pitch"in a?+a.pitch:E,N="padding"in a?a.padding:d.padding,Z=d.zoomScale(A-_),Y=h.pointGeometry.convert(a.offset);let q=d.centerPoint.add(Y);const Q=d.pointLocation(q),ne=h.LngLat.convert(a.center||Q);this._normalizeCenter(ne);const se=d.project(Q),ue=d.project(ne).sub(se);let he=a.curve;const Ee=Math.max(d.width,d.height),pe=Ee/Z,ve=ue.mag();if("minZoom"in a){const xt=h.clamp(Math.min(a.minZoom,_,A),d.minZoom,d.maxZoom),fr=Ee/d.zoomScale(xt-_);he=Math.sqrt(fr/ve*2)}const Ie=he*he;function Re(xt){const fr=(pe*pe-Ee*Ee+(xt?-1:1)*Ie*Ie*ve*ve)/(2*(xt?pe:Ee)*Ie*ve);return Math.log(Math.sqrt(fr*fr+1)-fr)}function Me(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function We(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const $e=Re(0);let ht=function(xt){return We($e)/We($e+he*xt)},Dt=function(xt){return Ee*((We($e)*(Me(fr=$e+he*xt)/We(fr))-Me($e))/Ie)/ve;var fr},vt=(Re(1)-$e)/he;if(Math.abs(ve)<1e-6||!isFinite(vt)){if(Math.abs(Ee-pe)<1e-6)return this.easeTo(a,c);const xt=pe<Ee?-1:1;vt=Math.abs(Math.log(pe/Ee))/he,Dt=function(){return 0},ht=function(fr){return Math.exp(xt*he*fr)}}return a.duration="duration"in a?+a.duration:1e3*vt/("screenSpeed"in a?+a.screenSpeed/he:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=x!==D,this._pitching=F!==E,this._padding=!d.isPaddingEqual(N),this._prepareEase(c,!1),this._ease(xt=>{const fr=xt*vt,ut=1/ht(fr);d.zoom=xt===1?A:_+d.scaleZoom(ut),this._rotating&&(d.bearing=h.number(x,D,xt)),this._pitching&&(d.pitch=h.number(E,F,xt)),this._padding&&(d.interpolatePadding(S,N,xt),q=d.centerPoint.add(Y));const Tt=xt===1?ne:d.unproject(se.add(ue.mult(Dt(fr))).mult(ut));d.setLocationAtPoint(d.renderWorldCopies?Tt.wrap():Tt,q),this._fireMoveEvents(c)},()=>this._afterEase(c),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,c)}if(!a){const d=this.handlers;d&&d.stop(!1)}return this}_ease(a,c,d){d.animate===!1||d.duration===0?(a(1),c()):(this._easeStart=h.exported.now(),this._easeOptions=d,this._onEaseFrame=a,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((h.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,c){a=h.wrap(a,-180,180);const d=Math.abs(a-c);return Math.abs(a-360-c)<d&&(a-=360),Math.abs(a+360-c)<d&&(a+=360),a}_normalizeCenter(a){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const d=a.lng-c.center.lng;a.lng+=d>180?-360:d<-180?360:0}}class Vl{constructor(a={}){this.options=a,h.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options&&this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,c){const d=this._map._getUIString(`AttributionControl.${c}`);a.title=d,a.setAttribute("aria-label",d)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(a){!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(_=>typeof _!="string"?"":_)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const c=this._map.style.sourceCaches;for(const _ in c){const x=c[_];if(x.used){const E=x.getSource();E.attribution&&a.indexOf(E.attribution)<0&&a.push(E.attribution)}}a=a.filter(_=>String(_).trim()),a.sort((_,x)=>_.length-x.length),a=a.filter((_,x)=>{for(let E=x+1;E<a.length;E++)if(a[E].indexOf(_)>=0)return!1;return!0});const d=a.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,a.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class bc{constructor(){h.bindAll(["_updateLogo"],this),h.bindAll(["_updateCompact"],this)}onAdd(a){this._map=a,this._container=R.create("div","maplibregl-ctrl mapboxgl-ctrl");const c=R.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(void 0),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&a.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return;const a=this._map.style.sourceCaches;for(const c in a)if(a[c].getSource().maplibreLogo)return!0;return!1}_updateCompact(){const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("maplibregl-compact","mapboxgl-compact"):c.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class wc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const c=++this._id;return this._queue.push({callback:a,id:c,cancelled:!1}),c}remove(a){const c=this._currentlyRunning,d=c?this._queue.concat(c):this._queue;for(const _ of d)if(_.id===a)return void(_.cancelled=!0)}run(a=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const d of c)if(!d.cancelled&&(d.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const hf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Qi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},po={showCompass:!0,showZoom:!0,visualizePitch:!1};class Je{constructor(a,c,d=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Ll({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,d&&(this.mousePitch=new La({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),h.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),R.addEventListener(c,"mousedown",this.mousedown),R.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(c,"touchmove",this.touchmove),R.addEventListener(c,"touchend",this.touchend),R.addEventListener(c,"touchcancel",this.reset)}down(a,c){this.mouseRotate.mousedown(a,c),this.mousePitch&&this.mousePitch.mousedown(a,c),R.disableDrag()}move(a,c){const d=this.map,_=this.mouseRotate.mousemoveWindow(a,c);if(_&&_.bearingDelta&&d.setBearing(d.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(a,c);x&&x.pitchDelta&&d.setPitch(d.getPitch()+x.pitchDelta)}}off(){const a=this.element;R.removeEventListener(a,"mousedown",this.mousedown),R.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(a,"touchmove",this.touchmove),R.removeEventListener(a,"touchend",this.touchend),R.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup)}mousedown(a){this.down(h.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),R.mousePos(this.element,a)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)}mousemove(a){this.move(a,R.mousePos(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){a.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){a.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){a.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function st(m,a,c){if(m=new h.LngLat(m.lng,m.lat),a){const d=new h.LngLat(m.lng-360,m.lat),_=new h.LngLat(m.lng+360,m.lat),x=c.locationPoint(m).distSqr(a);c.locationPoint(d).distSqr(a)<x?m=d:c.locationPoint(_).distSqr(a)<x&&(m=_)}for(;Math.abs(m.lng-c.center.lng)>180;){const d=c.locationPoint(m);if(d.x>=0&&d.y>=0&&d.x<=c.width&&d.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const za={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function mo(m,a,c){const d=m.classList;for(const _ in za)d.remove(`maplibregl-${c}-anchor-${_}`,`mapboxgl-${c}-anchor-${_}`);d.add(`maplibregl-${c}-anchor-${a}`,`mapboxgl-${c}-anchor-${a}`)}class _s extends h.Evented{constructor(a,c){if(super(),(a instanceof HTMLElement||c)&&(a=h.extend({element:a},c)),h.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,a&&a.element)this._element=a.element,this._offset=h.pointGeometry.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const d=R.createNS("http://www.w3.org/2000/svg","svg"),_=41,x=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${_}px`),d.setAttributeNS(null,"width",`${x}px`),d.setAttributeNS(null,"viewBox",`0 0 ${x} ${_}`);const E=R.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"stroke","none"),E.setAttributeNS(null,"stroke-width","1"),E.setAttributeNS(null,"fill","none"),E.setAttributeNS(null,"fill-rule","evenodd");const S=R.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const A=R.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ue of D){const he=R.createNS("http://www.w3.org/2000/svg","ellipse");he.setAttributeNS(null,"opacity","0.04"),he.setAttributeNS(null,"cx","10.5"),he.setAttributeNS(null,"cy","5.80029008"),he.setAttributeNS(null,"rx",ue.rx),he.setAttributeNS(null,"ry",ue.ry),A.appendChild(he)}const F=R.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const N=R.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(N);const Z=R.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const Y=R.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(Y);const q=R.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),q.setAttributeNS(null,"fill","#FFFFFF");const Q=R.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=R.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const se=R.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ne),Q.appendChild(se),S.appendChild(A),S.appendChild(F),S.appendChild(Z),S.appendChild(q),S.appendChild(Q),d.appendChild(S),d.setAttributeNS(null,"height",_*this._scale+"px"),d.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(d),this._offset=h.pointGeometry.convert(a&&a.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),mo(this._element,this._anchor,"marker"),this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=h.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const c=38.1,d=13.5,_=Math.sqrt(Math.pow(d,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[_,-1*(c-d+_)],"bottom-right":[-_,-1*(c-d+_)],left:[d,-1*(c-d)],right:[-d,-1*(c-d)]}:this._offset}this._popup=a,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(a){const c=a.code,d=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(a){const c=a.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?a.remove():a.addTo(this._map),this):this}_update(a){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=st(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),a&&a.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${za[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`)}getOffset(){return this._offset}setOffset(a){return this._offset=h.pointGeometry.convert(a),this._update(),this}_onMove(a){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.Event("dragstart"))),this.fire(new h.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.Event("dragend")),this._state="inactive"}_addDragHandler(a){this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const _i={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let fn,Mi=0,ys=!1;const go={maxWidth:100,unit:"metric"};function cr(m,a,c){const d=c&&c.maxWidth||100,_=m._container.clientHeight/2,x=m.unproject([0,_]),E=m.unproject([d,_]),S=x.distanceTo(E);if(c&&c.unit==="imperial"){const A=3.2808*S;A>5280?ur(a,d,A/5280,m._getUIString("ScaleControl.Miles")):ur(a,d,A,m._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?ur(a,d,S/1852,m._getUIString("ScaleControl.NauticalMiles")):S>=1e3?ur(a,d,S/1e3,m._getUIString("ScaleControl.Kilometers")):ur(a,d,S,m._getUIString("ScaleControl.Meters"))}function ur(m,a,c,d){const _=function(x){const E=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/E;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(S),E*S}(c);m.style.width=a*(_/c)+"px",m.innerHTML=`${_}&nbsp;${d}`}const Ec={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _o(m){if(m){if(typeof m=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(m,2)));return{center:new h.pointGeometry(0,0),top:new h.pointGeometry(0,m),"top-left":new h.pointGeometry(a,a),"top-right":new h.pointGeometry(-a,a),bottom:new h.pointGeometry(0,-m),"bottom-left":new h.pointGeometry(a,-a),"bottom-right":new h.pointGeometry(-a,-a),left:new h.pointGeometry(m,0),right:new h.pointGeometry(-m,0)}}if(m instanceof h.pointGeometry||Array.isArray(m)){const a=h.pointGeometry.convert(m);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:h.pointGeometry.convert(m.center||[0,0]),top:h.pointGeometry.convert(m.top||[0,0]),"top-left":h.pointGeometry.convert(m["top-left"]||[0,0]),"top-right":h.pointGeometry.convert(m["top-right"]||[0,0]),bottom:h.pointGeometry.convert(m.bottom||[0,0]),"bottom-left":h.pointGeometry.convert(m["bottom-left"]||[0,0]),"bottom-right":h.pointGeometry.convert(m["bottom-right"]||[0,0]),left:h.pointGeometry.convert(m.left||[0,0]),right:h.pointGeometry.convert(m.right||[0,0])}}return _o(new h.pointGeometry(0,0))}const xs={supported:b,setRTLTextPlugin:h.setRTLTextPlugin,getRTLTextPluginStatus:h.getRTLTextPluginStatus,Map:class extends Gl{constructor(m){var a;if(h.PerformanceUtils.mark(h.PerformanceMarkers.create),(m=h.extend({},Qi,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new so(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),{bearingSnap:m.bearingSnap}),this._interactive=m.interactive,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._renderTaskQueue=new wc,this._controls=[],this._mapId=h.uniqueId(),this._locale=h.extend({},hf,m.locale),this._clickTolerance=m.clickTolerance,this._pixelRatio=(a=m.pixelRatio)!==null&&a!==void 0?a:devicePixelRatio,this._requestManager=new U(m.transformRequest),typeof m.container=="string"){if(this._container=document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(m.maxBounds&&this.setMaxBounds(m.maxBounds),h.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Qt(this,m),this._hash=m.hash&&new cc(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,h.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localIdeographFontFamily:m.localIdeographFontFamily}),m.attributionControl&&this.addControl(new Vl({customAttribution:m.customAttribution})),this.addControl(new bc,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new h.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new h.Event(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new h.Event("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(m,a){if(a===void 0&&(a=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const d=this._controlPositions[a];return a.indexOf("bottom")!==-1?d.insertBefore(c,d.firstChild):d.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new h.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(m);return a>-1&&this._controls.splice(a,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}resize(m){const a=this._containerDimensions(),c=a[0],d=a[1];this._resizeCanvas(c,d,this.getPixelRatio()),this.transform.resize(c,d),this.painter.resize(c,d,this.getPixelRatio());const _=!this._moving;return _&&(this.stop(),this.fire(new h.Event("movestart",m)).fire(new h.Event("move",m))),this.fire(new h.Event("resize",m)),_&&this.fire(new h.Event("moveend",m)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(m){const[a,c]=this._containerDimensions();this._pixelRatio=m,this._resizeCanvas(a,c,m),this.painter.resize(a,c,m)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(h.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m==null?60:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}project(m){return this.transform.locationPoint(h.LngLat.convert(m))}unproject(m){return this.transform.pointLocation(h.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(m,a,c){if(m==="mouseenter"||m==="mouseover"){let d=!1;return{layer:a,listener:c,delegates:{mousemove:x=>{const E=this.getLayer(a)?this.queryRenderedFeatures(x.point,{layers:[a]}):[];E.length?d||(d=!0,c.call(this,new yr(m,this,x.originalEvent,{features:E}))):d=!1},mouseout:()=>{d=!1}}}}if(m==="mouseleave"||m==="mouseout"){let d=!1;return{layer:a,listener:c,delegates:{mousemove:E=>{(this.getLayer(a)?this.queryRenderedFeatures(E.point,{layers:[a]}):[]).length?d=!0:d&&(d=!1,c.call(this,new yr(m,this,E.originalEvent)))},mouseout:E=>{d&&(d=!1,c.call(this,new yr(m,this,E.originalEvent)))}}}}{const d=_=>{const x=this.getLayer(a)?this.queryRenderedFeatures(_.point,{layers:[a]}):[];x.length&&(_.features=x,c.call(this,_),delete _.features)};return{layer:a,listener:c,delegates:{[m]:d}}}}on(m,a,c){if(c===void 0)return super.on(m,a);const d=this._createDelegatedListener(m,a,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(m,a,c){if(c===void 0)return super.once(m,a);const d=this._createDelegatedListener(m,a,c);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(m,a,c){return c===void 0?super.off(m,a):(this._delegatedListeners&&this._delegatedListeners[m]&&(d=>{const _=this._delegatedListeners[m];for(let x=0;x<_.length;x++){const E=_[x];if(E.layer===a&&E.listener===c){for(const S in E.delegates)this.off(S,E.delegates[S]);return _.splice(x,1),this}}})(),this)}queryRenderedFeatures(m,a){if(!this.style)return[];let c;if(a!==void 0||m===void 0||m instanceof h.pointGeometry||Array.isArray(m)||(a=m,m=void 0),a=a||{},(m=m||[[0,0],[this.transform.width,this.transform.height]])instanceof h.pointGeometry||typeof m[0]=="number")c=[h.pointGeometry.convert(m)];else{const d=h.pointGeometry.convert(m[0]),_=h.pointGeometry.convert(m[1]);c=[d,new h.pointGeometry(_.x,d.y),_,new h.pointGeometry(d.x,_.y),d]}return this.style.queryRenderedFeatures(c,a,this.transform)}querySourceFeatures(m,a){return this.style.querySourceFeatures(m,a)}setStyle(m,a){return(a=h.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(m,a))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const a=this._locale[m];if(a==null)throw new Error(`Missing UI string '${m}'`);return a}_updateStyle(m,a){return this.style&&(this.style.setEventedParent(null),this.style._remove()),m?(this.style=new Ji(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ji(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,a){if(typeof m=="string"){const c=this._requestManager.transformRequest(m,h.ResourceType.Style);h.getJSON(c,(d,_)=>{d?this.fire(new h.ErrorEvent(d)):_&&this._updateDiff(_,a)})}else typeof m=="object"&&this._updateDiff(m,a)}_updateDiff(m,a){try{this.style.setState(m)&&this._update(!0)}catch(c){h.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(m,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.warnOnce("There is no style added to the map.")}addSource(m,a){return this._lazyInitEmptyStyle(),this.style.addSource(m,a),this._update(!0)}isSourceLoaded(m){const a=this.style&&this.style.sourceCaches[m];if(a!==void 0)return a.loaded();this.fire(new h.ErrorEvent(new Error(`There is no source with ID '${m}'`)))}areTilesLoaded(){const m=this.style&&this.style.sourceCaches;for(const a in m){const c=m[a]._tiles;for(const d in c){const _=c[d];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}addSourceType(m,a,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(m,a,c)}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,a,{pixelRatio:c=1,sdf:d=!1,stretchX:_,stretchY:x,content:E}={}){if(this._lazyInitEmptyStyle(),a instanceof HTMLImageElement||h.isImageBitmap(a)){const{width:S,height:A,data:D}=h.exported.getImageData(a);this.style.addImage(m,{data:new h.RGBAImage({width:S,height:A},D),pixelRatio:c,stretchX:_,stretchY:x,content:E,sdf:d,version:0})}else{if(a.width===void 0||a.height===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:A,data:D}=a,F=a;this.style.addImage(m,{data:new h.RGBAImage({width:S,height:A},new Uint8Array(D)),pixelRatio:c,stretchX:_,stretchY:x,content:E,sdf:d,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}}updateImage(m,a){const c=this.style.getImage(m);if(!c)return this.fire(new h.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=a instanceof HTMLImageElement||h.isImageBitmap(a)?h.exported.getImageData(a):a,{width:_,height:x,data:E}=d;if(_===void 0||x===void 0)return this.fire(new h.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==c.data.width||x!==c.data.height)return this.fire(new h.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(a instanceof HTMLImageElement||h.isImageBitmap(a));c.data.replace(E,S),this.style.updateImage(m,c)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new h.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,a){h.getImage(this._requestManager.transformRequest(m,h.ResourceType.Image),a)}listImages(){return this.style.listImages()}addLayer(m,a){return this._lazyInitEmptyStyle(),this.style.addLayer(m,a),this._update(!0)}moveLayer(m,a){return this.style.moveLayer(m,a),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,a,c){return this.style.setLayerZoomRange(m,a,c),this._update(!0)}setFilter(m,a,c={}){return this.style.setFilter(m,a,c),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,a,c,d={}){return this.style.setPaintProperty(m,a,c,d),this._update(!0)}getPaintProperty(m,a){return this.style.getPaintProperty(m,a)}setLayoutProperty(m,a,c,d={}){return this.style.setLayoutProperty(m,a,c,d),this._update(!0)}getLayoutProperty(m,a){return this.style.getLayoutProperty(m,a)}setLight(m,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(m,a){return this.style.setFeatureState(m,a),this._update()}removeFeatureState(m,a){return this.style.removeFeatureState(m,a),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,a=0;return this._container&&(m=this._container.clientWidth||400,a=this._container.clientHeight||300),[m,a]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map","mapboxgl-map");const a=this._canvasContainer=R.create("div","maplibregl-canvas-container mapboxgl-canvas-container",m);this._interactive&&a.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1],this.getPixelRatio());const d=this._controlContainer=R.create("div","maplibregl-control-container mapboxgl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=R.create("div",`maplibregl-ctrl-${x} mapboxgl-ctrl-${x}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,a,c){this._canvas.width=c*m,this._canvas.height=c*a,this._canvas.style.width=`${m}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const m=h.extend({},b.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._canvas.getContext("webgl",m)||this._canvas.getContext("experimental-webgl",m);a?(this.painter=new hc(a,this.transform),h.exported$1.testSupport(a)):this.fire(new h.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new h.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new h.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){let a,c=0;const d=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(a=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,a),c=h.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let _=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,S=h.exported.now();this.style.zoomHistory.update(E,S);const A=new h.EvaluationParameters(E,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=A.crossFadingFactor();D===1&&D===this._crossFadingFactor||(_=!0,this._crossFadingFactor=D),this.style.update(A)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new h.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.load),this.fire(new h.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const E=h.exported.now()-c;d.endQueryEXT(d.TIME_ELAPSED_EXT,a),setTimeout(()=>{const S=d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(a),this.fire(new h.Event("gpu-timing-frame",{cpuTime:E,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(E);this.fire(new h.Event("gpu-timing-layer",{layerTimes:S}))},50)}const x=this._sourcesDirty||this._styleDirty||this._placementDirty;return x||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.Event("idle")),!this._loaded||this._fullyLoaded||x||(this._fullyLoaded=!0,h.PerformanceUtils.mark(h.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),h.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new h.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=h.exported.frame(m=>{h.PerformanceUtils.frame(m),this._frame=null,this._render(m)}))}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,a){h.setCacheLimits(m,a)}},NavigationControl:class{constructor(m){this.options=h.extend({},po,m),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(h.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),R.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),R.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(h.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map.getZoom(),a=m===this._map.getMaxZoom(),c=m===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const m=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=m}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Je(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,a){const c=R.create("button",m,this._container);return c.type="button",c.addEventListener("click",a),c}_setButtonTitle(m,a){const c=this._map._getUIString(`NavigationControl.${a}`);m.title=c,m.setAttribute("aria-label",c)}},GeolocateControl:class extends h.Evented{constructor(m){super(),this.options=h.extend({},_i,m),h.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(m){var a;return this._map=m,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),a=this._setupUI,fn!==void 0?a(fn):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(c=>{fn=c.state!=="denied",a(fn)}):(fn=!!window.navigator.geolocation,a(fn)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Mi=0,ys=!1}_isOutOfMapMaxBounds(m){const a=this._map.getMaxBounds(),c=m.coords;return a&&(c.longitude<a.getWest()||c.longitude>a.getEast()||c.latitude<a.getSouth()||c.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new h.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("geolocate",m)),this._finish()}}_updateCamera(m){const a=new h.LngLat(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,d=this._map.getBearing(),_=h.extend({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(c),_,{geolocateSource:!0})}_updateMarker(m){if(m){const a=new h.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._container.clientHeight/2,a=this._map.unproject([0,m]),c=this._map.unproject([1,m]),d=a.distanceTo(c),_=Math.ceil(2*this._accuracy/d);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&ys)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new h.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){h.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new _s(this._dotElement),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _s({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a.originalEvent&&a.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new h.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return h.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Mi--,ys=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new h.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Mi++,Mi>1?(m={maximumAge:6e5,timeout:0},ys=!0):(m=this.options.positionOptions,ys=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Vl,ScaleControl:class{constructor(m){this.options=h.extend({},go,m),h.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){cr(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,cr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:h.warnOnce("Full screen control 'container' must be a DOM element.")),h.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",h.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends h.Evented{constructor(m){super(),this.options=h.extend(Object.create(Ec),m),h.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new h.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new h.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=h.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const a=document.createDocumentFragment(),c=document.createElement("body");let d;for(c.innerHTML=m;d=c.firstChild,d;)a.appendChild(d);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){this._container&&this._container.classList.add(m)}removeClassName(m){this._container&&this._container.classList.remove(m)}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(m){this._update(m.point)}_onMouseMove(m){this._update(m.point)}_onDrag(m){this._update(m.point)}_update(m){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=R.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=st(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!m))return;const a=this._pos=this._trackPointer&&m?m:this._map.project(this._lngLat);let c=this.options.anchor;const d=_o(this.options.offset);if(!c){const x=this._container.offsetWidth,E=this._container.offsetHeight;let S;S=a.y+d.bottom.y<E?["top"]:a.y>this._map.transform.height-E?["bottom"]:[],a.x<x/2?S.push("left"):a.x>this._map.transform.width-x/2&&S.push("right"),c=S.length===0?"bottom":S.join("-")}const _=a.add(d[c]).round();R.setTransform(this._container,`${za[c]} translate(${_.x}px,${_.y}px)`),mo(this._container,c,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(vs);m&&m.focus()}_onClose(){this.remove()}},Marker:_s,Style:Ji,LngLat:h.LngLat,LngLatBounds:h.LngLatBounds,Point:h.pointGeometry,MercatorCoordinate:h.MercatorCoordinate,Evented:h.Evented,AJAXError:h.AJAXError,config:h.config,CanvasSource:Rr,GeoJSONSource:Fi,ImageSource:Nr,RasterDEMTileSource:qr,RasterTileSource:Er,VectorTileSource:Zt,VideoSource:Ur,prewarm:function(){Vi().acquire(En)},clearPrewarmedResources:function(){const m=Ei;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(En),Ei=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return hn.workerCount},set workerCount(m){hn.workerCount=m},get maxParallelImageRequests(){return h.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){h.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){h.clearTileCache(m)},workerUrl:"",addProtocol(m,a){h.config.REGISTERED_PROTOCOLS[m]=a},removeProtocol(m){delete h.config.REGISTERED_PROTOCOLS[m]}};return fo.extend(xs,{isSafari:h.isSafari,getPerformanceMetrics:h.PerformanceUtils.getPerformanceMetrics}),xs});var g=s;return g})})(gy);var rS=gy.exports;class $P extends b_{constructor(t){const e=Object.assign({},t);delete e.maplibreOptions;super(e);const n=document.createElement("div");n.style.position="absolute",n.style.width="100%",n.style.height="100%",this.maplibreMap=new rS.Map(Object.assign({},t.maplibreOptions,{container:n,attributionControl:!1,interactive:!1})),this.applyOpacity_()}setOpacity(t){super.setOpacity(t),this.applyOpacity_()}applyOpacity_(){const t=this.maplibreMap.getCanvas(),e=this.getOpacity().toString();e!==t.style.opacity&&(t.style.opacity=e)}render(t){const e=t.viewState;this.maplibreMap.jumpTo({center:r1(e.center),zoom:e.zoom-1,bearing:wx(-e.rotation),animate:!1});const n=this.maplibreMap.getCanvas();return(n.width!==t.size[0]||n.height!==t.size[1])&&this.maplibreMap.resize(),this.maplibreMap.redraw(),this.maplibreMap.getContainer()}}function iS(r){r("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),r("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),r("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),r.WGS84=r["EPSG:4326"],r["EPSG:3785"]=r["EPSG:3857"],r.GOOGLE=r["EPSG:3857"],r["EPSG:900913"]=r["EPSG:3857"],r["EPSG:102113"]=r["EPSG:3857"]}var Us=1,Gs=2,zu=3,nS=4,up=5,yy=6378137,aS=6356752314e-3,vy=.0066943799901413165,Ch=484813681109536e-20,Le=Math.PI/2,sS=.16666666666666666,oS=.04722222222222222,lS=.022156084656084655,Ke=1e-10,hi=.017453292519943295,$n=57.29577951308232,qt=Math.PI/4,Ih=Math.PI*2,Or=3.14159265359,Ui={};Ui.greenwich=0;Ui.lisbon=-9.131906111111;Ui.paris=2.337229166667;Ui.bogota=-74.080916666667;Ui.madrid=-3.687938888889;Ui.rome=12.452333333333;Ui.bern=7.439583333333;Ui.jakarta=106.807719444444;Ui.ferro=-17.666666666667;Ui.brussels=4.367975;Ui.stockholm=18.058277777778;Ui.athens=23.7163375;Ui.oslo=10.722916666667;var hS={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},xy=/[\s_\-\/\(\)]/g;function Ha(r,t){if(r[t])return r[t];for(var e=Object.keys(r),n=t.toLowerCase().replace(xy,""),s=-1,u,g;++s<e.length;)if(u=e[s],g=u.toLowerCase().replace(xy,""),g===n)return r[u]}function fp(r){var t={},e=r.split("+").map(function(h){return h.trim()}).filter(function(h){return h}).reduce(function(h,b){var T=b.split("=");return T.push(!0),h[T[0].toLowerCase()]=T[1],h},{}),n,s,u,g={proj:"projName",datum:"datumCode",rf:function(h){t.rf=parseFloat(h)},lat_0:function(h){t.lat0=h*hi},lat_1:function(h){t.lat1=h*hi},lat_2:function(h){t.lat2=h*hi},lat_ts:function(h){t.lat_ts=h*hi},lon_0:function(h){t.long0=h*hi},lon_1:function(h){t.long1=h*hi},lon_2:function(h){t.long2=h*hi},alpha:function(h){t.alpha=parseFloat(h)*hi},gamma:function(h){t.rectified_grid_angle=parseFloat(h)},lonc:function(h){t.longc=h*hi},x_0:function(h){t.x0=parseFloat(h)},y_0:function(h){t.y0=parseFloat(h)},k_0:function(h){t.k0=parseFloat(h)},k:function(h){t.k0=parseFloat(h)},a:function(h){t.a=parseFloat(h)},b:function(h){t.b=parseFloat(h)},r_a:function(){t.R_A=!0},zone:function(h){t.zone=parseInt(h,10)},south:function(){t.utmSouth=!0},towgs84:function(h){t.datum_params=h.split(",").map(function(b){return parseFloat(b)})},to_meter:function(h){t.to_meter=parseFloat(h)},units:function(h){t.units=h;var b=Ha(hS,h);b&&(t.to_meter=b.to_meter)},from_greenwich:function(h){t.from_greenwich=h*hi},pm:function(h){var b=Ha(Ui,h);t.from_greenwich=(b||parseFloat(h))*hi},nadgrids:function(h){h==="@null"?t.datumCode="none":t.nadgrids=h},axis:function(h){var b="ewnsud";h.length===3&&b.indexOf(h.substr(0,1))!==-1&&b.indexOf(h.substr(1,1))!==-1&&b.indexOf(h.substr(2,1))!==-1&&(t.axis=h)},approx:function(){t.approx=!0}};for(n in e)s=e[n],n in g?(u=g[n],typeof u=="function"?u(s):t[u]=s):t[n]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}var Ph=1,by=2,wy=3,Fu=4,Ey=5,dp=-1,cS=/\s/,uS=/[A-Za-z]/,fS=/[A-Za-z84_]/,Bu=/[,\]]/,Ty=/[\d\.E\-\+]/;function wa(r){if(typeof r!="string")throw new Error("not a string");this.text=r.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Ph}wa.prototype.readCharicter=function(){var r=this.text[this.place++];if(this.state!==Fu)for(;cS.test(r);){if(this.place>=this.text.length)return;r=this.text[this.place++]}switch(this.state){case Ph:return this.neutral(r);case by:return this.keyword(r);case Fu:return this.quoted(r);case Ey:return this.afterquote(r);case wy:return this.number(r);case dp:return}};wa.prototype.afterquote=function(r){if(r==='"'){this.word+='"',this.state=Fu;return}if(Bu.test(r)){this.word=this.word.trim(),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in afterquote yet, index '+this.place)};wa.prototype.afterItem=function(r){if(r===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=Ph;return}if(r==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=Ph,this.currentObject=this.stack.pop(),this.currentObject||(this.state=dp);return}};wa.prototype.number=function(r){if(Ty.test(r)){this.word+=r;return}if(Bu.test(r)){this.word=parseFloat(this.word),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in number yet, index '+this.place)};wa.prototype.quoted=function(r){if(r==='"'){this.state=Ey;return}this.word+=r};wa.prototype.keyword=function(r){if(fS.test(r)){this.word+=r;return}if(r==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=Ph;return}if(Bu.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in keyword yet, index '+this.place)};wa.prototype.neutral=function(r){if(uS.test(r)){this.word=r,this.state=by;return}if(r==='"'){this.word="",this.state=Fu;return}if(Ty.test(r)){this.word=r,this.state=wy;return}if(Bu.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in neutral yet, index '+this.place)};wa.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===dp)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function dS(r){var t=new wa(r);return t.output()}function My(r,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:r,s=e.reduce(function(u,g){return Jo(g,u),u},n);t&&(r[t]=s)}function Jo(r,t){if(!Array.isArray(r)){t[r]=!0;return}var e=r.shift();if(e==="PARAMETER"&&(e=r.shift()),r.length===1){if(Array.isArray(r[0])){t[e]={},Jo(r[0],t[e]);return}t[e]=r[0];return}if(!r.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=r;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(r);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:r[0].toLowerCase(),convert:r[1]},r.length===3&&Jo(r[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:r[0],a:r[1],rf:r[2]},r.length===4&&Jo(r[3],t[e]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":r[0]=["name",r[0]],My(t,e,r);return;default:for(n=-1;++n<r.length;)if(!Array.isArray(r[n]))return Jo(r,t[e]);return My(t,e,r)}}var pS=.017453292519943295;function mS(r,t){var e=t[0],n=t[1];!(e in r)&&n in r&&(r[e]=r[n],t.length===3&&(r[e]=t[2](r[e])))}function Ea(r){return r*pS}function gS(r){if(r.type==="GEOGCS"?r.projName="longlat":r.type==="LOCAL_CS"?(r.projName="identity",r.local=!0):typeof r.PROJECTION=="object"?r.projName=Object.keys(r.PROJECTION)[0]:r.projName=r.PROJECTION,r.AXIS){for(var t="",e=0,n=r.AXIS.length;e<n;++e){var s=[r.AXIS[e][0].toLowerCase(),r.AXIS[e][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?t+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?t+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?t+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(t+="w")}t.length===2&&(t+="u"),t.length===3&&(r.axis=t)}r.UNIT&&(r.units=r.UNIT.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.UNIT.convert&&(r.type==="GEOGCS"?r.DATUM&&r.DATUM.SPHEROID&&(r.to_meter=r.UNIT.convert*r.DATUM.SPHEROID.a):r.to_meter=r.UNIT.convert));var u=r.GEOGCS;r.type==="GEOGCS"&&(u=r),u&&(u.DATUM?r.datumCode=u.DATUM.name.toLowerCase():r.datumCode=u.name.toLowerCase(),r.datumCode.slice(0,2)==="d_"&&(r.datumCode=r.datumCode.slice(2)),(r.datumCode==="new_zealand_geodetic_datum_1949"||r.datumCode==="new_zealand_1949")&&(r.datumCode="nzgd49"),(r.datumCode==="wgs_1984"||r.datumCode==="world_geodetic_system_1984")&&(r.PROJECTION==="Mercator_Auxiliary_Sphere"&&(r.sphere=!0),r.datumCode="wgs84"),r.datumCode.slice(-6)==="_ferro"&&(r.datumCode=r.datumCode.slice(0,-6)),r.datumCode.slice(-8)==="_jakarta"&&(r.datumCode=r.datumCode.slice(0,-8)),~r.datumCode.indexOf("belge")&&(r.datumCode="rnb72"),u.DATUM&&u.DATUM.SPHEROID&&(r.ellps=u.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),r.ellps.toLowerCase().slice(0,13)==="international"&&(r.ellps="intl"),r.a=u.DATUM.SPHEROID.a,r.rf=parseFloat(u.DATUM.SPHEROID.rf,10)),u.DATUM&&u.DATUM.TOWGS84&&(r.datum_params=u.DATUM.TOWGS84),~r.datumCode.indexOf("osgb_1936")&&(r.datumCode="osgb36"),~r.datumCode.indexOf("osni_1952")&&(r.datumCode="osni52"),(~r.datumCode.indexOf("tm65")||~r.datumCode.indexOf("geodetic_datum_of_1965"))&&(r.datumCode="ire65"),r.datumCode==="ch1903+"&&(r.datumCode="ch1903"),~r.datumCode.indexOf("israel")&&(r.datumCode="isr93")),r.b&&!isFinite(r.b)&&(r.b=r.a);function g(T){var C=r.to_meter||1;return T*C}var h=function(T){return mS(r,T)},b=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Ea],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Ea],["x0","false_easting",g],["y0","false_northing",g],["long0","central_meridian",Ea],["lat0","latitude_of_origin",Ea],["lat0","standard_parallel_1",Ea],["lat1","standard_parallel_1",Ea],["lat2","standard_parallel_2",Ea],["azimuth","Azimuth"],["alpha","azimuth",Ea],["srsCode","name"]];b.forEach(h),!r.long0&&r.longc&&(r.projName==="Albers_Conic_Equal_Area"||r.projName==="Lambert_Azimuthal_Equal_Area")&&(r.long0=r.longc),!r.lat_ts&&r.lat1&&(r.projName==="Stereographic_South_Pole"||r.projName==="Polar Stereographic (variant B)")&&(r.lat0=Ea(r.lat1>0?90:-90),r.lat_ts=r.lat1)}function Sy(r){var t=dS(r),e=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",e]);var s={};return Jo(t,s),gS(s),s}function Oi(r){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?Oi[r]=fp(arguments[1]):Oi[r]=Sy(arguments[1]):Oi[r]=e}else if(arguments.length===1){if(Array.isArray(r))return r.map(function(n){Array.isArray(n)?Oi.apply(t,n):Oi(n)});if(typeof r=="string"){if(r in Oi)return Oi[r]}else"EPSG"in r?Oi["EPSG:"+r.EPSG]=r:"ESRI"in r?Oi["ESRI:"+r.ESRI]=r:"IAU2000"in r?Oi["IAU2000:"+r.IAU2000]=r:console.log(r);return}}iS(Oi);function _S(r){return typeof r=="string"}function yS(r){return r in Oi}var vS=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function xS(r){return vS.some(function(t){return r.indexOf(t)>-1})}var bS=["3857","900913","3785","102113"];function wS(r){var t=Ha(r,"authority");if(!!t){var e=Ha(t,"epsg");return e&&bS.indexOf(e)>-1}}function ES(r){var t=Ha(r,"extension");if(!!t)return Ha(t,"proj4")}function TS(r){return r[0]==="+"}function MS(r){if(_S(r)){if(yS(r))return Oi[r];if(xS(r)){var t=Sy(r);if(wS(t))return Oi["EPSG:3857"];var e=ES(t);return e?fp(e):t}if(TS(r))return fp(r)}else return r}function Ay(r,t){r=r||{};var e,n;if(!t)return r;for(n in t)e=t[n],e!==void 0&&(r[n]=e);return r}function jn(r,t,e){var n=r*t;return e/Math.sqrt(1-n*n)}function Rh(r){return r<0?-1:1}function Qe(r){return Math.abs(r)<=Or?r:r-Rh(r)*Ih}function bn(r,t,e){var n=r*e,s=.5*r;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(Le-t))/n}function kh(r,t){for(var e=.5*r,n,s,u=Le-2*Math.atan(t),g=0;g<=15;g++)if(n=r*Math.sin(u),s=Le-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-u,u+=s,Math.abs(s)<=1e-10)return u;return-9999}function SS(){var r=this.b/this.a;this.es=1-r*r,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=jn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function AS(r){var t=r.x,e=r.y;if(e*$n>90&&e*$n<-90&&t*$n>180&&t*$n<-180)return null;var n,s;if(Math.abs(Math.abs(e)-Le)<=Ke)return null;if(this.sphere)n=this.x0+this.a*this.k0*Qe(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(qt+.5*e));else{var u=Math.sin(e),g=bn(this.e,e,u);n=this.x0+this.a*this.k0*Qe(t-this.long0),s=this.y0-this.a*this.k0*Math.log(g)}return r.x=n,r.y=s,r}function CS(r){var t=r.x-this.x0,e=r.y-this.y0,n,s;if(this.sphere)s=Le-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var u=Math.exp(-e/(this.a*this.k0));if(s=kh(this.e,u),s===-9999)return null}return n=Qe(this.long0+t/(this.a*this.k0)),r.x=n,r.y=s,r}var IS=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"],PS={init:SS,forward:AS,inverse:CS,names:IS};function RS(){}function Cy(r){return r}var kS=["longlat","identity"],DS={init:RS,forward:Cy,inverse:Cy,names:kS},LS=[PS,DS],Nu={},Uu=[];function Iy(r,t){var e=Uu.length;return r.names?(Uu[e]=r,r.names.forEach(function(n){Nu[n.toLowerCase()]=e}),this):(console.log(t),!0)}function OS(r){if(!r)return!1;var t=r.toLowerCase();if(typeof Nu[t]!="undefined"&&Uu[Nu[t]])return Uu[Nu[t]]}function zS(){LS.forEach(Iy)}var FS={start:zS,add:Iy,get:OS},_t={};_t.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};_t.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};_t.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};_t.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};_t.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};_t.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};_t.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};_t.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};_t.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};_t.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};_t.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};_t.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};_t.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};_t.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};_t.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};_t.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};_t.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};_t.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};_t.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};_t.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};_t.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};_t.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};_t.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};_t.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};_t.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};_t.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};_t.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};_t.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};_t.hough={a:6378270,rf:297,ellipseName:"Hough"};_t.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};_t.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};_t.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};_t.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};_t.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};_t.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};_t.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};_t.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};_t.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};_t.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};_t.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};_t.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var BS=_t.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};_t.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function NS(r,t,e,n){var s=r*r,u=t*t,g=(s-u)/s,h=0;n?(r*=1-g*(sS+g*(oS+g*lS)),s=r*r,g=0):h=Math.sqrt(g);var b=(s-u)/u;return{es:g,e:h,ep2:b}}function US(r,t,e,n,s){if(!r){var u=Ha(_t,n);u||(u=BS),r=u.a,t=u.b,e=u.rf}return e&&!t&&(t=(1-1/e)*r),(e===0||Math.abs(r-t)<Ke)&&(s=!0,t=r),{a:r,b:t,rf:e,sphere:s}}var ti={};ti.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};ti.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};ti.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};ti.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};ti.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};ti.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};ti.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};ti.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};ti.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};ti.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};ti.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};ti.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};ti.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};ti.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};ti.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};ti.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};ti.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function GS(r,t,e,n,s,u,g){var h={};return r===void 0||r==="none"?h.datum_type=up:h.datum_type=nS,t&&(h.datum_params=t.map(parseFloat),(h.datum_params[0]!==0||h.datum_params[1]!==0||h.datum_params[2]!==0)&&(h.datum_type=Us),h.datum_params.length>3&&(h.datum_params[3]!==0||h.datum_params[4]!==0||h.datum_params[5]!==0||h.datum_params[6]!==0)&&(h.datum_type=Gs,h.datum_params[3]*=Ch,h.datum_params[4]*=Ch,h.datum_params[5]*=Ch,h.datum_params[6]=h.datum_params[6]/1e6+1)),g&&(h.datum_type=zu,h.grids=g),h.a=e,h.b=n,h.es=s,h.ep2=u,h}var Py={};function VS(r,t){var e=new DataView(t),n=ZS(e),s=qS(e,n);s.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var u=XS(e,s,n),g={header:s,subgrids:u};return Py[r]=g,g}function $S(r){if(r===void 0)return null;var t=r.split(",");return t.map(jS)}function jS(r){if(r.length===0)return null;var t=r[0]==="@";return t&&(r=r.slice(1)),r==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:r,mandatory:!t,grid:Py[r]||null,isNull:!1}}function Qo(r){return r/3600*Math.PI/180}function ZS(r){var t=r.getInt32(8,!1);return t===11?!1:(t=r.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function qS(r,t){return{nFields:r.getInt32(8,t),nSubgridFields:r.getInt32(24,t),nSubgrids:r.getInt32(40,t),shiftType:pp(r,56,56+8).trim(),fromSemiMajorAxis:r.getFloat64(120,t),fromSemiMinorAxis:r.getFloat64(136,t),toSemiMajorAxis:r.getFloat64(152,t),toSemiMinorAxis:r.getFloat64(168,t)}}function pp(r,t,e){return String.fromCharCode.apply(null,new Uint8Array(r.buffer.slice(t,e)))}function XS(r,t,e){for(var n=176,s=[],u=0;u<t.nSubgrids;u++){var g=HS(r,n,e),h=WS(r,n,g,e),b=Math.round(1+(g.upperLongitude-g.lowerLongitude)/g.longitudeInterval),T=Math.round(1+(g.upperLatitude-g.lowerLatitude)/g.latitudeInterval);s.push({ll:[Qo(g.lowerLongitude),Qo(g.lowerLatitude)],del:[Qo(g.longitudeInterval),Qo(g.latitudeInterval)],lim:[b,T],count:g.gridNodeCount,cvs:KS(h)})}return s}function KS(r){return r.map(function(t){return[Qo(t.longitudeShift),Qo(t.latitudeShift)]})}function HS(r,t,e){return{name:pp(r,t+8,t+16).trim(),parent:pp(r,t+24,t+24+8).trim(),lowerLatitude:r.getFloat64(t+72,e),upperLatitude:r.getFloat64(t+88,e),lowerLongitude:r.getFloat64(t+104,e),upperLongitude:r.getFloat64(t+120,e),latitudeInterval:r.getFloat64(t+136,e),longitudeInterval:r.getFloat64(t+152,e),gridNodeCount:r.getInt32(t+168,e)}}function WS(r,t,e,n){for(var s=t+176,u=16,g=[],h=0;h<e.gridNodeCount;h++){var b={latitudeShift:r.getFloat32(s+h*u,n),longitudeShift:r.getFloat32(s+h*u+4,n),latitudeAccuracy:r.getFloat32(s+h*u+8,n),longitudeAccuracy:r.getFloat32(s+h*u+12,n)};g.push(b)}return g}function Zn(r,t){if(!(this instanceof Zn))return new Zn(r);t=t||function(T){if(T)throw T};var e=MS(r);if(typeof e!="object"){t(r);return}var n=Zn.projections.get(e.projName);if(!n){t(r);return}if(e.datumCode&&e.datumCode!=="none"){var s=Ha(ti,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var u=US(e.a,e.b,e.rf,e.ellps,e.sphere),g=NS(u.a,u.b,u.rf,e.R_A),h=$S(e.nadgrids),b=e.datum||GS(e.datumCode,e.datum_params,u.a,u.b,g.es,g.ep2,h);Ay(this,e),Ay(this,n),this.a=u.a,this.b=u.b,this.rf=u.rf,this.sphere=u.sphere,this.es=g.es,this.e=g.e,this.ep2=g.ep2,this.datum=b,this.init(),t(null,this)}Zn.projections=FS;Zn.projections.start();function YS(r,t){return r.datum_type!==t.datum_type||r.a!==t.a||Math.abs(r.es-t.es)>5e-11?!1:r.datum_type===Us?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]:r.datum_type===Gs?r.datum_params[0]===t.datum_params[0]&&r.datum_params[1]===t.datum_params[1]&&r.datum_params[2]===t.datum_params[2]&&r.datum_params[3]===t.datum_params[3]&&r.datum_params[4]===t.datum_params[4]&&r.datum_params[5]===t.datum_params[5]&&r.datum_params[6]===t.datum_params[6]:!0}function Ry(r,t,e){var n=r.x,s=r.y,u=r.z?r.z:0,g,h,b,T;if(s<-Le&&s>-1.001*Le)s=-Le;else if(s>Le&&s<1.001*Le)s=Le;else{if(s<-Le)return{x:-1/0,y:-1/0,z:r.z};if(s>Le)return{x:1/0,y:1/0,z:r.z}}return n>Math.PI&&(n-=2*Math.PI),h=Math.sin(s),T=Math.cos(s),b=h*h,g=e/Math.sqrt(1-t*b),{x:(g+u)*T*Math.cos(n),y:(g+u)*T*Math.sin(n),z:(g*(1-t)+u)*h}}function ky(r,t,e,n){var s=1e-12,u=s*s,g=30,h,b,T,C,P,R,U,j,H,re,ge,ce,be,we=r.x,Ae=r.y,De=r.z?r.z:0,it,ze,lt;if(h=Math.sqrt(we*we+Ae*Ae),b=Math.sqrt(we*we+Ae*Ae+De*De),h/e<s){if(it=0,b/e<s)return ze=Le,lt=-n,{x:r.x,y:r.y,z:r.z}}else it=Math.atan2(Ae,we);T=De/b,C=h/b,P=1/Math.sqrt(1-t*(2-t)*C*C),j=C*(1-t)*P,H=T*P,be=0;do be++,U=e/Math.sqrt(1-t*H*H),lt=h*j+De*H-U*(1-t*H*H),R=t*U/(U+lt),P=1/Math.sqrt(1-R*(2-R)*C*C),re=C*(1-R)*P,ge=T*P,ce=ge*j-re*H,j=re,H=ge;while(ce*ce>u&&be<g);return ze=Math.atan(ge/Math.abs(re)),{x:it,y:ze,z:lt}}function JS(r,t,e){if(t===Us)return{x:r.x+e[0],y:r.y+e[1],z:r.z+e[2]};if(t===Gs){var n=e[0],s=e[1],u=e[2],g=e[3],h=e[4],b=e[5],T=e[6];return{x:T*(r.x-b*r.y+h*r.z)+n,y:T*(b*r.x+r.y-g*r.z)+s,z:T*(-h*r.x+g*r.y+r.z)+u}}}function QS(r,t,e){if(t===Us)return{x:r.x-e[0],y:r.y-e[1],z:r.z-e[2]};if(t===Gs){var n=e[0],s=e[1],u=e[2],g=e[3],h=e[4],b=e[5],T=e[6],C=(r.x-n)/T,P=(r.y-s)/T,R=(r.z-u)/T;return{x:C+b*P-h*R,y:-b*C+P+g*R,z:h*C-g*P+R}}}function Gu(r){return r===Us||r===Gs}function eA(r,t,e){if(YS(r,t)||r.datum_type===up||t.datum_type===up)return e;var n=r.a,s=r.es;if(r.datum_type===zu){var u=Dy(r,!1,e);if(u!==0)return;n=yy,s=vy}var g=t.a,h=t.b,b=t.es;if(t.datum_type===zu&&(g=yy,h=aS,b=vy),s===b&&n===g&&!Gu(r.datum_type)&&!Gu(t.datum_type))return e;if(e=Ry(e,s,n),Gu(r.datum_type)&&(e=JS(e,r.datum_type,r.datum_params)),Gu(t.datum_type)&&(e=QS(e,t.datum_type,t.datum_params)),e=ky(e,b,g,h),t.datum_type===zu){var T=Dy(t,!0,e);if(T!==0)return}return e}function Dy(r,t,e){if(r.grids===null||r.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var n={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},u=[],g=0;g<r.grids.length;g++){var h=r.grids[g];if(u.push(h.name),h.isNull){s=n;break}if(h.grid===null){if(h.mandatory)return console.log("Unable to find mandatory grid '"+h.name+"'"),-1;continue}var b=h.grid.subgrids[0],T=(Math.abs(b.del[1])+Math.abs(b.del[0]))/1e4,C=b.ll[0]-T,P=b.ll[1]-T,R=b.ll[0]+(b.lim[0]-1)*b.del[0]+T,U=b.ll[1]+(b.lim[1]-1)*b.del[1]+T;if(!(P>n.y||C>n.x||U<n.y||R<n.x)&&(s=tA(n,t,b),!isNaN(s.x)))break}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*$n+" "+n.y*$n+" tried: '"+u+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function tA(r,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(r.x))return n;var s={x:r.x,y:r.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=Qe(s.x-Math.PI)+Math.PI;var u=Ly(s,e);if(t){if(isNaN(u.x))return n;u.x=s.x-u.x,u.y=s.y-u.y;var g=9,h=1e-12,b,T;do{if(T=Ly(u,e),isNaN(T.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}b={x:s.x-(T.x+u.x),y:s.y-(T.y+u.y)},u.x+=b.x,u.y+=b.y}while(g--&&Math.abs(b.x)>h&&Math.abs(b.y)>h);if(g<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=Qe(u.x+e.ll[0]),n.y=u.y+e.ll[1]}else isNaN(u.x)||(n.x=r.x+u.x,n.y=r.y+u.y);return n}function Ly(r,t){var e={x:r.x/t.del[0],y:r.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*n.x,y:e.y-1*n.y},u={x:Number.NaN,y:Number.NaN},g;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return u;g=n.y*t.lim[0]+n.x;var h={x:t.cvs[g][0],y:t.cvs[g][1]};g++;var b={x:t.cvs[g][0],y:t.cvs[g][1]};g+=t.lim[0];var T={x:t.cvs[g][0],y:t.cvs[g][1]};g--;var C={x:t.cvs[g][0],y:t.cvs[g][1]},P=s.x*s.y,R=s.x*(1-s.y),U=(1-s.x)*(1-s.y),j=(1-s.x)*s.y;return u.x=U*h.x+R*b.x+j*C.x+P*T.x,u.y=U*h.y+R*b.y+j*C.y+P*T.y,u}function Oy(r,t,e){var n=e.x,s=e.y,u=e.z||0,g,h,b,T={};for(b=0;b<3;b++)if(!(t&&b===2&&e.z===void 0))switch(b===0?(g=n,"ew".indexOf(r.axis[b])!==-1?h="x":h="y"):b===1?(g=s,"ns".indexOf(r.axis[b])!==-1?h="y":h="x"):(g=u,h="z"),r.axis[b]){case"e":T[h]=g;break;case"w":T[h]=-g;break;case"n":T[h]=g;break;case"s":T[h]=-g;break;case"u":e[h]!==void 0&&(T.z=g);break;case"d":e[h]!==void 0&&(T.z=-g);break;default:return null}return T}function zy(r){var t={x:r[0],y:r[1]};return r.length>2&&(t.z=r[2]),r.length>3&&(t.m=r[3]),t}function rA(r){Fy(r.x),Fy(r.y)}function Fy(r){if(typeof Number.isFinite=="function"){if(Number.isFinite(r))return;throw new TypeError("coordinates must be finite numbers")}if(typeof r!="number"||r!==r||!isFinite(r))throw new TypeError("coordinates must be finite numbers")}function iA(r,t){return(r.datum.datum_type===Us||r.datum.datum_type===Gs)&&t.datumCode!=="WGS84"||(t.datum.datum_type===Us||t.datum.datum_type===Gs)&&r.datumCode!=="WGS84"}function Vu(r,t,e,n){var s;if(Array.isArray(e)&&(e=zy(e)),rA(e),r.datum&&t.datum&&iA(r,t)&&(s=new Zn("WGS84"),e=Vu(r,s,e,n),r=s),n&&r.axis!=="enu"&&(e=Oy(r,!1,e)),r.projName==="longlat")e={x:e.x*hi,y:e.y*hi,z:e.z||0};else if(r.to_meter&&(e={x:e.x*r.to_meter,y:e.y*r.to_meter,z:e.z||0}),e=r.inverse(e),!e)return;if(r.from_greenwich&&(e.x+=r.from_greenwich),e=eA(r.datum,t.datum,e),!!e)return t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*$n,y:e.y*$n,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?Oy(t,!0,e):e}var By=Zn("WGS84");function mp(r,t,e,n){var s,u,g;return Array.isArray(e)?(s=Vu(r,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof r.name!="undefined"&&r.name==="geocent"||typeof t.name!="undefined"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.splice(3)):[s.x,s.y,e[2]].concat(e.splice(3)):[s.x,s.y].concat(e.splice(2)):[s.x,s.y]):(u=Vu(r,t,e,n),g=Object.keys(e),g.length===2||g.forEach(function(h){if(typeof r.name!="undefined"&&r.name==="geocent"||typeof t.name!="undefined"&&t.name==="geocent"){if(h==="x"||h==="y"||h==="z")return}else if(h==="x"||h==="y")return;u[h]=e[h]}),u)}function Ny(r){return r instanceof Zn?r:r.oProj?r.oProj:Zn(r)}function on(r,t,e){r=Ny(r);var n=!1,s;return typeof t=="undefined"?(t=r,r=By,n=!0):(typeof t.x!="undefined"||Array.isArray(t))&&(e=t,t=r,r=By,n=!0),t=Ny(t),e?mp(r,t,e):(s={forward:function(u,g){return mp(r,t,u,g)},inverse:function(u,g){return mp(t,r,u,g)}},n&&(s.oProj=t),s)}var Uy=6,Gy="AJSAJS",Vy="AFAFAF",el=65,Gi=73,ln=79,Dh=86,Lh=90,nA={forward:$y,inverse:aA,toPoint:jy};function $y(r,t){return t=t||5,lA(sA({lat:r[1],lon:r[0]}),t)}function aA(r){var t=_p(Xy(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function jy(r){var t=_p(Xy(r.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function gp(r){return r*(Math.PI/180)}function Zy(r){return 180*(r/Math.PI)}function sA(r){var t=r.lat,e=r.lon,n=6378137,s=.00669438,u=.9996,g,h,b,T,C,P,R,U=gp(t),j=gp(e),H,re;re=Math.floor((e+180)/6)+1,e===180&&(re=60),t>=56&&t<64&&e>=3&&e<12&&(re=32),t>=72&&t<84&&(e>=0&&e<9?re=31:e>=9&&e<21?re=33:e>=21&&e<33?re=35:e>=33&&e<42&&(re=37)),g=(re-1)*6-180+3,H=gp(g),h=s/(1-s),b=n/Math.sqrt(1-s*Math.sin(U)*Math.sin(U)),T=Math.tan(U)*Math.tan(U),C=h*Math.cos(U)*Math.cos(U),P=Math.cos(U)*(j-H),R=n*((1-s/4-3*s*s/64-5*s*s*s/256)*U-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*U)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*U)-35*s*s*s/3072*Math.sin(6*U));var ge=u*b*(P+(1-T+C)*P*P*P/6+(5-18*T+T*T+72*C-58*h)*P*P*P*P*P/120)+5e5,ce=u*(R+b*Math.tan(U)*(P*P/2+(5-T+9*C+4*C*C)*P*P*P*P/24+(61-58*T+T*T+600*C-330*h)*P*P*P*P*P*P/720));return t<0&&(ce+=1e7),{northing:Math.round(ce),easting:Math.round(ge),zoneNumber:re,zoneLetter:oA(t)}}function _p(r){var t=r.northing,e=r.easting,n=r.zoneLetter,s=r.zoneNumber;if(s<0||s>60)return null;var u=.9996,g=6378137,h=.00669438,b,T=(1-Math.sqrt(1-h))/(1+Math.sqrt(1-h)),C,P,R,U,j,H,re,ge,ce,be=e-5e5,we=t;n<"N"&&(we-=1e7),re=(s-1)*6-180+3,b=h/(1-h),H=we/u,ge=H/(g*(1-h/4-3*h*h/64-5*h*h*h/256)),ce=ge+(3*T/2-27*T*T*T/32)*Math.sin(2*ge)+(21*T*T/16-55*T*T*T*T/32)*Math.sin(4*ge)+151*T*T*T/96*Math.sin(6*ge),C=g/Math.sqrt(1-h*Math.sin(ce)*Math.sin(ce)),P=Math.tan(ce)*Math.tan(ce),R=b*Math.cos(ce)*Math.cos(ce),U=g*(1-h)/Math.pow(1-h*Math.sin(ce)*Math.sin(ce),1.5),j=be/(C*u);var Ae=ce-C*Math.tan(ce)/U*(j*j/2-(5+3*P+10*R-4*R*R-9*b)*j*j*j*j/24+(61+90*P+298*R+45*P*P-252*b-3*R*R)*j*j*j*j*j*j/720);Ae=Zy(Ae);var De=(j-(1+2*P+R)*j*j*j/6+(5-2*R+28*P-3*R*R+8*b+24*P*P)*j*j*j*j*j/120)/Math.cos(ce);De=re+Zy(De);var it;if(r.accuracy){var ze=_p({northing:r.northing+r.accuracy,easting:r.easting+r.accuracy,zoneLetter:r.zoneLetter,zoneNumber:r.zoneNumber});it={top:ze.lat,right:ze.lon,bottom:Ae,left:De}}else it={lat:Ae,lon:De};return it}function oA(r){var t="Z";return 84>=r&&r>=72?t="X":72>r&&r>=64?t="W":64>r&&r>=56?t="V":56>r&&r>=48?t="U":48>r&&r>=40?t="T":40>r&&r>=32?t="S":32>r&&r>=24?t="R":24>r&&r>=16?t="Q":16>r&&r>=8?t="P":8>r&&r>=0?t="N":0>r&&r>=-8?t="M":-8>r&&r>=-16?t="L":-16>r&&r>=-24?t="K":-24>r&&r>=-32?t="J":-32>r&&r>=-40?t="H":-40>r&&r>=-48?t="G":-48>r&&r>=-56?t="F":-56>r&&r>=-64?t="E":-64>r&&r>=-72?t="D":-72>r&&r>=-80&&(t="C"),t}function lA(r,t){var e="00000"+r.easting,n="00000"+r.northing;return r.zoneNumber+r.zoneLetter+hA(r.easting,r.northing,r.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function hA(r,t,e){var n=qy(e),s=Math.floor(r/1e5),u=Math.floor(t/1e5)%20;return cA(s,u,n)}function qy(r){var t=r%Uy;return t===0&&(t=Uy),t}function cA(r,t,e){var n=e-1,s=Gy.charCodeAt(n),u=Vy.charCodeAt(n),g=s+r-1,h=u+t,b=!1;g>Lh&&(g=g-Lh+el-1,b=!0),(g===Gi||s<Gi&&g>Gi||(g>Gi||s<Gi)&&b)&&g++,(g===ln||s<ln&&g>ln||(g>ln||s<ln)&&b)&&(g++,g===Gi&&g++),g>Lh&&(g=g-Lh+el-1),h>Dh?(h=h-Dh+el-1,b=!0):b=!1,(h===Gi||u<Gi&&h>Gi||(h>Gi||u<Gi)&&b)&&h++,(h===ln||u<ln&&h>ln||(h>ln||u<ln)&&b)&&(h++,h===Gi&&h++),h>Dh&&(h=h-Dh+el-1);var T=String.fromCharCode(g)+String.fromCharCode(h);return T}function Xy(r){if(r&&r.length===0)throw"MGRSPoint coverting from nothing";for(var t=r.length,e=null,n="",s,u=0;!/[A-Z]/.test(s=r.charAt(u));){if(u>=2)throw"MGRSPoint bad conversion from: "+r;n+=s,u++}var g=parseInt(n,10);if(u===0||u+3>t)throw"MGRSPoint bad conversion from: "+r;var h=r.charAt(u++);if(h<="A"||h==="B"||h==="Y"||h>="Z"||h==="I"||h==="O")throw"MGRSPoint zone letter "+h+" not handled: "+r;e=r.substring(u,u+=2);for(var b=qy(g),T=uA(e.charAt(0),b),C=fA(e.charAt(1),b);C<dA(h);)C+=2e6;var P=t-u;if(P%2!=0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+r;var R=P/2,U=0,j=0,H,re,ge,ce,be;return R>0&&(H=1e5/Math.pow(10,R),re=r.substring(u,u+R),U=parseFloat(re)*H,ge=r.substring(u+R),j=parseFloat(ge)*H),ce=U+T,be=j+C,{easting:ce,northing:be,zoneLetter:h,zoneNumber:g,accuracy:H}}function uA(r,t){for(var e=Gy.charCodeAt(t-1),n=1e5,s=!1;e!==r.charCodeAt(0);){if(e++,e===Gi&&e++,e===ln&&e++,e>Lh){if(s)throw"Bad character: "+r;e=el,s=!0}n+=1e5}return n}function fA(r,t){if(r>"V")throw"MGRSPoint given invalid Northing "+r;for(var e=Vy.charCodeAt(t-1),n=0,s=!1;e!==r.charCodeAt(0);){if(e++,e===Gi&&e++,e===ln&&e++,e>Dh){if(s)throw"Bad character: "+r;e=el,s=!0}n+=1e5}return n}function dA(r){var t;switch(r){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+r}function tl(r,t,e){if(!(this instanceof tl))return new tl(r,t,e);if(Array.isArray(r))this.x=r[0],this.y=r[1],this.z=r[2]||0;else if(typeof r=="object")this.x=r.x,this.y=r.y,this.z=r.z||0;else if(typeof r=="string"&&typeof t=="undefined"){var n=r.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=r,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}tl.fromMGRS=function(r){return new tl(jy(r))};tl.prototype.toMGRS=function(r){return $y([this.x,this.y],r)};var pA=1,mA=.25,Ky=.046875,Hy=.01953125,Wy=.01068115234375,gA=.75,_A=.46875,yA=.013020833333333334,vA=.007120768229166667,xA=.3645833333333333,bA=.005696614583333333,wA=.3076171875;function Yy(r){var t=[];t[0]=pA-r*(mA+r*(Ky+r*(Hy+r*Wy))),t[1]=r*(gA-r*(Ky+r*(Hy+r*Wy)));var e=r*r;return t[2]=e*(_A-r*(yA+r*vA)),e*=r,t[3]=e*(xA-r*bA),t[4]=e*r*wA,t}function $u(r,t,e,n){return e*=t,t*=t,n[0]*r-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var EA=20;function Jy(r,t,e){for(var n=1/(1-t),s=r,u=EA;u;--u){var g=Math.sin(s),h=1-t*g*g;if(h=($u(s,g,Math.cos(s),e)-r)*(h*Math.sqrt(h))*n,s-=h,Math.abs(h)<Ke)return s}return s}function TA(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Yy(this.es),this.ml0=$u(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function MA(r){var t=r.x,e=r.y,n=Qe(t-this.long0),s,u,g,h=Math.sin(e),b=Math.cos(e);if(this.es){var C=b*n,P=Math.pow(C,2),R=this.ep2*Math.pow(b,2),U=Math.pow(R,2),j=Math.abs(b)>Ke?Math.tan(e):0,H=Math.pow(j,2),re=Math.pow(H,2);s=1-this.es*Math.pow(h,2),C=C/Math.sqrt(s);var ge=$u(e,h,b,this.en);u=this.a*(this.k0*C*(1+P/6*(1-H+R+P/20*(5-18*H+re+14*R-58*H*R+P/42*(61+179*re-re*H-479*H)))))+this.x0,g=this.a*(this.k0*(ge-this.ml0+h*n*C/2*(1+P/12*(5-H+9*R+4*U+P/30*(61+re-58*H+270*R-330*H*R+P/56*(1385+543*re-re*H-3111*H))))))+this.y0}else{var T=b*Math.sin(n);if(Math.abs(Math.abs(T)-1)<Ke)return 93;if(u=.5*this.a*this.k0*Math.log((1+T)/(1-T))+this.x0,g=b*Math.cos(n)/Math.sqrt(1-Math.pow(T,2)),T=Math.abs(g),T>=1){if(T-1>Ke)return 93;g=0}else g=Math.acos(g);e<0&&(g=-g),g=this.a*this.k0*(g-this.lat0)+this.y0}return r.x=u,r.y=g,r}function SA(r){var t,e,n,s,u=(r.x-this.x0)*(1/this.a),g=(r.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+g/this.k0,e=Jy(t,this.es,this.en),Math.abs(e)<Le){var P=Math.sin(e),R=Math.cos(e),U=Math.abs(R)>Ke?Math.tan(e):0,j=this.ep2*Math.pow(R,2),H=Math.pow(j,2),re=Math.pow(U,2),ge=Math.pow(re,2);t=1-this.es*Math.pow(P,2);var ce=u*Math.sqrt(t)/this.k0,be=Math.pow(ce,2);t=t*U,n=e-t*be/(1-this.es)*.5*(1-be/12*(5+3*re-9*j*re+j-4*H-be/30*(61+90*re-252*j*re+45*ge+46*j-be/56*(1385+3633*re+4095*ge+1574*ge*re)))),s=Qe(this.long0+ce*(1-be/6*(1+2*re+j-be/20*(5+28*re+24*ge+8*j*re+6*j-be/42*(61+662*re+1320*ge+720*ge*re))))/R)}else n=Le*Rh(g),s=0;else{var h=Math.exp(u/this.k0),b=.5*(h-1/h),T=this.lat0+g/this.k0,C=Math.cos(T);t=Math.sqrt((1-Math.pow(C,2))/(1+Math.pow(b,2))),n=Math.asin(t),g<0&&(n=-n),b===0&&C===0?s=0:s=Qe(Math.atan2(b,C)+this.long0)}return r.x=s,r.y=n,r}var AA=["Fast_Transverse_Mercator","Fast Transverse Mercator"],ju={init:TA,forward:MA,inverse:SA,names:AA};function Qy(r){var t=Math.exp(r);return t=(t-1/t)/2,t}function wn(r,t){r=Math.abs(r),t=Math.abs(t);var e=Math.max(r,t),n=Math.min(r,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function CA(r){var t=1+r,e=t-1;return e===0?r:r*Math.log(t)/e}function IA(r){var t=Math.abs(r);return t=CA(t*(1+t/(wn(1,t)+1))),r<0?-t:t}function yp(r,t){for(var e=2*Math.cos(2*t),n=r.length-1,s=r[n],u=0,g;--n>=0;)g=-u+e*s+r[n],u=s,s=g;return t+g*Math.sin(2*t)}function PA(r,t){for(var e=2*Math.cos(t),n=r.length-1,s=r[n],u=0,g;--n>=0;)g=-u+e*s+r[n],u=s,s=g;return Math.sin(t)*g}function RA(r){var t=Math.exp(r);return t=(t+1/t)/2,t}function e0(r,t,e){for(var n=Math.sin(t),s=Math.cos(t),u=Qy(e),g=RA(e),h=2*s*g,b=-2*n*u,T=r.length-1,C=r[T],P=0,R=0,U=0,j,H;--T>=0;)j=R,H=P,R=C,P=U,C=-j+h*R-b*P+r[T],U=-H+b*R+h*P;return h=n*g,b=s*u,[h*C-b*U,h*U+b*C]}function kA(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(ju.init.apply(this),this.forward=ju.forward,this.inverse=ju.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var r=this.es/(1+Math.sqrt(1-this.es)),t=r/(2-r),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=yp(this.cbg,this.lat0);this.Zb=-this.Qn*(n+PA(this.gtu,2*n))}function DA(r){var t=Qe(r.x-this.long0),e=r.y;e=yp(this.cbg,e);var n=Math.sin(e),s=Math.cos(e),u=Math.sin(t),g=Math.cos(t);e=Math.atan2(n,g*s),t=Math.atan2(u*s,wn(n,s*g)),t=IA(Math.tan(t));var h=e0(this.gtu,2*e,2*t);e=e+h[0],t=t+h[1];var b,T;return Math.abs(t)<=2.623395162778?(b=this.a*(this.Qn*t)+this.x0,T=this.a*(this.Qn*e+this.Zb)+this.y0):(b=1/0,T=1/0),r.x=b,r.y=T,r}function LA(r){var t=(r.x-this.x0)*(1/this.a),e=(r.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,s;if(Math.abs(t)<=2.623395162778){var u=e0(this.utg,2*e,2*t);e=e+u[0],t=t+u[1],t=Math.atan(Qy(t));var g=Math.sin(e),h=Math.cos(e),b=Math.sin(t),T=Math.cos(t);e=Math.atan2(g*T,wn(b,T*h)),t=Math.atan2(b,T*h),n=Qe(t+this.long0),s=yp(this.cgb,e)}else n=1/0,s=1/0;return r.x=n,r.y=s,r}var OA=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"],Zu={init:kA,forward:DA,inverse:LA,names:OA};function zA(r,t){if(r===void 0){if(r=Math.floor((Qe(t)+Math.PI)*30/Math.PI)+1,r<0)return 0;if(r>60)return 60}return r}var FA="etmerc";function BA(){var r=zA(this.zone,this.long0);if(r===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(r)-183)*hi,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Zu.init.apply(this),this.forward=Zu.forward,this.inverse=Zu.inverse}var NA=["Universal Transverse Mercator System","utm"],UA={init:BA,names:NA,dependsOn:FA};function vp(r,t){return Math.pow((1-r)/(1+r),t)}var GA=20;function VA(){var r=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*r*r),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(r/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+qt)/(Math.pow(Math.tan(.5*this.lat0+qt),this.C)*vp(this.e*r,this.ratexp))}function $A(r){var t=r.x,e=r.y;return r.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+qt),this.C)*vp(this.e*Math.sin(e),this.ratexp))-Le,r.x=this.C*t,r}function jA(r){for(var t=1e-14,e=r.x/this.C,n=r.y,s=Math.pow(Math.tan(.5*n+qt)/this.K,1/this.C),u=GA;u>0&&(n=2*Math.atan(s*vp(this.e*Math.sin(r.y),-.5*this.e))-Le,!(Math.abs(n-r.y)<t));--u)r.y=n;return u?(r.x=e,r.y=n,r):null}var ZA=["gauss"],xp={init:VA,forward:$A,inverse:jA,names:ZA};function qA(){xp.init.apply(this),!!this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function XA(r){var t,e,n,s;return r.x=Qe(r.x-this.long0),xp.forward.apply(this,[r]),t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),r.x=s*e*Math.sin(r.x),r.y=s*(this.cosc0*t-this.sinc0*e*n),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function KA(r){var t,e,n,s,u;if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,u=Math.sqrt(r.x*r.x+r.y*r.y)){var g=2*Math.atan2(u,this.R2);t=Math.sin(g),e=Math.cos(g),s=Math.asin(e*this.sinc0+r.y*t*this.cosc0/u),n=Math.atan2(r.x*t,u*this.cosc0*e-r.y*this.sinc0*t)}else s=this.phic0,n=0;return r.x=n,r.y=s,xp.inverse.apply(this,[r]),r.x=Qe(r.x+this.long0),r}var HA=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],WA={init:qA,forward:XA,inverse:KA,names:HA};function YA(r,t,e){return t*=e,Math.tan(.5*(Le+r))*Math.pow((1-t)/(1+t),.5*e)}function JA(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ke&&(this.k0=.5*(1+Rh(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Ke&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Ke&&(this.k0=.5*this.cons*jn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/bn(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=jn(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Le,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function QA(r){var t=r.x,e=r.y,n=Math.sin(e),s=Math.cos(e),u,g,h,b,T,C,P=Qe(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=Ke&&Math.abs(e+this.lat0)<=Ke?(r.x=NaN,r.y=NaN,r):this.sphere?(u=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(P)),r.x=this.a*u*s*Math.sin(P)+this.x0,r.y=this.a*u*(this.coslat0*n-this.sinlat0*s*Math.cos(P))+this.y0,r):(g=2*Math.atan(this.ssfn_(e,n,this.e))-Le,b=Math.cos(g),h=Math.sin(g),Math.abs(this.coslat0)<=Ke?(T=bn(this.e,e*this.con,this.con*n),C=2*this.a*this.k0*T/this.cons,r.x=this.x0+C*Math.sin(t-this.long0),r.y=this.y0-this.con*C*Math.cos(t-this.long0),r):(Math.abs(this.sinlat0)<Ke?(u=2*this.a*this.k0/(1+b*Math.cos(P)),r.y=u*h):(u=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*h+this.cosX0*b*Math.cos(P))),r.y=u*(this.cosX0*h-this.sinX0*b*Math.cos(P))+this.y0),r.x=u*b*Math.sin(P)+this.x0,r))}function eC(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,s,u,g=Math.sqrt(r.x*r.x+r.y*r.y);if(this.sphere){var h=2*Math.atan(g/(2*this.a*this.k0));return t=this.long0,e=this.lat0,g<=Ke?(r.x=t,r.y=e,r):(e=Math.asin(Math.cos(h)*this.sinlat0+r.y*Math.sin(h)*this.coslat0/g),Math.abs(this.coslat0)<Ke?this.lat0>0?t=Qe(this.long0+Math.atan2(r.x,-1*r.y)):t=Qe(this.long0+Math.atan2(r.x,r.y)):t=Qe(this.long0+Math.atan2(r.x*Math.sin(h),g*this.coslat0*Math.cos(h)-r.y*this.sinlat0*Math.sin(h))),r.x=t,r.y=e,r)}else if(Math.abs(this.coslat0)<=Ke){if(g<=Ke)return e=this.lat0,t=this.long0,r.x=t,r.y=e,r;r.x*=this.con,r.y*=this.con,n=g*this.cons/(2*this.a*this.k0),e=this.con*kh(this.e,n),t=this.con*Qe(this.con*this.long0+Math.atan2(r.x,-1*r.y))}else s=2*Math.atan(g*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,g<=Ke?u=this.X0:(u=Math.asin(Math.cos(s)*this.sinX0+r.y*Math.sin(s)*this.cosX0/g),t=Qe(this.long0+Math.atan2(r.x*Math.sin(s),g*this.cosX0*Math.cos(s)-r.y*this.sinX0*Math.sin(s)))),e=-1*kh(this.e,Math.tan(.5*(Le+u)));return r.x=t,r.y=e,r}var tC=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],rC={init:JA,forward:QA,inverse:eC,names:tC,ssfn_:YA};function iC(){var r=this.lat0;this.lambda0=this.long0;var t=Math.sin(r),e=this.a,n=this.rf,s=1/n,u=2*s-Math.pow(s,2),g=this.e=Math.sqrt(u);this.R=this.k0*e*Math.sqrt(1-u)/(1-u*Math.pow(t,2)),this.alpha=Math.sqrt(1+u/(1-u)*Math.pow(Math.cos(r),4)),this.b0=Math.asin(t/this.alpha);var h=Math.log(Math.tan(Math.PI/4+this.b0/2)),b=Math.log(Math.tan(Math.PI/4+r/2)),T=Math.log((1+g*t)/(1-g*t));this.K=h-this.alpha*b+this.alpha*g/2*T}function nC(r){var t=Math.log(Math.tan(Math.PI/4-r.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y))),n=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),u=this.alpha*(r.x-this.lambda0),g=Math.atan(Math.sin(u)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(u))),h=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(u));return r.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,r.x=this.R*g+this.x0,r}function aC(r){for(var t=r.x-this.x0,e=r.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),u=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),g=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),h=this.lambda0+g/this.alpha,b=0,T=u,C=-1e3,P=0;Math.abs(T-C)>1e-7;){if(++P>20)return;b=1/this.alpha*(Math.log(Math.tan(Math.PI/4+u/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(T))/2)),C=T,T=2*Math.atan(Math.exp(b))-Math.PI/2}return r.x=h,r.y=T,r}var sC=["somerc"],oC={init:iC,forward:nC,inverse:aC,names:sC},rl=1e-7;function lC(r){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof r.PROJECTION=="object"?Object.keys(r.PROJECTION)[0]:r.PROJECTION;return"no_uoff"in r||"no_off"in r||t.indexOf(e)!==-1}function hC(){var r,t,e,n,s,u,g,h,b,T,C=0,P,R=0,U=0,j=0,H=0,re=0,ge=0;this.no_off=lC(this),this.no_rot="no_rot"in this;var ce=!1;"alpha"in this&&(ce=!0);var be=!1;if("rectified_grid_angle"in this&&(be=!0),ce&&(ge=this.alpha),be&&(C=this.rectified_grid_angle*hi),ce||be)R=this.longc;else if(U=this.long1,H=this.lat1,j=this.long2,re=this.lat2,Math.abs(H-re)<=rl||(r=Math.abs(H))<=rl||Math.abs(r-Le)<=rl||Math.abs(Math.abs(this.lat0)-Le)<=rl||Math.abs(Math.abs(re)-Le)<=rl)throw new Error;var we=1-this.es;t=Math.sqrt(we),Math.abs(this.lat0)>Ke?(h=Math.sin(this.lat0),e=Math.cos(this.lat0),r=1-this.es*h*h,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/we),this.A=this.B*this.k0*t/r,n=this.B*t/(e*Math.sqrt(r)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(bn(this.e,this.lat0,h),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=s=1),ce||be?(ce?(P=Math.asin(Math.sin(ge)/n),be||(C=ge)):(P=C,ge=Math.asin(n*Math.sin(P))),this.lam0=R-Math.asin(.5*(s-1/s)*Math.tan(P))/this.B):(u=Math.pow(bn(this.e,H,Math.sin(H)),this.B),g=Math.pow(bn(this.e,re,Math.sin(re)),this.B),s=this.E/u,b=(g-u)/(g+u),T=this.E*this.E,T=(T-g*u)/(T+g*u),r=U-j,r<-Math.pi?j-=Ih:r>Math.pi&&(j+=Ih),this.lam0=Qe(.5*(U+j)-Math.atan(T*Math.tan(.5*this.B*(U-j))/b)/this.B),P=Math.atan(2*Math.sin(this.B*Qe(U-this.lam0))/(s-1/s)),C=ge=Math.asin(n*Math.sin(P))),this.singam=Math.sin(P),this.cosgam=Math.cos(P),this.sinrot=Math.sin(C),this.cosrot=Math.cos(C),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(ge))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*P,this.v_pole_n=this.ArB*Math.log(Math.tan(qt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(qt+s))}function cC(r){var t={},e,n,s,u,g,h,b,T;if(r.x=r.x-this.lam0,Math.abs(Math.abs(r.y)-Le)>Ke){if(g=this.E/Math.pow(bn(this.e,r.y,Math.sin(r.y)),this.B),h=1/g,e=.5*(g-h),n=.5*(g+h),u=Math.sin(this.B*r.x),s=(e*this.singam-u*this.cosgam)/n,Math.abs(Math.abs(s)-1)<Ke)throw new Error;T=.5*this.ArB*Math.log((1-s)/(1+s)),h=Math.cos(this.B*r.x),Math.abs(h)<rl?b=this.A*r.x:b=this.ArB*Math.atan2(e*this.cosgam+u*this.singam,h)}else T=r.y>0?this.v_pole_n:this.v_pole_s,b=this.ArB*r.y;return this.no_rot?(t.x=b,t.y=T):(b-=this.u_0,t.x=T*this.cosrot+b*this.sinrot,t.y=b*this.cosrot-T*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function uC(r){var t,e,n,s,u,g,h,b={};if(r.x=(r.x-this.x0)*(1/this.a),r.y=(r.y-this.y0)*(1/this.a),this.no_rot?(e=r.y,t=r.x):(e=r.x*this.cosrot-r.y*this.sinrot,t=r.y*this.cosrot+r.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),s=.5*(n-1/n),u=.5*(n+1/n),g=Math.sin(this.BrA*t),h=(g*this.cosgam+s*this.singam)/u,Math.abs(Math.abs(h)-1)<Ke)b.x=0,b.y=h<0?-Le:Le;else{if(b.y=this.E/Math.sqrt((1+h)/(1-h)),b.y=kh(this.e,Math.pow(b.y,1/this.B)),b.y===1/0)throw new Error;b.x=-this.rB*Math.atan2(s*this.cosgam-g*this.singam,Math.cos(this.BrA*t))}return b.x+=this.lam0,b}var fC=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],dC={init:hC,forward:cC,inverse:uC,names:fC};function pC(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Ke)){var r=this.b/this.a;this.e=Math.sqrt(1-r*r);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=jn(this.e,t,e),s=bn(this.e,this.lat1,t),u=Math.sin(this.lat2),g=Math.cos(this.lat2),h=jn(this.e,u,g),b=bn(this.e,this.lat2,u),T=bn(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Ke?this.ns=Math.log(n/h)/Math.log(s/b):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(T,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function mC(r){var t=r.x,e=r.y;Math.abs(2*Math.abs(e)-Math.PI)<=Ke&&(e=Rh(e)*(Le-2*Ke));var n=Math.abs(Math.abs(e)-Le),s,u;if(n>Ke)s=bn(this.e,e,Math.sin(e)),u=this.a*this.f0*Math.pow(s,this.ns);else{if(n=e*this.ns,n<=0)return null;u=0}var g=this.ns*Qe(t-this.long0);return r.x=this.k0*(u*Math.sin(g))+this.x0,r.y=this.k0*(this.rh-u*Math.cos(g))+this.y0,r}function gC(r){var t,e,n,s,u,g=(r.x-this.x0)/this.k0,h=this.rh-(r.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(g*g+h*h),e=1):(t=-Math.sqrt(g*g+h*h),e=-1);var b=0;if(t!==0&&(b=Math.atan2(e*g,e*h)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),s=kh(this.e,n),s===-9999)return null}else s=-Le;return u=Qe(b/this.ns+this.long0),r.x=u,r.y=s,r}var _C=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],yC={init:pC,forward:mC,inverse:gC,names:_C};function vC(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function xC(r){var t,e,n,s,u,g,h,b=r.x,T=r.y,C=Qe(b-this.long0);return t=Math.pow((1+this.e*Math.sin(T))/(1-this.e*Math.sin(T)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(T/2+this.s45),this.alfa)/t)-this.s45),n=-C*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),u=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(s)),g=this.n*u,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),r.y=h*Math.cos(g)/1,r.x=h*Math.sin(g)/1,this.czech||(r.y*=-1,r.x*=-1),r}function bC(r){var t,e,n,s,u,g,h,b,T=r.x;r.x=r.y,r.y=T,this.czech||(r.y*=-1,r.x*=-1),g=Math.sqrt(r.x*r.x+r.y*r.y),u=Math.atan2(r.y,r.x),s=u/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/g,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),e=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(t)),r.x=this.long0-e/this.alfa,h=t,b=0;var C=0;do r.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.e/2))-this.s45),Math.abs(h-r.y)<1e-10&&(b=1),h=r.y,C+=1;while(b===0&&C<15);return C>=15?null:r}var wC=["Krovak","krovak"],EC={init:vC,forward:xC,inverse:bC,names:wC};function zi(r,t,e,n,s){return r*s-t*Math.sin(2*s)+e*Math.sin(4*s)-n*Math.sin(6*s)}function Oh(r){return 1-.25*r*(1+r/16*(3+1.25*r))}function zh(r){return .375*r*(1+.25*r*(1+.46875*r))}function Fh(r){return .05859375*r*r*(1+.75*r)}function Bh(r){return r*r*r*(35/3072)}function il(r,t,e){var n=t*e;return r/Math.sqrt(1-n*n)}function nl(r){return Math.abs(r)<Le?r:r-Rh(r)*Math.PI}function qu(r,t,e,n,s){var u,g;u=r/t;for(var h=0;h<15;h++)if(g=(r-(t*u-e*Math.sin(2*u)+n*Math.sin(4*u)-s*Math.sin(6*u)))/(t-2*e*Math.cos(2*u)+4*n*Math.cos(4*u)-6*s*Math.cos(6*u)),u+=g,Math.abs(g)<=1e-10)return u;return NaN}function TC(){this.sphere||(this.e0=Oh(this.es),this.e1=zh(this.es),this.e2=Fh(this.es),this.e3=Bh(this.es),this.ml0=this.a*zi(this.e0,this.e1,this.e2,this.e3,this.lat0))}function MC(r){var t,e,n=r.x,s=r.y;if(n=Qe(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var u=Math.sin(s),g=Math.cos(s),h=il(this.a,this.e,u),b=Math.tan(s)*Math.tan(s),T=n*Math.cos(s),C=T*T,P=this.es*g*g/(1-this.es),R=this.a*zi(this.e0,this.e1,this.e2,this.e3,s);t=h*T*(1-C*b*(1/6-(8-b+8*P)*C/120)),e=R-this.ml0+h*u/g*C*(.5+(5-b+6*P)*C/24)}return r.x=t+this.x0,r.y=e+this.y0,r}function SC(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,s;if(this.sphere){var u=e+this.lat0;n=Math.asin(Math.sin(u)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(u))}else{var g=this.ml0/this.a+e,h=qu(g,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(h)-Le)<=Ke)return r.x=this.long0,r.y=Le,e<0&&(r.y*=-1),r;var b=il(this.a,this.e,Math.sin(h)),T=b*b*b/this.a/this.a*(1-this.es),C=Math.pow(Math.tan(h),2),P=t*this.a/b,R=P*P;n=h-b*Math.tan(h)/T*P*P*(.5-(1+3*C)*P*P/24),s=P*(1-R*(C/3+(1+3*C)*C*R/15))/Math.cos(h)}return r.x=Qe(s+this.long0),r.y=nl(n),r}var AC=["Cassini","Cassini_Soldner","cass"],CC={init:TC,forward:MC,inverse:SC,names:AC};function Wa(r,t){var e;return r>1e-7?(e=r*t,(1-r*r)*(t/(1-e*e)-.5/r*Math.log((1-e)/(1+e)))):2*t}var IC=1,PC=2,RC=3,kC=4;function DC(){var r=Math.abs(this.lat0);if(Math.abs(r-Le)<Ke?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(r)<Ke?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=Wa(this.e,1),this.mmf=.5/(1-this.es),this.apa=VC(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Wa(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function LC(r){var t,e,n,s,u,g,h,b,T,C,P=r.x,R=r.y;if(P=Qe(P-this.long0),this.sphere){if(u=Math.sin(R),C=Math.cos(R),n=Math.cos(P),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+C*n:1+this.sinph0*u+this.cosph0*C*n,e<=Ke)return null;e=Math.sqrt(2/e),t=e*C*Math.sin(P),e*=this.mode===this.EQUIT?u:this.cosph0*u-this.sinph0*C*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(R+this.lat0)<Ke)return null;e=qt-R*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(P),e*=n}}else{switch(h=0,b=0,T=0,n=Math.cos(P),s=Math.sin(P),u=Math.sin(R),g=Wa(this.e,u),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(h=g/this.qp,b=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:T=1+this.sinb1*h+this.cosb1*b*n;break;case this.EQUIT:T=1+b*n;break;case this.N_POLE:T=Le+R,g=this.qp-g;break;case this.S_POLE:T=R-Le,g=this.qp+g;break}if(Math.abs(T)<Ke)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:T=Math.sqrt(2/T),this.mode===this.OBLIQ?e=this.ymf*T*(this.cosb1*h-this.sinb1*b*n):e=(T=Math.sqrt(2/(1+b*n)))*h*this.ymf,t=this.xmf*T*b*s;break;case this.N_POLE:case this.S_POLE:g>=0?(t=(T=Math.sqrt(g))*s,e=n*(this.mode===this.S_POLE?T:-T)):t=e=0;break}}return r.x=this.a*t+this.x0,r.y=this.a*e+this.y0,r}function OC(r){r.x-=this.x0,r.y-=this.y0;var t=r.x/this.a,e=r.y/this.a,n,s,u,g,h,b,T;if(this.sphere){var C=0,P,R=0;if(P=Math.sqrt(t*t+e*e),s=P*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(R=Math.sin(s),C=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(P)<=Ke?0:Math.asin(e*R/P),t*=R,e=C*P;break;case this.OBLIQ:s=Math.abs(P)<=Ke?this.lat0:Math.asin(C*this.sinph0+e*R*this.cosph0/P),t*=R*this.cosph0,e=(C-Math.sin(s)*this.sinph0)*P;break;case this.N_POLE:e=-e,s=Le-s;break;case this.S_POLE:s-=Le;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(T=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,b=Math.sqrt(t*t+e*e),b<Ke)return r.x=this.long0,r.y=this.lat0,r;g=2*Math.asin(.5*b/this.rq),u=Math.cos(g),t*=g=Math.sin(g),this.mode===this.OBLIQ?(T=u*this.sinb1+e*g*this.cosb1/b,h=this.qp*T,e=b*this.cosb1*u-e*this.sinb1*g):(T=e*g/b,h=this.qp*T,e=b*u)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),h=t*t+e*e,!h)return r.x=this.long0,r.y=this.lat0,r;T=1-h/this.qp,this.mode===this.S_POLE&&(T=-T)}n=Math.atan2(t,e),s=$C(Math.asin(T),this.apa)}return r.x=Qe(this.long0+n),r.y=s,r}var zC=.3333333333333333,FC=.17222222222222222,BC=.10257936507936508,NC=.06388888888888888,UC=.0664021164021164,GC=.016415012942191543;function VC(r){var t,e=[];return e[0]=r*zC,t=r*r,e[0]+=t*FC,e[1]=t*NC,t*=r,e[0]+=t*BC,e[1]+=t*UC,e[2]=t*GC,e}function $C(r,t){var e=r+r;return r+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var jC=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],ZC={init:DC,forward:LC,inverse:OC,names:jC,S_POLE:IC,N_POLE:PC,EQUIT:RC,OBLIQ:kC};function Ya(r){return Math.abs(r)>1&&(r=r>1?1:-1),Math.asin(r)}function qC(){Math.abs(this.lat1+this.lat2)<Ke||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=jn(this.e3,this.sin_po,this.cos_po),this.qs1=Wa(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=jn(this.e3,this.sin_po,this.cos_po),this.qs2=Wa(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Wa(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>Ke?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function XC(r){var t=r.x,e=r.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=Wa(this.e3,this.sin_phi,this.cos_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,u=this.ns0*Qe(t-this.long0),g=s*Math.sin(u)+this.x0,h=this.rh-s*Math.cos(u)+this.y0;return r.x=g,r.y=h,r}function KC(r){var t,e,n,s,u,g;return r.x-=this.x0,r.y=this.rh-r.y+this.y0,this.ns0>=0?(t=Math.sqrt(r.x*r.x+r.y*r.y),n=1):(t=-Math.sqrt(r.x*r.x+r.y*r.y),n=-1),s=0,t!==0&&(s=Math.atan2(n*r.x,n*r.y)),n=t*this.ns0/this.a,this.sphere?g=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,g=this.phi1z(this.e3,e)),u=Qe(s/this.ns0+this.long0),r.x=u,r.y=g,r}function HC(r,t){var e,n,s,u,g,h=Ya(.5*t);if(r<Ke)return h;for(var b=r*r,T=1;T<=25;T++)if(e=Math.sin(h),n=Math.cos(h),s=r*e,u=1-s*s,g=.5*u*u/n*(t/(1-b)-e/u+.5/r*Math.log((1-s)/(1+s))),h=h+g,Math.abs(g)<=1e-7)return h;return null}var WC=["Albers_Conic_Equal_Area","Albers","aea"],YC={init:qC,forward:XC,inverse:KC,names:WC,phi1z:HC};function JC(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function QC(r){var t,e,n,s,u,g,h,b,T=r.x,C=r.y;return n=Qe(T-this.long0),t=Math.sin(C),e=Math.cos(C),s=Math.cos(n),g=this.sin_p14*t+this.cos_p14*e*s,u=1,g>0||Math.abs(g)<=Ke?(h=this.x0+this.a*u*e*Math.sin(n)/g,b=this.y0+this.a*u*(this.cos_p14*t-this.sin_p14*e*s)/g):(h=this.x0+this.infinity_dist*e*Math.sin(n),b=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),r.x=h,r.y=b,r}function eI(r){var t,e,n,s,u,g;return r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,(t=Math.sqrt(r.x*r.x+r.y*r.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),n=Math.cos(s),g=Ya(n*this.sin_p14+r.y*e*this.cos_p14/t),u=Math.atan2(r.x*e,t*this.cos_p14*n-r.y*this.sin_p14*e),u=Qe(this.long0+u)):(g=this.phic0,u=0),r.x=u,r.y=g,r}var tI=["gnom"],rI={init:JC,forward:QC,inverse:eI,names:tI};function iI(r,t){var e=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*Le:Le;for(var n=Math.asin(.5*t),s,u,g,h,b=0;b<30;b++)if(u=Math.sin(n),g=Math.cos(n),h=r*u,s=Math.pow(1-h*h,2)/(2*g)*(t/(1-r*r)-u/(1-h*h)+.5/r*Math.log((1-h)/(1+h))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function nI(){this.sphere||(this.k0=jn(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function aI(r){var t=r.x,e=r.y,n,s,u=Qe(t-this.long0);if(this.sphere)n=this.x0+this.a*u*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var g=Wa(this.e,Math.sin(e));n=this.x0+this.a*this.k0*u,s=this.y0+this.a*g*.5/this.k0}return r.x=n,r.y=s,r}function sI(r){r.x-=this.x0,r.y-=this.y0;var t,e;return this.sphere?(t=Qe(this.long0+r.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(r.y/this.a*Math.cos(this.lat_ts))):(e=iI(this.e,2*r.y*this.k0/this.a),t=Qe(this.long0+r.x/(this.a*this.k0))),r.x=t,r.y=e,r}var oI=["cea"],lI={init:nI,forward:aI,inverse:sI,names:oI};function hI(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function cI(r){var t=r.x,e=r.y,n=Qe(t-this.long0),s=nl(e-this.lat0);return r.x=this.x0+this.a*n*this.rc,r.y=this.y0+this.a*s,r}function uI(r){var t=r.x,e=r.y;return r.x=Qe(this.long0+(t-this.x0)/(this.a*this.rc)),r.y=nl(this.lat0+(e-this.y0)/this.a),r}var fI=["Equirectangular","Equidistant_Cylindrical","eqc"],dI={init:hI,forward:cI,inverse:uI,names:fI},t0=20;function pI(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oh(this.es),this.e1=zh(this.es),this.e2=Fh(this.es),this.e3=Bh(this.es),this.ml0=this.a*zi(this.e0,this.e1,this.e2,this.e3,this.lat0)}function mI(r){var t=r.x,e=r.y,n,s,u,g=Qe(t-this.long0);if(u=g*Math.sin(e),this.sphere)Math.abs(e)<=Ke?(n=this.a*g,s=-1*this.a*this.lat0):(n=this.a*Math.sin(u)/Math.tan(e),s=this.a*(nl(e-this.lat0)+(1-Math.cos(u))/Math.tan(e)));else if(Math.abs(e)<=Ke)n=this.a*g,s=-1*this.ml0;else{var h=il(this.a,this.e,Math.sin(e))/Math.tan(e);n=h*Math.sin(u),s=this.a*zi(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+h*(1-Math.cos(u))}return r.x=n+this.x0,r.y=s+this.y0,r}function gI(r){var t,e,n,s,u,g,h,b,T;if(n=r.x-this.x0,s=r.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=Ke)t=Qe(n/this.a+this.long0),e=0;else{g=this.lat0+s/this.a,h=n*n/this.a/this.a+g*g,b=g;var C;for(u=t0;u;--u)if(C=Math.tan(b),T=-1*(g*(b*C+1)-b-.5*(b*b+h)*C)/((b-g)/C-1),b+=T,Math.abs(T)<=Ke){e=b;break}t=Qe(this.long0+Math.asin(n*Math.tan(b)/this.a)/Math.sin(e))}else if(Math.abs(s+this.ml0)<=Ke)e=0,t=Qe(this.long0+n/this.a);else{g=(this.ml0+s)/this.a,h=n*n/this.a/this.a+g*g,b=g;var P,R,U,j,H;for(u=t0;u;--u)if(H=this.e*Math.sin(b),P=Math.sqrt(1-H*H)*Math.tan(b),R=this.a*zi(this.e0,this.e1,this.e2,this.e3,b),U=this.e0-2*this.e1*Math.cos(2*b)+4*this.e2*Math.cos(4*b)-6*this.e3*Math.cos(6*b),j=R/this.a,T=(g*(P*j+1)-j-.5*P*(j*j+h))/(this.es*Math.sin(2*b)*(j*j+h-2*g*j)/(4*P)+(g-j)*(P*U-2/Math.sin(2*b))-U),b-=T,Math.abs(T)<=Ke){e=b;break}P=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=Qe(this.long0+Math.asin(n*P/this.a)/Math.sin(e))}return r.x=t,r.y=e,r}var _I=["Polyconic","poly"],yI={init:pI,forward:mI,inverse:gI,names:_I};function vI(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function xI(r){var t,e=r.x,n=r.y,s=n-this.lat0,u=e-this.long0,g=s/Ch*1e-5,h=u,b=1,T=0;for(t=1;t<=10;t++)b=b*g,T=T+this.A[t]*b;var C=T,P=h,R=1,U=0,j,H,re=0,ge=0;for(t=1;t<=6;t++)j=R*C-U*P,H=U*C+R*P,R=j,U=H,re=re+this.B_re[t]*R-this.B_im[t]*U,ge=ge+this.B_im[t]*R+this.B_re[t]*U;return r.x=ge*this.a+this.x0,r.y=re*this.a+this.y0,r}function bI(r){var t,e=r.x,n=r.y,s=e-this.x0,u=n-this.y0,g=u/this.a,h=s/this.a,b=1,T=0,C,P,R=0,U=0;for(t=1;t<=6;t++)C=b*g-T*h,P=T*g+b*h,b=C,T=P,R=R+this.C_re[t]*b-this.C_im[t]*T,U=U+this.C_im[t]*b+this.C_re[t]*T;for(var j=0;j<this.iterations;j++){var H=R,re=U,ge,ce,be=g,we=h;for(t=2;t<=6;t++)ge=H*R-re*U,ce=re*R+H*U,H=ge,re=ce,be=be+(t-1)*(this.B_re[t]*H-this.B_im[t]*re),we=we+(t-1)*(this.B_im[t]*H+this.B_re[t]*re);H=1,re=0;var Ae=this.B_re[1],De=this.B_im[1];for(t=2;t<=6;t++)ge=H*R-re*U,ce=re*R+H*U,H=ge,re=ce,Ae=Ae+t*(this.B_re[t]*H-this.B_im[t]*re),De=De+t*(this.B_im[t]*H+this.B_re[t]*re);var it=Ae*Ae+De*De;R=(be*Ae+we*De)/it,U=(we*Ae-be*De)/it}var ze=R,lt=U,ct=1,Rt=0;for(t=1;t<=9;t++)ct=ct*ze,Rt=Rt+this.D[t]*ct;var Bt=this.lat0+Rt*Ch*1e5,Kt=this.long0+lt;return r.x=Kt,r.y=Bt,r}var wI=["New_Zealand_Map_Grid","nzmg"],EI={init:vI,forward:xI,inverse:bI,names:wI};function TI(){}function MI(r){var t=r.x,e=r.y,n=Qe(t-this.long0),s=this.x0+this.a*n,u=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return r.x=s,r.y=u,r}function SI(r){r.x-=this.x0,r.y-=this.y0;var t=Qe(this.long0+r.x/this.a),e=2.5*(Math.atan(Math.exp(.8*r.y/this.a))-Math.PI/4);return r.x=t,r.y=e,r}var AI=["Miller_Cylindrical","mill"],CI={init:TI,forward:MI,inverse:SI,names:AI},II=20;function PI(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Yy(this.es)}function RI(r){var t,e,n=r.x,s=r.y;if(n=Qe(n-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var u=this.n*Math.sin(s),g=II;g;--g){var h=(this.m*s+Math.sin(s)-u)/(this.m+Math.cos(s));if(s-=h,Math.abs(h)<Ke)break}t=this.a*this.C_x*n*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var b=Math.sin(s),T=Math.cos(s);e=this.a*$u(s,b,T,this.en),t=this.a*n*T/Math.sqrt(1-this.es*b*b)}return r.x=t,r.y=e,r}function kI(r){var t,e,n,s;return r.x-=this.x0,n=r.x/this.a,r.y-=this.y0,t=r.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=Ya((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Ya(Math.sin(t)/this.n)),n=Qe(n+this.long0),t=nl(t)):(t=Jy(r.y/this.a,this.es,this.en),s=Math.abs(t),s<Le?(s=Math.sin(t),e=this.long0+r.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),n=Qe(e)):s-Ke<Le&&(n=this.long0)),r.x=n,r.y=t,r}var DI=["Sinusoidal","sinu"],LI={init:PI,forward:RI,inverse:kI,names:DI};function OI(){}function zI(r){for(var t=r.x,e=r.y,n=Qe(t-this.long0),s=e,u=Math.PI*Math.sin(e);;){var g=-(s+Math.sin(s)-u)/(1+Math.cos(s));if(s+=g,Math.abs(g)<Ke)break}s/=2,Math.PI/2-Math.abs(e)<Ke&&(n=0);var h=.900316316158*this.a*n*Math.cos(s)+this.x0,b=1.4142135623731*this.a*Math.sin(s)+this.y0;return r.x=h,r.y=b,r}function FI(r){var t,e;r.x-=this.x0,r.y-=this.y0,e=r.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=Qe(this.long0+r.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return r.x=n,r.y=s,r}var BI=["Mollweide","moll"],NI={init:OI,forward:zI,inverse:FI,names:BI};function UI(){Math.abs(this.lat1+this.lat2)<Ke||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Oh(this.es),this.e1=zh(this.es),this.e2=Fh(this.es),this.e3=Bh(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=jn(this.e,this.sinphi,this.cosphi),this.ml1=zi(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Ke?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=jn(this.e,this.sinphi,this.cosphi),this.ml2=zi(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=zi(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function GI(r){var t=r.x,e=r.y,n;if(this.sphere)n=this.a*(this.g-e);else{var s=zi(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-s)}var u=this.ns*Qe(t-this.long0),g=this.x0+n*Math.sin(u),h=this.y0+this.rh-n*Math.cos(u);return r.x=g,r.y=h,r}function VI(r){r.x-=this.x0,r.y=this.rh-r.y+this.y0;var t,e,n,s;this.ns>=0?(e=Math.sqrt(r.x*r.x+r.y*r.y),t=1):(e=-Math.sqrt(r.x*r.x+r.y*r.y),t=-1);var u=0;if(e!==0&&(u=Math.atan2(t*r.x,t*r.y)),this.sphere)return s=Qe(this.long0+u/this.ns),n=nl(this.g-e/this.a),r.x=s,r.y=n,r;var g=this.g-e/this.a;return n=qu(g,this.e0,this.e1,this.e2,this.e3),s=Qe(this.long0+u/this.ns),r.x=s,r.y=n,r}var $I=["Equidistant_Conic","eqdc"],jI={init:UI,forward:GI,inverse:VI,names:$I};function ZI(){this.R=this.a}function qI(r){var t=r.x,e=r.y,n=Qe(t-this.long0),s,u;Math.abs(e)<=Ke&&(s=this.x0+this.R*n,u=this.y0);var g=Ya(2*Math.abs(e/Math.PI));(Math.abs(n)<=Ke||Math.abs(Math.abs(e)-Le)<=Ke)&&(s=this.x0,e>=0?u=this.y0+Math.PI*this.R*Math.tan(.5*g):u=this.y0+Math.PI*this.R*-Math.tan(.5*g));var h=.5*Math.abs(Math.PI/n-n/Math.PI),b=h*h,T=Math.sin(g),C=Math.cos(g),P=C/(T+C-1),R=P*P,U=P*(2/T-1),j=U*U,H=Math.PI*this.R*(h*(P-j)+Math.sqrt(b*(P-j)*(P-j)-(j+b)*(R-j)))/(j+b);n<0&&(H=-H),s=this.x0+H;var re=b+P;return H=Math.PI*this.R*(U*re-h*Math.sqrt((j+b)*(b+1)-re*re))/(j+b),e>=0?u=this.y0+H:u=this.y0-H,r.x=s,r.y=u,r}function XI(r){var t,e,n,s,u,g,h,b,T,C,P,R,U;return r.x-=this.x0,r.y-=this.y0,P=Math.PI*this.R,n=r.x/P,s=r.y/P,u=n*n+s*s,g=-Math.abs(s)*(1+u),h=g-2*s*s+n*n,b=-2*g+1+2*s*s+u*u,U=s*s/b+(2*h*h*h/b/b/b-9*g*h/b/b)/27,T=(g-h*h/3/b)/b,C=2*Math.sqrt(-T/3),P=3*U/T/C,Math.abs(P)>1&&(P>=0?P=1:P=-1),R=Math.acos(P)/3,r.y>=0?e=(-C*Math.cos(R+Math.PI/3)-h/3/b)*Math.PI:e=-(-C*Math.cos(R+Math.PI/3)-h/3/b)*Math.PI,Math.abs(n)<Ke?t=this.long0:t=Qe(this.long0+Math.PI*(u-1+Math.sqrt(1+2*(n*n-s*s)+u*u))/2/n),r.x=t,r.y=e,r}var KI=["Van_der_Grinten_I","VanDerGrinten","vandg"],HI={init:ZI,forward:qI,inverse:XI,names:KI};function WI(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function YI(r){var t=r.x,e=r.y,n=Math.sin(r.y),s=Math.cos(r.y),u=Qe(t-this.long0),g,h,b,T,C,P,R,U,j,H,re,ge,ce,be,we,Ae,De,it,ze,lt,ct,Rt,Bt;return this.sphere?Math.abs(this.sin_p12-1)<=Ke?(r.x=this.x0+this.a*(Le-e)*Math.sin(u),r.y=this.y0-this.a*(Le-e)*Math.cos(u),r):Math.abs(this.sin_p12+1)<=Ke?(r.x=this.x0+this.a*(Le+e)*Math.sin(u),r.y=this.y0+this.a*(Le+e)*Math.cos(u),r):(it=this.sin_p12*n+this.cos_p12*s*Math.cos(u),Ae=Math.acos(it),De=Ae?Ae/Math.sin(Ae):1,r.x=this.x0+this.a*De*s*Math.sin(u),r.y=this.y0+this.a*De*(this.cos_p12*n-this.sin_p12*s*Math.cos(u)),r):(g=Oh(this.es),h=zh(this.es),b=Fh(this.es),T=Bh(this.es),Math.abs(this.sin_p12-1)<=Ke?(C=this.a*zi(g,h,b,T,Le),P=this.a*zi(g,h,b,T,e),r.x=this.x0+(C-P)*Math.sin(u),r.y=this.y0-(C-P)*Math.cos(u),r):Math.abs(this.sin_p12+1)<=Ke?(C=this.a*zi(g,h,b,T,Le),P=this.a*zi(g,h,b,T,e),r.x=this.x0+(C+P)*Math.sin(u),r.y=this.y0+(C+P)*Math.cos(u),r):(R=n/s,U=il(this.a,this.e,this.sin_p12),j=il(this.a,this.e,n),H=Math.atan((1-this.es)*R+this.es*U*this.sin_p12/(j*s)),re=Math.atan2(Math.sin(u),this.cos_p12*Math.tan(H)-this.sin_p12*Math.cos(u)),re===0?ze=Math.asin(this.cos_p12*Math.sin(H)-this.sin_p12*Math.cos(H)):Math.abs(Math.abs(re)-Math.PI)<=Ke?ze=-Math.asin(this.cos_p12*Math.sin(H)-this.sin_p12*Math.cos(H)):ze=Math.asin(Math.sin(u)*Math.cos(H)/Math.sin(re)),ge=this.e*this.sin_p12/Math.sqrt(1-this.es),ce=this.e*this.cos_p12*Math.cos(re)/Math.sqrt(1-this.es),be=ge*ce,we=ce*ce,lt=ze*ze,ct=lt*ze,Rt=ct*ze,Bt=Rt*ze,Ae=U*ze*(1-lt*we*(1-we)/6+ct/8*be*(1-2*we)+Rt/120*(we*(4-7*we)-3*ge*ge*(1-7*we))-Bt/48*be),r.x=this.x0+Ae*Math.sin(re),r.y=this.y0+Ae*Math.cos(re),r))}function JI(r){r.x-=this.x0,r.y-=this.y0;var t,e,n,s,u,g,h,b,T,C,P,R,U,j,H,re,ge,ce,be,we,Ae,De,it,ze;return this.sphere?(t=Math.sqrt(r.x*r.x+r.y*r.y),t>2*Le*this.a?void 0:(e=t/this.a,n=Math.sin(e),s=Math.cos(e),u=this.long0,Math.abs(t)<=Ke?g=this.lat0:(g=Ya(s*this.sin_p12+r.y*n*this.cos_p12/t),h=Math.abs(this.lat0)-Le,Math.abs(h)<=Ke?this.lat0>=0?u=Qe(this.long0+Math.atan2(r.x,-r.y)):u=Qe(this.long0-Math.atan2(-r.x,r.y)):u=Qe(this.long0+Math.atan2(r.x*n,t*this.cos_p12*s-r.y*this.sin_p12*n))),r.x=u,r.y=g,r)):(b=Oh(this.es),T=zh(this.es),C=Fh(this.es),P=Bh(this.es),Math.abs(this.sin_p12-1)<=Ke?(R=this.a*zi(b,T,C,P,Le),t=Math.sqrt(r.x*r.x+r.y*r.y),U=R-t,g=qu(U/this.a,b,T,C,P),u=Qe(this.long0+Math.atan2(r.x,-1*r.y)),r.x=u,r.y=g,r):Math.abs(this.sin_p12+1)<=Ke?(R=this.a*zi(b,T,C,P,Le),t=Math.sqrt(r.x*r.x+r.y*r.y),U=t-R,g=qu(U/this.a,b,T,C,P),u=Qe(this.long0+Math.atan2(r.x,r.y)),r.x=u,r.y=g,r):(t=Math.sqrt(r.x*r.x+r.y*r.y),re=Math.atan2(r.x,r.y),j=il(this.a,this.e,this.sin_p12),ge=Math.cos(re),ce=this.e*this.cos_p12*ge,be=-ce*ce/(1-this.es),we=3*this.es*(1-be)*this.sin_p12*this.cos_p12*ge/(1-this.es),Ae=t/j,De=Ae-be*(1+be)*Math.pow(Ae,3)/6-we*(1+3*be)*Math.pow(Ae,4)/24,it=1-be*De*De/2-Ae*De*De*De/6,H=Math.asin(this.sin_p12*Math.cos(De)+this.cos_p12*Math.sin(De)*ge),u=Qe(this.long0+Math.asin(Math.sin(re)*Math.sin(De)/Math.cos(H))),ze=Math.sin(H),g=Math.atan2((ze-this.es*it*this.sin_p12)*Math.tan(H),ze*(1-this.es)),r.x=u,r.y=g,r))}var QI=["Azimuthal_Equidistant","aeqd"],eP={init:WI,forward:YI,inverse:JI,names:QI};function tP(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function rP(r){var t,e,n,s,u,g,h,b,T=r.x,C=r.y;return n=Qe(T-this.long0),t=Math.sin(C),e=Math.cos(C),s=Math.cos(n),g=this.sin_p14*t+this.cos_p14*e*s,u=1,(g>0||Math.abs(g)<=Ke)&&(h=this.a*u*e*Math.sin(n),b=this.y0+this.a*u*(this.cos_p14*t-this.sin_p14*e*s)),r.x=h,r.y=b,r}function iP(r){var t,e,n,s,u,g,h;return r.x-=this.x0,r.y-=this.y0,t=Math.sqrt(r.x*r.x+r.y*r.y),e=Ya(t/this.a),n=Math.sin(e),s=Math.cos(e),g=this.long0,Math.abs(t)<=Ke?(h=this.lat0,r.x=g,r.y=h,r):(h=Ya(s*this.sin_p14+r.y*n*this.cos_p14/t),u=Math.abs(this.lat0)-Le,Math.abs(u)<=Ke?(this.lat0>=0?g=Qe(this.long0+Math.atan2(r.x,-r.y)):g=Qe(this.long0-Math.atan2(-r.x,r.y)),r.x=g,r.y=h,r):(g=Qe(this.long0+Math.atan2(r.x*n,t*this.cos_p14*s-r.y*this.sin_p14*n)),r.x=g,r.y=h,r))}var nP=["ortho"],aP={init:tP,forward:rP,inverse:iP,names:nP},wr={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Xt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function sP(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Le-qt/2?this.face=wr.TOP:this.lat0<=-(Le-qt/2)?this.face=wr.BOTTOM:Math.abs(this.long0)<=qt?this.face=wr.FRONT:Math.abs(this.long0)<=Le+qt?this.face=this.long0>0?wr.RIGHT:wr.LEFT:this.face=wr.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function oP(r){var t={x:0,y:0},e,n,s,u,g,h,b={value:0};if(r.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(r.y)):e=r.y,n=r.x,this.face===wr.TOP)u=Le-e,n>=qt&&n<=Le+qt?(b.value=Xt.AREA_0,s=n-Le):n>Le+qt||n<=-(Le+qt)?(b.value=Xt.AREA_1,s=n>0?n-Or:n+Or):n>-(Le+qt)&&n<=-qt?(b.value=Xt.AREA_2,s=n+Le):(b.value=Xt.AREA_3,s=n);else if(this.face===wr.BOTTOM)u=Le+e,n>=qt&&n<=Le+qt?(b.value=Xt.AREA_0,s=-n+Le):n<qt&&n>=-qt?(b.value=Xt.AREA_1,s=-n):n<-qt&&n>=-(Le+qt)?(b.value=Xt.AREA_2,s=-n-Le):(b.value=Xt.AREA_3,s=n>0?-n+Or:-n-Or);else{var T,C,P,R,U,j,H;this.face===wr.RIGHT?n=al(n,+Le):this.face===wr.BACK?n=al(n,+Or):this.face===wr.LEFT&&(n=al(n,-Le)),R=Math.sin(e),U=Math.cos(e),j=Math.sin(n),H=Math.cos(n),T=U*H,C=U*j,P=R,this.face===wr.FRONT?(u=Math.acos(T),s=Xu(u,P,C,b)):this.face===wr.RIGHT?(u=Math.acos(C),s=Xu(u,P,-T,b)):this.face===wr.BACK?(u=Math.acos(-T),s=Xu(u,P,-C,b)):this.face===wr.LEFT?(u=Math.acos(-C),s=Xu(u,P,T,b)):(u=s=0,b.value=Xt.AREA_0)}return h=Math.atan(12/Or*(s+Math.acos(Math.sin(s)*Math.cos(qt))-Le)),g=Math.sqrt((1-Math.cos(u))/(Math.cos(h)*Math.cos(h))/(1-Math.cos(Math.atan(1/Math.cos(s))))),b.value===Xt.AREA_1?h+=Le:b.value===Xt.AREA_2?h+=Or:b.value===Xt.AREA_3&&(h+=1.5*Or),t.x=g*Math.cos(h),t.y=g*Math.sin(h),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,r.x=t.x,r.y=t.y,r}function lP(r){var t={lam:0,phi:0},e,n,s,u,g,h,b,T,C,P={value:0};if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,n=Math.atan(Math.sqrt(r.x*r.x+r.y*r.y)),e=Math.atan2(r.y,r.x),r.x>=0&&r.x>=Math.abs(r.y)?P.value=Xt.AREA_0:r.y>=0&&r.y>=Math.abs(r.x)?(P.value=Xt.AREA_1,e-=Le):r.x<0&&-r.x>=Math.abs(r.y)?(P.value=Xt.AREA_2,e=e<0?e+Or:e-Or):(P.value=Xt.AREA_3,e+=Le),C=Or/12*Math.tan(e),g=Math.sin(C)/(Math.cos(C)-1/Math.sqrt(2)),h=Math.atan(g),s=Math.cos(e),u=Math.tan(n),b=1-s*s*u*u*(1-Math.cos(Math.atan(1/Math.cos(h)))),b<-1?b=-1:b>1&&(b=1),this.face===wr.TOP)T=Math.acos(b),t.phi=Le-T,P.value===Xt.AREA_0?t.lam=h+Le:P.value===Xt.AREA_1?t.lam=h<0?h+Or:h-Or:P.value===Xt.AREA_2?t.lam=h-Le:t.lam=h;else if(this.face===wr.BOTTOM)T=Math.acos(b),t.phi=T-Le,P.value===Xt.AREA_0?t.lam=-h+Le:P.value===Xt.AREA_1?t.lam=-h:P.value===Xt.AREA_2?t.lam=-h-Le:t.lam=h<0?-h-Or:-h+Or;else{var R,U,j;R=b,C=R*R,C>=1?j=0:j=Math.sqrt(1-C)*Math.sin(h),C+=j*j,C>=1?U=0:U=Math.sqrt(1-C),P.value===Xt.AREA_1?(C=U,U=-j,j=C):P.value===Xt.AREA_2?(U=-U,j=-j):P.value===Xt.AREA_3&&(C=U,U=j,j=-C),this.face===wr.RIGHT?(C=R,R=-U,U=C):this.face===wr.BACK?(R=-R,U=-U):this.face===wr.LEFT&&(C=R,R=U,U=-C),t.phi=Math.acos(-j)-Le,t.lam=Math.atan2(U,R),this.face===wr.RIGHT?t.lam=al(t.lam,-Le):this.face===wr.BACK?t.lam=al(t.lam,-Or):this.face===wr.LEFT&&(t.lam=al(t.lam,+Le))}if(this.es!==0){var H,re,ge;H=t.phi<0?1:0,re=Math.tan(t.phi),ge=this.b/Math.sqrt(re*re+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-ge*ge)/(this.one_minus_f*ge)),H&&(t.phi=-t.phi)}return t.lam+=this.long0,r.x=t.lam,r.y=t.phi,r}function Xu(r,t,e,n){var s;return r<Ke?(n.value=Xt.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=qt?n.value=Xt.AREA_0:s>qt&&s<=Le+qt?(n.value=Xt.AREA_1,s-=Le):s>Le+qt||s<=-(Le+qt)?(n.value=Xt.AREA_2,s=s>=0?s-Or:s+Or):(n.value=Xt.AREA_3,s+=Le)),s}function al(r,t){var e=r+t;return e<-Or?e+=Ih:e>+Or&&(e-=Ih),e}var hP=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],cP={init:sP,forward:oP,inverse:lP,names:hP},bp=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Nh=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],r0=.8487,i0=1.3523,n0=$n/5,uP=1/n0,sl=18,Ku=function(r,t){return r[0]+t*(r[1]+t*(r[2]+t*r[3]))},fP=function(r,t){return r[1]+t*(2*r[2]+t*3*r[3])};function dP(r,t,e,n){for(var s=t;n;--n){var u=r(s);if(s-=u,Math.abs(u)<e)break}return s}function pP(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function mP(r){var t=Qe(r.x-this.long0),e=Math.abs(r.y),n=Math.floor(e*n0);n<0?n=0:n>=sl&&(n=sl-1),e=$n*(e-uP*n);var s={x:Ku(bp[n],e)*t,y:Ku(Nh[n],e)};return r.y<0&&(s.y=-s.y),s.x=s.x*this.a*r0+this.x0,s.y=s.y*this.a*i0+this.y0,s}function gP(r){var t={x:(r.x-this.x0)/(this.a*r0),y:Math.abs(r.y-this.y0)/(this.a*i0)};if(t.y>=1)t.x/=bp[sl][0],t.y=r.y<0?-Le:Le;else{var e=Math.floor(t.y*sl);for(e<0?e=0:e>=sl&&(e=sl-1);;)if(Nh[e][0]>t.y)--e;else if(Nh[e+1][0]<=t.y)++e;else break;var n=Nh[e],s=5*(t.y-n[0])/(Nh[e+1][0]-n[0]);s=dP(function(u){return(Ku(n,u)-t.y)/fP(n,u)},s,Ke,100),t.x/=Ku(bp[e],s),t.y=(5*e+s)*hi,r.y<0&&(t.y=-t.y)}return t.x=Qe(t.x+this.long0),t}var _P=["Robinson","robin"],yP={init:pP,forward:mP,inverse:gP,names:_P};function vP(){this.name="geocent"}function xP(r){var t=Ry(r,this.es,this.a);return t}function bP(r){var t=ky(r,this.es,this.a,this.b);return t}var wP=["Geocentric","geocentric","geocent","Geocent"],EP={init:vP,forward:xP,inverse:bP,names:wP},bi={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Uh={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function TP(){if(Object.keys(Uh).forEach(function(e){if(typeof this[e]=="undefined")this[e]=Uh[e].def;else{if(Uh[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Uh[e].num&&(this[e]=parseFloat(this[e]))}Uh[e].degrees&&(this[e]=this[e]*hi)}.bind(this)),Math.abs(Math.abs(this.lat0)-Le)<Ke?this.mode=this.lat0<0?bi.S_POLE:bi.N_POLE:Math.abs(this.lat0)<Ke?this.mode=bi.EQUIT:(this.mode=bi.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var r=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(r),this.sw=Math.sin(r)}function MP(r){r.x-=this.long0;var t=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),s,u;switch(this.mode){case bi.OBLIQ:u=this.sinph0*t+this.cosph0*e*n;break;case bi.EQUIT:u=e*n;break;case bi.S_POLE:u=-t;break;case bi.N_POLE:u=t;break}switch(u=this.pn1/(this.p-u),s=u*e*Math.sin(r.x),this.mode){case bi.OBLIQ:u*=this.cosph0*t-this.sinph0*e*n;break;case bi.EQUIT:u*=t;break;case bi.N_POLE:u*=-(e*n);break;case bi.S_POLE:u*=e*n;break}var g,h;return g=u*this.cg+s*this.sg,h=1/(g*this.sw*this.h1+this.cw),s=(s*this.cg-u*this.sg)*this.cw*h,u=g*h,r.x=s*this.a,r.y=u*this.a,r}function SP(r){r.x/=this.a,r.y/=this.a;var t={x:r.x,y:r.y},e,n,s;s=1/(this.pn1-r.y*this.sw),e=this.pn1*r.x*s,n=this.pn1*r.y*this.cw*s,r.x=e*this.cg+n*this.sg,r.y=n*this.cg-e*this.sg;var u=wn(r.x,r.y);if(Math.abs(u)<Ke)t.x=0,t.y=r.y;else{var g,h;switch(h=1-u*u*this.pfact,h=(this.p-Math.sqrt(h))/(this.pn1/u+u/this.pn1),g=Math.sqrt(1-h*h),this.mode){case bi.OBLIQ:t.y=Math.asin(g*this.sinph0+r.y*h*this.cosph0/u),r.y=(g-this.sinph0*Math.sin(t.y))*u,r.x*=h*this.cosph0;break;case bi.EQUIT:t.y=Math.asin(r.y*h/u),r.y=g*u,r.x*=h;break;case bi.N_POLE:t.y=Math.asin(g),r.y=-r.y;break;case bi.S_POLE:t.y=-Math.asin(g);break}t.x=Math.atan2(r.x,r.y)}return r.x=t.x+this.long0,r.y=t.y,r}var AP=["Tilted_Perspective","tpers"],CP={init:TP,forward:MP,inverse:SP,names:AP};function IP(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var r=1-this.es,t=1/r;this.radius_p=Math.sqrt(r),this.radius_p2=r,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function PP(r){var t=r.x,e=r.y,n,s,u,g;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var h=this.radius_p/wn(this.radius_p*Math.cos(e),Math.sin(e));if(s=h*Math.cos(t)*Math.cos(e),u=h*Math.sin(t)*Math.cos(e),g=h*Math.sin(e),(this.radius_g-s)*s-u*u-g*g*this.radius_p_inv2<0)return r.x=Number.NaN,r.y=Number.NaN,r;n=this.radius_g-s,this.flip_axis?(r.x=this.radius_g_1*Math.atan(u/wn(g,n)),r.y=this.radius_g_1*Math.atan(g/n)):(r.x=this.radius_g_1*Math.atan(u/n),r.y=this.radius_g_1*Math.atan(g/wn(u,n)))}else this.shape==="sphere"&&(n=Math.cos(e),s=Math.cos(t)*n,u=Math.sin(t)*n,g=Math.sin(e),n=this.radius_g-s,this.flip_axis?(r.x=this.radius_g_1*Math.atan(u/wn(g,n)),r.y=this.radius_g_1*Math.atan(g/n)):(r.x=this.radius_g_1*Math.atan(u/n),r.y=this.radius_g_1*Math.atan(g/wn(u,n))));return r.x=r.x*this.a,r.y=r.y*this.a,r}function RP(r){var t=-1,e=0,n=0,s,u,g,h;if(r.x=r.x/this.a,r.y=r.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*wn(1,n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*wn(1,e));var b=n/this.radius_p;if(s=e*e+b*b+t*t,u=2*this.radius_g*t,g=u*u-4*s*this.C,g<0)return r.x=Number.NaN,r.y=Number.NaN,r;h=(-u-Math.sqrt(g))/(2*s),t=this.radius_g+h*t,e*=h,n*=h,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t),r.y=Math.atan(this.radius_p_inv2*Math.tan(r.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+n*n+t*t,u=2*this.radius_g*t,g=u*u-4*s*this.C,g<0)return r.x=Number.NaN,r.y=Number.NaN,r;h=(-u-Math.sqrt(g))/(2*s),t=this.radius_g+h*t,e*=h,n*=h,r.x=Math.atan2(e,t),r.y=Math.atan(n*Math.cos(r.x)/t)}return r.x=r.x+this.long0,r}var kP=["Geostationary Satellite View","Geostationary_Satellite","geos"],DP={init:IP,forward:PP,inverse:RP,names:kP};function LP(r){r.Proj.projections.add(ju),r.Proj.projections.add(Zu),r.Proj.projections.add(UA),r.Proj.projections.add(WA),r.Proj.projections.add(rC),r.Proj.projections.add(oC),r.Proj.projections.add(dC),r.Proj.projections.add(yC),r.Proj.projections.add(EC),r.Proj.projections.add(CC),r.Proj.projections.add(ZC),r.Proj.projections.add(YC),r.Proj.projections.add(rI),r.Proj.projections.add(lI),r.Proj.projections.add(dI),r.Proj.projections.add(yI),r.Proj.projections.add(EI),r.Proj.projections.add(CI),r.Proj.projections.add(LI),r.Proj.projections.add(NI),r.Proj.projections.add(jI),r.Proj.projections.add(HI),r.Proj.projections.add(eP),r.Proj.projections.add(aP),r.Proj.projections.add(cP),r.Proj.projections.add(yP),r.Proj.projections.add(EP),r.Proj.projections.add(CP),r.Proj.projections.add(DP)}on.defaultDatum="WGS84";on.Proj=Zn;on.WGS84=new on.Proj("WGS84");on.Point=tl;on.toPoint=zy;on.defs=Oi;on.nadgrid=VS;on.transform=Vu;on.mgrs=nA;on.version="__VERSION__";LP(on);export{UP as G,FP as L,$P as M,VP as T,Bs as V,GP as a,BP as b,zP as f};
//# sourceMappingURL=vendor.92407124.js.map
